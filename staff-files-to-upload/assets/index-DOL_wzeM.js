const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdf-renderer-vFrxe4Hr.js","assets/react-vendor-C0WT37-r.js","assets/react-router-vendor-BbNHREzj.js"])))=>i.map(i=>d[i]);
import{j as e,d as nl,V as K,S as es,I as cn,T,D as dn,P as un,B as Zs,p as mn,e as xn,f as hn}from"./pdf-renderer-vFrxe4Hr.js";import{a as ol}from"./react-dom-vendor-DvaaoMYK.js";import{r as d,u as vs,R as le,L as Pe,a as tr,b as il,N as pn,B as ll,c as cl,d as $e}from"./react-router-vendor-BbNHREzj.js";import{S as fn,R as gn,b as jn,T as dl,a as ul}from"./radix-base-8sogCZDb.js";import{t as ml,c as xl,a as Os}from"./style-utils-BrjEifj3.js";import{c as hl,_ as pl}from"./supabase-vendor-TBxGvWff.js";import{O as la,q as yn,r as ca,s as sr,T as da,t as ua,p as vn,v as bn,u as St,c as $s,P as Fe,l as ds,b as we,g as Nt,d as Ts,w as fl,x as Nn,y as gl,z as jl,a as wn,D as yl,C as vl,f as bl,i as ar,j as Nl,A as wl,k as Cl,B as Cn,E as _l,G as _n,H as Sn,I as Tn,J as En,K as In,L as Sl,M as Tl,N as El,Q as Il,e as Pl,n as Dl,o as Rl}from"./radix-overlays-DvCfQBqh.js";import{X as Ms,G as kl,C as rr,a as Pn,b as Dn,c as Ge,L as Yt,S as Es,d as ql,e as Dt,f as nr,P as Ht,g as tt,T as Ot,M as zs,h as ma,R as xa,U as ha,i as At,j as Kt,F as mt,D as or,k as Rn,l as kn,m as Al,n as Fl,o as Ll,p as ct,q as Js,r as pa,s as Ol,t as $l,H as fa,B as qn,u as Ml,A as ye,v as ve,w as zl,x as Ul,y as Us,z as Ql,E as Is,I as An,J as $t,K as Fn,N as Ln,O as On,Q as $n,V as Bl,W as Vl,Y as Hl,Z as Kl,_ as ga,$ as Ps,a0 as Lr,a1 as Or,a2 as $r,a3 as Mr,a4 as zr,a5 as ir,a6 as Mt,a7 as Wl,a8 as Ze,a9 as Mn,aa as Vt,ab as Ur,ac as Qr,ad as Br,ae as Ws,af as Gl,ag as Vr,ah as zn,ai as Yl,aj as ns,ak as Xl,al as Qa,am as ja,an as lr,ao as Hr,ap as Zl,aq as Jl,ar as ec,as as tc,at as sc,au as ac,av as rc,aw as ya,ax as Un,ay as Ba,az as Qn,aA as Kr}from"./icons-vendor-DxZtfAkm.js";import{a as nc,c as oc,T as Bn,I as ic,S as Vn,b as Hn,P as lc,C as Kn,V as cc,L as Wn,d as Gn,e as dc,f as uc,g as Yn,R as mc,h as xc,G as hc,i as pc,j as Xn,k as Zn,l as Jn,m as fc,n as eo,o as to,p as gc,q as so,r as ao,s as ro,t as no,v as oo,w as io,x as lo,y as jc,z as yc,A as vc,B as bc,D as co,u as Nc}from"./radix-inputs-CvCyzzxO.js";import{e as ms,g as Wr,i as Gr,N as wc,r as Cc}from"./charts-vendor-B44St8iE.js";import{u as ie,a as fe,b as me,s as _c,Q as Sc,c as Tc}from"./react-query-ZZpjEUTV.js";import{o as Ec,r as Ic,a as Pc,b as Ee,s as z,u as Dc,F as Rc,C as kc,c as Tt,d as bs,e as Lt,n as te,f as va,g as ea,l as ta,h as _s}from"./forms-vendor-BtcwN4Bt.js";import{_ as it}from"./app-utils-DiM5f1d2.js";import{D as qc,f as Wt}from"./date-utils-3Lshzkt4.js";import{u as Ac,f as Yr,g as Fc,a as Lc,b as Oc,c as $c,d as ba}from"./react-table-CN_AjSNs.js";import"./react-vendor-C0WT37-r.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();var Mc=ol();const zc={theme:"system",setTheme:()=>null},uo=d.createContext(zc);function Uc({children:t,defaultTheme:s="system",storageKey:a="vite-ui-theme",...r}){const[n,i]=d.useState(()=>localStorage.getItem(a)||s);d.useEffect(()=>{const l=window.document.documentElement;if(l.classList.remove("light","dark"),n==="system"){const c=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";l.classList.add(c);return}l.classList.add(n)},[n]);const o={theme:n,setTheme:l=>{localStorage.setItem(a,l),i(l)}};return e.jsx(uo.Provider,{...r,value:o,children:t})}const Qc=()=>{const t=d.useContext(uo);if(t===void 0)throw new Error("useTheme must be used within a ThemeProvider");return t};function A(...t){return ml(xl(t))}function Na(t){return t?t.split(" ").map(s=>s[0].toUpperCase()).join(""):"NA"}function os(t){const s=new Date(Date.parse(t)),a={year:"numeric",month:"2-digit",day:"2-digit",timeZone:"UTC"};return s.toLocaleDateString("en-US",a)}function wa(t){if(!t)return t;const s=t.replace(/[^\d]/g,""),a=s.length;return a<4?s:a<7?`(${s.slice(0,3)}) ${s.slice(3)}`:`(${s.slice(0,3)}) ${s.slice(3,6)}-${s.slice(6,10)}`}function pe(t){return t?.toLocaleString("en-US",{minimumIntegerDigits:3,useGrouping:!0})}function se(t){return typeof t!="number"?t?.toLocaleString(void 0,{minimumFractionDigits:2}):(Math.ceil(t*100)/100).toLocaleString(void 0,{minimumFractionDigits:2})}function wt(t){return new Date(Date.parse(t)).toLocaleDateString({},{timeZone:"UTC",month:"long",day:"2-digit",year:"numeric"})}function Bc(t){return new Date(Date.parse(t)).toLocaleDateString("en-US",{timeZone:"America/Chicago",month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})}const Ds=Os("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",primary:"bg-[#2463EB] text-white hover:bg-[#2463EB]/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),j=d.forwardRef(({className:t,variant:s,size:a,asChild:r=!1,...n},i)=>{const o=r?fn:"button";return e.jsx(o,{className:A(Ds({variant:s,size:a,className:t})),ref:i,...n})});j.displayName="Button";var w=hl("","");const mo=d.createContext({session:null,user:null,signOut:()=>{}}),Vc=({children:t})=>{const[s,a]=d.useState(),[r,n]=d.useState(),[i,o]=d.useState(!0),l=async()=>{const{error:u}=await w.auth.signInWithOAuth({provider:"google",options:{scopes:"https://www.googleapis.com/auth/gmail.send https://www.googleapis.com/auth/gmail.readonly",queryParams:{access_type:"offline",prompt:"consent"}}});return u&&console.log(u),{error:u}};d.useEffect(()=>{const u=async()=>{const{data:{session:p},error:g}=await w.auth.getSession();if(g)throw g;n(p),a(p?.user),o(!1)},{data:h}=w.auth.onAuthStateChange((p,g)=>{n(g),a(g?.user),o(!1)});return u(),()=>{h?.subscription.unsubscribe()}},[]);const c={session:r,user:s,signOut:()=>w.auth.signOut(),googleLogin:l};return e.jsx(mo.Provider,{value:c,children:!i&&t})},ts=()=>d.useContext(mo),Hc=1,Kc=1e6;let $a=0;function Wc(){return $a=($a+1)%Number.MAX_VALUE,$a.toString()}const Ma=new Map,Xr=t=>{if(Ma.has(t))return;const s=setTimeout(()=>{Ma.delete(t),Ss({type:"REMOVE_TOAST",toastId:t})},Kc);Ma.set(t,s)},Gc=(t,s)=>{switch(s.type){case"ADD_TOAST":return{...t,toasts:[s.toast,...t.toasts].slice(0,Hc)};case"UPDATE_TOAST":return{...t,toasts:t.toasts.map(a=>a.id===s.toast.id?{...a,...s.toast}:a)};case"DISMISS_TOAST":{const{toastId:a}=s;return a?Xr(a):t.toasts.forEach(r=>{Xr(r.id)}),{...t,toasts:t.toasts.map(r=>r.id===a||a===void 0?{...r,open:!1}:r)}}case"REMOVE_TOAST":return s.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(a=>a.id!==s.toastId)}}},Gs=[];let Ys={toasts:[]};function Ss(t){Ys=Gc(Ys,t),Gs.forEach(s=>{s(Ys)})}function Be({...t}){const s=Wc(),a=n=>Ss({type:"UPDATE_TOAST",toast:{...n,id:s}}),r=()=>Ss({type:"DISMISS_TOAST",toastId:s});return Ss({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:n=>{n||r()}}}),{id:s,dismiss:r,update:a}}function ss(){const[t,s]=d.useState(Ys);return d.useEffect(()=>(Gs.push(s),()=>{const a=Gs.indexOf(s);a>-1&&Gs.splice(a,1)}),[t]),{...t,toast:Be,dismiss:a=>Ss({type:"DISMISS_TOAST",toastId:a})}}function Yc(){const t=vs(),s=ts(),{toast:a}=ss(),r=async n=>{n.preventDefault();const i=await s.googleLogin();i.error?a({variant:"destructive",title:"Uh oh! Something went wrong",description:`${i.error.message}`}):t("/")};return e.jsx("div",{className:"flex flex-col w-full",children:e.jsx("div",{className:"flex justify-center w-screen-xl mx-auto mt-[100px] sm:mt-[180px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-2",children:e.jsx("div",{className:"w-[60px] shadow-md bg-blue-600 rounded-2xl mx-auto mb-4",children:e.jsx("img",{src:"/assets/TRA-logo.png",className:"shadow-xs p-[2px]"})})}),e.jsx("p",{className:"font-[600] text-[30px] mb-2",children:"Log in to your account"}),e.jsx("p",{className:"text-muted-foreground text-[16px] mb-6 font-[400]",children:'Welcome to "The Roofing App" to empower your business. 🚀'}),e.jsx("form",{onSubmit:r,children:e.jsxs(j,{variant:"outline",className:"w-full",type:"submit",children:[e.jsx("img",{src:"/assets/google-icon-144.png",alt:"Google Icon",className:"mr-2 h-4 w-4"})," ","Sign in with Google"]})})]})})})}const Jt=d.forwardRef(({className:t,orientation:s="horizontal",decorative:a=!0,...r},n)=>e.jsx(gn,{ref:n,decorative:a,orientation:s,className:A("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",t),...r}));Jt.displayName=gn.displayName;const De=vn,as=bn,Ke=sr,Xc=yn,xo=d.forwardRef(({className:t,...s},a)=>e.jsx(la,{className:A("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:a}));xo.displayName=la.displayName;const Zc=Os("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),Re=d.forwardRef(({side:t="right",className:s,children:a,...r},n)=>e.jsxs(Xc,{children:[e.jsx(xo,{}),e.jsxs(ca,{ref:n,className:A(Zc({side:t}),s),...r,children:[a,e.jsxs(sr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));Re.displayName=ca.displayName;const ke=({className:t,...s})=>e.jsx("div",{className:A("flex flex-col space-y-2 text-center sm:text-left",t),...s});ke.displayName="SheetHeader";const qt=({className:t,...s})=>e.jsx("div",{className:A("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});qt.displayName="SheetFooter";const qe=d.forwardRef(({className:t,...s},a)=>e.jsx(da,{ref:a,className:A("text-lg font-semibold text-foreground",t),...s}));qe.displayName=da.displayName;const Ct=d.forwardRef(({className:t,...s},a)=>e.jsx(ua,{ref:a,className:A("text-sm text-muted-foreground",t),...s}));Ct.displayName=ua.displayName;function Jc(t,s){return d.useReducer((a,r)=>s[a][r]??a,t)}var cr="ScrollArea",[ho]=$s(cr),[ed,Et]=ho(cr),po=d.forwardRef((t,s)=>{const{__scopeScrollArea:a,type:r="hover",dir:n,scrollHideDelay:i=600,...o}=t,[l,c]=d.useState(null),[u,h]=d.useState(null),[p,g]=d.useState(null),[N,_]=d.useState(null),[m,R]=d.useState(null),[S,E]=d.useState(0),[b,O]=d.useState(0),[F,L]=d.useState(!1),[H,ne]=d.useState(!1),G=St(s,oe=>c(oe)),Z=nc(n);return e.jsx(ed,{scope:a,type:r,dir:Z,scrollHideDelay:i,scrollArea:l,viewport:u,onViewportChange:h,content:p,onContentChange:g,scrollbarX:N,onScrollbarXChange:_,scrollbarXEnabled:F,onScrollbarXEnabledChange:L,scrollbarY:m,onScrollbarYChange:R,scrollbarYEnabled:H,onScrollbarYEnabledChange:ne,onCornerWidthChange:E,onCornerHeightChange:O,children:e.jsx(Fe.div,{dir:Z,...o,ref:G,style:{position:"relative","--radix-scroll-area-corner-width":S+"px","--radix-scroll-area-corner-height":b+"px",...t.style}})})});po.displayName=cr;var fo="ScrollAreaViewport",go=d.forwardRef((t,s)=>{const{__scopeScrollArea:a,children:r,nonce:n,...i}=t,o=Et(fo,a),l=d.useRef(null),c=St(s,l,o.onViewportChange);return e.jsxs(e.Fragment,{children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),e.jsx(Fe.div,{"data-radix-scroll-area-viewport":"",...i,ref:c,style:{overflowX:o.scrollbarXEnabled?"scroll":"hidden",overflowY:o.scrollbarYEnabled?"scroll":"hidden",...t.style},children:e.jsx("div",{ref:o.onContentChange,style:{minWidth:"100%",display:"table"},children:r})})]})});go.displayName=fo;var Ut="ScrollAreaScrollbar",dr=d.forwardRef((t,s)=>{const{forceMount:a,...r}=t,n=Et(Ut,t.__scopeScrollArea),{onScrollbarXEnabledChange:i,onScrollbarYEnabledChange:o}=n,l=t.orientation==="horizontal";return d.useEffect(()=>(l?i(!0):o(!0),()=>{l?i(!1):o(!1)}),[l,i,o]),n.type==="hover"?e.jsx(td,{...r,ref:s,forceMount:a}):n.type==="scroll"?e.jsx(sd,{...r,ref:s,forceMount:a}):n.type==="auto"?e.jsx(jo,{...r,ref:s,forceMount:a}):n.type==="always"?e.jsx(ur,{...r,ref:s}):null});dr.displayName=Ut;var td=d.forwardRef((t,s)=>{const{forceMount:a,...r}=t,n=Et(Ut,t.__scopeScrollArea),[i,o]=d.useState(!1);return d.useEffect(()=>{const l=n.scrollArea;let c=0;if(l){const u=()=>{window.clearTimeout(c),o(!0)},h=()=>{c=window.setTimeout(()=>o(!1),n.scrollHideDelay)};return l.addEventListener("pointerenter",u),l.addEventListener("pointerleave",h),()=>{window.clearTimeout(c),l.removeEventListener("pointerenter",u),l.removeEventListener("pointerleave",h)}}},[n.scrollArea,n.scrollHideDelay]),e.jsx(ds,{present:a||i,children:e.jsx(jo,{"data-state":i?"visible":"hidden",...r,ref:s})})}),sd=d.forwardRef((t,s)=>{const{forceMount:a,...r}=t,n=Et(Ut,t.__scopeScrollArea),i=t.orientation==="horizontal",o=_a(()=>c("SCROLL_END"),100),[l,c]=Jc("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return d.useEffect(()=>{if(l==="idle"){const u=window.setTimeout(()=>c("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(u)}},[l,n.scrollHideDelay,c]),d.useEffect(()=>{const u=n.viewport,h=i?"scrollLeft":"scrollTop";if(u){let p=u[h];const g=()=>{const N=u[h];p!==N&&(c("SCROLL"),o()),p=N};return u.addEventListener("scroll",g),()=>u.removeEventListener("scroll",g)}},[n.viewport,i,c,o]),e.jsx(ds,{present:a||l!=="hidden",children:e.jsx(ur,{"data-state":l==="hidden"?"hidden":"visible",...r,ref:s,onPointerEnter:we(t.onPointerEnter,()=>c("POINTER_ENTER")),onPointerLeave:we(t.onPointerLeave,()=>c("POINTER_LEAVE"))})})}),jo=d.forwardRef((t,s)=>{const a=Et(Ut,t.__scopeScrollArea),{forceMount:r,...n}=t,[i,o]=d.useState(!1),l=t.orientation==="horizontal",c=_a(()=>{if(a.viewport){const u=a.viewport.offsetWidth<a.viewport.scrollWidth,h=a.viewport.offsetHeight<a.viewport.scrollHeight;o(l?u:h)}},10);return xs(a.viewport,c),xs(a.content,c),e.jsx(ds,{present:r||i,children:e.jsx(ur,{"data-state":i?"visible":"hidden",...n,ref:s})})}),ur=d.forwardRef((t,s)=>{const{orientation:a="vertical",...r}=t,n=Et(Ut,t.__scopeScrollArea),i=d.useRef(null),o=d.useRef(0),[l,c]=d.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),u=wo(l.viewport,l.content),h={...r,sizes:l,onSizesChange:c,hasThumb:u>0&&u<1,onThumbChange:g=>i.current=g,onThumbPointerUp:()=>o.current=0,onThumbPointerDown:g=>o.current=g};function p(g,N){return ld(g,o.current,l,N)}return a==="horizontal"?e.jsx(ad,{...h,ref:s,onThumbPositionChange:()=>{if(n.viewport&&i.current){const g=n.viewport.scrollLeft,N=Zr(g,l,n.dir);i.current.style.transform=`translate3d(${N}px, 0, 0)`}},onWheelScroll:g=>{n.viewport&&(n.viewport.scrollLeft=g)},onDragScroll:g=>{n.viewport&&(n.viewport.scrollLeft=p(g,n.dir))}}):a==="vertical"?e.jsx(rd,{...h,ref:s,onThumbPositionChange:()=>{if(n.viewport&&i.current){const g=n.viewport.scrollTop,N=Zr(g,l);i.current.style.transform=`translate3d(0, ${N}px, 0)`}},onWheelScroll:g=>{n.viewport&&(n.viewport.scrollTop=g)},onDragScroll:g=>{n.viewport&&(n.viewport.scrollTop=p(g))}}):null}),ad=d.forwardRef((t,s)=>{const{sizes:a,onSizesChange:r,...n}=t,i=Et(Ut,t.__scopeScrollArea),[o,l]=d.useState(),c=d.useRef(null),u=St(s,c,i.onScrollbarXChange);return d.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),e.jsx(vo,{"data-orientation":"horizontal",...n,ref:u,sizes:a,style:{bottom:0,left:i.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:i.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Ca(a)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.x),onDragScroll:h=>t.onDragScroll(h.x),onWheelScroll:(h,p)=>{if(i.viewport){const g=i.viewport.scrollLeft+h.deltaX;t.onWheelScroll(g),_o(g,p)&&h.preventDefault()}},onResize:()=>{c.current&&i.viewport&&o&&r({content:i.viewport.scrollWidth,viewport:i.viewport.offsetWidth,scrollbar:{size:c.current.clientWidth,paddingStart:aa(o.paddingLeft),paddingEnd:aa(o.paddingRight)}})}})}),rd=d.forwardRef((t,s)=>{const{sizes:a,onSizesChange:r,...n}=t,i=Et(Ut,t.__scopeScrollArea),[o,l]=d.useState(),c=d.useRef(null),u=St(s,c,i.onScrollbarYChange);return d.useEffect(()=>{c.current&&l(getComputedStyle(c.current))},[c]),e.jsx(vo,{"data-orientation":"vertical",...n,ref:u,sizes:a,style:{top:0,right:i.dir==="ltr"?0:void 0,left:i.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Ca(a)+"px",...t.style},onThumbPointerDown:h=>t.onThumbPointerDown(h.y),onDragScroll:h=>t.onDragScroll(h.y),onWheelScroll:(h,p)=>{if(i.viewport){const g=i.viewport.scrollTop+h.deltaY;t.onWheelScroll(g),_o(g,p)&&h.preventDefault()}},onResize:()=>{c.current&&i.viewport&&o&&r({content:i.viewport.scrollHeight,viewport:i.viewport.offsetHeight,scrollbar:{size:c.current.clientHeight,paddingStart:aa(o.paddingTop),paddingEnd:aa(o.paddingBottom)}})}})}),[nd,yo]=ho(Ut),vo=d.forwardRef((t,s)=>{const{__scopeScrollArea:a,sizes:r,hasThumb:n,onThumbChange:i,onThumbPointerUp:o,onThumbPointerDown:l,onThumbPositionChange:c,onDragScroll:u,onWheelScroll:h,onResize:p,...g}=t,N=Et(Ut,a),[_,m]=d.useState(null),R=St(s,G=>m(G)),S=d.useRef(null),E=d.useRef(""),b=N.viewport,O=r.content-r.viewport,F=Nt(h),L=Nt(c),H=_a(p,10);function ne(G){if(S.current){const Z=G.clientX-S.current.left,oe=G.clientY-S.current.top;u({x:Z,y:oe})}}return d.useEffect(()=>{const G=Z=>{const oe=Z.target;_?.contains(oe)&&F(Z,O)};return document.addEventListener("wheel",G,{passive:!1}),()=>document.removeEventListener("wheel",G,{passive:!1})},[b,_,O,F]),d.useEffect(L,[r,L]),xs(_,H),xs(N.content,H),e.jsx(nd,{scope:a,scrollbar:_,hasThumb:n,onThumbChange:Nt(i),onThumbPointerUp:Nt(o),onThumbPositionChange:L,onThumbPointerDown:Nt(l),children:e.jsx(Fe.div,{...g,ref:R,style:{position:"absolute",...g.style},onPointerDown:we(t.onPointerDown,G=>{G.button===0&&(G.target.setPointerCapture(G.pointerId),S.current=_.getBoundingClientRect(),E.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",N.viewport&&(N.viewport.style.scrollBehavior="auto"),ne(G))}),onPointerMove:we(t.onPointerMove,ne),onPointerUp:we(t.onPointerUp,G=>{const Z=G.target;Z.hasPointerCapture(G.pointerId)&&Z.releasePointerCapture(G.pointerId),document.body.style.webkitUserSelect=E.current,N.viewport&&(N.viewport.style.scrollBehavior=""),S.current=null})})})}),sa="ScrollAreaThumb",bo=d.forwardRef((t,s)=>{const{forceMount:a,...r}=t,n=yo(sa,t.__scopeScrollArea);return e.jsx(ds,{present:a||n.hasThumb,children:e.jsx(od,{ref:s,...r})})}),od=d.forwardRef((t,s)=>{const{__scopeScrollArea:a,style:r,...n}=t,i=Et(sa,a),o=yo(sa,a),{onThumbPositionChange:l}=o,c=St(s,p=>o.onThumbChange(p)),u=d.useRef(void 0),h=_a(()=>{u.current&&(u.current(),u.current=void 0)},100);return d.useEffect(()=>{const p=i.viewport;if(p){const g=()=>{if(h(),!u.current){const N=cd(p,l);u.current=N,l()}};return l(),p.addEventListener("scroll",g),()=>p.removeEventListener("scroll",g)}},[i.viewport,h,l]),e.jsx(Fe.div,{"data-state":o.hasThumb?"visible":"hidden",...n,ref:c,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...r},onPointerDownCapture:we(t.onPointerDownCapture,p=>{const N=p.target.getBoundingClientRect(),_=p.clientX-N.left,m=p.clientY-N.top;o.onThumbPointerDown({x:_,y:m})}),onPointerUp:we(t.onPointerUp,o.onThumbPointerUp)})});bo.displayName=sa;var mr="ScrollAreaCorner",No=d.forwardRef((t,s)=>{const a=Et(mr,t.__scopeScrollArea),r=!!(a.scrollbarX&&a.scrollbarY);return a.type!=="scroll"&&r?e.jsx(id,{...t,ref:s}):null});No.displayName=mr;var id=d.forwardRef((t,s)=>{const{__scopeScrollArea:a,...r}=t,n=Et(mr,a),[i,o]=d.useState(0),[l,c]=d.useState(0),u=!!(i&&l);return xs(n.scrollbarX,()=>{const h=n.scrollbarX?.offsetHeight||0;n.onCornerHeightChange(h),c(h)}),xs(n.scrollbarY,()=>{const h=n.scrollbarY?.offsetWidth||0;n.onCornerWidthChange(h),o(h)}),u?e.jsx(Fe.div,{...r,ref:s,style:{width:i,height:l,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...t.style}}):null});function aa(t){return t?parseInt(t,10):0}function wo(t,s){const a=t/s;return isNaN(a)?0:a}function Ca(t){const s=wo(t.viewport,t.content),a=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,r=(t.scrollbar.size-a)*s;return Math.max(r,18)}function ld(t,s,a,r="ltr"){const n=Ca(a),i=n/2,o=s||i,l=n-o,c=a.scrollbar.paddingStart+o,u=a.scrollbar.size-a.scrollbar.paddingEnd-l,h=a.content-a.viewport,p=r==="ltr"?[0,h]:[h*-1,0];return Co([c,u],p)(t)}function Zr(t,s,a="ltr"){const r=Ca(s),n=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,i=s.scrollbar.size-n,o=s.content-s.viewport,l=i-r,c=a==="ltr"?[0,o]:[o*-1,0],u=oc(t,c);return Co([0,o],[0,l])(u)}function Co(t,s){return a=>{if(t[0]===t[1]||s[0]===s[1])return s[0];const r=(s[1]-s[0])/(t[1]-t[0]);return s[0]+r*(a-t[0])}}function _o(t,s){return t>0&&t<s}var cd=(t,s=()=>{})=>{let a={left:t.scrollLeft,top:t.scrollTop},r=0;return(function n(){const i={left:t.scrollLeft,top:t.scrollTop},o=a.left!==i.left,l=a.top!==i.top;(o||l)&&s(),a=i,r=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(r)};function _a(t,s){const a=Nt(t),r=d.useRef(0);return d.useEffect(()=>()=>window.clearTimeout(r.current),[]),d.useCallback(()=>{window.clearTimeout(r.current),r.current=window.setTimeout(a,s)},[a,s])}function xs(t,s){const a=Nt(s);Ts(()=>{let r=0;if(t){const n=new ResizeObserver(()=>{cancelAnimationFrame(r),r=window.requestAnimationFrame(a)});return n.observe(t),()=>{window.cancelAnimationFrame(r),n.unobserve(t)}}},[t,a])}var So=po,dd=go,ud=No;const Je=d.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(So,{ref:r,className:A("relative overflow-hidden",t),...a,children:[e.jsx(dd,{className:"h-full w-full rounded-[inherit]",children:s}),e.jsx(To,{}),e.jsx(ud,{})]}));Je.displayName=So.displayName;const To=d.forwardRef(({className:t,orientation:s="vertical",...a},r)=>e.jsx(dr,{ref:r,orientation:s,className:A("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",t),...a,children:e.jsx(bo,{className:"relative flex-1 rounded-full bg-border"})}));To.displayName=dr.displayName;function Ns({title:t,subheading:s,addItemTextButton:a,sheetTitle:r,sheetDescription:n,sheetContent:i,SheetContentBody:o}){const[l,c]=le.useState(!1);return e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex flex-col w-full justify-between mt-4 md:mt-4 md:flex-row gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[24px] md:text-[24px] font-bold",children:t}),e.jsx("p",{className:"text-[14px] font-[400] text-muted-foreground",children:s})]}),e.jsx("div",{children:e.jsxs(De,{open:l,onOpenChange:c,children:[e.jsx(as,{asChild:!0,children:e.jsxs(j,{variant:"primary",size:"sm",children:[e.jsx(rr,{className:"mr-2 h-4 w-4"}),a]})}),e.jsxs(Re,{className:"w-full sm:max-w-xl px-2",children:[e.jsxs(ke,{className:"px-4 space-y-0",children:[e.jsx(qe,{className:"text-[18px]",children:r}),e.jsx(Ct,{children:n})]}),e.jsx(Je,{className:"w-full h-full pb-8 pt-6",children:e.jsx(o,{setOpen:c})})]})]})})]}),e.jsx("div",{className:"w-full",children:e.jsx(Jt,{className:"mt-2"})})]})}function za(){return ts(),e.jsxs("div",{className:"flex w-full justify-between mt-4 flex-col lg:flex-row gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[24px] font-[600]",children:"Dashboard"}),e.jsx("p",{className:"text-[14px] text-muted-foreground",children:"Welcome! Have a look at the analytics for your business here."})]}),e.jsx("div",{className:"mt-auto",children:e.jsxs(j,{variant:"outline",onClick:()=>window.open("https://github.com/rrios4/roofing-webapp/issues/new","_blank"),children:[e.jsx(kl,{className:"mr-2 h-4 w-4"})," Open issue"]})})]})}function Qs({title:t,subheading:s,showActionButton:a=!0,actionButtonText:r,actionButtonIcon:n=e.jsx(rr,{className:"mr-2 h-4 w-4"}),actionButtonVariant:i="primary",onActionClick:o,useSheet:l=!0,sheetTitle:c,sheetDescription:u,sheetContent:h,SheetContentBody:p,customActions:g,showSeparator:N=!0,headerClassName:_,titleClassName:m,subheadingClassName:R,addItemTextButton:S}){const[E,b]=le.useState(!1),O=r||S||"Add Item",F=()=>{o?o():l&&b(!0)};return e.jsxs("div",{className:`flex flex-col w-full gap-4 ${_||""}`,children:[e.jsxs("div",{className:"flex flex-col w-full justify-between mt-4 md:mt-4 md:flex-row gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-[24px] md:text-[24px] font-bold ${m||""}`,children:t}),s&&e.jsx("p",{className:`text-[14px] font-[400] text-muted-foreground ${R||""}`,children:s})]}),e.jsx("div",{className:"flex gap-2",children:g||a&&(l?e.jsxs(De,{open:E,onOpenChange:b,children:[e.jsx(as,{asChild:!0,children:e.jsxs(j,{variant:i,size:"sm",children:[n,O]})}),e.jsxs(Re,{className:"w-full sm:max-w-xl px-2",children:[e.jsxs(ke,{className:"px-4 space-y-0",children:[e.jsx(qe,{className:"text-[18px]",children:c}),u&&e.jsx(Ct,{children:u})]}),e.jsx(Je,{className:"w-full h-full pb-8 pt-6 px-4",children:p?e.jsx(p,{setOpen:b}):h})]})]}):e.jsxs(j,{variant:i,size:"sm",onClick:F,children:[n,O]}))})]}),N&&e.jsx("div",{className:"w-full",children:e.jsx(Jt,{className:"mt-0"})})]})}const md=Os("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",blue:"border-transparent bg-[#BEE3F8] text-[#2B4365] dark:text-[#90CDF4] dark:bg-[#2D3C4C]/80",green:"border-transparent bg-[#C6F6D5] text-[#21543D] dark:text-[#9AE6B4] dark:bg-[#2E4142]/80",gray:"border-transparent bg-[#EDF2F8] text-[#21543D] dark:text-[#E2E8F0] dark:bg-[#3A404C]/80",yellow:"border-transparent bg-[#FEFCC0] text-[#744210] dark:text-[#FAF08A] dark:bg-[#3F413C]/80",red:"border-transparent bg-[#FED7D7] text-[#822727] dark:text-[#FEB2B2] dark:bg-[#3F3842]/80",orange:""}},defaultVariants:{variant:"default"}});function de({className:t,variant:s,...a}){return e.jsx("div",{className:A(md({variant:s}),t),...a})}const q={CUSTOMER:"customer",CUSTOMER_TYPE:"customer_type",INVOICE:"invoice",INVOICE_LINE_SERVICE:"invoice_line_service",INVOICE_PAYMENT:"invoice_payment",INVOICE_STATUS:"invoice_status",PROJECTS:"projects",QUOTE:"quote",QUOTE_LINE_ITEM:"quote_line_item",QUOTE_REQUEST:"quote_request",QUOTE_REQUEST_STATUS:"quote_request_status",QUOTE_STATUS:"quote_status",SERVICE:"service"},xd=async()=>{const{count:t,error:s}=await w.from(q.QUOTE_REQUEST).select("*",{count:"exact"}).eq("est_request_status_id",1);if(s)throw console.log(s),s;return t},hd=async()=>{const{count:t,error:s}=await w.from(q.QUOTE_REQUEST).select("*",{count:"exact"}).eq("est_request_status_id",2);if(s)throw console.log(s),s;return t},pd=async()=>{const{count:t,error:s}=await w.from(q.QUOTE_REQUEST).select("*",{count:"exact"}).eq("est_request_status_id",4);if(s)throw console.log(s),s;return t},fd=async()=>{const{count:t,error:s}=await w.from(q.CUSTOMER).select("*",{count:"exact"});if(s)throw console.log(s),s;return t},gd=async()=>{const{count:t,error:s}=await w.from(q.CUSTOMER).select("*",{count:"exact"}).eq("customer_type_id",1);if(s)throw console.log(s),s;return t},jd=async()=>{const{count:t,error:s}=await w.from(q.CUSTOMER).select("*",{count:"exact"}).eq("customer_type_id",2);if(s)throw console.log(s),s;return t},yd=async()=>{const{count:t,error:s}=await w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",3);if(s)throw console.log(s),s;return t},vd=async()=>{const{count:t,error:s}=await w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",2);if(s)throw console.log(s),s;return t},bd=async()=>{const{count:t,error:s}=await w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",1);if(s)throw console.log(s),s;return t},Nd=async()=>{const{count:t,error:s}=await w.from(q.QUOTE).select("*",{count:"exact"}).eq("status_id",2);if(s)throw console.log(s),s;return t},wd=async()=>{const{count:t,error:s}=await w.from(q.QUOTE).select("*",{count:"exact"}).eq("status_id",1);if(s)throw console.log(s),s;return t},Cd=async()=>{const{count:t,error:s}=await w.from(q.QUOTE).select("*",{count:"exact"}).eq("status_id",3);if(s)throw console.log(s),s;return t},Eo=()=>{const t=new Date().getFullYear(),s=[];for(let a=4;a>=0;a--)s.push((t-a).toString());return s},_d=async()=>{try{const t=new Date().getFullYear(),s=t-4,a=Eo(),r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],n=r.map(l=>{const c={month:l};return a.forEach(u=>{c[u]=null}),c}),{data:i,error:o}=await w.from(q.INVOICE_PAYMENT).select("amount, date_received").gte("date_received",`${s}-01-01`).lte("date_received",`${t}-12-31`).order("date_received",{ascending:!0});if(o)throw console.error("Error fetching multi-year revenue data:",o),o;return i?(i.forEach(l=>{if(l.date_received&&l.amount){const c=new Date(l.date_received),u=c.getFullYear().toString(),h=c.getMonth(),p=r[h],g=n.find(N=>N.month===p);if(g&&a.includes(u)&&u in g){const N=g[u];N===null?g[u]=l.amount:g[u]=N+l.amount}}}),console.log(`Multi-year revenue data processed for ${a.join(", ")}:`,n),n):(console.log("No payment data found"),n)}catch(t){throw console.error("Error in fetchMultiYearRevenueData:",t),t}},Sd=async()=>{try{const t=new Date,s=t.getFullYear(),a=t.getMonth(),r=new Date(s,a,1),n=new Date(s,a+1,0,23,59,59,999);let i=s,o=a-1;o<0&&(o=11,i=s-1);const l=new Date(i,o,1),c=new Date(i,o+1,0,23,59,59,999),[u,h,p,g,N,_,m,R,S,E,b]=await Promise.all([w.from(q.CUSTOMER).select("*",{count:"exact"}),w.from(q.CUSTOMER).select("*",{count:"exact"}).gte("created_at",r.toISOString()).lte("created_at",n.toISOString()),w.from(q.CUSTOMER).select("*",{count:"exact"}).gte("created_at",l.toISOString()).lte("created_at",c.toISOString()),w.from(q.QUOTE).select("*",{count:"exact"}).eq("status_id",2),w.from(q.QUOTE).select("*",{count:"exact"}).eq("status_id",2).gte("created_at",r.toISOString()).lte("created_at",n.toISOString()),w.from(q.QUOTE).select("*",{count:"exact"}).eq("status_id",2).gte("created_at",l.toISOString()).lte("created_at",c.toISOString()),w.from(q.INVOICE_PAYMENT).select("amount").gte("date_received",r.toISOString().split("T")[0]).lte("date_received",n.toISOString().split("T")[0]),w.from(q.INVOICE_PAYMENT).select("amount").gte("date_received",l.toISOString().split("T")[0]).lte("date_received",c.toISOString().split("T")[0]),w.from(q.QUOTE_REQUEST).select("*",{count:"exact"}).in("est_request_status_id",[1,2]),w.from(q.QUOTE_REQUEST).select("*",{count:"exact"}).gte("created_at",r.toISOString()).lte("created_at",n.toISOString()),w.from(q.QUOTE_REQUEST).select("*",{count:"exact"}).gte("created_at",l.toISOString()).lte("created_at",c.toISOString())]),O=[u,h,p,g,N,_,m,R,S,E,b];for(const C of O)if(C.error)throw console.error("Supabase error:",C.error),C.error;const F=m.data?.reduce((C,W)=>C+(W.amount||0),0)||0,L=R.data?.reduce((C,W)=>C+(W.amount||0),0)||0,H=(C,W)=>W===0?C>0?100:0:(C-W)/W*100,ne=h.count||0,G=p.count||0,Z=N.count||0,oe=_.count||0,v=E.count||0,$=b.count||0;console.log("Dashboard Metrics Debug:",{currentMonthStart:r.toISOString().split("T")[0],currentMonthEnd:n.toISOString().split("T")[0],previousMonthStart:l.toISOString().split("T")[0],previousMonthEnd:c.toISOString().split("T")[0],currentMonthCustomers:ne,previousMonthCustomers:G,currentMonthQuotes:Z,previousMonthQuotes:oe,currentMonthRevenue:`$${F.toLocaleString()}`,previousMonthRevenue:`$${L.toLocaleString()}`,currentMonthLeads:v,previousMonthLeads:$,paymentRecordsCurrentMonth:m.data?.length||0,paymentRecordsPreviousMonth:R.data?.length||0});const x=H(ne,G),y=H(Z,oe),f=H(F,L),M=H(v,$);return{totalCustomers:u.count||0,customerPercentChange:Math.round(x*10)/10,activeQuotes:g.count||0,quotePercentChange:Math.round(y*10)/10,monthlyRevenue:F,revenuePercentChange:Math.round(f*10)/10,pendingLeads:S.count||0,leadPercentChange:Math.round(M*10)/10}}catch(t){throw console.error("Error fetching dashboard metrics:",t),t}},Td=async()=>{try{const[t,s,a,r,n,i]=await Promise.all([w.from(q.QUOTE).select("*",{count:"exact"}).eq("status_id",1),w.from(q.QUOTE).select("*",{count:"exact"}).eq("status_id",2),w.from(q.QUOTE).select("*",{count:"exact"}).eq("status_id",3),w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",1),w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",2),w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",3)]),o=[t,s,a,r,n,i];for(const l of o)if(l.error)throw console.error("Error fetching business status data:",l.error),l.error;return{quoteStatus:{accepted:t.count||0,pending:s.count||0,rejected:a.count||0},invoiceStatus:{paid:r.count||0,pending:n.count||0,overdue:i.count||0},projectStatus:{active:32,onHold:5,completed:89}}}catch(t){throw console.error("Error in fetchBusinessStatusOverview:",t),t}},Ed=async()=>{try{const{data:t,error:s}=await w.from(q.INVOICE).select("*").limit(1);if(s)return console.error("Error fetching sample invoice:",s),await Jr();t&&t.length>0&&console.log("Available invoice columns:",Object.keys(t[0]));const a=["amount","total","invoice_amount","total_amount","grand_total","invoice_total"];let r=null;for(const _ of a)if(t&&t.length>0&&_ in t[0]){r=_,console.log(`Found amount column: ${_}`);break}if(!r)return console.warn("No amount column found, falling back to count-only"),await Jr();const[n,i,o,l]=await Promise.all([w.from(q.INVOICE).select(r).eq("invoice_status_id",1),w.from(q.INVOICE).select(r).eq("invoice_status_id",2),w.from(q.INVOICE).select(r).eq("invoice_status_id",3),w.from(q.INVOICE).select(r).eq("invoice_status_id",4)]),c=[n,i,o,l];for(const _ of c)if(_.error)throw console.error("Error fetching invoice status tracking data:",_.error),_.error;const u=(_,m)=>{const R=_?.length||0,S=_?.reduce((E,b)=>E+(b[m]||0),0)||0;return{count:R,amount:S}},h=u(n.data,r),p=u(i.data,r),g=u(o.data,r),N=u(l.data,r);return console.log("Invoice Status Tracking Debug (Real Data):",{amountColumn:r,paid:`${h.count} invoices, $${h.amount.toLocaleString()}`,pending:`${p.count} invoices, $${p.amount.toLocaleString()}`,overdue:`${g.count} invoices, $${g.amount.toLocaleString()}`,draft:`${N.count} invoices, $${N.amount.toLocaleString()}`}),{paid:{status:"Paid",count:h.count,amount:h.amount},pending:{status:"Pending",count:p.count,amount:p.amount},overdue:{status:"Overdue",count:g.count,amount:g.amount},draft:{status:"Draft",count:N.count,amount:N.amount}}}catch(t){throw console.error("Error in fetchInvoiceStatusTracking:",t),t}},Jr=async()=>{const[t,s,a,r]=await Promise.all([w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",1),w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",2),w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",3),w.from(q.INVOICE).select("*",{count:"exact"}).eq("invoice_status_id",4)]),n=[t,s,a,r];for(const _ of n)if(_.error)throw console.error("Error fetching invoice status tracking data:",_.error),_.error;const i=t.count||0,o=s.count||0,l=a.count||0,c=r.count||0,u=(_,m)=>_*m,h=u(i,4e3),p=u(o,4e3),g=u(l,3500),N=u(c,3e3);return console.log("Invoice Status Tracking Debug (Estimated Data):",{paid:`${i} invoices, $${h.toLocaleString()} (estimated)`,pending:`${o} invoices, $${p.toLocaleString()} (estimated)`,overdue:`${l} invoices, $${g.toLocaleString()} (estimated)`,draft:`${c} invoices, $${N.toLocaleString()} (estimated)`}),{paid:{status:"Paid",count:i,amount:h},pending:{status:"Pending",count:o,amount:p},overdue:{status:"Overdue",count:l,amount:g},draft:{status:"Draft",count:c,amount:N}}},Id=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalNewLeads"],queryFn:async()=>await xd()});return{data:t,isLoading:s,isError:a}},Pd=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalScheduledLeads"],queryFn:async()=>await hd()});return{data:t,isLoading:s,isError:a}},Dd=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalClosedLeads"],queryFn:async()=>await pd()});return{data:t,isLoading:s,isError:a}},Rd=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalCustomers"],queryFn:async()=>await fd()});return{data:t,isLoading:s,isError:a}},kd=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalResidentialCustomers"],queryFn:async()=>await gd()});return{data:t,isLoading:s,isError:a}},qd=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalCommercialCustomers"],queryFn:async()=>await jd()});return{data:t,isLoading:s,isError:a}},Ad=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalOverdueInvoices"],queryFn:async()=>await yd()});return{data:t,isLoading:s,isError:a}},Fd=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalPendingInvoices"],queryFn:async()=>await vd()});return{data:t,isLoading:s,isError:a}},Ld=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalPaidInvoices"],queryFn:async()=>await bd()});return{data:t,isLoading:s,isError:a}},Od=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalPendingQuotes"],queryFn:async()=>await Nd()});return{data:t,isLoading:s,isError:a}},$d=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalAcceptedQuotes"],queryFn:async()=>await wd()});return{data:t,isLoading:s,isError:a}},Md=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["totalRejectedQuotes"],queryFn:async()=>await Cd()});return{data:t,isLoading:s,isError:a}},zd=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["dashboardMetrics"],queryFn:async()=>await Sd(),staleTime:3e5,cacheTime:6e5});return{data:t,isLoading:s,isError:a}},Ud=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["multiYearRevenueData"],queryFn:async()=>await _d(),staleTime:6e5,cacheTime:18e5}),r=Eo();return{data:t,isLoading:s,isError:a,years:r}},Qd=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["businessStatusOverview"],queryFn:async()=>await Td(),staleTime:3e5,cacheTime:6e5});return{data:t,isLoading:s,isError:a}},Bd=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["invoiceStatusTracking"],queryFn:async()=>await Ed(),staleTime:3e5,cacheTime:6e5});return{data:t,isLoading:s,isError:a}},Y=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:A("rounded-lg border bg-card text-card-foreground shadow-sm",t),...s}));Y.displayName="Card";const re=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:A("flex flex-col space-y-1.5 p-6",t),...s}));re.displayName="CardHeader";const ce=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:A("text-2xl font-semibold leading-none tracking-tight",t),...s}));ce.displayName="CardTitle";const rs=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:A("text-sm text-muted-foreground",t),...s}));rs.displayName="CardDescription";const X=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:A("p-6 pt-0",t),...s}));X.displayName="CardContent";const Vd=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{ref:a,className:A("flex items-center p-6 pt-0",t),...s}));Vd.displayName="CardFooter";var Hd=function(t,s){for(var a={};t.length;){var r=t[0],n=r.code,i=r.message,o=r.path.join(".");if(!a[o])if("unionErrors"in r){var l=r.unionErrors[0].errors[0];a[o]={message:l.message,type:l.code}}else a[o]={message:i,type:n};if("unionErrors"in r&&r.unionErrors.forEach(function(h){return h.errors.forEach(function(p){return t.push(p)})}),s){var c=a[o].types,u=c&&c[r.code];a[o]=Pc(o,s,a,n,u?[].concat(u,r.message):r.message)}t.shift()}return a},gt=function(t,s,a){return a===void 0&&(a={}),function(r,n,i){try{return Promise.resolve((function(o,l){try{var c=Promise.resolve(t[a.mode==="sync"?"parse":"parseAsync"](r,s)).then(function(u){return i.shouldUseNativeValidation&&Ec({},i),{errors:{},values:a.raw?r:u}})}catch(u){return l(u)}return c&&c.then?c.then(void 0,l):c})(0,function(o){if((function(l){return Array.isArray(l?.errors)})(o))return{values:{},errors:Ic(Hd(o.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw o}))}catch(o){return Promise.reject(o)}}};const Kd=Ee({first_name:z(),last_name:z(),customer_type:z(),email:z({required_error:"Please type an email to save."}).email(),phone_number:z().min(10).max(14).optional(),street_address:z().optional(),city:z().min(3).max(50),state:z().min(2).max(2),zipcode:z()}),Wd=Ee({id:z(),first_name:z(),last_name:z(),customer_type:z(),email:z({required_error:"Please type an email to save."}).email(),phone_number:z().min(10).max(14),street_address:z(),city:z().min(3).max(50),state:z().min(2).max(2),zipcode:z()});var Gd="Label",Io=d.forwardRef((t,s)=>e.jsx(Fe.label,{...t,ref:s,onMouseDown:a=>{a.target.closest("button, input, select, textarea")||(t.onMouseDown?.(a),!a.defaultPrevented&&a.detail>1&&a.preventDefault())}}));Io.displayName=Gd;var Po=Io;const Yd=Os("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ae=d.forwardRef(({className:t,...s},a)=>e.jsx(Po,{ref:a,className:A(Yd(),t),...s}));ae.displayName=Po.displayName;const It=Rc,Do=d.createContext({}),D=({...t})=>e.jsx(Do.Provider,{value:{name:t.name},children:e.jsx(kc,{...t})}),Sa=()=>{const t=d.useContext(Do),s=d.useContext(Ro),{getFieldState:a,formState:r}=Dc(),n=a(t.name,r);if(!t)throw new Error("useFormField should be used within <FormField>");const{id:i}=s;return{id:i,name:t.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...n}},Ro=d.createContext({}),I=d.forwardRef(({className:t,...s},a)=>{const r=d.useId();return e.jsx(Ro.Provider,{value:{id:r},children:e.jsx("div",{ref:a,className:A("space-y-2",t),...s})})});I.displayName="FormItem";const P=d.forwardRef(({className:t,...s},a)=>{const{error:r,formItemId:n}=Sa();return e.jsx(ae,{ref:a,className:A(r&&"text-destructive",t),htmlFor:n,...s})});P.displayName="FormLabel";const k=d.forwardRef(({...t},s)=>{const{error:a,formItemId:r,formDescriptionId:n,formMessageId:i}=Sa();return e.jsx(fn,{ref:s,id:r,"aria-describedby":a?`${n} ${i}`:`${n}`,"aria-invalid":!!a,...t})});k.displayName="FormControl";const dt=d.forwardRef(({className:t,...s},a)=>{const{formDescriptionId:r}=Sa();return e.jsx("p",{ref:a,id:r,className:A("text-[0.8rem] text-muted-foreground",t),...s})});dt.displayName="FormDescription";const U=d.forwardRef(({className:t,children:s,...a},r)=>{const{error:n,formMessageId:i}=Sa(),o=n?String(n?.message):s;return o?e.jsx("p",{ref:r,id:i,className:A("text-[0.8rem] font-medium text-destructive",t),...a,children:o}):null});U.displayName="FormMessage";const Ce=mc,ko=hc,_e=xc,Ne=d.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(Bn,{ref:r,className:A("flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...a,children:[s,e.jsx(ic,{asChild:!0,children:e.jsx(Pn,{className:"h-4 w-4 opacity-50"})})]}));Ne.displayName=Bn.displayName;const qo=d.forwardRef(({className:t,...s},a)=>e.jsx(Vn,{ref:a,className:A("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Dn,{className:"h-4 w-4"})}));qo.displayName=Vn.displayName;const Ao=d.forwardRef(({className:t,...s},a)=>e.jsx(Hn,{ref:a,className:A("flex cursor-default items-center justify-center py-1",t),...s,children:e.jsx(Pn,{className:"h-4 w-4"})}));Ao.displayName=Hn.displayName;const Ye=d.forwardRef(({className:t,children:s,position:a="popper",...r},n)=>e.jsx(lc,{children:e.jsxs(Kn,{ref:n,className:A("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:a,...r,children:[e.jsx(qo,{}),e.jsx(cc,{className:A("p-1",a==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),e.jsx(Ao,{})]})}));Ye.displayName=Kn.displayName;const xr=d.forwardRef(({className:t,...s},a)=>e.jsx(Wn,{ref:a,className:A("px-2 py-1.5 text-sm font-semibold",t),...s}));xr.displayName=Wn.displayName;const et=d.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(Gn,{ref:r,className:A("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(dc,{children:e.jsx(Ge,{className:"h-4 w-4"})})}),e.jsx(uc,{children:s})]}));et.displayName=Gn.displayName;const Xd=d.forwardRef(({className:t,...s},a)=>e.jsx(Yn,{ref:a,className:A("-mx-1 my-1 h-px bg-muted",t),...s}));Xd.displayName=Yn.displayName;const Fo=async()=>{try{const{data:t,error:s}=await w.from(q.CUSTOMER_TYPE).select("*").order("name",{ascending:!0});return s?(console.error("Error fetching customer types:",s),{data:null,error:`Failed to fetch customer types: ${s.message}`}):{data:t||[],error:null}}catch(t){const s=t instanceof Error?t.message:"Unknown error occurred";return console.error("Error in fetchAllCustomerTypes:",t),{data:null,error:s}}},Zd=async t=>{try{const{data:s}=await w.from(q.CUSTOMER_TYPE).select("id, name").eq("name",t.name.trim()).maybeSingle();if(s)return{data:null,error:`A customer type with the name "${t.name}" already exists`};const a={name:t.name.trim(),description:t.description?.trim()||null},{data:r,error:n}=await w.from(q.CUSTOMER_TYPE).insert(a).select().single();return n?(console.error("Error creating customer type:",n),n.code==="23505"&&n.message.includes("pkey")?{data:null,error:"Database primary key error. Please refresh the page and try again."}:n.code==="23505"?{data:null,error:"A customer type with this name already exists. Please choose a different name."}:{data:null,error:n.message}):{data:r,error:null}}catch(s){const a=s instanceof Error?s.message:"Unknown error occurred";return console.error("Error creating customer type:",s),{data:null,error:a}}},Jd=async t=>{try{const{data:s}=await w.from(q.CUSTOMER_TYPE).select("id, name").eq("name",t.name.trim()).neq("id",t.id).maybeSingle();if(s)return{data:null,error:`A customer type with the name "${t.name}" already exists`};const a={name:t.name.trim(),description:t.description?.trim()||null},{data:r,error:n}=await w.from(q.CUSTOMER_TYPE).update(a).eq("id",t.id).select().single();return n?(console.error("Error updating customer type:",n),n.code==="23505"?{data:null,error:"A customer type with this name already exists. Please choose a different name."}:{data:null,error:n.message}):{data:r,error:null}}catch(s){const a=s instanceof Error?s.message:"Unknown error occurred";return console.error("Error updating customer type:",s),{data:null,error:a}}},eu=async t=>{try{const{count:s}=await w.from(q.CUSTOMER).select("id",{count:"exact",head:!0}).eq("customer_type_id",t);if(s&&s>0)return{success:!1,error:`Cannot delete customer type. It is being used by ${s} customer(s).`};const{error:a}=await w.from(q.CUSTOMER_TYPE).delete().eq("id",t);return a?(console.error("Error deleting customer type:",a),{success:!1,error:a.message}):{success:!0}}catch(s){const a=s instanceof Error?s.message:"Unknown error occurred";return console.error("Error deleting customer type:",s),{success:!1,error:a}}},tu=async t=>{try{const{count:s}=await w.from(q.CUSTOMER).select("id",{count:"exact",head:!0}).eq("customer_type_id",t);return{data:{customerCount:s||0,canDelete:!s||s===0},error:null}}catch(s){const a=s instanceof Error?s.message:"Unknown error occurred";return console.error("Error getting customer type usage:",s),{data:{customerCount:0,canDelete:!0},error:a}}},hr=()=>{const{data:t,isError:s,isLoading:a,error:r}=ie({queryKey:["customerTypes"],queryFn:async()=>{const n=await Fo();if(n.error)throw new Error(n.error);return n.data||[]},staleTime:3e5,retry:2});return{data:t||[],isError:s,isLoading:a,error:r?.message||null}},Q=d.forwardRef(({className:t,type:s,...a},r)=>e.jsx("input",{type:s,className:A("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:r,...a}));Q.displayName="Input";const pr=[{name:"Alabama",abbreviation:"AL"},{name:"Alaska",abbreviation:"AK"},{name:"American Samoa",abbreviation:"AS"},{name:"Arizona",abbreviation:"AZ"},{name:"Arkansas",abbreviation:"AR"},{name:"California",abbreviation:"CA"},{name:"Colorado",abbreviation:"CO"},{name:"Connecticut",abbreviation:"CT"},{name:"Delaware",abbreviation:"DE"},{name:"District Of Columbia",abbreviation:"DC"},{name:"Federated States Of Micronesia",abbreviation:"FM"},{name:"Florida",abbreviation:"FL"},{name:"Georgia",abbreviation:"GA"},{name:"Guam",abbreviation:"GU"},{name:"Hawaii",abbreviation:"HI"},{name:"Idaho",abbreviation:"ID"},{name:"Illinois",abbreviation:"IL"},{name:"Indiana",abbreviation:"IN"},{name:"Iowa",abbreviation:"IA"},{name:"Kansas",abbreviation:"KS"},{name:"Kentucky",abbreviation:"KY"},{name:"Louisiana",abbreviation:"LA"},{name:"Maine",abbreviation:"ME"},{name:"Marshall Islands",abbreviation:"MH"},{name:"Maryland",abbreviation:"MD"},{name:"Massachusetts",abbreviation:"MA"},{name:"Michigan",abbreviation:"MI"},{name:"Minnesota",abbreviation:"MN"},{name:"Mississippi",abbreviation:"MS"},{name:"Missouri",abbreviation:"MO"},{name:"Montana",abbreviation:"MT"},{name:"Nebraska",abbreviation:"NE"},{name:"Nevada",abbreviation:"NV"},{name:"New Hampshire",abbreviation:"NH"},{name:"New Jersey",abbreviation:"NJ"},{name:"New Mexico",abbreviation:"NM"},{name:"New York",abbreviation:"NY"},{name:"North Carolina",abbreviation:"NC"},{name:"North Dakota",abbreviation:"ND"},{name:"Northern Mariana Islands",abbreviation:"MP"},{name:"Ohio",abbreviation:"OH"},{name:"Oklahoma",abbreviation:"OK"},{name:"Oregon",abbreviation:"OR"},{name:"Palau",abbreviation:"PW"},{name:"Pennsylvania",abbreviation:"PA"},{name:"Puerto Rico",abbreviation:"PR"},{name:"Rhode Island",abbreviation:"RI"},{name:"South Carolina",abbreviation:"SC"},{name:"South Dakota",abbreviation:"SD"},{name:"Tennessee",abbreviation:"TN"},{name:"Texas",abbreviation:"TX"},{name:"Utah",abbreviation:"UT"},{name:"Vermont",abbreviation:"VT"},{name:"Virgin Islands",abbreviation:"VI"},{name:"Virginia",abbreviation:"VA"},{name:"Washington",abbreviation:"WA"},{name:"West Virginia",abbreviation:"WV"},{name:"Wisconsin",abbreviation:"WI"},{name:"Wyoming",abbreviation:"WY"}],su=async()=>{const{data:t,error:s}=await w.from(q.CUSTOMER).select(`
      id,
      customer_type_id,
      first_name,
      last_name,
      street_address,
      city,
      state,
      zipcode,
      phone_number,
      email,
      company_name,
      created_at,
      updated_at,
      customer_type (
        id,
        name,
        description,
        created_at,
        updated_at
      )
    `).order("created_at",{ascending:!1});if(s)throw console.log(s),s;return t?.map(r=>({...r,customer_type:Array.isArray(r.customer_type)?r.customer_type[0]:r.customer_type}))},au=async t=>{const{data:s,error:a}=await w.from(q.CUSTOMER).select(`
      id,
      customer_type_id,
      first_name,
      last_name,
      street_address,
      city,
      state,
      zipcode,
      phone_number,
      email,
      company_name,
      created_at,
      updated_at,
      customer_type (
        id,
        name,
        description,
        created_at,
        updated_at
      )
    `).eq("id",t).single();if(a)throw console.log(a),a;return{...s,customer_type:Array.isArray(s.customer_type)?s.customer_type[0]:s.customer_type}},ru=async t=>{const{data:s,error:a}=await w.from(q.INVOICE).select(`
      *,
      customer (
        id,
        first_name,
        last_name,
        email,
        phone_number
      ),
      invoice_status (
        id,
        name,
        description,
        created_at,
        updated_at
      ),
      service (
        id,
        name,
        description,
        default_price,
        created_at,
        updated_at
      )
    `).eq("customer_id",t);if(a)throw console.log(a),a;return s},nu=async t=>{const{data:s,error:a}=await w.from(q.QUOTE).select(`
      *,
      customer (
        id,
        first_name,
        last_name,
        email,
        phone_number
      ),
      quote_status (
        id,
        name,
        description,
        created_at,
        updated_at
      ),
      service (
        id,
        name,
        description,
        default_price,
        created_at,
        updated_at
      )
    `).eq("customer_id",t);if(a)throw console.log(a),a;return s},ou=async t=>{const{error:s}=await w.from(q.CUSTOMER).delete().eq("id",t);if(s)throw s},iu=async t=>{const{data:s,error:a}=await w.from(q.CUSTOMER).insert(t).select().single();if(a)throw a;return s},lu=async t=>{const{data:s,error:a}=await w.from(q.CUSTOMER).update(t).eq("id",t.id).select().single();if(a)throw a;return s},Bs=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["customers"],queryFn:()=>su()});return{customers:t,isLoading:s,isError:a}},cu=t=>{const{data:s,isLoading:a,isError:r}=ie({queryKey:["fetchCustomerById",t],queryFn:async()=>await au(t)});return{customerById:s,isLoading:a,isError:r}},du=t=>{const{data:s,isLoading:a,isError:r}=ie({queryKey:["fetchCustomerInvoices",t],queryFn:()=>ru(t)});return{customerInvoices:s,isLoading:a,isError:r}},uu=t=>{const{data:s,isLoading:a,isError:r}=ie({queryKey:["fetchCustomerQuotes",t],queryFn:()=>nu(t)});return{customerQuotes:s,isLoading:a,isError:r}},mu=t=>{const s=vs(),a=fe();return me(r=>ou(r),{onError:r=>{t({position:"top",title:"Error Deleting Customer!",description:`Message: ${r.details}`,status:"error",duration:5e3,isClosable:!0})},onSuccess:()=>{a.invalidateQueries({queryKey:["customers"]}),s("/customers"),t({position:"top",title:"Customer deleted!",description:"We've deleted customer and associated data pertaining to that customer for you 🎉.",status:"success",duration:5e3,isClosable:!0})}})},xu=(t,s)=>{const a=fe();return me(r=>iu(r),{onError:r=>{t({variant:"destructive",title:"Uh oh! Something went wrong.",description:e.jsx("p",{children:"There was a problem with adding new customer to our system"})}),s(!0)},onSuccess:()=>{a.invalidateQueries({queryKey:["customers"]}),s(!1),t({variant:"success",title:"Added customer successfully! 🎉",description:e.jsx("p",{children:"Successfully added new customer to our system."})})}})},hu=(t,s)=>{const a=fe();return me(async r=>await lu(r),{onError:r=>{console.error("Error updating customer",r),t({variant:"destructive",title:"Uh oh! Something went wrong.",description:e.jsx("p",{children:"There was a problem with adding new customer to our system"})})},onSuccess:async()=>{a.invalidateQueries({queryKey:["fetchCustomerById",s]}),t({variant:"success",title:"Added customer successfully! 🎉",description:e.jsx("p",{children:"Successfully updated customer info in our system."})})}})};function Ve({data:t,valueKey:s="id",labelKey:a="name",emptyMessage:r="No items available ❌",disabled:n=!1}){return e.jsx(Ye,{children:t&&t.length>0?t.map((i,o)=>{const l=i[s],c=i[a],u=l!=null&&l!==""?String(l):`fallback_${o}`;return e.jsx(le.Fragment,{children:e.jsx(et,{value:u,className:"hover:cursor-pointer",disabled:n,children:String(c||"")})},`${o}_${u}`)}):e.jsx(et,{value:"no_items_available",disabled:!0,children:r})})}function pu({variant:t}){return e.jsxs(j,{disabled:!0,variant:t,children:[e.jsx(Yt,{className:"mr-2 h-4 w-4 animate-spi"}),"Please wait"]})}function hs({setOpen:t}){const{data:s,isLoading:a,error:r}=hr(),{mutate:n,isLoading:i}=xu(Be,t);le.useEffect(()=>{console.log("Customer Types Data:",s),console.log("Customer Types Loading:",a),console.log("Customer Types Error:",r)},[s,a,r]);const o=Tt({resolver:gt(Kd),defaultValues:{first_name:"",last_name:"",email:"",phone_number:"",street_address:"",customer_type:"1",city:"",zipcode:""}});function l(c){const u={first_name:c.first_name,last_name:c.last_name,customer_type_id:c.customer_type,email:c.email,phone_number:c.phone_number===void 0?"":c.phone_number,street_address:c.street_address===void 0?"":c.street_address,city:c.city,state:c.state,zipcode:c.zipcode};n(u)}return e.jsx("div",{className:"w-full mb-4",children:e.jsx(It,{...o,children:e.jsx("form",{onSubmit:o.handleSubmit(l),children:e.jsxs("div",{className:"space-y-4 h-full px-4 pb-6",children:[e.jsx(D,{control:o.control,name:"customer_type",render:({field:c})=>e.jsxs(I,{children:[e.jsx(P,{children:"Customer Type"}),e.jsxs(Ce,{onValueChange:c.onChange,defaultValue:c.value,disabled:a,children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:a?"Loading customer types...":r?"Error loading customer types":"Select the type of customer"})})}),e.jsx(Ve,{data:s,valueKey:"id",labelKey:"name",emptyMessage:r?`Error: ${r}`:"No customer types available"})]}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:o.control,name:"first_name",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"First Name"}),e.jsx(k,{children:e.jsx(Q,{...c,className:"w-full"})}),e.jsx(U,{})]})}),e.jsx(D,{control:o.control,name:"last_name",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Last Name"}),e.jsx(k,{children:e.jsx(Q,{...c})})]})})]}),e.jsx(D,{control:o.control,name:"email",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Email"}),e.jsx(k,{children:e.jsx(Q,{...c,type:"email",className:"w-full"})}),e.jsx(U,{})]})}),e.jsx(D,{control:o.control,name:"phone_number",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Phone Number"}),e.jsx(k,{children:e.jsx(Q,{...c,type:"tel",className:"w-full",onChange:u=>c.onChange(wa(u.target.value))})}),e.jsx(U,{})]})}),e.jsx(D,{control:o.control,name:"street_address",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Street Address"}),e.jsx(k,{children:e.jsx(Q,{...c,className:"w-full"})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:o.control,name:"city",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"City"}),e.jsx(k,{children:e.jsx(Q,{...c,className:"w-full"})}),e.jsx(U,{})]})}),e.jsx(D,{control:o.control,name:"state",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"State"}),e.jsxs(Ce,{onValueChange:c.onChange,defaultValue:c.value,children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select US state"})})}),e.jsx(Ve,{data:pr||[],valueKey:"abbreviation",labelKey:"name"})]}),e.jsx(U,{})]})})]}),e.jsx(D,{control:o.control,name:"zipcode",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Zipcode"}),e.jsx(k,{children:e.jsx(Q,{...c,type:"numeric",pattern:"[0-9]*",inputMode:"numeric"})})]})}),e.jsxs(qt,{className:"pt-8 gap-2",children:[e.jsx(Ke,{asChild:!0,children:e.jsx(j,{variant:"secondary",children:"Cancel"})}),i?e.jsx(pu,{variant:"primary"}):e.jsx(j,{variant:"primary",type:"submit",children:"Save changes"})]})]})})})})}const fu=Ee({quote_number:te().min(1,"Invoice number is required"),customer_id:te(),service_id:te(),status_id:te(),quote_date:Lt(),expiration_date:Lt(),public_note:z().optional(),private_note:z().optional(),measurement_note:z().optional(),line_items:bs(Ee({description:z().min(1,"Description is required"),qty:te().min(1,"Quantity must be at least 1"),amount:te().positive(),subtotal:te().positive()})).min(1,"At least one line item is required.").optional(),custom_street_address:z().optional(),custom_city:z().optional(),custom_state:z().optional(),custom_zipcode:z().optional()}),gu=Ee({id:te(),quote_number:te().min(1,"Quote number is required"),customer_id:te(),service_id:te(),status_id:te(),quote_date:Lt(),expiration_date:Lt(),public_note:z().optional(),private_note:z().optional(),measurement_note:z().optional(),line_items:bs(Ee({id:te().optional(),description:z().min(1,"Description is required"),qty:te().min(1,"Quantity must be at least 1"),amount:te().positive(),subtotal:te().positive()})).min(1,"At least one line item is required.").optional(),custom_street_address:z().optional(),custom_city:z().optional(),custom_state:z().optional(),custom_zipcode:z().optional()}),xt=gl,ht=jl,st=d.forwardRef(({className:t,align:s="center",sideOffset:a=4,...r},n)=>e.jsx(fl,{children:e.jsx(Nn,{ref:n,align:s,sideOffset:a,className:A("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));st.displayName=Nn.displayName;const pt=vn,ws=bn,ju=yn,Lo=d.forwardRef(({className:t,...s},a)=>e.jsx(la,{ref:a,className:A("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s}));Lo.displayName=la.displayName;const at=d.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(ju,{children:[e.jsx(Lo,{}),e.jsxs(ca,{ref:r,className:A("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...a,children:[s,e.jsxs(sr,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(Ms,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));at.displayName=ca.displayName;const rt=({className:t,...s})=>e.jsx("div",{className:A("flex flex-col space-y-1.5 text-center sm:text-left",t),...s});rt.displayName="DialogHeader";const ft=({className:t,...s})=>e.jsx("div",{className:A("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});ft.displayName="DialogFooter";const nt=d.forwardRef(({className:t,...s},a)=>e.jsx(da,{ref:a,className:A("text-lg font-semibold leading-none tracking-tight",t),...s}));nt.displayName=da.displayName;const ot=d.forwardRef(({className:t,...s},a)=>e.jsx(ua,{ref:a,className:A("text-sm text-muted-foreground",t),...s}));ot.displayName=ua.displayName;const Oo=d.forwardRef(({className:t,...s},a)=>e.jsx(it,{ref:a,className:A("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",t),...s}));Oo.displayName=it.displayName;const $o=d.forwardRef(({className:t,...s},a)=>e.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[e.jsx(Es,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),e.jsx(it.Input,{ref:a,className:A("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",t),...s})]}));$o.displayName=it.Input.displayName;const Mo=d.forwardRef(({className:t,...s},a)=>e.jsx(it.List,{ref:a,className:A("max-h-[300px] overflow-y-auto overflow-x-hidden",t),...s}));Mo.displayName=it.List.displayName;const zo=d.forwardRef((t,s)=>e.jsx(it.Empty,{ref:s,className:"py-6 text-center text-sm",...t}));zo.displayName=it.Empty.displayName;const Uo=d.forwardRef(({className:t,...s},a)=>e.jsx(it.Group,{ref:a,className:A("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",t),...s}));Uo.displayName=it.Group.displayName;const yu=d.forwardRef(({className:t,...s},a)=>e.jsx(it.Separator,{ref:a,className:A("-mx-1 h-px bg-border",t),...s}));yu.displayName=it.Separator.displayName;const Qo=d.forwardRef(({className:t,...s},a)=>e.jsx(it.Item,{ref:a,className:A("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",t),...s}));Qo.displayName=it.Item.displayName;function vu(){return _c.useSyncExternalStore(bu,()=>!0,()=>!1)}function bu(){return()=>{}}var fr="Avatar",[Nu]=$s(fr),[wu,Bo]=Nu(fr),Vo=d.forwardRef((t,s)=>{const{__scopeAvatar:a,...r}=t,[n,i]=d.useState("idle");return e.jsx(wu,{scope:a,imageLoadingStatus:n,onImageLoadingStatusChange:i,children:e.jsx(Fe.span,{...r,ref:s})})});Vo.displayName=fr;var Ho="AvatarImage",Ko=d.forwardRef((t,s)=>{const{__scopeAvatar:a,src:r,onLoadingStatusChange:n=()=>{},...i}=t,o=Bo(Ho,a),l=Cu(r,i),c=Nt(u=>{n(u),o.onImageLoadingStatusChange(u)});return Ts(()=>{l!=="idle"&&c(l)},[l,c]),l==="loaded"?e.jsx(Fe.img,{...i,ref:s,src:r}):null});Ko.displayName=Ho;var Wo="AvatarFallback",Go=d.forwardRef((t,s)=>{const{__scopeAvatar:a,delayMs:r,...n}=t,i=Bo(Wo,a),[o,l]=d.useState(r===void 0);return d.useEffect(()=>{if(r!==void 0){const c=window.setTimeout(()=>l(!0),r);return()=>window.clearTimeout(c)}},[r]),o&&i.imageLoadingStatus!=="loaded"?e.jsx(Fe.span,{...n,ref:s}):null});Go.displayName=Wo;function en(t,s){return t?s?(t.src!==s&&(t.src=s),t.complete&&t.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Cu(t,{referrerPolicy:s,crossOrigin:a}){const r=vu(),n=d.useRef(null),i=r?(n.current||(n.current=new window.Image),n.current):null,[o,l]=d.useState(()=>en(i,t));return Ts(()=>{l(en(i,t))},[i,t]),Ts(()=>{const c=p=>()=>{l(p)};if(!i)return;const u=c("loaded"),h=c("error");return i.addEventListener("load",u),i.addEventListener("error",h),s&&(i.referrerPolicy=s),typeof a=="string"&&(i.crossOrigin=a),()=>{i.removeEventListener("load",u),i.removeEventListener("error",h)}},[i,a,s]),o}var Yo=Vo,Xo=Ko,Zo=Go;const Rt=d.forwardRef(({className:t,...s},a)=>e.jsx(Yo,{ref:a,className:A("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...s}));Rt.displayName=Yo.displayName;const ps=d.forwardRef(({className:t,...s},a)=>e.jsx(Xo,{ref:a,className:A("aspect-square h-full w-full",t),...s}));ps.displayName=Xo.displayName;const kt=d.forwardRef(({className:t,...s},a)=>e.jsx(Zo,{ref:a,className:A("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...s}));kt.displayName=Zo.displayName;function Ta({data:t,form:s,field:a}){const[r,n]=le.useState(!1);return le.useEffect(()=>{},[]),e.jsxs(xt,{open:r,onOpenChange:n,children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",role:"combobox",className:A("w-full justify-between",!a.value&&"text-muted-foreground"),children:[a.value?t.find(i=>i.id===a.value)?.email:"Select customer",e.jsx(ql,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})})}),e.jsx(st,{className:"p-1 w-[350px]",children:e.jsxs(Oo,{children:[e.jsx($o,{placeholder:"Select customer..."}),e.jsxs(Mo,{children:[e.jsx(zo,{children:"No customer found."}),e.jsx(Uo,{children:t?.map((i,o)=>e.jsx(le.Fragment,{children:e.jsxs(Qo,{value:i.id,onSelect:()=>{s.setValue("customer_id",i.id),n(!1)},className:"gap-4 hover:cursor-pointer",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(Rt,{children:e.jsxs(kt,{className:"bg-gray-300 dark:bg-gray-700",children:[i.first_name.charAt(0),i.last_name.charAt(0)]})}),e.jsxs("div",{className:"flex flex-col gap-0",children:[e.jsxs("p",{className:"font-[500]",children:[i.first_name," ",i.last_name]}),e.jsx("p",{className:"text-xs",children:i.email})]})]}),e.jsx(Ge,{className:A("mr-0 h-4 w-4",i.id===a.value?"opacity-100":"opacity-0")})]},i.id)},o))})]})]})})]})}const Jo=d.forwardRef(({className:t,...s},a)=>e.jsx(jn,{className:A("peer inline-flex h-[24px] w-[44px] shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primarytheme data-[state=unchecked]:bg-input",t),...s,ref:a,children:e.jsx(dl,{className:A("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Jo.displayName=jn.displayName;function He({title:t,description:s,icon:a,switchValue:r,setSwitchValue:n}){return e.jsxs("div",{className:"flex gap-4 justify-between p-4 rounded-md border border-gray-200",children:[e.jsxs("div",{className:"flex gap-6",children:[a,e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[14px]",children:t}),e.jsx("p",{className:"text-[14px] text-gray-500",children:s})]})]}),e.jsx("div",{className:"my-auto",children:e.jsx(Jo,{checked:r,onCheckedChange:()=>n(!r)})})]})}function zt({className:t,classNames:s,showOutsideDays:a=!0,...r}){return e.jsx(qc,{showOutsideDays:a,className:A("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:A(Ds({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:A("relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md",r.mode==="range"?"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md":"[&:has([aria-selected])]:rounded-md"),day:A(Ds({variant:"ghost"}),"h-8 w-8 p-0 font-normal aria-selected:opacity-100"),day_range_start:"day-range-start",day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...s},components:{IconLeft:({className:n,...i})=>e.jsx(nr,{className:A("h-4 w-4",n),...i}),IconRight:({className:n,...i})=>e.jsx(Dt,{className:A("h-4 w-4",n),...i})},...r})}zt.displayName="Calendar";const ei=async()=>{const{data:t,error:s}=await w.from(q.SERVICE).select("*").order("id",{ascending:!0});if(s)throw console.log(s),s;return t},_u=async t=>{console.log("Creating service with data:",t);const{data:s,error:a}=await w.from(q.SERVICE).insert([t]).select().single();if(a)throw console.log("Error creating service:",a),a;return s},Su=async t=>{const{id:s,...a}=t,{data:r,error:n}=await w.from(q.SERVICE).update(a).eq("id",s).select().single();if(n)throw console.log("Error updating service:",n),n;return r},Tu=async t=>{const{error:s}=await w.from(q.SERVICE).delete().eq("id",t);if(s)throw console.log("Error deleting service:",s),s},Vs=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["roofingServices"],queryFn:()=>ei()});return{data:t,isLoading:s,isError:a}},Eu=async()=>{const{data:t,error:s}=await w.from(q.QUOTE_STATUS).select("*").order("id",{ascending:!0});if(s)throw console.log(s),s;return t},gr=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["quoteStatuses"],queryFn:Eu});return{quoteStatuses:t,isLoading:s,isError:a}},Iu=async()=>{const{data:t,error:s}=await w.from(q.QUOTE).select(`
      *,
      customer (
        id,
        first_name,
        last_name,
        email,
        phone_number,
        street_address,
        city,
        state,
        zipcode
      ),
      quote_status (
        id,
        name,
        description,
        created_at,
        updated_at
      ),
      service (
        id,
        name,
        description,
        default_price,
        created_at,
        updated_at
      )
    `).order("quote_number",{ascending:!1});if(s)throw console.log(s),s;return t},Pu=async t=>{const{data:s,error:a}=await w.from(q.QUOTE).select(`
      *,
      customer (
        id,
        first_name,
        last_name,
        email,
        phone_number,
        street_address,
        city,
        state,
        zipcode
      ),
      quote_status (
        id,
        name,
        description,
        created_at,
        updated_at
      ),
      service (
        id,
        name,
        description,
        default_price,
        created_at,
        updated_at
      ),
      quote_line_item (
        id,
        quote_id,
        service_id,
        qty,
        amount,
        rate,
        sq_ft,
        description,
        fixed_item,
        subtotal,
        created_at,
        updated_at
      )
    `).eq("quote_number",t);if(a)throw console.log(a),a;return s[0]},Du=async t=>{const{data:s,error:a}=await w.from(q.QUOTE).delete().eq("quote_number",t);if(a)throw a;return s},Ru=async(t,s)=>{console.log(t),console.log(s);const{data:a,error:r}=await w.from(q.QUOTE).update({status_id:t}).eq("quote_number",s);if(r)throw r;return a},ku=async()=>{const{data:t,error:s}=await w.from(q.INVOICE).select("invoice_number").order("invoice_number",{ascending:!1}).limit(1);if(s)throw s;return(t&&t.length>0?t[0].invoice_number:0)+1},qu=async t=>{const{data:s,error:a}=await w.from(q.INVOICE).select("*").eq("converted_from_quote_number",t).single();if(a&&a.code!=="PGRST116")throw a;if(s)throw new Error(`This quote has already been converted to Invoice #${s.invoice_number}. Each quote can only be converted once.`);const{data:r,error:n}=await w.from(q.QUOTE).select(`
      *,
      customer (
        id,
        first_name,
        last_name,
        email,
        phone_number,
        street_address,
        city,
        state,
        zipcode
      ),
      service (
        id,
        name,
        description,
        default_price
      ),
      quote_line_item (
        *
      )
    `).eq("quote_number",t).single();if(n)throw n;if(r.converted)throw new Error("This quote has already been marked as converted. Please refresh the page and try again.");const i=await ku(),{data:o,error:l}=await w.from(q.INVOICE_STATUS).select("*").order("id",{ascending:!0}).limit(1);if(l)throw l;const c=o&&o.length>0?o[0].id:1,u=new Date().toISOString().split("T")[0],h=new Date;h.setDate(h.getDate()+30);const p={invoice_number:i,customer_id:r.customer_id,service_type_id:r.service_id,invoice_status_id:c,invoice_date:u,issue_date:u,due_date:h.toISOString().split("T")[0],subtotal:r.subtotal,total:r.total,amount_due:r.total,sqft_measurement:r.measurement_note||"",note:r.note||"",cust_note:r.cust_note||"",private_note:r.private_note||"",public_note:r.public_note||"",converted_from_quote_number:t,bill_from_street_address:"150 Tallant St",bill_from_city:"Houston",bill_from_state:"TX",bill_from_zipcode:"77076",bill_from_email:"rrios.roofing@gmail.com",bill_to_street_address:r.custom_address?r.custom_street_address||"":r.customer?.street_address||"",bill_to_city:r.custom_address?r.custom_city||"":r.customer?.city||"",bill_to_state:r.custom_address?r.custom_state||"":r.customer?.state||"",bill_to_zipcode:r.custom_address?r.custom_zipcode||"":r.customer?.zipcode||"",bill_to:!1},{data:g,error:N}=await w.from(q.INVOICE).insert(p).select().single();if(N)throw console.error("Invoice creation error:",N),N;let _=[];if(r.quote_line_item&&r.quote_line_item.length>0){const S=r.quote_line_item.map(O=>({invoice_id:g.invoice_number,service_id:O.service_id,qty:O.qty,amount:O.amount,rate:O.rate,sq_ft:O.sq_ft,description:O.description,fixed_item:O.fixed_item})),{data:E,error:b}=await w.from(q.INVOICE_LINE_SERVICE).insert(S).select();if(b)throw b;_=E||[]}const{data:m,error:R}=await w.from(q.QUOTE).update({converted:!0}).eq("quote_number",t).select().single();if(R)throw R;return{quote:m,invoice:g,invoiceLineItems:_}},ti=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["quotes"],queryFn:()=>Iu()});return{quotes:t,isLoading:s,isError:a}},si=t=>{const{data:s,isLoading:a,isError:r}=ie({queryKey:["quoteById",t],queryFn:()=>Pu(t)});return{quoteById:s,isLoading:a,isError:r}},Au=(t,s)=>{const a=fe();return me(r=>Du(r),{onError:r=>{s(!1),t({title:"Uh oh! Something went wrong.",description:`There was a problem with deleting quote from our system.
 Message: ${r.message}`,variant:"destructive"})},onSuccess:()=>{a.invalidateQueries({queryKey:"quotes"}),s(!1),t({variant:"success",title:"Deleted invoice successfully! 🎉",description:e.jsx("p",{children:"Successfully deleted invoice from our system."})})}})},Fu=(t,s)=>{const a=fe();return me(r=>Ru(r,s),{onError:r=>{t({position:"top",title:"Error Updating Quote Status",description:`Error: ${r.message}`,status:"error",duration:5e3,isClosable:!0})},onSuccess:()=>{a.invalidateQueries({queryKey:["quoteById",s]}),t({position:"top",title:"Successfully Updated Quote Status!",description:"We've updated quote status information for you 🎉",status:"success",duration:5e3,isClosable:!0})}})},Lu=(t,s)=>{const a=fe();return me(()=>qu(s),{onError:r=>{r.message.includes("already been converted")?t({title:"Quote Already Converted",description:r.message,variant:"destructive"}):t({title:"Error Converting Quote",description:`Failed to convert quote to invoice. Error: ${r.message}`,variant:"destructive"})},onSuccess:r=>{a.invalidateQueries({queryKey:["quoteById",s]}),a.invalidateQueries({queryKey:["quotes"]}),a.invalidateQueries({queryKey:["invoices"]});const n=r.invoice.invoice_number;return t({title:"Quote Converted Successfully! 🎉",description:`Quote has been converted to Invoice #INV-${n}. You can view it in the invoices section.`,variant:"success"}),r}})},jt=[{title:"Custom Address",description:"Manual input for address",icon:e.jsx(zs,{className:"w-5 h-5 my-auto mx-auto"})},{title:"General Notes",description:"To jot down general info",icon:e.jsx(ma,{className:"w-5 h-5 my-auto mx-auto"})},{title:"Measurements Note",description:"To write roof measurement",icon:e.jsx(xa,{className:"w-5 h-5 my-auto mx-auto"})},{title:"Customer Note",description:"Write a note to customer",icon:e.jsx(ha,{className:"w-5 h-5 my-auto mx-auto"})}];function ra(){const t=fe(),{quotes:s}=ti(),{customers:a}=Bs(),{data:r}=Vs(),{quoteStatuses:n}=gr(),[i,o]=le.useState(!1),[l,c]=d.useState(!1),[u,h]=d.useState(!1),[p,g]=d.useState(!1),[N,_]=d.useState(!1),m=Tt({resolver:gt(fu),defaultValues:{quote_number:void 0,customer_id:0,service_id:void 0,status_id:void 0,quote_date:new Date,expiration_date:new Date,line_items:[{description:"",qty:1,amount:0,subtotal:0}],custom_street_address:"",custom_city:"",custom_state:"",custom_zipcode:"",private_note:"",public_note:"",measurement_note:""}}),{fields:R,append:S,remove:E}=va({control:m.control,name:"line_items"});function b(x){return!x||x.length===0?1:Math.max(...x.map(y=>y.quote_number))+1}m.watch("quote_number");const O=b(s),F=m.watch("line_items");le.useEffect(()=>{const x=(F??[]).map(y=>({...y,subtotal:y.qty*y.amount}));m.setValue("line_items",x)},[F,m]);const H=(F??[]).reduce((x,y)=>x+y.subtotal,0),ne=H;async function G(x){const{data:y,error:f}=await w.from("quote").insert(x);if(f)throw f;return y}async function Z(x){const{data:y,error:f}=await w.from("quote_line_item").insert(x);return f&&console.error("Error creating quote line items",f.message),console.log("Quote line items created: ",y)}const oe=me(G),v=me(Z),$=async x=>{const{line_items:y,...f}=x,M={...f,total:ne,subtotal:H},C=y?.map(W=>({...W,quote_id:x.quote_number,service_id:x.service_id}));console.log("line_items",C),console.log("quote",M);try{await oe.mutateAsync(M),await v.mutateAsync(C),t.invalidateQueries(["quotes"]),m.reset()}catch(W){alert("Failed to create quote: "+W)}};return e.jsxs("div",{className:"w-full",children:[e.jsx(It,{...m,children:e.jsx("form",{onSubmit:m.handleSubmit($),children:e.jsxs("div",{className:"space-y-4 h-full px-4 pb-6",children:[e.jsx(D,{control:m.control,name:"customer_id",render:({field:x})=>e.jsxs(I,{className:"flex flex-col w-full",children:[e.jsx(P,{children:"Search for customer"}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Ta,{data:a,form:m,field:x})}),e.jsx(j,{type:"button",variant:"outline",size:"icon",onClick:()=>_(!0),className:"shrink-0 h-10 w-10",children:e.jsx(Ht,{className:"h-4 w-4"})})]}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:m.control,name:"quote_number",render:({field:x})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Quote #"}),e.jsx(k,{children:e.jsx(Q,{...x,className:"w-full",value:x.value||"",onChange:y=>{x.onChange(y.target.value?parseFloat(y.target.value):void 0)},placeholder:String(O)})}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:"status_id",render:({field:x})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Select Status"}),e.jsxs(Ce,{onValueChange:y=>x.onChange(Number(y)),value:x.value&&x.value!==0?String(x.value):void 0,children:[" ",e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select status for quote"})})}),e.jsx(Ve,{data:n})]}),e.jsx(U,{})]})})]}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:m.control,name:"quote_date",render:({field:x})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Quote date"}),e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",className:A("w-full pl-3 text-left font-normal",!x.value&&"text-muted-foreground"),children:[x.value?Wt(x.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(tt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(st,{className:"w-auto p-0 text-start",children:e.jsx(zt,{mode:"single",selected:x.value,onSelect:x.onChange})})]}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:"expiration_date",render:({field:x})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Expiration Date"}),e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",className:A("w-full pl-3 text-left font-normal",!x.value&&"text-muted-foreground"),children:[x.value?Wt(x.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(tt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(st,{className:"w-auto p-0 text-start",children:e.jsx(zt,{mode:"single",selected:x.value,onSelect:x.onChange})})]}),e.jsx(U,{})]})})]}),e.jsx(D,{control:m.control,name:"service_id",render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Select Service"}),e.jsxs(Ce,{onValueChange:y=>x.onChange(Number(y)),value:x.value&&x.value!==0?String(x.value):void 0,children:[" ",e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select a roofing service..."})})}),e.jsx(Ve,{data:r})]}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex flex-col py-2 gap-6",children:[e.jsx(ae,{children:"Line Items"}),R.map((x,y)=>e.jsx(le.Fragment,{children:e.jsxs("div",{className:"grid w-full grid-cols-8 grid-flow-row gap-4",children:[e.jsx(D,{control:m.control,render:({field:f})=>e.jsxs(I,{className:"col-span-6 sm:col-span-4",children:[e.jsx(P,{children:"Description"}),e.jsx(k,{children:e.jsx(Q,{type:"text",...f})})]}),name:`line_items.${y}.description`}),e.jsx(D,{control:m.control,render:({field:f})=>e.jsxs(I,{className:"sm:col-span-1",children:[e.jsx(P,{children:"Qty"}),e.jsx(k,{children:e.jsx(Q,{disabled:!0,...f})})]}),name:`line_items.${y}.qty`}),e.jsx(D,{control:m.control,render:({field:f})=>e.jsxs(I,{className:"col-span-3 sm:col-span-2",children:[e.jsx(P,{children:"Amount"}),e.jsx(k,{children:e.jsx(Q,{type:"text",inputMode:"numeric",pattern:"[0-9]*",...f,onChange:M=>{f.onChange(M.target.value?parseFloat(M.target.value):"")},value:f.value||""})})]}),name:`line_items.${y}.amount`}),e.jsx(D,{control:m.control,render:({field:f})=>e.jsxs(I,{className:"hidden col-span-3 sm:col-span-2",children:[e.jsx(P,{children:"Subtotal"}),e.jsx(k,{children:e.jsx(Q,{disabled:!0,type:"text",inputMode:"numeric",pattern:"[0-9]*",...f,onChange:M=>{f.onChange(M.target.value?parseFloat(M.target.value):"")},value:f.value||""})})]}),name:`line_items.${y}.subtotal`}),e.jsx("div",{className:"sm:col-span-1 mx-auto mt-auto",children:e.jsx(j,{type:"button",variant:"secondary",onClick:()=>E(y),children:e.jsx(Ot,{className:"w-4 h-4"})})})]})},y)),e.jsx(j,{type:"button",variant:"secondary",onClick:()=>S({description:"",qty:1,amount:0,subtotal:0}),children:"+ Add Line Item"})]}),e.jsx("div",{className:"w-full mx-auto pt-2 px-6",children:e.jsx("div",{className:"w-full flex flex-col gap-2 text-sm",children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("p",{className:"my-auto font-light",children:"Subtotal"}),e.jsxs("p",{className:"my-auto font-light",children:["$",se(H)]})]})})}),e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"w-full bg-blue-500 h-[50px] rounded-xl",children:e.jsxs("div",{className:"flex justify-between w-full h-full px-6",children:[e.jsx("p",{className:"my-auto font-bold text-white",children:"Total"}),e.jsxs("p",{className:"my-auto font-light text-white",children:["$",se(ne)]})]})})}),e.jsxs("div",{className:"flex flex-col gap-4 pt-2",children:[e.jsx(ae,{children:"Extra Options"}),i&&e.jsxs("div",{className:"flex gap-4 flex-col w-full mb-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(D,{render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Street Address"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter address",...x,defaultValue:""})})]}),name:"custom_street_address"})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-full",children:e.jsx(D,{render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"City"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter city",...x,defaultValue:""})})]}),name:"custom_city"})}),e.jsx("div",{className:"w-full",children:e.jsx(D,{render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"State"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter state",...x,defaultValue:""})})]}),name:"custom_state"})})]}),e.jsx("div",{children:e.jsx(D,{render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Zipcode"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter zipcode",...x,defaultValue:""})})]}),name:"custom_zipcode"})})]}),e.jsx(He,{title:jt[0].title,description:jt[0].description,icon:jt[0].icon,switchValue:i,setSwitchValue:o}),l&&e.jsx(e.Fragment,{children:e.jsx(D,{control:m.control,name:"private_note",render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Internal Note"}),e.jsx(k,{children:e.jsx(ms,{placeholder:"Jot down any notes here...",className:"resize-y rounded-lg h-[150px]",defaultValue:"",...x})})]})})}),e.jsx(He,{title:jt[1].title,description:jt[1].description,icon:jt[1].icon,switchValue:l,setSwitchValue:c}),u&&e.jsx(e.Fragment,{children:e.jsx(D,{control:m.control,render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Measurement"}),e.jsx(k,{children:e.jsx(ms,{placeholder:"Write down any measurements about the roof here...",className:"resize-y rounded-lg h-[150px]",defaultValue:"",...x})})]}),name:"measurement_note"})}),e.jsx(He,{title:jt[2].title,description:jt[2].description,icon:jt[2].icon,switchValue:u,setSwitchValue:h}),p&&e.jsx(e.Fragment,{children:e.jsx(D,{render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Public Note"}),e.jsx(k,{children:e.jsx(ms,{placeholder:"Tell the customer a custom message...",className:"resize-y rounded-lg h-[150px]",defaultValue:"",...x})})]}),name:"public_note"})}),e.jsx(He,{title:jt[3].title,description:jt[3].description,icon:jt[3].icon,switchValue:p,setSwitchValue:g})]}),e.jsxs(qt,{className:"pt-4 gap-2",children:[e.jsx(Ke,{asChild:!0,children:e.jsx(j,{type:"submit",disabled:m.formState.isSubmitting,children:m.formState.isSubmitting?"Loading...":"Submit"})}),e.jsx(Ke,{asChild:!0,children:e.jsx(j,{variant:"secondary",children:"Cancel"})})]})]})})}),e.jsx(De,{open:N,onOpenChange:_,children:e.jsxs(Re,{className:"w-full sm:max-w-lg px-2",children:[e.jsx(ke,{className:"px-4",children:e.jsx(qe,{children:"Add New Customer"})}),e.jsx(hs,{setOpen:_})]})})]})}const Ou=Ee({invoice_number:te().min(1,"Invoice number is required"),customer_id:te(),service_type_id:te(),invoice_status_id:te(),invoice_date:Lt(),issue_date:Lt(),due_date:Lt(),private_note:z().optional(),public_note:z().optional(),cust_note:z().optional(),sqft_measurement:z().optional(),bill_from_street_address:z().default("150 Tallant St"),bill_from_city:z().default("Houston"),bill_from_state:z().default("TX"),bill_from_zipcode:z().default("77076"),bill_from_email:z().optional(),bill_to_street_address:z().optional(),bill_to_city:z().optional(),bill_to_state:z().optional(),bill_to_zipcode:z().optional(),bill_to:ea().default(!1),line_items:bs(Ee({description:z().min(1,"Description is required"),qty:te().min(1,"Quantity must be at least 1"),rate:te().nonnegative("Rate must be non-negative"),amount:te().positive("Amount must be positive"),sq_ft:te().optional(),fixed_item:ea().default(!1)})).min(1,"At least one line item is required.").optional()}),$u=Ee({id:te(),invoice_number:te().min(1,"Invoice number is required"),customer_id:te(),service_type_id:te(),invoice_status_id:te(),invoice_date:Lt(),issue_date:Lt(),due_date:Lt(),private_note:z().optional(),public_note:z().optional(),cust_note:z().optional(),sqft_measurement:z().optional(),bill_from_street_address:z().default("150 Tallant St"),bill_from_city:z().default("Houston"),bill_from_state:z().default("TX"),bill_from_zipcode:z().default("77076"),bill_from_email:z().optional(),bill_to_street_address:z().optional(),bill_to_city:z().optional(),bill_to_state:z().optional(),bill_to_zipcode:z().optional(),bill_to:ea().default(!1),line_items:bs(Ee({id:te().optional(),description:z().min(1,"Description is required"),qty:te().min(1,"Quantity must be at least 1"),rate:te().nonnegative("Rate must be non-negative"),amount:te().positive("Amount must be positive"),sq_ft:te().optional(),fixed_item:ea().default(!1)})).min(1,"At least one line item is required.").optional()}),Ae=d.forwardRef(({className:t,...s},a)=>e.jsx("textarea",{className:A("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:a,...s}));Ae.displayName="Textarea";const Mu=async()=>{const{data:t,error:s}=await w.from(q.INVOICE_STATUS).select("*").order("id",{ascending:!0});if(s)throw console.log(s),s;return t},jr=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["invoiceStatuses"],queryFn:()=>Mu()});return{data:t,isLoading:s,isError:a}},zu=async()=>{const{data:t,error:s}=await w.from(q.INVOICE).select(`
      *,
      customer (
        id,
        first_name,
        last_name,
        email,
        phone_number,
        street_address,
        city,
        state,
        zipcode
      ),
      service (
        id,
        name,
        description,
        default_price,
        created_at,
        updated_at
      ),
      invoice_status (
        id,
        name,
        description,
        created_at,
        updated_at
      )
    `).order("invoice_number",{ascending:!1}).order("invoice_status_id",{ascending:!1}).order("updated_at",{ascending:!1});if(s)throw console.log(s.message),s;return t},Uu=async t=>{const{data:s,error:a}=await w.from(q.INVOICE).select(`
      *,
      customer (
        id,
        first_name,
        last_name,
        email,
        phone_number,
        street_address,
        city,
        state,
        zipcode
      ),
      invoice_status (
        id,
        name,
        description,
        created_at,
        updated_at
      ),
      service (
        id,
        name,
        description,
        default_price,
        created_at,
        updated_at
      ),
      invoice_line_service (
        id,
        invoice_id,
        service_id,
        sq_ft,
        qty,
        rate,
        amount,
        description,
        fixed_item,
        created_at,
        updated_at
      ),
      invoice_payment (
        id,
        invoice_id,
        payment_method,
        amount,
        date_received,
        created_at,
        updated_at
      )
    `).eq("invoice_number",t).single();if(a)throw console.log(a),a;return s},Qu=async t=>{const{error:s}=await w.from(q.INVOICE).delete().eq("invoice_number",t);if(s)throw s},Bu=async t=>{const{error:s}=await w.from(q.INVOICE).update({invoice_status_id:t.status_id}).eq("invoice_number",t.invoice_number);if(s)throw s;return t.invoice_number},ai=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["invoices"],queryFn:async()=>await zu()});return{data:t,isError:a,isLoading:s}},ri=t=>{const{data:s,isError:a,isLoading:r}=ie({queryKey:["invoiceById",t],queryFn:()=>Uu(t),enabled:!!t&&t>0});return{data:s,isError:a,isLoading:r}},Vu=(t,s)=>{const a=fe();return me(r=>Qu(r),{onError:r=>{s(!1),t({title:"Uh oh! Something went wrong.",description:`There was a problem with adding a new request to our system.
 Message: ${r.message}`,variant:"destructive"})},onSuccess:r=>{a.invalidateQueries({queryKey:["invoices"]}),s(!1),t({variant:"success",title:"Deleted invoice successfully! 🎉",description:e.jsx("p",{children:"Successfully deleted invoice from our system."})})}})},Hu=t=>{const s=fe();return me(a=>Bu(a),{onError:a=>{console.log(a),t({position:"top",title:"Error occured updating invoice status!",description:`Error: ${a.message}`,status:"error",duration:5e3,isClosable:!0})},onSuccess:a=>{s.invalidateQueries({queryKey:["invoiceById",a.toString()]}),t({position:"top",title:"Invoice Status Updated!",description:`We've updated invoice status for INV# ${a} for you succesfully! 🚀`,status:"success",duration:5e3,isClosable:!0})}})},yt=[{title:"Custom Bill To Address",description:"Different billing address",icon:e.jsx(zs,{className:"w-5 h-5 my-auto mx-auto"})},{title:"General Notes",description:"Internal notes",icon:e.jsx(ma,{className:"w-5 h-5 my-auto mx-auto"})},{title:"SQFT Measurement",description:"Square footage details",icon:e.jsx(xa,{className:"w-5 h-5 my-auto mx-auto"})},{title:"Customer Note",description:"Note visible to customer",icon:e.jsx(ha,{className:"w-5 h-5 my-auto mx-auto"})}];function na({setOpen:t,onSuccess:s}){const a=fe(),{data:r}=ai(),{customers:n}=Bs(),{data:i}=Vs(),{data:o}=jr(),[l,c]=d.useState(!1),[u,h]=d.useState(!1),[p,g]=d.useState(!1),[N,_]=d.useState(!1),[m,R]=d.useState(!1),S=Tt({resolver:gt(Ou),defaultValues:{invoice_number:void 0,customer_id:0,service_type_id:0,invoice_status_id:0,invoice_date:new Date,issue_date:new Date,due_date:new Date(Date.now()+720*60*60*1e3),line_items:[{description:"",qty:1,rate:0,amount:0,sq_ft:0,fixed_item:!0}],bill_from_street_address:"150 Tallant St",bill_from_city:"Houston",bill_from_state:"TX",bill_from_zipcode:"77076",bill_from_email:"",bill_to_street_address:"",bill_to_city:"",bill_to_state:"",bill_to_zipcode:"",bill_to:!1,private_note:"",public_note:"",cust_note:"",sqft_measurement:""}}),{fields:E,append:b,remove:O}=va({control:S.control,name:"line_items"});function F(f){return!f||f.length===0?1:Math.max(...f.map(M=>M.invoice_number))+1}const L=F(r),H=S.watch("line_items");d.useEffect(()=>{const f=(H??[]).map((C,W)=>{const ge=C.qty||1;return{...C,qty:ge,rate:0,amount:C.amount||0}});f.some((C,W)=>{const ge=H?.[W];return!ge||C.qty!==ge.qty||C.rate!==ge.rate})&&S.setValue("line_items",f,{shouldValidate:!1})},[H,S]);const G=(H??[]).reduce((f,M)=>f+M.amount,0),Z=G;async function oe(f){const{data:M,error:C}=await w.from(q.INVOICE).insert(f).select();if(C)throw C;return M}async function v(f){const{data:M,error:C}=await w.from(q.INVOICE_LINE_SERVICE).insert(f);if(C)throw console.error("Error creating invoice line items",C.message),C;return M}const $=me({mutationFn:oe,onSuccess:()=>{a.invalidateQueries({queryKey:["invoices"]}),a.invalidateQueries({queryKey:["totalPaidInvoices"]}),a.invalidateQueries({queryKey:["totalPendingInvoices"]}),a.invalidateQueries({queryKey:["totalOverdueInvoices"]})}}),x=me({mutationFn:v,onSuccess:()=>{a.invalidateQueries({queryKey:["invoiceLineItems"]}),a.invalidateQueries({queryKey:["invoices"]})}}),y=async f=>{const{line_items:M,...C}=f,W={...C,total:Z,subtotal:G,amount_due:Z,invoice_date:f.invoice_date.toISOString().split("T")[0],issue_date:f.issue_date.toISOString().split("T")[0],due_date:f.due_date.toISOString().split("T")[0],invoice_number:f.invoice_number||L},ge=M?.map(je=>({...je,invoice_id:W.invoice_number,service_id:f.service_type_id,amount:je.amount,rate:0}));console.log("Creating invoice:",W),console.log("Creating line items:",ge);try{await $.mutateAsync(W),ge&&await x.mutateAsync(ge),S.reset(),t&&t(!1),s&&s()}catch(je){console.error("Failed to create invoice:",je);let Qe="Unknown error occurred";je&&typeof je=="object"?"message"in je?Qe=je.message:"details"in je?Qe=je.details:Qe=JSON.stringify(je):typeof je=="string"&&(Qe=je),alert("Failed to create invoice: "+Qe)}};return e.jsxs("div",{className:"w-full",children:[e.jsx(It,{...S,children:e.jsx("form",{onSubmit:S.handleSubmit(y),children:e.jsxs("div",{className:"space-y-4 h-full px-4 pb-6",children:[e.jsx(D,{control:S.control,name:"customer_id",render:({field:f})=>e.jsxs(I,{className:"flex flex-col w-full",children:[e.jsx(P,{children:"Search for customer"}),e.jsxs("div",{className:"flex gap-2 w-full",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Ta,{data:n,form:S,field:f})}),e.jsx(j,{type:"button",variant:"outline",size:"icon",onClick:()=>R(!0),className:"shrink-0 h-10 w-10",children:e.jsx(Ht,{className:"h-4 w-4"})})]}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:S.control,name:"invoice_number",render:({field:f})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Invoice #"}),e.jsx(k,{children:e.jsx(Q,{type:"number",className:"w-full",value:f.value||"",onChange:M=>{const C=M.target.value;f.onChange(C===""?void 0:Number(C))},placeholder:String(L)})}),e.jsx(U,{})]})}),e.jsx(D,{control:S.control,name:"invoice_status_id",render:({field:f})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Select Status"}),e.jsxs(Ce,{onValueChange:M=>f.onChange(Number(M)),value:f.value&&f.value>0?String(f.value):"",children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select status"})})}),e.jsx(Ye,{side:"bottom",align:"start",sideOffset:4,avoidCollisions:!0,position:"popper",children:e.jsx(Ve,{data:o||[]})})]}),e.jsx(U,{})]})})]}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:S.control,name:"invoice_date",render:({field:f})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Invoice Date"}),e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",className:A("w-full pl-3 text-left font-normal",!f.value&&"text-muted-foreground"),children:[f.value?Wt(f.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(tt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(st,{className:"w-auto p-0",align:"start",children:e.jsx(zt,{mode:"single",selected:f.value,onSelect:f.onChange,disabled:M=>M>new Date||M<new Date("1900-01-01"),initialFocus:!0})})]}),e.jsx(U,{})]})}),e.jsx(D,{control:S.control,name:"due_date",render:({field:f})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Due Date"}),e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",className:A("w-full pl-3 text-left font-normal",!f.value&&"text-muted-foreground"),children:[f.value?Wt(f.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(tt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(st,{className:"w-auto p-0",align:"start",children:e.jsx(zt,{mode:"single",selected:f.value,onSelect:f.onChange,disabled:M=>M<new Date,initialFocus:!0})})]}),e.jsx(U,{})]})})]}),e.jsx(D,{control:S.control,name:"service_type_id",render:({field:f})=>e.jsxs(I,{children:[e.jsx(P,{children:"Select Service"}),e.jsxs(Ce,{onValueChange:M=>f.onChange(Number(M)),value:f.value&&f.value>0?String(f.value):"",children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select service"})})}),e.jsx(Ye,{side:"bottom",align:"start",sideOffset:4,avoidCollisions:!0,position:"popper",children:e.jsx(Ve,{data:i||[]})})]}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex flex-col py-2 gap-6",children:[e.jsx(ae,{children:"Line Items"}),E.map((f,M)=>e.jsxs("div",{className:"flex flex-col gap-4 p-4 border rounded-lg bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Item ",M+1]}),E.length>1&&e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>O(M),className:"text-red-500 hover:text-red-700",children:e.jsx(Ot,{className:"h-4 w-4"})})]}),e.jsx(D,{control:S.control,name:`line_items.${M}.description`,render:({field:C})=>e.jsxs(I,{children:[e.jsx(P,{children:"Description"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter item description",value:C.value||"",onChange:C.onChange,onBlur:C.onBlur,name:C.name})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(D,{control:S.control,name:`line_items.${M}.qty`,render:({field:C})=>e.jsxs(I,{children:[e.jsx(P,{children:"Quantity"}),e.jsx(k,{children:e.jsx(Q,{type:"number",min:"1",value:C.value||1,onChange:W=>C.onChange(Number(W.target.value)||1),onBlur:C.onBlur,name:C.name})}),e.jsx(U,{})]})}),e.jsx(D,{control:S.control,name:`line_items.${M}.rate`,render:({field:C})=>e.jsxs(I,{children:[e.jsx(P,{children:"Rate (Disabled)"}),e.jsx(k,{children:e.jsx(Q,{type:"text",value:"Fixed Pricing",disabled:!0,className:"bg-gray-100 dark:bg-gray-700 opacity-50 text-center",placeholder:"Fixed rate (future feature)"})}),e.jsx(U,{})]})}),e.jsx(D,{control:S.control,name:`line_items.${M}.amount`,render:({field:C})=>e.jsxs(I,{children:[e.jsx(P,{children:"Amount"}),e.jsx(k,{children:e.jsx(Q,{type:"text",value:C.value||"",onChange:W=>{const ge=W.target.value;(ge===""||/^\d*\.?\d*$/.test(ge))&&C.onChange(ge===""?0:Number(ge)||0)},onBlur:C.onBlur,name:C.name,placeholder:"Enter fixed amount"})}),e.jsx(U,{})]})})]})]},f.id)),e.jsx(j,{type:"button",variant:"secondary",onClick:()=>b({description:"",qty:1,rate:0,amount:0,sq_ft:0,fixed_item:!0}),children:"+ Add Line Item"})]}),e.jsx("div",{className:"w-full mx-auto pt-2 px-6",children:e.jsx("div",{className:"w-full flex flex-col gap-2 text-sm",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",se(G)]})]})})}),e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"w-full bg-blue-500 h-[50px] rounded-xl",children:e.jsxs("div",{className:"flex justify-between items-center text-white px-6 py-3",children:[e.jsx("span",{className:"text-lg font-bold",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold",children:["$",se(Z)]})]})})}),e.jsxs("div",{className:"flex flex-col gap-4 pt-2",children:[e.jsx(ae,{children:"Extra Options"}),e.jsx(He,{title:yt[0].title,description:yt[0].description,icon:yt[0].icon,switchValue:l,setSwitchValue:c}),l&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 border rounded-lg",children:[e.jsx(D,{control:S.control,name:"bill_to_street_address",render:({field:f})=>e.jsxs(I,{className:"col-span-2",children:[e.jsx(P,{children:"Street Address"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter billing street address",...f})}),e.jsx(U,{})]})}),e.jsx(D,{control:S.control,name:"bill_to_city",render:({field:f})=>e.jsxs(I,{children:[e.jsx(P,{children:"City"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter city",...f})}),e.jsx(U,{})]})}),e.jsx(D,{control:S.control,name:"bill_to_state",render:({field:f})=>e.jsxs(I,{children:[e.jsx(P,{children:"State"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"TX",maxLength:2,...f})}),e.jsx(U,{})]})}),e.jsx(D,{control:S.control,name:"bill_to_zipcode",render:({field:f})=>e.jsxs(I,{children:[e.jsx(P,{children:"Zipcode"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"77076",...f})}),e.jsx(U,{})]})})]}),e.jsx(He,{title:yt[1].title,description:yt[1].description,icon:yt[1].icon,switchValue:u,setSwitchValue:h}),u&&e.jsx(D,{control:S.control,name:"private_note",render:({field:f})=>e.jsxs(I,{children:[e.jsx(P,{children:"General Notes (Internal)"}),e.jsx(k,{children:e.jsx(Ae,{placeholder:"Enter internal notes here...",className:"min-h-[100px]",...f})}),e.jsx(U,{})]})}),e.jsx(He,{title:yt[2].title,description:yt[2].description,icon:yt[2].icon,switchValue:p,setSwitchValue:g}),p&&e.jsx(D,{control:S.control,name:"sqft_measurement",render:({field:f})=>e.jsxs(I,{children:[e.jsx(P,{children:"Square Footage Measurement"}),e.jsx(k,{children:e.jsx(Ae,{placeholder:"Enter measurement details...",className:"min-h-[100px]",...f})}),e.jsx(U,{})]})}),e.jsx(He,{title:yt[3].title,description:yt[3].description,icon:yt[3].icon,switchValue:N,setSwitchValue:_}),N&&e.jsx(D,{control:S.control,name:"cust_note",render:({field:f})=>e.jsxs(I,{children:[e.jsx(P,{children:"Customer Note"}),e.jsx(k,{children:e.jsx(Ae,{placeholder:"Enter note visible to customer...",className:"min-h-[100px]",...f})}),e.jsx(U,{})]})})]}),e.jsxs(qt,{className:"pt-4 gap-2",children:[e.jsx(Ke,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",children:"Cancel"})}),e.jsx(j,{type:"submit",disabled:$.isLoading||x.isLoading,children:$.isLoading||x.isLoading?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"mr-2 h-4 w-4 animate-spin"}),"Please wait"]}):"Create Invoice"})]})]})})}),e.jsx(De,{open:m,onOpenChange:R,children:e.jsxs(Re,{className:"w-full sm:max-w-lg px-2",children:[e.jsx(ke,{className:"px-4",children:e.jsx(qe,{children:"Add New Customer"})}),e.jsx(hs,{setOpen:R})]})})]})}function Ku(){const{data:t,isLoading:s,isError:a}=zd(),{data:r,isLoading:n,isError:i,years:o}=Ud(),{data:l,isLoading:c,isError:u}=Qd(),{data:h,isLoading:p,isError:g}=Bd(),[N,_]=le.useState(!1),[m,R]=le.useState(!1),[S,E]=le.useState(!1),b=F=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(F),O=F=>{const L=F>=0,H=L?"text-green-600":"text-red-600",ne=L?ye:ve;return e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(ne,{className:`h-4 w-4 ${L?"text-green-500":"text-red-500"} mr-1`}),e.jsxs("span",{className:`text-sm ${H}`,children:[L?"+":"",F,"%"]}),e.jsx("span",{className:"text-sm text-gray-500 ml-1",children:"vs last month"})]})};return s?e.jsxs("div",{className:"w-full",children:[e.jsx(za,{}),e.jsxs("div",{className:"flex items-center justify-center h-64",children:[e.jsx(Yt,{className:"h-8 w-8 animate-spin text-gray-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading dashboard data..."})]})]}):a||!t?e.jsxs("div",{className:"w-full",children:[e.jsx(za,{}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx(At,{className:"h-8 w-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-600",children:"Error loading dashboard data"}),e.jsx(j,{variant:"outline",className:"mt-2",onClick:()=>window.location.reload(),children:"Retry"})]})})]}):e.jsxs("div",{className:"w-full",children:[e.jsx(za,{}),e.jsxs("div",{className:"flex flex-col w-full gap-4 my-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(Y,{children:e.jsx(X,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Total Customers"}),e.jsx("p",{className:"text-2xl font-bold",children:t.totalCustomers.toLocaleString()}),O(t.customerPercentChange)]}),e.jsx("div",{className:"p-3 bg-blue-100 rounded-full",children:e.jsx(Kt,{className:"h-6 w-6 text-blue-600"})})]})})}),e.jsx(Y,{children:e.jsx(X,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Active Quotes"}),e.jsx("p",{className:"text-2xl font-bold",children:t.activeQuotes.toLocaleString()}),O(t.quotePercentChange)]}),e.jsx("div",{className:"p-3 bg-green-100 rounded-full",children:e.jsx(mt,{className:"h-6 w-6 text-green-600"})})]})})}),e.jsx(Y,{children:e.jsx(X,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Monthly Revenue"}),e.jsx("p",{className:"text-2xl font-bold",children:b(t.monthlyRevenue)}),O(t.revenuePercentChange)]}),e.jsx("div",{className:"p-3 bg-purple-100 rounded-full",children:e.jsx(or,{className:"h-6 w-6 text-purple-600"})})]})})}),e.jsx(Y,{children:e.jsx(X,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Pending Leads"}),e.jsx("p",{className:"text-2xl font-bold",children:t.pendingLeads.toLocaleString()}),O(t.leadPercentChange)]}),e.jsx("div",{className:"p-3 bg-orange-100 rounded-full",children:e.jsx(Rn,{className:"h-6 w-6 text-orange-600"})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsxs(Y,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ce,{className:"text-lg",children:"Quick Actions"}),e.jsx(de,{variant:"blue",children:"Fast Track"})]})}),e.jsx(X,{children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs(j,{className:"w-full justify-start",variant:"outline",onClick:()=>_(!0),children:[e.jsx(kn,{className:"h-4 w-4 mr-3"}),"Add New Customer"]}),e.jsxs(j,{className:"w-full justify-start",variant:"outline",onClick:()=>R(!0),children:[e.jsx(Al,{className:"h-4 w-4 mr-3"}),"Create Quote"]}),e.jsxs(j,{className:"w-full justify-start",variant:"outline",onClick:()=>E(!0),children:[e.jsx(Fl,{className:"h-4 w-4 mr-3"}),"Generate Invoice"]}),e.jsxs(j,{disabled:!0,className:"w-full justify-start",variant:"outline",children:[e.jsx(Ll,{className:"h-4 w-4 mr-3"}),"Update Kanban"," ",e.jsx("span",{className:"text-red-400 ml-2 font-extralight",children:"Coming Soon!"})]}),e.jsxs(j,{disabled:!0,className:"w-full justify-start",variant:"outline",children:[e.jsx(tt,{className:"h-4 w-4 mr-3"}),"Schedule Visit"," ",e.jsx("span",{className:"text-red-400 ml-2 font-extralight",children:"Coming Soon!"})]})]})})]}),e.jsxs(Y,{className:"lg:col-span-2",children:[e.jsx(re,{children:e.jsx(ce,{className:"text-lg",children:"Business Status Overview"})}),e.jsxs(X,{children:[c?e.jsxs("div",{className:"flex items-center justify-center h-32",children:[e.jsx(Yt,{className:"h-6 w-6 animate-spin text-gray-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading business status..."})]}):u||!l?e.jsx("div",{className:"flex items-center justify-center h-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx(At,{className:"h-6 w-6 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-600 text-sm",children:"Error loading business status"})]})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Quote Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ct,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Accepted"})]}),e.jsx(de,{variant:"green",children:l.quoteStatus.accepted})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Js,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pending"})]}),e.jsx(de,{variant:"yellow",children:l.quoteStatus.pending})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(pa,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Rejected"})]}),e.jsx(de,{variant:"red",children:l.quoteStatus.rejected})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Invoice Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ge,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Paid"})]}),e.jsx(de,{variant:"green",children:l.invoiceStatus.paid})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Js,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Pending"})]}),e.jsx(de,{variant:"yellow",children:l.invoiceStatus.pending})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(At,{className:"h-4 w-4 text-red-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Overdue"})]}),e.jsx(de,{variant:"red",children:l.invoiceStatus.overdue})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Project Status"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ol,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Active"})]}),e.jsx(de,{variant:"blue",children:l.projectStatus.active})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx($l,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"On Hold"})]}),e.jsx(de,{variant:"yellow",children:l.projectStatus.onHold})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ct,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Completed"})]}),e.jsx(de,{variant:"green",children:l.projectStatus.completed})]})]})]})]}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"font-medium text-gray-700 dark:text-gray-300 mb-4",children:"Customer Types"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-full",children:e.jsx(fa,{className:"h-4 w-4 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Residential"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Active customers"})]})]}),e.jsx(de,{variant:"blue",children:"189"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 dark:bg-purple-900 rounded-full",children:e.jsx(qn,{className:"h-4 w-4 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Commercial"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Business clients"})]})]}),e.jsx(de,{variant:"default",children:"58"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900 rounded-full",children:e.jsx(Kt,{className:"h-4 w-4 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Referrals"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Word of mouth"})]})]}),e.jsx(de,{variant:"green",children:"34"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 dark:bg-orange-900 rounded-full",children:e.jsx(Ml,{className:"h-4 w-4 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"New Leads"}),e.jsx("p",{className:"text-xs text-gray-500",children:"This month"})]})]}),e.jsx(de,{variant:"yellow",children:"42"})]})]})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(Y,{className:"p-6",children:[e.jsxs(Wr,{className:"text-gray-900 dark:text-white",children:[o.length,"-Year Revenue Trend"]}),e.jsxs(Gr,{className:"text-gray-600 dark:text-gray-400",children:["Monthly revenue growth from ",o[0]," to current (",o[o.length-1],")"]}),n?e.jsxs("div",{className:"mt-6 h-96 flex items-center justify-center",children:[e.jsx(Yt,{className:"h-8 w-8 animate-spin text-gray-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading revenue data..."})]}):i||!r?e.jsx("div",{className:"mt-6 h-96 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(At,{className:"h-8 w-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-600",children:"Error loading revenue data"})]})}):e.jsx(wc,{data:r,index:"month",categories:o,colors:["gray","red","yellow","blue","green"].slice(0,o.length),className:"mt-6 h-96",valueFormatter:F=>`$${(F/1e3).toFixed(0)}K`,showAnimation:!0,showLegend:!0,showGridLines:!0,connectNulls:!1})]})}),e.jsxs(Y,{className:"p-6",children:[e.jsx(Wr,{className:"text-gray-900 dark:text-white",children:"Invoice Status"}),e.jsx(Gr,{className:"text-gray-600 dark:text-gray-400",children:"Payment tracking"}),p?e.jsxs("div",{className:"mt-6 flex items-center justify-center h-32",children:[e.jsx(Yt,{className:"h-6 w-6 animate-spin text-gray-500"}),e.jsx("span",{className:"ml-2 text-gray-500",children:"Loading invoice data..."})]}):g||!h?e.jsx("div",{className:"mt-6 flex items-center justify-center h-32",children:e.jsxs("div",{className:"text-center",children:[e.jsx(At,{className:"h-8 w-8 text-red-500 mx-auto mb-2"}),e.jsx("p",{className:"text-red-600",children:"Error loading invoice data"})]})}):e.jsx("div",{className:"mt-6 space-y-4",children:Object.entries(h).map(([F,L])=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:L.status}),e.jsxs("p",{className:"text-sm text-gray-500",children:[L.count," invoices"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-white",children:L.amount>=1e3?`$${(L.amount/1e3).toFixed(0)}K`:`$${L.amount}`}),e.jsx(de,{variant:L.status==="Paid"?"green":L.status==="Pending"?"yellow":L.status==="Draft"?"gray":"red",children:L.status})]})]},F))})]})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4"})]}),e.jsx(De,{open:N,onOpenChange:_,children:e.jsxs(Re,{className:"w-full sm:max-w-lg px-2",children:[e.jsx(ke,{className:"px-4 space-y-0 mb-4",children:e.jsx(qe,{children:"Add New Customer"})}),e.jsx(Je,{className:"h-[calc(100vh-120px)]",children:e.jsx(hs,{setOpen:_})})]})}),e.jsx(De,{open:m,onOpenChange:R,children:e.jsxs(Re,{className:"w-full sm:max-w-lg px-2",children:[e.jsx(ke,{className:"px-4 space-y-0 mb-4",children:e.jsx(qe,{children:"Create New Quote"})}),e.jsx(Je,{className:"h-[calc(100vh-120px)]",children:e.jsx(ra,{})})]})}),e.jsx(De,{open:S,onOpenChange:E,children:e.jsxs(Re,{className:"w-full sm:max-w-lg px-2",children:[e.jsx(ke,{className:"px-4 space-y-0 mb-4",children:e.jsx(qe,{children:"Create New Invoice"})}),e.jsx(Je,{className:"h-[calc(100vh-120px)]",children:e.jsx(na,{setOpen:E})})]})})]})}function ee({className:t,...s}){return e.jsx("div",{className:A("animate-pulse rounded-md bg-muted",t),...s})}function _t({title:t,totalCount:s,icon:a,isLoading:r}){return r?e.jsx(ee,{className:"flex flex-col p-6 rounded-lg shadow-xs w-full md:w-[35%] h-[131px] md:h-[140px]"}):e.jsxs("div",{className:"flex flex-col border p-6 rounded-lg shadow-xs w-full md:w-[35%] md:h-[140px] justify-center bg-slate-100 dark:bg-zinc-800",children:[e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("p",{className:"font-[500]",children:t}),a]}),e.jsxs("div",{className:"flex mt-2 font-[600]",children:[e.jsx("p",{className:"text-[32px] w-[60%] ",children:s}),e.jsx("div",{className:"flex w-[40%] justify-end",children:e.jsx("div",{className:"mb-1 w-[80px] h-[34px] border-2 border-green-500 mt-auto rounded-2xl",children:e.jsxs("div",{className:"flex w-full h-full justify-center gap-1",children:[e.jsx("div",{className:"flex flex-col justify-center",children:e.jsx(Dn,{size:"20px",className:"text-green-700"})}),e.jsx("p",{className:"text-[14px] font-[500] my-auto text-green-500",children:"0%"})]})})})]})]})}function Wu({icon:t,entity:s,activateModal:a,sheetTitle:r,sheetDescription:n,SheetContentBody:i}){const[o,l]=le.useState(!1);return e.jsx("div",{className:"flex w-full justify-center p-8 mx-auto mt-4 max-w-[600px] shadow-sm border rounded-lg dark:bg-zinc-800",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"mx-auto p-3 border rounded-lg w-max dark:border-zinc-700",children:t}),e.jsxs("p",{className:"font-[600] text-18px text-center",children:["No ",s,"s found"]}),e.jsxs("p",{className:"text-[14px] font-[400] mb-6",children:["Click on the button below to add a new ",s," to system."]}),e.jsx("div",{className:"flex justify-center text-[16px]",children:e.jsxs(De,{open:o,onOpenChange:l,children:[e.jsx(as,{asChild:!0,children:e.jsxs(j,{variant:"primary",onClick:a,children:[e.jsx(rr,{className:"mr-2 h-4 w-4"})," Add ",s]})}),e.jsxs(Re,{className:"w-full sm:max-w-xl overflow-y-auto px-2",children:[e.jsxs(ke,{className:"px-4 space-y-0",children:[e.jsx(qe,{children:r}),e.jsx(Ct,{children:n})]}),e.jsx(Je,{className:"w-full h-full pb-8 pt-6",children:e.jsx(i,{open:o})})]})]})})]})})}const is=d.forwardRef(({className:t,...s},a)=>e.jsx("div",{className:"w-full overflow-auto",children:e.jsx("table",{ref:a,className:A("w-full caption-bottom text-sm",t),...s})}));is.displayName="Table";const ls=d.forwardRef(({className:t,...s},a)=>e.jsx("thead",{ref:a,className:A("[&_tr]:border-b",t),...s}));ls.displayName="TableHeader";const cs=d.forwardRef(({className:t,...s},a)=>e.jsx("tbody",{ref:a,className:A("[&_tr:last-child]:border-0",t),...s}));cs.displayName="TableBody";const Gu=d.forwardRef(({className:t,...s},a)=>e.jsx("tfoot",{ref:a,className:A("bg-primary font-medium text-primary-foreground",t),...s}));Gu.displayName="TableFooter";const We=d.forwardRef(({className:t,...s},a)=>e.jsx("tr",{ref:a,className:A("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",t),...s}));We.displayName="TableRow";const he=d.forwardRef(({className:t,...s},a)=>e.jsx("th",{ref:a,className:A("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",t),...s}));he.displayName="TableHead";const ue=d.forwardRef(({className:t,...s},a)=>e.jsx("td",{ref:a,className:A("p-4 align-middle [&:has([role=checkbox])]:pr-0",t),...s}));ue.displayName="TableCell";const Va=d.forwardRef(({className:t,...s},a)=>e.jsx("caption",{ref:a,className:A("mt-4 text-sm text-muted-foreground",t),...s}));Va.displayName="TableCaption";function Ea({data:t,isLoading:s,entity:a,activateModal:r,columns:n,EntityFilterBar:i,firstSelectName:o,secondSelectName:l,thirdSelectName:c,filterBarEntity:u,emptyStateSheetTitle:h,emptyStateSheetDescription:p,EmptyStateSheetBody:g}){const[N,_]=le.useState([]),[m,R]=le.useState([]),[S,E]=le.useState(""),b=Ac({data:t,columns:n,getCoreRowModel:$c(),getPaginationRowModel:Oc(),onSortingChange:_,getSortedRowModel:Lc(),onColumnFiltersChange:R,getFilteredRowModel:Fc(),onGlobalFilterChange:E,state:{sorting:N,columnFilters:m,globalFilter:S}}),[O,F]=le.useState("10");return s?e.jsxs("div",{className:"flex flex-col w-full gap-6",children:[e.jsx(ee,{className:"w-full h-[115px] rounded-lg"}),e.jsx(ee,{className:"w-full h-[400px] rounded-lg"})]}):t.length===0?e.jsx(Wu,{entity:a,icon:e.jsx(zl,{size:"20px"}),activateModal:!1,sheetTitle:h||"",sheetDescription:p||"",SheetContentBody:g}):e.jsxs(e.Fragment,{children:[e.jsx(i,{rootTable:b,entity:u,columnEntity:u,firstSelectName:o,secondSelectName:l,thirdSelectName:c}),e.jsxs("div",{className:"w-full border rounded-lg overflow-hidden",children:[e.jsxs(is,{className:"",children:[e.jsx(ls,{className:"bg-slate-100 dark:bg-zinc-800",children:b.getHeaderGroups().map(L=>e.jsx(We,{className:"rounded-full bg-slate-100 dark:bg-zinc-800 hover:bg-slate-100 dark:hover:bg-zinc-800",children:L.headers.map(H=>e.jsx(he,{children:H.isPlaceholder?null:Yr(H.column.columnDef.header,H.getContext())},H.id))},L.id))}),e.jsx(cs,{children:b.getRowModel().rows.map(L=>e.jsx(We,{className:"hover:bg-transparent",children:L.getVisibleCells().map(H=>e.jsx(ue,{children:Yr(H.column.columnDef.cell,H.getContext())},H.id))},L.id))})]}),e.jsxs("div",{className:"grid grid-flow-row grid-cols-3 gap-4 w-full p-4 border-t rounded-b-lg ",children:[e.jsx("div",{className:"",children:e.jsxs(j,{variant:"secondary",disabled:!b.getCanPreviousPage(),onClick:()=>b.previousPage(),children:[e.jsx(nr,{className:"mr-2 h-4 w-4"})," ",e.jsx("p",{className:"font-[500] hidden md:flex",children:"Previous"})]})}),e.jsxs("div",{className:"flex my-auto w-full justify-center gap-4 md:flex-row flex-col-reverse",children:[e.jsxs("div",{className:"flex gap-1 my-auto text-[14px] font-[400] mx-auto md:mx-0",children:[e.jsx("p",{children:"Page"}),e.jsx("p",{className:"font-[700]",children:b.getState().pagination.pageIndex+1}),e.jsx("p",{children:"of"}),e.jsx("p",{className:"font-[600]",children:b.getPageCount()})]}),e.jsx("div",{className:"flex my-auto gap-2",children:e.jsxs(Ce,{onValueChange:L=>b.setPageSize(Number(L)),children:[e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select page size"})}),e.jsx(Ye,{children:["10","20","30","40","50","100"].map((L,H)=>e.jsxs(et,{value:L,children:["Show ",L]},H))})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(j,{variant:"secondary",onClick:()=>b.nextPage(),disabled:!b.getCanNextPage(),children:[e.jsx("p",{className:"font-[500] hidden md:flex",children:"Next"})," ",e.jsx(Dt,{className:"md:ml-4 h-4 w-4"})]})})]})]})]})}function xe({title:t,colorScheme:s,variant:a}){return e.jsx(de,{variant:a,children:e.jsxs("div",{className:"flex gap-2",children:[a==="blue"?e.jsx("div",{className:"w-1 h-1 p-1 rounded-full my-auto bg-blue-500"}):a==="green"?e.jsx("div",{className:"w-1 h-1 p-1 rounded-full my-auto bg-[#37A169]"}):a==="gray"?e.jsx("div",{className:"w-1 h-1 p-1 rounded-full my-auto bg-gray-500"}):a==="yellow"?e.jsx("div",{className:"w-1 h-1 p-1 rounded-full my-auto bg-[#D59E2E]"}):a==="red"?e.jsx("div",{className:"w-1 h-1 p-1 rounded-full my-auto bg-[#E53E3E]"}):"",e.jsx("p",{className:"text-[12px] font-[500]",children:t})]})})}function ni({streetAddress:t,city:s,state:a,zipcode:r,addressQuery:n,textSize:i}){return e.jsxs(xt,{children:[e.jsxs(ht,{children:[!i&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-1 font-[400] text-[14px] cursor-pointer hover:text-blue-500",children:[e.jsx("p",{children:t}),e.jsxs("p",{children:[s,","]}),e.jsx("p",{children:a}),e.jsx("p",{children:r})]})}),i==="md"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-1 font-[400] text-[16px] cursor-pointer hover:text-blue-500",children:[e.jsx("p",{children:t}),e.jsxs("p",{children:[s,","]}),e.jsx("p",{children:a}),e.jsx("p",{children:r})]})}),i==="sm"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex gap-1 font-light text-sm cursor-pointer hover:text-blue-500",children:[e.jsx("p",{children:t}),e.jsxs("p",{children:[s,","]}),e.jsx("p",{children:a}),e.jsx("p",{children:r})]})})]}),e.jsxs(st,{className:"w-full h-full px-6 py-6",children:[e.jsx("iframe",{src:`https://maps.google.com/maps?f=q&source=s_q&hl=en&geocode=&q='${n}'&z=14&output=embed`,className:"border mx-auto my-auto rounded-lg bg-secondary w-[300px] h-[200px] md:w-[600px] md:h-[320px]",allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade"}),e.jsxs("div",{className:"flex justify-between pt-6 flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-[20px] font-[600]",children:t}),e.jsxs("p",{className:"font-[400]",children:[s,", ",a," ",r]})]}),e.jsx("div",{className:"w-full md:w-[300px]",children:e.jsxs(j,{className:"w-full",variant:"primary",onClick:()=>window.open(`https://www.google.com/maps/search/?api=1&query=${n}`),children:[e.jsx(Ul,{className:"h-4 w-4 mr-4"}),"Visit Google Maps"]})})]})]})]})}const us=ba(),Yu={weekday:"long",year:"numeric",month:"short",day:"numeric"},Xu=[us.accessor(t=>`${t.first_name} ${t.last_name} ${t.email} ${t.street_address} ${t.city} ${t.zipcode} ${t.phone_number}`,{id:"customer",cell:({row:t})=>{const s=t.original;return e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{}),e.jsx(Rt,{className:"border w-[45px] h-[45px] bg-blue-100 dark:bg-blue-700/30",children:e.jsx(kt,{children:`${s.first_name.substring(0,1)}${s.last_name.substring(0,1)}`})}),e.jsxs("div",{className:"text-[14px]",children:[e.jsxs("div",{className:"flex gap-1 font-[600]",children:[e.jsx("p",{children:s.first_name}),e.jsx("p",{children:s.last_name})]}),e.jsx("p",{className:"font-[300]",children:s.email})]})]})},header:({column:t})=>e.jsxs(j,{className:"py-0 gap-2",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Customer",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})}),us.accessor("customer_type_id",{cell:({row:t})=>{const s=t.original;return s.customer_type.name==="Residential"?e.jsx(xe,{title:s.customer_type.name,variant:"blue"}):s.customer_type.name==="Commercial"?e.jsx(xe,{title:s.customer_type.name,variant:"green"}):e.jsx(xe,{title:s.customer_type.name,variant:"gray"})},header:({column:t})=>e.jsxs(j,{variant:"ghost",className:"px-0 gap-2",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Type",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})}),us.accessor("address",{cell:({row:t})=>{const s=t.original,a=`${s.street_address}+${s.city}+${s.state}+${s.zipcode}`;return e.jsx(ni,{streetAddress:s.street_address,city:s.city,state:s.state,zipcode:s.zipcode,addressQuery:a})},header:()=>e.jsx("p",{className:"min-w-[300px]",children:"Address"})}),us.accessor("phone_number",{cell:({row:t})=>{const s=t.original;return e.jsx("p",{className:"font-[400] text-[14px] min-w-[150px]",children:s.phone_number})},header:()=>e.jsx("p",{children:"Phone Number"})}),us.accessor("created_at",{cell:({row:t})=>{const s=t.original;return e.jsx("p",{className:"text-[14px]",children:new Date(s.created_at).toLocaleDateString("en-us",Yu)})},header:({column:t})=>e.jsx("div",{className:"flex gap-4 min-w-[180px]",children:e.jsxs(j,{className:"gap-2 px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Registered Since",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),us.accessor("actions",{cell:({row:t})=>{const s=t.original;return e.jsx(Pe,{to:`/customers/${s.id}`,children:e.jsx(j,{variant:"secondary",children:e.jsx(Dt,{size:"15px"})})})},header:()=>e.jsx("p",{children:"Actions"})})];var Zu=Xu;function Ia({rootTable:t,entity:s,columnEntity:a,firstSelectName:r,secondSelectName:n,thirdSelectName:i}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"flex w-full shadow-xs gap-4 border px-[1rem] py-6 rounded-lg flex-col md:flex-row bg-slate-100 dark:bg-zinc-800",children:[e.jsxs("div",{className:"w-full md:w-[40%]",children:[e.jsxs("p",{className:"mb-1 text-muted-foreground text-[14px]",children:["Search for ",s]}),e.jsx(Q,{className:"bg-white dark:bg-zinc-900",name:`search_${s}`,type:"search",placeholder:`Enter ${s} information here...`,onChange:o=>t?.getColumn(a)?.setFilterValue(o.target.value),value:t?.getColumn(a)?.getFilterValue()??""})]}),e.jsxs("div",{className:"grid grid-flow-row grid-cols-1 gap-4 w-full md:w-[60%] md:grid-cols-3",children:[e.jsxs("div",{className:"text-[14px] font-[500]",children:[e.jsx("p",{className:"mb-1 text-muted-foreground text-[14px]",children:r}),e.jsxs(Ce,{children:[e.jsx(Ne,{className:"bg-white dark:bg-zinc-900",children:e.jsx(_e,{placeholder:"All"})}),e.jsx(Ye,{children:e.jsx(et,{value:"all",children:"All"})})]})]}),e.jsxs("div",{className:"text-[14px] font-[500]",children:[e.jsx("p",{className:"mb-1 text-muted-foreground text-[14px]",children:n}),e.jsxs(Ce,{children:[e.jsx(Ne,{className:"bg-white dark:bg-zinc-900",children:e.jsx(_e,{placeholder:"All"})}),e.jsx(Ye,{children:e.jsx(et,{value:"all",children:"All"})})]})]}),e.jsxs("div",{className:"text-[14px] font-[500]",children:[e.jsx("p",{className:"mb-1 text-muted-foreground text-[14px]",children:i}),e.jsxs(Ce,{children:[e.jsx(Ne,{className:"bg-white dark:bg-zinc-900",children:e.jsx(_e,{placeholder:"All"})}),e.jsx(Ye,{children:e.jsx(et,{value:"all",children:"All"})})]})]})]})]})})})}function Ju(){const{customers:t,isLoading:s}=Bs(),{data:a,isLoading:r}=Rd(),{data:n,isLoading:i}=kd(),{data:o,isLoading:l}=qd();return e.jsxs("div",{className:"flex flex-col w-full gap-6 mb-6",children:[e.jsx(Ns,{title:"Customers",subheading:"Manage customers and view information focused on them.",addItemTextButton:"Add customer",sheetTitle:"Add customer",sheetDescription:"Create a new customer to track their content.",SheetContentBody:hs}),e.jsxs("div",{className:"flex w-full gap-4 flex-col md:flex-row",children:[e.jsx(_t,{title:"Total Customers",totalCount:a??0,icon:e.jsx(Us,{size:"25px"}),isLoading:r}),e.jsx(_t,{title:"Residential",totalCount:n??0,icon:e.jsx(Ql,{size:"25px"}),isLoading:i}),e.jsx(_t,{title:"Commercial",totalCount:o??0,icon:e.jsx(qn,{size:"25px"}),isLoading:l})]}),e.jsx(Ea,{data:t,isLoading:s,columns:Zu,entity:"customer",EntityFilterBar:Ia,activateModal:!1,firstSelectName:"Type",secondSelectName:"State",thirdSelectName:"Zipcode",filterBarEntity:"customer",EmptyStateSheetBody:hs,emptyStateSheetTitle:"Add customer",emptyStateSheetDescription:"Create a new customer to track their content."})]})}function em({setOpen:t}){return e.jsx("div",{children:"AddJobForm"})}function tm(){return e.jsx("div",{className:"w-full",children:e.jsx(Ns,{title:"Jobs",subheading:"Manage multiple jobs at the same time to quickly glance all active jobs.",addItemTextButton:"Add job",sheetTitle:"Add job",sheetDescription:"Create a new job to start managing a new job within the company.",SheetContentBody:em})})}var[Pa]=$s("Tooltip",[wn]),Da=wn(),oi="TooltipProvider",sm=700,Ha="tooltip.open",[am,yr]=Pa(oi),ii=t=>{const{__scopeTooltip:s,delayDuration:a=sm,skipDelayDuration:r=300,disableHoverableContent:n=!1,children:i}=t,o=d.useRef(!0),l=d.useRef(!1),c=d.useRef(0);return d.useEffect(()=>{const u=c.current;return()=>window.clearTimeout(u)},[]),e.jsx(am,{scope:s,isOpenDelayedRef:o,delayDuration:a,onOpen:d.useCallback(()=>{window.clearTimeout(c.current),o.current=!1},[]),onClose:d.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(()=>o.current=!0,r)},[r]),isPointerInTransitRef:l,onPointerInTransitChange:d.useCallback(u=>{l.current=u},[]),disableHoverableContent:n,children:i})};ii.displayName=oi;var Rs="Tooltip",[rm,Ra]=Pa(Rs),li=t=>{const{__scopeTooltip:s,children:a,open:r,defaultOpen:n,onOpenChange:i,disableHoverableContent:o,delayDuration:l}=t,c=yr(Rs,t.__scopeTooltip),u=Da(s),[h,p]=d.useState(null),g=bl(),N=d.useRef(0),_=o??c.disableHoverableContent,m=l??c.delayDuration,R=d.useRef(!1),[S,E]=ar({prop:r,defaultProp:n??!1,onChange:H=>{H?(c.onOpen(),document.dispatchEvent(new CustomEvent(Ha))):c.onClose(),i?.(H)},caller:Rs}),b=d.useMemo(()=>S?R.current?"delayed-open":"instant-open":"closed",[S]),O=d.useCallback(()=>{window.clearTimeout(N.current),N.current=0,R.current=!1,E(!0)},[E]),F=d.useCallback(()=>{window.clearTimeout(N.current),N.current=0,E(!1)},[E]),L=d.useCallback(()=>{window.clearTimeout(N.current),N.current=window.setTimeout(()=>{R.current=!0,E(!0),N.current=0},m)},[m,E]);return d.useEffect(()=>()=>{N.current&&(window.clearTimeout(N.current),N.current=0)},[]),e.jsx(Nl,{...u,children:e.jsx(rm,{scope:s,contentId:g,open:S,stateAttribute:b,trigger:h,onTriggerChange:p,onTriggerEnter:d.useCallback(()=>{c.isOpenDelayedRef.current?L():O()},[c.isOpenDelayedRef,L,O]),onTriggerLeave:d.useCallback(()=>{_?F():(window.clearTimeout(N.current),N.current=0)},[F,_]),onOpen:O,onClose:F,disableHoverableContent:_,children:a})})};li.displayName=Rs;var Ka="TooltipTrigger",ci=d.forwardRef((t,s)=>{const{__scopeTooltip:a,...r}=t,n=Ra(Ka,a),i=yr(Ka,a),o=Da(a),l=d.useRef(null),c=St(s,l,n.onTriggerChange),u=d.useRef(!1),h=d.useRef(!1),p=d.useCallback(()=>u.current=!1,[]);return d.useEffect(()=>()=>document.removeEventListener("pointerup",p),[p]),e.jsx(wl,{asChild:!0,...o,children:e.jsx(Fe.button,{"aria-describedby":n.open?n.contentId:void 0,"data-state":n.stateAttribute,...r,ref:c,onPointerMove:we(t.onPointerMove,g=>{g.pointerType!=="touch"&&!h.current&&!i.isPointerInTransitRef.current&&(n.onTriggerEnter(),h.current=!0)}),onPointerLeave:we(t.onPointerLeave,()=>{n.onTriggerLeave(),h.current=!1}),onPointerDown:we(t.onPointerDown,()=>{n.open&&n.onClose(),u.current=!0,document.addEventListener("pointerup",p,{once:!0})}),onFocus:we(t.onFocus,()=>{u.current||n.onOpen()}),onBlur:we(t.onBlur,n.onClose),onClick:we(t.onClick,n.onClose)})})});ci.displayName=Ka;var nm="TooltipPortal",[bp,om]=Pa(nm,{forceMount:void 0}),fs="TooltipContent",di=d.forwardRef((t,s)=>{const a=om(fs,t.__scopeTooltip),{forceMount:r=a.forceMount,side:n="top",...i}=t,o=Ra(fs,t.__scopeTooltip);return e.jsx(ds,{present:r||o.open,children:o.disableHoverableContent?e.jsx(ui,{side:n,...i,ref:s}):e.jsx(im,{side:n,...i,ref:s})})}),im=d.forwardRef((t,s)=>{const a=Ra(fs,t.__scopeTooltip),r=yr(fs,t.__scopeTooltip),n=d.useRef(null),i=St(s,n),[o,l]=d.useState(null),{trigger:c,onClose:u}=a,h=n.current,{onPointerInTransitChange:p}=r,g=d.useCallback(()=>{l(null),p(!1)},[p]),N=d.useCallback((_,m)=>{const R=_.currentTarget,S={x:_.clientX,y:_.clientY},E=mm(S,R.getBoundingClientRect()),b=xm(S,E),O=hm(m.getBoundingClientRect()),F=fm([...b,...O]);l(F),p(!0)},[p]);return d.useEffect(()=>()=>g(),[g]),d.useEffect(()=>{if(c&&h){const _=R=>N(R,h),m=R=>N(R,c);return c.addEventListener("pointerleave",_),h.addEventListener("pointerleave",m),()=>{c.removeEventListener("pointerleave",_),h.removeEventListener("pointerleave",m)}}},[c,h,N,g]),d.useEffect(()=>{if(o){const _=m=>{const R=m.target,S={x:m.clientX,y:m.clientY},E=c?.contains(R)||h?.contains(R),b=!pm(S,o);E?g():b&&(g(),u())};return document.addEventListener("pointermove",_),()=>document.removeEventListener("pointermove",_)}},[c,h,o,u,g]),e.jsx(ui,{...t,ref:i})}),[lm,cm]=Pa(Rs,{isInside:!1}),dm=ul("TooltipContent"),ui=d.forwardRef((t,s)=>{const{__scopeTooltip:a,children:r,"aria-label":n,onEscapeKeyDown:i,onPointerDownOutside:o,...l}=t,c=Ra(fs,a),u=Da(a),{onClose:h}=c;return d.useEffect(()=>(document.addEventListener(Ha,h),()=>document.removeEventListener(Ha,h)),[h]),d.useEffect(()=>{if(c.trigger){const p=g=>{g.target?.contains(c.trigger)&&h()};return window.addEventListener("scroll",p,{capture:!0}),()=>window.removeEventListener("scroll",p,{capture:!0})}},[c.trigger,h]),e.jsx(yl,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:p=>p.preventDefault(),onDismiss:h,children:e.jsxs(vl,{"data-state":c.stateAttribute,...u,...l,ref:s,style:{...l.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[e.jsx(dm,{children:r}),e.jsx(lm,{scope:a,isInside:!0,children:e.jsx(pc,{id:c.contentId,role:"tooltip",children:n||r})})]})})});di.displayName=fs;var mi="TooltipArrow",um=d.forwardRef((t,s)=>{const{__scopeTooltip:a,...r}=t,n=Da(a);return cm(mi,a).isInside?null:e.jsx(Cl,{...n,...r,ref:s})});um.displayName=mi;function mm(t,s){const a=Math.abs(s.top-t.y),r=Math.abs(s.bottom-t.y),n=Math.abs(s.right-t.x),i=Math.abs(s.left-t.x);switch(Math.min(a,r,n,i)){case i:return"left";case n:return"right";case a:return"top";case r:return"bottom";default:throw new Error("unreachable")}}function xm(t,s,a=5){const r=[];switch(s){case"top":r.push({x:t.x-a,y:t.y+a},{x:t.x+a,y:t.y+a});break;case"bottom":r.push({x:t.x-a,y:t.y-a},{x:t.x+a,y:t.y-a});break;case"left":r.push({x:t.x+a,y:t.y-a},{x:t.x+a,y:t.y+a});break;case"right":r.push({x:t.x-a,y:t.y-a},{x:t.x-a,y:t.y+a});break}return r}function hm(t){const{top:s,right:a,bottom:r,left:n}=t;return[{x:n,y:s},{x:a,y:s},{x:a,y:r},{x:n,y:r}]}function pm(t,s){const{x:a,y:r}=t;let n=!1;for(let i=0,o=s.length-1;i<s.length;o=i++){const l=s[i],c=s[o],u=l.x,h=l.y,p=c.x,g=c.y;h>r!=g>r&&a<(p-u)*(r-h)/(g-h)+u&&(n=!n)}return n}function fm(t){const s=t.slice();return s.sort((a,r)=>a.x<r.x?-1:a.x>r.x?1:a.y<r.y?-1:a.y>r.y?1:0),gm(s)}function gm(t){if(t.length<=1)return t.slice();const s=[];for(let r=0;r<t.length;r++){const n=t[r];for(;s.length>=2;){const i=s[s.length-1],o=s[s.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))s.pop();else break}s.push(n)}s.pop();const a=[];for(let r=t.length-1;r>=0;r--){const n=t[r];for(;a.length>=2;){const i=a[a.length-1],o=a[a.length-2];if((i.x-o.x)*(n.y-o.y)>=(i.y-o.y)*(n.x-o.x))a.pop();else break}a.push(n)}return a.pop(),s.length===1&&a.length===1&&s[0].x===a[0].x&&s[0].y===a[0].y?s:s.concat(a)}var jm=ii,ym=li,vm=ci,xi=di;const ks=jm,qs=ym,As=vm,gs=d.forwardRef(({className:t,sideOffset:s=4,...a},r)=>e.jsx(xi,{ref:r,sideOffset:s,className:A("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-85 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a}));gs.displayName=xi.displayName;function vr({avatarUrl:t,firstName:s,lastName:a,email:r,phoneNumber:n,streetAddress:i,city:o,state:l,zipcode:c,customerId:u}){return e.jsxs(xt,{children:[e.jsx(ht,{children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(Rt,{className:"border bg-blue-100 dark:bg-blue-700/30",children:[e.jsx(ps,{src:t}),e.jsx(kt,{children:`${s.substring(0,1)}${a.substring(0,1)}`})]}),e.jsxs("div",{className:"-space-y-0 my-auto",children:[e.jsxs("div",{className:"flex gap-1 font-[600]",children:[e.jsx("p",{children:s}),e.jsx("p",{children:a})]}),e.jsx("p",{className:" text-xs font-[300]",children:r})]})]})}),e.jsx(st,{className:"w-[300px] h-[400px] p-6",children:e.jsxs("div",{className:"w-full h-full",children:[e.jsx("div",{className:"w-full",children:e.jsxs(Rt,{className:"border w-[120px] h-[120px] mx-auto bg-blue-100 dark:bg-blue-700/30",children:[e.jsx(ps,{src:t,sizes:"xl",className:"mx-auto"}),e.jsx(kt,{className:"text-4xl",children:`${s.substring(0,1)}${a.substring(0,1)}`})]})}),e.jsxs("p",{className:"mx-auto text-center mt-4 font-[600] text-[24px] mb-2",children:[s," ",a]}),e.jsx("p",{className:"text-center font-[400] text-muted-foreground",children:r}),e.jsx("p",{className:"text-center font-[400] text-muted-foreground mb-2",children:n}),e.jsx("p",{className:"text-center font-[400] text-muted-foreground",children:i}),e.jsxs("p",{className:"text-center font-[400] text-muted-foreground",children:[o,", ",l," ",c]}),e.jsxs("div",{className:"grid w-full grid-flow-row grid-cols-3 mt-6 gap-4",children:[e.jsx(j,{asChild:!0,variant:"primary",children:e.jsx("a",{href:`mailto:${r}`,target:"_blank",rel:"noreferrer",children:e.jsx(Is,{size:"18px"})})}),e.jsx(j,{variant:"primary",onClick:()=>window.open(`https://www.google.com/maps/search/?api=1&query=${i}+${o}+${l}+${c}`),children:e.jsx(An,{size:"18px"})}),e.jsx(j,{asChild:!0,variant:"primary",children:e.jsx(Pe,{to:`/customers/${u}`,children:e.jsx(Dt,{size:"18px"})})})]})]})})]})}const vt=[{title:"Custom Address",description:"Manual input for address",icon:e.jsx(zs,{className:"w-5 h-5 my-auto mx-auto"})},{title:"General Notes",description:"To jot down general info",icon:e.jsx(ma,{className:"w-5 h-5 my-auto mx-auto"})},{title:"Measurements Note",description:"To write roof measurement",icon:e.jsx(xa,{className:"w-5 h-5 my-auto mx-auto"})},{title:"Customer Note",description:"Write a note to customer",icon:e.jsx(ha,{className:"w-5 h-5 my-auto mx-auto"})}];function bm({quote:t,quoteLineItems:s,onSuccess:a}){const r=fe(),{customers:n}=Bs(),{data:i}=Vs(),{quoteStatuses:o}=gr(),[l,c]=d.useState(!!t.custom_address),[u,h]=d.useState(!!t.private_note),[p,g]=d.useState(!!t.measurement_note),[N,_]=d.useState(!!t.public_note),m=Tt({resolver:gt(gu),defaultValues:{id:t.id,quote_number:t.quote_number,customer_id:t.customer_id,service_id:t.service_id,status_id:t.status_id,quote_date:new Date(t.quote_date),expiration_date:new Date(t.expiration_date),line_items:s?.map(v=>({id:v.id,description:v.description||"",qty:v.qty,amount:v.amount,subtotal:v.subtotal}))||[{description:"",qty:1,amount:0,subtotal:0}],custom_street_address:t.custom_street_address||"",custom_city:t.custom_city||"",custom_state:t.custom_state||"",custom_zipcode:t.custom_zipcode||"",private_note:t.private_note||"",public_note:t.public_note||"",measurement_note:t.measurement_note||""}}),{fields:R,append:S,remove:E}=va({control:m.control,name:"line_items"}),b=m.watch("line_items");d.useEffect(()=>{const v=(b??[]).map($=>({...$,subtotal:$.qty*$.amount}));m.setValue("line_items",v)},[b,m]);const F=(b??[]).reduce((v,$)=>v+$.subtotal,0),L=F;async function H(v){const{data:$,error:x}=await w.from("quote").update(v).eq("id",t.id).select();if(x)throw x;return $}async function ne(v){await w.from("quote_line_item").delete().eq("quote_id",t.quote_number);const $=v.map(f=>{const{id:M,...C}=f;return{...C,quote_id:f.quote_id,service_id:f.service_id,description:f.description||"",qty:f.qty||1,amount:f.amount||0,subtotal:f.subtotal||0,rate:f.rate||f.amount||0,sq_ft:f.sq_ft||0,fixed_item:f.fixed_item||!1}}),{data:x,error:y}=await w.from("quote_line_item").insert($);if(y)throw console.error("Error updating quote line items",y.message),console.error("Line items that failed:",$),y;return x}const G=me({mutationFn:H,onSuccess:()=>{r.invalidateQueries({queryKey:["quotes"]}),r.invalidateQueries({queryKey:["quoteById",t.quote_number]}),r.invalidateQueries({queryKey:["quoteById"]}),r.invalidateQueries({queryKey:["totalPendingQuotes"]}),r.invalidateQueries({queryKey:["totalAcceptedQuotes"]}),r.invalidateQueries({queryKey:["totalRejectedQuotes"]})}}),Z=me({mutationFn:ne,onSuccess:()=>{r.invalidateQueries({queryKey:["quoteLineItems"]}),r.invalidateQueries({queryKey:["quotes"]}),r.invalidateQueries({queryKey:["quoteById",t.quote_number]})}}),oe=async v=>{const{line_items:$,id:x,...y}=v,f={...y,total:L,subtotal:F,custom_address:l,quote_date:y.quote_date.toISOString().split("T")[0],expiration_date:y.expiration_date.toISOString().split("T")[0]},M=$?.map(C=>({...C,quote_id:v.quote_number,service_id:v.service_id}));console.log("Updating quote:",f),console.log("Updating line items:",M);try{await G.mutateAsync(f),M&&await Z.mutateAsync(M),a&&a()}catch(C){console.error("Failed to update quote:",C);let W="Unknown error occurred";C&&typeof C=="object"?"message"in C?W=C.message:"details"in C?W=C.details:W=JSON.stringify(C):typeof C=="string"&&(W=C),alert("Failed to update quote: "+W)}};return e.jsx("div",{className:"w-full pt-4",children:e.jsx(It,{...m,children:e.jsx("form",{onSubmit:m.handleSubmit(oe),children:e.jsxs("div",{className:"space-y-4 h-full pb-6",children:[e.jsx(D,{control:m.control,name:"customer_id",render:({field:v})=>e.jsxs(I,{className:"flex flex-col w-full",children:[e.jsx(P,{children:"Search for customer"}),e.jsx(Ta,{data:n||[],form:m,field:v}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:m.control,name:"quote_number",render:({field:v})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Quote #"}),e.jsx(k,{children:e.jsx(Q,{...v,className:"w-full",value:v.value||"",onChange:$=>{v.onChange($.target.value?parseFloat($.target.value):void 0)}})}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:"status_id",render:({field:v})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Select Status"}),e.jsxs(Ce,{onValueChange:$=>v.onChange(Number($)),value:v.value?String(v.value):void 0,children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select status for quote"})})}),e.jsx(Ve,{data:o||[]})]}),e.jsx(U,{})]})})]}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:m.control,name:"quote_date",render:({field:v})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Quote date"}),e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",className:A("w-full pl-3 text-left font-normal",!v.value&&"text-muted-foreground"),children:[v.value?Wt(v.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(tt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(st,{className:"w-auto p-0 text-start",children:e.jsx(zt,{mode:"single",selected:v.value,onSelect:v.onChange})})]}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:"expiration_date",render:({field:v})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Expiration Date"}),e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",className:A("w-full pl-3 text-left font-normal",!v.value&&"text-muted-foreground"),children:[v.value?Wt(v.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(tt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(st,{className:"w-auto p-0 text-start",children:e.jsx(zt,{mode:"single",selected:v.value,onSelect:v.onChange})})]}),e.jsx(U,{})]})})]}),e.jsx(D,{control:m.control,name:"service_id",render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Select Service"}),e.jsxs(Ce,{onValueChange:$=>v.onChange(Number($)),value:v.value?String(v.value):void 0,children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select a roofing service..."})})}),e.jsx(Ve,{data:i||[]})]}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex flex-col py-2 gap-6",children:[e.jsx(ae,{children:"Line Items"}),R.map((v,$)=>e.jsx(le.Fragment,{children:e.jsxs("div",{className:"grid w-full grid-cols-8 grid-flow-row gap-4",children:[e.jsx(D,{control:m.control,render:({field:x})=>e.jsxs(I,{className:"col-span-6 sm:col-span-4",children:[e.jsx(P,{children:"Description"}),e.jsx(k,{children:e.jsx(Q,{type:"text",...x})})]}),name:`line_items.${$}.description`}),e.jsx(D,{control:m.control,render:({field:x})=>e.jsxs(I,{className:"sm:col-span-1",children:[e.jsx(P,{children:"Qty"}),e.jsx(k,{children:e.jsx(Q,{disabled:!0,...x})})]}),name:`line_items.${$}.qty`}),e.jsx(D,{control:m.control,render:({field:x})=>e.jsxs(I,{className:"col-span-3 sm:col-span-2",children:[e.jsx(P,{children:"Amount"}),e.jsx(k,{children:e.jsx(Q,{type:"text",inputMode:"numeric",pattern:"[0-9]*",...x,onChange:y=>{x.onChange(y.target.value?parseFloat(y.target.value):0)},value:x.value||""})})]}),name:`line_items.${$}.amount`}),e.jsx("div",{className:"sm:col-span-1 mx-auto mt-auto",children:e.jsx(j,{type:"button",variant:"secondary",onClick:()=>E($),children:e.jsx(Ot,{className:"w-4 h-4"})})})]})},$)),e.jsx(j,{type:"button",variant:"secondary",onClick:()=>S({description:"",qty:1,amount:0,subtotal:0}),children:"+ Add Line Item"})]}),e.jsx("div",{className:"w-full mx-auto pt-2 px-6",children:e.jsx("div",{className:"w-full flex flex-col gap-2 text-sm",children:e.jsxs("div",{className:"flex justify-between w-full",children:[e.jsx("p",{className:"my-auto font-light",children:"Subtotal"}),e.jsxs("p",{className:"my-auto font-light",children:["$",se(F)]})]})})}),e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"w-full bg-blue-500 h-[50px] rounded-xl",children:e.jsxs("div",{className:"flex justify-between w-full h-full px-6",children:[e.jsx("p",{className:"my-auto font-bold text-white",children:"Total"}),e.jsxs("p",{className:"my-auto font-light text-white",children:["$",se(L)]})]})})}),e.jsxs("div",{className:"flex flex-col gap-4 pt-2",children:[e.jsx(ae,{children:"Extra Options"}),e.jsx(He,{title:vt[0].title,description:vt[0].description,icon:vt[0].icon,switchValue:l,setSwitchValue:c}),l&&e.jsxs("div",{className:"flex gap-4 flex-col w-full mb-2",children:[e.jsx("div",{className:"w-full",children:e.jsx(D,{render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Street Address"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter address",...v})})]}),name:"custom_street_address"})}),e.jsxs("div",{className:"flex gap-6",children:[e.jsx("div",{className:"w-full",children:e.jsx(D,{render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"City"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter city",...v})})]}),name:"custom_city"})}),e.jsx("div",{className:"w-full",children:e.jsx(D,{render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"State"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter state",...v})})]}),name:"custom_state"})})]}),e.jsx("div",{children:e.jsx(D,{render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Zipcode"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter zipcode",...v})})]}),name:"custom_zipcode"})})]}),e.jsx(He,{title:vt[1].title,description:vt[1].description,icon:vt[1].icon,switchValue:u,setSwitchValue:h}),u&&e.jsx(D,{control:m.control,name:"private_note",render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Internal Note"}),e.jsx(k,{children:e.jsx(ms,{placeholder:"Jot down any notes here...",className:"resize-y rounded-lg h-[150px]",...v})})]})}),e.jsx(He,{title:vt[2].title,description:vt[2].description,icon:vt[2].icon,switchValue:p,setSwitchValue:g}),p&&e.jsx(D,{control:m.control,render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Measurement"}),e.jsx(k,{children:e.jsx(ms,{placeholder:"Write down any measurements about the roof here...",className:"resize-y rounded-lg h-[150px]",...v})})]}),name:"measurement_note"}),e.jsx(He,{title:vt[3].title,description:vt[3].description,icon:vt[3].icon,switchValue:N,setSwitchValue:_}),N&&e.jsx(D,{render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Public Note"}),e.jsx(k,{children:e.jsx(ms,{placeholder:"Tell the customer a custom message...",className:"resize-y rounded-lg h-[150px]",...v})})]}),name:"public_note"})]}),e.jsxs(qt,{className:"pt-4 gap-2",children:[e.jsx(Ke,{asChild:!0,children:e.jsx(j,{type:"submit",disabled:m.formState.isSubmitting||G.isPending||Z.isPending,children:m.formState.isSubmitting||G.isPending||Z.isPending?"Updating...":"Update Quote"})}),e.jsx(Ke,{asChild:!0,children:e.jsx(j,{variant:"secondary",children:"Cancel"})})]})]})})})})}function hi({quote:t,trigger:s}){const{quoteById:a,isLoading:r,isError:n}=si(t.quote_number),i=e.jsxs(j,{variant:"ghost",size:"sm",children:[e.jsx($t,{className:"h-4 w-4"}),"Edit Quote"]});return n?e.jsx("div",{className:"text-red-500 text-sm",children:"Error loading quote data"}):e.jsxs(De,{children:[e.jsx(as,{asChild:!0,children:s||i}),e.jsxs(Re,{className:"w-full md:w-[600px] sm:max-w-none overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsxs(qe,{children:["Update Quote #",t.quote_number]}),e.jsx(Ct,{children:"Make changes to the quote details, line items, and notes."})]}),r?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a?e.jsx(bm,{quote:a,quoteLineItems:a.quote_line_item||[]}):e.jsx("div",{className:"text-gray-500 text-sm py-4",children:"Quote not found"})]})]})}const pi=Sl,fi=Tl,Nm=_l,gi=d.forwardRef(({className:t,...s},a)=>e.jsx(Cn,{className:A("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...s,ref:a}));gi.displayName=Cn.displayName;const br=d.forwardRef(({className:t,...s},a)=>e.jsxs(Nm,{children:[e.jsx(gi,{}),e.jsx(_n,{ref:a,className:A("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s})]}));br.displayName=_n.displayName;const Nr=({className:t,...s})=>e.jsx("div",{className:A("flex flex-col space-y-2 text-center sm:text-left",t),...s});Nr.displayName="AlertDialogHeader";const wr=({className:t,...s})=>e.jsx("div",{className:A("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...s});wr.displayName="AlertDialogFooter";const Cr=d.forwardRef(({className:t,...s},a)=>e.jsx(Sn,{ref:a,className:A("text-lg font-semibold",t),...s}));Cr.displayName=Sn.displayName;const _r=d.forwardRef(({className:t,...s},a)=>e.jsx(Tn,{ref:a,className:A("text-sm text-muted-foreground",t),...s}));_r.displayName=Tn.displayName;const Sr=d.forwardRef(({className:t,...s},a)=>e.jsx(En,{ref:a,className:A(Ds(),t),...s}));Sr.displayName=En.displayName;const Tr=d.forwardRef(({className:t,...s},a)=>e.jsx(In,{ref:a,className:A(Ds({variant:"outline"}),"mt-2 sm:mt-0",t),...s}));Tr.displayName=In.displayName;function ka({title:t,description:s,onSubmit:a,open:r,onOpenChange:n,isLoading:i,buttonTextEnabled:o,buttonVariant:l}){function c(u){u.preventDefault(),a()}return e.jsxs(pi,{open:r,onOpenChange:n,children:[e.jsx(fi,{asChild:!0,children:e.jsxs(j,{variant:l,size:"icon",children:[o?e.jsx(Ot,{className:"w-4 h-4 mr-3"}):e.jsx(Ot,{className:"w-4 h-4"}),o?"Delete":""]})}),e.jsxs(br,{children:[e.jsxs("div",{className:"grid grid-flow-row grid-cols-1 sm:grid-cols-4 w-full gap-6",children:[e.jsx("div",{className:"w-[80px] h-[80px] mx-auto sm:w-full sm:h-full",children:e.jsx("div",{className:"w-full h-full rounded-full bg-red-100 mx-auto p-4 dark:bg-red-300/80",children:e.jsx("div",{className:"w-full h-full bg-red-200 rounded-full dark:bg-red-500/50",children:e.jsx("div",{className:"flex w-full flex-col h-full justify-center",children:e.jsx(Fn,{className:"w-6 h-6 mx-auto text-red-600 dark:text-red-800"})})})})}),e.jsxs(Nr,{className:"sm:col-span-3",children:[e.jsx(Cr,{children:t}),e.jsx(_r,{children:s})]})]}),e.jsxs(wr,{children:[e.jsx(Tr,{children:"Cancel"}),e.jsxs(Sr,{className:"bg-red-500 hover:bg-red-500/80 dark:text-white",onClick:c,disabled:i,children:[i&&e.jsx(Yt,{className:"mr-3 h-4 w-4 animate-spi"}),"Delete"]})]})]})]})}const wm=async()=>{const{data:t,error:s}=await w.from(q.QUOTE_REQUEST).select(`
      *,
      service (
        id,
        name,
        description,
        default_price,
        created_at,
        updated_at
      ),
      customer_type (
        id,
        name,
        description,
        created_at,
        updated_at
      ),
      quote_request_status (
        id,
        name,
        description,
        created_at,
        updated_at
      )
    `).order("est_request_status_id",{ascending:!0}).order("created_at",{ascending:!1});if(s)throw console.log(s),s;return t?.map(r=>({...r,service:Array.isArray(r.service)?r.service[0]:r.service,customer_type:Array.isArray(r.customer_type)?r.customer_type[0]:r.customer_type,status:Array.isArray(r.quote_request_status)?r.quote_request_status[0]:r.quote_request_status}))},Cm=async t=>{const{data:s,error:a}=await w.from(q.QUOTE_REQUEST).insert(t).select().single();if(a)throw a;return s},_m=async t=>{const{error:s}=await w.from(q.QUOTE_REQUEST).delete().eq("id",t);if(s)throw s},Sm=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["quoteRequests"],queryFn:()=>wm()});return{data:t,isLoading:s,isError:a}},Tm=(t,s)=>{const a=fe();return me(r=>Cm(r),{onError:r=>{s(!0),t({title:"Uh oh! Something went wrong.",description:`There was a problem with adding a new request to our system.
 Message: ${r.message}`,variant:"destructive"})},onSuccess:r=>{a.invalidateQueries({queryKey:["quoteRequests"]}),console.log(r),s(!1),t({variant:"success",title:"Added request successfully! 🎉",description:e.jsx("p",{children:"Successfully added new request to our system."})})}})},Em=(t,s)=>{const a=fe();return me(r=>_m(r),{onError:r=>{s(!1),t({title:"Uh oh! Something went wrong.",description:`There was a problem with adding a new request to our system.
 Message: ${r.message}`,variant:"destructive"})},onSuccess:r=>{a.invalidateQueries({queryKey:["quoteRequests"]}),s(!1),t({variant:"success",title:"Deleted request successfully! 🎉",description:e.jsx("p",{children:"Successfully deleted request from our system."})})}})},Im=async t=>{const{data:s,error:a}=await w.from(q.INVOICE_PAYMENT).insert(t).select().single();if(a)throw a;return s},Pm=async t=>{const{data:s,error:a}=await w.from(q.INVOICE_PAYMENT).delete().eq("id",t.item_id).select().single();if(a)throw a;return s},Dm=async t=>{const{data:s,error:a}=await w.from(q.INVOICE_PAYMENT).delete().eq("invoice_id",t).select();if(a)throw a;return s??[]},Rm=async t=>{const{data:s,error:a}=await w.from(q.INVOICE_LINE_SERVICE).delete().eq("invoice_id",t).select();if(a)throw a;return s??[]},km=(t,s)=>{const{mutate:a}=Vu(t,s);return me(r=>Rm(r),{onError:r=>{s(!1),t({title:"Uh oh! Something went wrong.",description:`There was a problem with deleting invoice line items from our system.
 Message: ${r.message}`,variant:"destructive"})},onSuccess:(r,n)=>{a(n)}})},ji=(t,s)=>{const a=fe();return me(r=>Im(r),{onError:r=>{t({position:"top",title:"Error Occured Adding Payment",description:`Error: ${r.message}`,status:"error",duration:5e3,isClosable:!0})},onSuccess:r=>{a.invalidateQueries({queryKey:["invoiceById",r.invoice_id.toString()]}),t({position:"top",title:"Succesfully Added Payment",description:`We were able to add a payment for invoice number ${r.invoice_id} 🎉`,status:"success",duration:5e3,isClosable:!0})}})},qm=t=>{const s=fe();return me(a=>Pm(a),{onError:a=>{t({position:"top",title:"Error Occurred Deleting Payment",description:`Error: ${a.message}`,status:"error",duration:5e3,isClosable:!0})},onSuccess:a=>{a&&a.invoice_number&&s.invalidateQueries({queryKey:["invoiceById",a.invoice_number.toString()]}),t({position:"top",title:"Successfully Deleted Payment",description:`We were able to delete a payment${a&&a.date_received?` that was posted for ${os(a.date_received)}`:""}${a&&a.amount?` for a total of $${se(a.amount)}`:""} 🎉`,status:"success",duration:5e3,isClosable:!0})}})},Am=(t,s)=>{const{mutate:a}=km(t,s);return me(r=>Dm(r),{onError:r=>{s(!1),t({title:"Uh oh! Something went wrong.",description:`There was a problem with deleting invoice payments from our system.
 Message: ${r.message}`,variant:"destructive"})},onSuccess:(r,n)=>{a(n)}})},Fm=async t=>{const{data:s,error:a}=await w.from("quote_line_item").delete().eq("quote_id",t);if(a)throw console.log(a.message),a;return s??[]},Lm=(t,s,a)=>{const{mutate:r}=Au(t,a);return me(n=>Fm(n),{onError:n=>{a(!1),t({title:"Uh oh! Something went wrong.",description:`There was a problem with deleting quote line items from our system.
 Message: ${n.message}`,variant:"destructive"})},onSuccess:(n,i)=>{r(i)}})};function Om({title:t,description:s,itemId:a}){const[r,n]=d.useState(!1),{mutate:i,isLoading:o}=Em(Be,n),l=async()=>{const c=typeof a=="number"?a:parseInt(a,10);i(c)};return e.jsx(ka,{isLoading:o,title:t,description:s,itemId:a,onSubmit:l,open:r,onOpenChange:n,buttonTextEnabled:!1,buttonVariant:"secondary"})}function $m({title:t,description:s,itemId:a}){const[r,n]=d.useState(!1),{mutate:i,isLoading:o}=Am(Be,n),l=async()=>{const c=parseInt(a?.toString()||"0",10);c&&c>0?i(c):Be({title:"Error",description:"Invalid invoice number provided.",variant:"destructive"})};return e.jsx(ka,{isLoading:o,title:t,description:s,itemId:a,open:r,onOpenChange:n,onSubmit:l,buttonTextEnabled:!1,buttonVariant:"outline"})}function Mm({title:t,description:s,itemId:a}){const[r,n]=d.useState(!1),{mutate:i,isLoading:o}=Lm(Be,a,n),l=async()=>{const c=parseInt(a?.toString()||"0",10);c&&c>0?i(c):Be({title:"Error",description:"Invalid quote number provided.",variant:"destructive"})};return e.jsx(ka,{isLoading:o,title:t,description:s,open:r,onOpenChange:n,onSubmit:l,itemId:a,buttonTextEnabled:!1,buttonVariant:"outline"})}function zm({title:t,description:s,itemId:a,buttonTextEnabled:r}){const[n,i]=d.useState(!1),{mutate:o,isLoading:l}=mu(Be),c=async()=>{const u=typeof a=="number"?a:parseInt(a,10);o(u)};return e.jsx(ka,{open:n,isLoading:l,title:t,description:s,onOpenChange:i,onSubmit:c,itemId:a,buttonTextEnabled:r||!1,buttonVariant:"primary"})}const Qt=ba();function Um(){const{quotes:t,isLoading:s}=ti(),{data:a,isLoading:r}=$d(),{data:n,isLoading:i}=Od(),{data:o,isLoading:l}=Md();return e.jsxs("div",{className:"flex flex-col w-full gap-6 mb-6",children:[e.jsx(Ns,{title:"Quotes",subheading:"Manage quotes and view information focused on them.",addItemTextButton:"Add quote",sheetTitle:"Add Quote",sheetDescription:"Create a new quote that will help track potential new work.",SheetContentBody:ra}),e.jsxs("div",{className:"flex w-full gap-4 flex-col md:flex-row",children:[e.jsx(_t,{title:"Accepted",icon:e.jsx(ct,{size:"25px"}),totalCount:a??0,isLoading:r}),e.jsx(_t,{title:"Pending",icon:e.jsx(Ln,{size:"25px"}),totalCount:n??0,isLoading:i}),e.jsx(_t,{title:"Rejected",icon:e.jsx(On,{size:"25px"}),totalCount:o??0,isLoading:l})]}),e.jsx(Ea,{entity:"quote",data:t,isLoading:s,firstSelectName:"Status",secondSelectName:"Service Type",thirdSelectName:"Customer",activateModal:!1,EntityFilterBar:Ia,filterBarEntity:"customer",columns:Qm,emptyStateSheetTitle:"Add quote",emptyStateSheetDescription:"Create a new quote to keep track of estimates customers request.",EmptyStateSheetBody:ra})]})}const Qm=[Qt.accessor("quote_number",{cell:({row:t})=>{const s=t.original;return e.jsxs("p",{className:"text-center text-[14px]",children:["QT-",pe(s.quote_number)]})},header:({column:t})=>e.jsx("div",{className:"w-full justify-center flex",children:e.jsxs(j,{className:"px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Quote",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Qt.accessor(t=>`${t.customer.first_name} ${t.customer.last_name} ${t.customer.email} ${t.quote_number} ${t.quote_status.name} ${t.service.name}`,{id:"customer",cell:({row:t})=>{const s=t.original;return e.jsx(vr,{firstName:s.customer.first_name,lastName:s.customer.last_name,email:s.customer.email,phoneNumber:s.customer.phone_number,streetAddress:s.customer.street_address,city:s.customer.city,state:s.customer.state,zipcode:s.customer.zipcode,customerId:s.customer.id})},header:({column:t})=>e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Customer",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})}),Qt.accessor("status_id",{header:({column:t})=>e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Status",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]}),cell:({row:t})=>{const s=t.original;return s.quote_status.name==="Accepted"?e.jsx(xe,{title:s.quote_status.name,variant:"green"}):s.quote_status.name==="Pending"?e.jsx(xe,{title:s.quote_status.name,variant:"yellow"}):s.quote_status.name==="Rejected"?e.jsx(xe,{title:s.quote_status.name,variant:"red"}):e.jsx(xe,{title:s.quote_status.name,variant:"gray"})}}),Qt.accessor("quote_date",{cell:({row:t})=>{const s=t.original;return e.jsx("p",{className:"font-[400] text-[14px]",children:wt(s.quote_date)})},header:({column:t})=>e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Date",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})}),Qt.accessor("service",{id:"service",header:({column:t})=>e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Service",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]}),cell:({row:t})=>{const s=t.original;return e.jsx("p",{className:"font-[400] text-[14px]",children:s?.service?.name})}}),Qt.accessor("expiration_date",{header:({column:t})=>e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Expiration",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]}),cell:({row:t})=>{const s=t.original;return e.jsx("p",{className:"font-[400] text-[14px]",children:wt(s.expiration_date)})}}),Qt.accessor("total",{cell:({row:t})=>{const s=t.original;return e.jsxs("p",{className:"font-[400] text-[14px]",children:["$",se(s.total)]})},header:({column:t})=>e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Total",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})}),Qt.accessor("updated_at",{cell:({row:t})=>{const s=t.original;return e.jsx("p",{className:"font-[400] text-[14px]",children:Bc(s.updated_at)})},header:({column:t})=>e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Updated At",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})}),Qt.accessor("actions",{header:()=>e.jsx("p",{children:"Actions"}),cell:({row:t})=>{const s=t.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(hi,{quote:s,trigger:e.jsx(j,{variant:"outline",size:"icon",children:e.jsx($t,{size:"15px"})})}),e.jsx(Mm,{title:"Are you absolutely sure?",description:"This action cannot be undone. This will permanently delete quote with line-items and remove data from out servers.",itemId:s.quote_number}),e.jsx(ks,{children:e.jsxs(qs,{children:[e.jsx(As,{asChild:!0,children:e.jsx(Pe,{to:`/quotes/${s.quote_number}`,children:e.jsx(j,{variant:"primary",size:"icon",children:e.jsx(Dt,{size:"15px"})})})}),e.jsx(gs,{children:"Go to see details"})]})})]})}})],bt=[{title:"Custom Bill To Address",description:"Different billing address",icon:e.jsx(zs,{className:"w-5 h-5 my-auto mx-auto"})},{title:"General Notes",description:"Internal notes",icon:e.jsx(ma,{className:"w-5 h-5 my-auto mx-auto"})},{title:"SQFT Measurement",description:"Square footage details",icon:e.jsx(xa,{className:"w-5 h-5 my-auto mx-auto"})},{title:"Customer Note",description:"Note visible to customer",icon:e.jsx(ha,{className:"w-5 h-5 my-auto mx-auto"})}];function Bm({invoice:t,invoiceLineItems:s,onSuccess:a}){const r=fe(),{customers:n}=Bs(),{data:i}=Vs(),{data:o}=jr(),[l,c]=d.useState(!!t.bill_to),[u,h]=d.useState(!!t.private_note),[p,g]=d.useState(!!t.sqft_measurement),[N,_]=d.useState(!!t.cust_note),m=Tt({resolver:gt($u),defaultValues:{id:t.id,invoice_number:t.invoice_number,customer_id:t.customer_id,service_type_id:t.service_type_id,invoice_status_id:t.invoice_status_id,invoice_date:new Date(t.invoice_date),issue_date:new Date(t.issue_date),due_date:new Date(t.due_date),line_items:s?.map(v=>({id:v.id,description:v.description||"",qty:v.qty,rate:v.rate||0,amount:v.amount,sq_ft:v.sq_ft||0,fixed_item:v.fixed_item||!0}))||[{description:"",qty:1,rate:0,amount:0,sq_ft:0,fixed_item:!0}],bill_from_street_address:t.bill_from_street_address||"150 Tallant St",bill_from_city:t.bill_from_city||"Houston",bill_from_state:t.bill_from_state||"TX",bill_from_zipcode:t.bill_from_zipcode||"77076",bill_from_email:t.bill_from_email||"",bill_to_street_address:t.bill_to_street_address||"",bill_to_city:t.bill_to_city||"",bill_to_state:t.bill_to_state||"",bill_to_zipcode:t.bill_to_zipcode||"",bill_to:t.bill_to||!1,private_note:t.private_note||"",public_note:t.public_note||"",cust_note:t.cust_note||"",sqft_measurement:t.sqft_measurement||""}}),{fields:R,append:S,remove:E}=va({control:m.control,name:"line_items"}),b=m.watch("line_items");d.useEffect(()=>{const v=(b??[]).map((x,y)=>{const f=x.qty||1;return{...x,qty:f,rate:0,amount:x.amount||0}});v.some((x,y)=>{const f=b?.[y];return!f||x.qty!==f.qty||x.rate!==f.rate})&&m.setValue("line_items",v,{shouldValidate:!1})},[b,m]);const F=(b??[]).reduce((v,$)=>v+$.amount,0),L=F;async function H(v){const{data:$,error:x}=await w.from(q.INVOICE).update(v).eq("id",t.id).select();if(x)throw x;return $}async function ne(v){await w.from(q.INVOICE_LINE_SERVICE).delete().eq("invoice_id",t.invoice_number);const $=v.map(f=>{const{id:M,...C}=f;return{...C,invoice_id:f.invoice_id,service_id:f.service_id,description:f.description||"",qty:f.qty||1,amount:f.amount||0,rate:0,sq_ft:f.sq_ft||0,fixed_item:f.fixed_item||!0}}),{data:x,error:y}=await w.from(q.INVOICE_LINE_SERVICE).insert($);if(y)throw console.error("Error updating invoice line items",y.message),console.error("Line items that failed:",$),y;return x}const G=me({mutationFn:H,onSuccess:()=>{r.invalidateQueries({queryKey:["invoices"]}),r.invalidateQueries({queryKey:["invoiceById",t.invoice_number]}),r.invalidateQueries({queryKey:["invoiceById"]}),r.invalidateQueries({queryKey:["totalPaidInvoices"]}),r.invalidateQueries({queryKey:["totalPendingInvoices"]}),r.invalidateQueries({queryKey:["totalOverdueInvoices"]})}}),Z=me({mutationFn:ne,onSuccess:()=>{r.invalidateQueries({queryKey:["invoiceLineItems"]}),r.invalidateQueries({queryKey:["invoices"]}),r.invalidateQueries({queryKey:["invoiceById",t.invoice_number]})}}),oe=async v=>{const{line_items:$,id:x,...y}=v,f={...y,total:L,subtotal:F,amount_due:L,invoice_date:y.invoice_date.toISOString().split("T")[0],issue_date:y.issue_date.toISOString().split("T")[0],due_date:y.due_date.toISOString().split("T")[0]},M=$?.map(C=>({...C,invoice_id:v.invoice_number,service_id:v.service_type_id,amount:C.amount,rate:0}));console.log("Updating invoice:",f),console.log("Updating line items:",M);try{await G.mutateAsync(f),M&&await Z.mutateAsync(M),a&&a()}catch(C){console.error("Failed to update invoice:",C);let W="Unknown error occurred";C&&typeof C=="object"?"message"in C?W=C.message:"details"in C?W=C.details:W=JSON.stringify(C):typeof C=="string"&&(W=C),alert("Failed to update invoice: "+W)}};return e.jsx("div",{className:"w-full pt-4",children:e.jsx(It,{...m,children:e.jsx("form",{onSubmit:m.handleSubmit(oe),children:e.jsxs("div",{className:"space-y-4 h-full pb-6",children:[e.jsx(D,{control:m.control,name:"customer_id",render:({field:v})=>e.jsxs(I,{className:"flex flex-col w-full",children:[e.jsx(P,{children:"Search for customer"}),e.jsx(Ta,{data:n||[],form:m,field:v}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:m.control,name:"invoice_number",render:({field:v})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Invoice #"}),e.jsx(k,{children:e.jsx(Q,{type:"number",className:"w-full",value:v.value||"",onChange:$=>{const x=$.target.value;v.onChange(x===""?void 0:Number(x))}})}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:"invoice_status_id",render:({field:v})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Select Status"}),e.jsxs(Ce,{onValueChange:$=>v.onChange(Number($)),value:v.value&&v.value!==0?String(v.value):void 0,children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select status"})})}),e.jsx(Ye,{children:e.jsx(Ve,{data:o||[]})})]}),e.jsx(U,{})]})})]}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:m.control,name:"invoice_date",render:({field:v})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Invoice Date"}),e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",className:A("w-full pl-3 text-left font-normal",!v.value&&"text-muted-foreground"),children:[v.value?Wt(v.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(tt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(st,{className:"w-auto p-0",align:"start",children:e.jsx(zt,{mode:"single",selected:v.value,onSelect:v.onChange,disabled:$=>$>new Date||$<new Date("1900-01-01"),initialFocus:!0})})]}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:"due_date",render:({field:v})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Due Date"}),e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",className:A("w-full pl-3 text-left font-normal",!v.value&&"text-muted-foreground"),children:[v.value?Wt(v.value,"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(tt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(st,{className:"w-auto p-0",align:"start",children:e.jsx(zt,{mode:"single",selected:v.value,onSelect:v.onChange,disabled:$=>$<new Date,initialFocus:!0})})]}),e.jsx(U,{})]})})]}),e.jsx(D,{control:m.control,name:"service_type_id",render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Select Service"}),e.jsxs(Ce,{onValueChange:$=>v.onChange(Number($)),value:v.value&&v.value!==0?String(v.value):void 0,children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select service"})})}),e.jsx(Ye,{children:e.jsx(Ve,{data:i||[]})})]}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex flex-col py-2 gap-6",children:[e.jsx(ae,{children:"Line Items"}),R.map((v,$)=>e.jsxs("div",{className:"flex flex-col gap-4 p-4 border rounded-lg bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm font-medium",children:["Item ",$+1]}),R.length>1&&e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>E($),className:"text-red-500 hover:text-red-700",children:e.jsx(Ot,{className:"h-4 w-4"})})]}),e.jsx(D,{control:m.control,name:`line_items.${$}.description`,render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Description"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter item description",value:x.value||"",onChange:x.onChange,onBlur:x.onBlur,name:x.name})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsx(D,{control:m.control,name:`line_items.${$}.qty`,render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Quantity"}),e.jsx(k,{children:e.jsx(Q,{type:"number",min:"1",value:x.value||1,onChange:y=>x.onChange(Number(y.target.value)||1),onBlur:x.onBlur,name:x.name})}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:`line_items.${$}.rate`,render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Rate (Disabled)"}),e.jsx(k,{children:e.jsx(Q,{type:"text",value:"Fixed Pricing",disabled:!0,className:"bg-gray-100 dark:bg-gray-700 opacity-50 text-center",placeholder:"Fixed rate (future feature)"})}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:`line_items.${$}.amount`,render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Amount"}),e.jsx(k,{children:e.jsx(Q,{type:"text",value:x.value||"",onChange:y=>{const f=y.target.value;(f===""||/^\d*\.?\d*$/.test(f))&&x.onChange(f===""?0:Number(f)||0)},onBlur:x.onBlur,name:x.name,placeholder:"Enter fixed amount"})}),e.jsx(U,{})]})})]})]},v.id)),e.jsx(j,{type:"button",variant:"secondary",onClick:()=>S({description:"",qty:1,rate:0,amount:0,sq_ft:0,fixed_item:!0}),children:"+ Add Line Item"})]}),e.jsx("div",{className:"w-full mx-auto pt-2 px-6",children:e.jsx("div",{className:"w-full flex flex-col gap-2 text-sm",children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsxs("span",{children:["$",se(F)]})]})})}),e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"w-full bg-blue-500 h-[50px] rounded-xl",children:e.jsxs("div",{className:"flex justify-between items-center text-white px-6 py-3",children:[e.jsx("span",{className:"text-lg font-bold",children:"Total:"}),e.jsxs("span",{className:"text-lg font-bold",children:["$",se(L)]})]})})}),e.jsxs("div",{className:"flex flex-col gap-4 pt-2",children:[e.jsx(ae,{children:"Extra Options"}),e.jsx(He,{title:bt[0].title,description:bt[0].description,icon:bt[0].icon,switchValue:l,setSwitchValue:c}),l&&e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-4 border rounded-lg",children:[e.jsx(D,{control:m.control,name:"bill_to_street_address",render:({field:v})=>e.jsxs(I,{className:"col-span-2",children:[e.jsx(P,{children:"Street Address"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter billing street address",...v})}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:"bill_to_city",render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"City"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter city",...v})}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:"bill_to_state",render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"State"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"TX",maxLength:2,...v})}),e.jsx(U,{})]})}),e.jsx(D,{control:m.control,name:"bill_to_zipcode",render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Zipcode"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"77076",...v})}),e.jsx(U,{})]})})]}),e.jsx(He,{title:bt[1].title,description:bt[1].description,icon:bt[1].icon,switchValue:u,setSwitchValue:h}),u&&e.jsx(D,{control:m.control,name:"private_note",render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"General Notes (Internal)"}),e.jsx(k,{children:e.jsx(Ae,{placeholder:"Enter internal notes here...",className:"min-h-[100px]",...v})}),e.jsx(U,{})]})}),e.jsx(He,{title:bt[2].title,description:bt[2].description,icon:bt[2].icon,switchValue:p,setSwitchValue:g}),p&&e.jsx(D,{control:m.control,name:"sqft_measurement",render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Square Footage Measurement"}),e.jsx(k,{children:e.jsx(Ae,{placeholder:"Enter measurement details...",className:"min-h-[100px]",...v})}),e.jsx(U,{})]})}),e.jsx(He,{title:bt[3].title,description:bt[3].description,icon:bt[3].icon,switchValue:N,setSwitchValue:_}),N&&e.jsx(D,{control:m.control,name:"cust_note",render:({field:v})=>e.jsxs(I,{children:[e.jsx(P,{children:"Customer Note"}),e.jsx(k,{children:e.jsx(Ae,{placeholder:"Enter note visible to customer...",className:"min-h-[100px]",...v})}),e.jsx(U,{})]})})]}),e.jsxs(qt,{className:"pt-4 gap-2",children:[e.jsx(Ke,{asChild:!0,children:e.jsx(j,{type:"submit",disabled:m.formState.isSubmitting||G.isPending||Z.isPending,children:m.formState.isSubmitting||G.isPending||Z.isPending?"Updating...":"Update Invoice"})}),e.jsx(Ke,{asChild:!0,children:e.jsx(j,{variant:"secondary",children:"Cancel"})})]})]})})})})}function yi({invoice:t,trigger:s}){const{data:a,isLoading:r,isError:n}=ri(t.invoice_number),i=e.jsxs(j,{variant:"ghost",size:"sm",children:[e.jsx($t,{className:"h-4 w-4"}),"Edit Invoice"]});return n?e.jsx("div",{className:"text-red-500 text-sm",children:"Error loading invoice data"}):e.jsxs(De,{children:[e.jsx(as,{asChild:!0,children:s||i}),e.jsxs(Re,{className:"w-full md:w-[600px] sm:max-w-none overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsxs(qe,{children:["Update Invoice #",t.invoice_number]}),e.jsx(Ct,{children:"Make changes to the invoice details, line items, and notes."})]}),r?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):a?e.jsx(Bm,{invoice:a,invoiceLineItems:a.invoice_line_service||[]}):e.jsx("div",{className:"text-gray-500 text-sm py-4",children:"Invoice not found"})]})]})}function Vm({invoice:t,trigger:s,onPaymentRecorded:a}){const{toast:r}=ss(),n=fe(),[i,o]=le.useState(!1),[l,c]=le.useState({amount:"",payment_method:"",date_received:new Date().toISOString().split("T")[0]}),{mutate:u,isLoading:h}=ji(r),p=t.invoice_line_service?.reduce((E,b)=>E+(b.amount||0),0)||0,g=t.invoice_payment?.reduce((E,b)=>E+(b.amount||0),0)||0,N=p-g,_=(E,b)=>{c(O=>({...O,[E]:b}))},m=()=>{if(!t?.invoice_number)return;if(!l.amount||!l.payment_method||!l.date_received){r({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});return}const E=parseFloat(l.amount);if(isNaN(E)||E<=0){r({title:"Validation Error",description:"Please enter a valid payment amount.",variant:"destructive"});return}u({invoice_id:t.invoice_number,amount:E,payment_method:l.payment_method,date_received:l.date_received},{onSuccess:()=>{c({amount:"",payment_method:"",date_received:new Date().toISOString().split("T")[0]}),n.invalidateQueries({queryKey:["invoiceById",t.invoice_number]}),n.invalidateQueries({queryKey:["invoices"]}),o(!1),a&&a()}})},R=()=>{o(!1),c({amount:"",payment_method:"",date_received:new Date().toISOString().split("T")[0]})},S=e.jsx(j,{size:"icon",variant:"outline",title:"Record payment",children:e.jsx($n,{className:"w-[16px]"})});return e.jsxs(pt,{open:i,onOpenChange:o,children:[e.jsx(ws,{asChild:!0,children:s||S}),e.jsxs(at,{className:"sm:max-w-[500px]",children:[e.jsxs(rt,{children:[e.jsxs(nt,{children:["Record Payment for INV-",pe(t.invoice_number||0)]}),e.jsxs(ot,{children:["Add a new payment for this invoice. Outstanding balance: $",se(N)]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ae,{htmlFor:"amount",className:"text-right",children:"Amount *"}),e.jsxs("div",{className:"col-span-3 relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"$"}),e.jsx(Q,{id:"amount",type:"number",step:"0.01",min:"0",max:N>0?N:void 0,placeholder:"0.00",value:l.amount,onChange:E=>_("amount",E.target.value),className:"pl-8"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ae,{htmlFor:"payment_method",className:"text-right",children:"Payment Method *"}),e.jsx(Q,{id:"payment_method",placeholder:"e.g., Cash, Check, Credit Card, Bank Transfer",value:l.payment_method,onChange:E=>_("payment_method",E.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ae,{htmlFor:"date_received",className:"text-right",children:"Date Received *"}),e.jsx(Q,{id:"date_received",type:"date",value:l.date_received,onChange:E=>_("date_received",E.target.value),className:"col-span-3"})]})]}),e.jsxs(ft,{children:[e.jsx(j,{variant:"outline",onClick:R,children:"Cancel"}),e.jsx(j,{onClick:m,disabled:h,children:h?"Recording...":"Record Payment"})]})]})]})}const Bt=ba();function Hm(){const{data:t,isLoading:s}=ai(),{data:a,isLoading:r}=Ad(),{data:n,isLoading:i}=Ld(),{data:o,isLoading:l}=Fd();return e.jsxs("div",{className:"flex flex-col w-full gap-6 mb-6",children:[e.jsx(Ns,{title:"Invoices",subheading:"Manage invoices and view information focused on them.",addItemTextButton:"Add invoice",SheetContentBody:na,sheetTitle:"Add invoice",sheetDescription:"Create a new invoice to track income."}),e.jsxs("div",{className:"flex w-full gap-4 flex-col md:flex-row",children:[e.jsx(_t,{title:"Overdue",totalCount:a??0,icon:e.jsx(On,{size:"25px"}),isLoading:r}),e.jsx(_t,{title:"Pending",icon:e.jsx(Ln,{size:"25px"}),totalCount:o??0,isLoading:l}),e.jsx(_t,{title:"Paid",icon:e.jsx(ct,{size:"25px"}),totalCount:n??0,isLoading:i})]}),e.jsx(Ea,{entity:"invoice",data:t,isLoading:s,EntityFilterBar:Ia,firstSelectName:"Status",secondSelectName:"Service Type",thirdSelectName:"Customer",filterBarEntity:"customer",activateModal:!1,columns:Km,EmptyStateSheetBody:na,emptyStateSheetTitle:"Add invoice",emptyStateSheetDescription:"Create a new invoice to track income."})]})}const Km=[Bt.accessor("invoice_number",{cell:({row:t})=>{const s=t.original;return e.jsxs("p",{className:"text-center text-[14px]",children:["INV-",pe(s.invoice_number||0)]})},header:({column:t})=>e.jsx("div",{className:"flex justify-center w-full",children:e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Invoice",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Bt.accessor(t=>`${t.customer?.first_name||""} ${t.customer?.last_name||""} ${t.customer?.email||""} ${t.invoice_number||""} ${t.invoice_status?.name||""} ${t.service?.name||""}`,{id:"customer",cell:({row:t})=>{const s=t.original;return e.jsx(vr,{firstName:s.customer?.first_name||"",lastName:s.customer?.last_name||"",email:s.customer?.email||"",phoneNumber:s.customer?.phone_number||"",streetAddress:s.customer?.street_address||"",city:s.customer?.city||"",state:s.customer?.state||"",zipcode:s.customer?.zipcode||"",customerId:s.customer?.id||0})},header:({column:t})=>e.jsx("div",{className:"flex",children:e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Customer",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Bt.accessor("invoice_status_id",{cell:({row:t})=>{const a=t.original.invoice_status?.name||"Unknown";return a==="Paid"?e.jsx(xe,{title:a,variant:"green"}):a==="Overdue"?e.jsx(xe,{title:a,variant:"red"}):a==="Pending"?e.jsx(xe,{title:a,variant:"yellow"}):e.jsx(xe,{title:a,variant:"gray"})},header:({column:t})=>e.jsx("div",{className:"flex",children:e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Status",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Bt.accessor("invoice_date",{cell:({row:t})=>{const s=t.original;return e.jsx("p",{className:"text-[14px] font-[400]",children:s.invoice_date?wt(s.invoice_date):"N/A"})},header:({column:t})=>e.jsx("div",{className:"flex",children:e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Date",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Bt.accessor("service_type_id",{cell:({row:t})=>{const s=t.original;return e.jsx("p",{children:s.service?.name||"Unknown Service"})},header:({column:t})=>e.jsx("div",{className:"flex",children:e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Service",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Bt.accessor("due_date",{cell:({row:t})=>{const s=t.original;return e.jsx("p",{children:s.due_date?wt(s.due_date):"N/A"})},header:({column:t})=>e.jsx("div",{className:"flex",children:e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Due Date",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Bt.accessor("total",{cell:({row:t})=>{const s=t.original;return e.jsxs("p",{children:["$",se(s.total||0)]})},header:({column:t})=>e.jsx("div",{className:"flex",children:e.jsxs(j,{className:"px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Total",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Bt.accessor("amount_due",{cell:({row:t})=>{const s=t.original;return e.jsxs("p",{children:["$",se(s.amount_due||0)]})},header:({column:t})=>e.jsx("div",{className:"flex",children:e.jsxs(j,{className:"px-1",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Balance Due",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Bt.accessor("actions",{cell:({row:t})=>{const s=t.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(yi,{invoice:s,trigger:e.jsx(j,{variant:"outline",className:"px-3",children:e.jsx($t,{size:"15px"})})}),e.jsx(Vm,{invoice:s}),e.jsx($m,{title:"Are you absolutely sure?",description:"This action cannot be undone. This will permanently delete invoice with line-items/payments and remove data from our server.",itemId:s.invoice_number}),e.jsx(ks,{children:e.jsxs(qs,{children:[e.jsx(As,{asChild:!0,children:e.jsx(Pe,{to:`/invoices/${s.invoice_number}`,children:e.jsx(j,{className:"px-3",variant:"primary",children:e.jsx(Dt,{size:"15px"})})})}),e.jsx(gs,{children:"Go to see details"})]})})]})},header:()=>e.jsx("p",{children:"Actions"})})],Wm=Ee({firstName:z(),lastName:z(),email:z().email(),phone_number:z(),customer_typeID:te(),est_request_status_id:te(),requested_date:z(),service_type_id:te(),streetAddress:z(),city:z(),state:z(),zipcode:z()}),Gm=async()=>{const{data:t,error:s}=await w.from(q.QUOTE_REQUEST_STATUS).select("*").order("id",{ascending:!0});if(s)throw console.log(s),s;return t},Ym=()=>{const{data:t,isLoading:s,isError:a}=ie({queryKey:["qrStatuses"],queryFn:()=>Gm()});return{data:t,isLoading:s,isError:a}};function tn({setOpen:t}){const{data:s}=Ym(),{data:a}=hr(),{data:r}=Vs(),{mutate:n,isLoading:i}=Tm(Be,t),o=Tt({resolver:gt(Wm)});function l(c){console.log(c),n(c)}return e.jsx("div",{className:"w-full my-4",children:e.jsx(Je,{className:"w-full",children:e.jsx(It,{...o,children:e.jsx("form",{onSubmit:o.handleSubmit(l),children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Bl,{className:"w-4 h-4 my-auto text-blue-900 dark:text-blue-300"}),e.jsx("p",{className:"font-[600] text-blue-500 dark:text-blue-300",children:"Request"})]}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:o.control,name:"est_request_status_id",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Status"}),e.jsxs(Ce,{onValueChange:u=>c.onChange(parseInt(u)),defaultValue:c.value?.toString(),children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select request status"})})}),e.jsx(Ve,{data:s})]}),e.jsx(U,{})]})}),e.jsx(D,{control:o.control,name:"requested_date",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Desired date"}),e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(k,{children:e.jsxs(j,{variant:"outline",className:A("w-[240px] pl-3 text-left font-normal",!c.value&&"text-muted-foreground"),children:[c.value?Wt(new Date(c.value),"PPP"):e.jsx("span",{children:"Pick a date"}),e.jsx(tt,{className:"ml-auto h-4 w-4 opacity-50"})]})})}),e.jsx(st,{className:"w-auto p-0 text-start",children:e.jsx(zt,{mode:"single",selected:c.value?new Date(c.value):void 0,onSelect:c.onChange,disabled:u=>u<new Date||u<new Date("1900-01-01")})})]}),e.jsx(U,{})]})})]}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:o.control,name:"customer_typeID",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Type of Customer"}),e.jsxs(Ce,{onValueChange:c.onChange,defaultValue:c.value?.toString(),children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select request status"})})}),e.jsx(Ve,{data:a})]}),e.jsx(U,{})]})}),e.jsx(D,{control:o.control,name:"service_type_id",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Service"}),e.jsxs(Ce,{onValueChange:c.onChange,defaultValue:c.value?.toString(),children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select request status"})})}),e.jsx(Ve,{data:r})]}),e.jsx(U,{})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Us,{className:"w-4 h-4 my-auto text-blue-900 dark:text-blue-300"}),e.jsx("p",{className:"font-[600] text-blue-500 dark:text-blue-300",children:"Client"})]}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:o.control,name:"firstName",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"First Name"}),e.jsx(k,{children:e.jsx(Q,{...c,className:"w-full"})}),e.jsx(U,{})]})}),e.jsx(D,{control:o.control,name:"lastName",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Last Name"}),e.jsx(k,{children:e.jsx(Q,{...c})})]})})]}),e.jsx(D,{control:o.control,name:"email",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Email"}),e.jsx(k,{children:e.jsx(Q,{...c,type:"email",className:"w-full"})}),e.jsx(U,{})]})}),e.jsx(D,{control:o.control,name:"phone_number",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Phone Number"}),e.jsx(k,{children:e.jsx(Q,{...c,type:"tel",className:"w-full",onChange:u=>c.onChange(wa(u.target.value))})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(An,{className:"w-4 h-4 my-auto text-blue-900 dark:text-blue-300"}),e.jsx("p",{className:"font-[600] text-blue-500 dark:text-blue-300",children:"Location"})]}),e.jsx(D,{control:o.control,name:"streetAddress",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Street Address"}),e.jsx(k,{children:e.jsx(Q,{...c,className:"w-full"})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:o.control,name:"city",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"City"}),e.jsx(k,{children:e.jsx(Q,{...c,className:"w-full"})}),e.jsx(U,{})]})}),e.jsx(D,{control:o.control,name:"state",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"State"}),e.jsxs(Ce,{onValueChange:c.onChange,defaultValue:c.value,children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select US state"})})}),e.jsx(Ve,{data:pr||[],valueKey:"abbreviation",labelKey:"name"})]}),e.jsx(U,{})]})})]}),e.jsx(D,{control:o.control,name:"zipcode",render:({field:c})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Zipcode"}),e.jsx(k,{children:e.jsx(Q,{...c,type:"numeric",pattern:"[0-9]*",inputMode:"numeric"})})]})}),e.jsxs(qt,{className:"pt-8 gap-2",children:[e.jsx(Ke,{asChild:!0,children:e.jsx(j,{variant:"secondary",children:"Cancel"})}),e.jsx(j,{variant:"primary",type:"submit",children:"Save changes"})]})]})})})})})}const Gt=ba();function Xm(){const{data:t,isLoading:s}=Sm(),{data:a,isLoading:r}=Id(),{data:n,isLoading:i}=Pd(),{data:o,isLoading:l}=Dd();return e.jsxs("div",{className:"flex flex-col w-full gap-6 mb-6",children:[e.jsx(Ns,{title:"Sales Leads",subheading:"Manage and view all lead requests from website here.",addItemTextButton:"Add request",sheetTitle:"Add request",sheetDescription:"Manually create a new lead when getting a new potential customer.",SheetContentBody:tn}),e.jsxs("div",{className:"flex w-full gap-4 flex-col md:flex-row",children:[e.jsx(_t,{title:"New",totalCount:a??0,icon:e.jsx(Vl,{size:"25px"}),isLoading:r}),e.jsx(_t,{title:"Scheduled",totalCount:n??0,isLoading:i,icon:e.jsx(tt,{size:"25px"})}),e.jsx(_t,{title:"Closed",totalCount:o??0,isLoading:l,icon:e.jsx(Hl,{size:"25px"})})]}),e.jsx(Ea,{entity:"lead",isLoading:s,data:t,activateModal:!1,firstSelectName:"Status",secondSelectName:"Service Type",thirdSelectName:"Customer Type",EntityFilterBar:Ia,columns:ex,filterBarEntity:"customer",EmptyStateSheetBody:tn,emptyStateSheetTitle:"Add request",emptyStateSheetDescription:"Manually create a new lead when getting a new potential customer."})]})}const Zm=t=>{},Jm=t=>{},ex=[Gt.accessor("id",{cell:({row:t})=>e.jsxs("p",{className:"text-center text-[14px]",children:["RQ-",pe(t.getValue("id"))]}),header:({column:t})=>e.jsx("div",{className:"w-full justify-center flex",children:e.jsxs(j,{className:"px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Request",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Gt.accessor(t=>`${t.firstName} ${t.lastName} ${t.streetAddress} ${t.city} ${t.zipcode} ${t.state} ${t.email} ${t.phone_number}`,{id:"customer",cell:({row:t})=>{const s=t.original;return e.jsx(vr,{firstName:s.firstName,lastName:s.lastName,email:s.email,phoneNumber:s.phone_number,streetAddress:s.streetAddress,state:s.state,city:s.city,zipcode:s.zipcode,customerId:s.id})},header:({column:t})=>e.jsx("div",{className:"w-full flex",children:e.jsxs(j,{className:"px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Requestor",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Gt.accessor("est_request_status_id",{cell:({row:t})=>{const s=t.original;return s.status?.name==="New"?e.jsx(xe,{title:s.status.name,variant:"green"}):s.status?.name==="Scheduled"?e.jsx(xe,{title:s.status.name,variant:"yellow"}):s.status?.name==="Pending"?e.jsx(xe,{title:s.status.name,variant:"yellow"}):s.status?.name==="Closed"?e.jsx(xe,{title:s.status.name,variant:"red"}):e.jsx(xe,{title:s.status?.name||"Unknown",variant:"gray"})},header:({column:t})=>e.jsx("div",{className:"w-full justify-center flex",children:e.jsxs(j,{className:"px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Status",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Gt.accessor("requested_date",{cell:({row:t})=>e.jsx("p",{children:wt(t.getValue("requested_date"))}),header:({column:t})=>e.jsx("div",{className:"w-full flex",children:e.jsxs(j,{className:"px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Desired Date",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Gt.accessor("service_type_id",{cell:({row:t})=>{const s=t.original;return e.jsx("p",{children:s.service?.name})},header:({column:t})=>e.jsx("div",{className:"w-full justify-center flex",children:e.jsxs(j,{className:"px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Service",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Gt.accessor("customer_typeID",{cell:({row:t})=>{const s=t.original;return s.customer_type.name==="Residential"?e.jsx(xe,{title:s.customer_type.name,variant:"blue"}):s.customer_type.name==="Commercial"?e.jsx(xe,{title:s.customer_type.name,variant:"green"}):e.jsx(xe,{title:s.customer_type.name,variant:"gray"})},header:({column:t})=>e.jsx("div",{className:"w-full justify-center flex",children:e.jsxs(j,{className:"px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Type",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Gt.accessor("created_at",{cell:({row:t})=>e.jsx("p",{children:new Date(t.getValue("created_at")).toLocaleString()}),header:({column:t})=>e.jsx("div",{className:"w-full justify-center flex",children:e.jsxs(j,{className:"px-0",variant:"ghost",onClick:()=>t.toggleSorting(t.getIsSorted()==="asc"),children:["Entry Date",t.getIsSorted()==="asc"?e.jsx(ye,{className:"h-3 w-3 ml-2"}):t.getIsSorted()==="desc"?e.jsx(ve,{className:"h-3 w-3 ml-2"}):null]})})}),Gt.accessor("actions",{cell:({row:t})=>{const s=t.original;return e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ks,{children:e.jsxs(qs,{children:[e.jsx(As,{className:"p-3 rounded-md bg-secondary",onClick:()=>Zm(),children:e.jsx($t,{className:"w-4 h-4"})}),e.jsx(gs,{children:"Edit"})]})}),e.jsx(Om,{title:"Are you absolutely sure?",description:"This action cannot be undone. This will permanently delete lead request and remove data from out servers.",itemId:s.id}),e.jsx(ks,{children:e.jsxs(qs,{children:[e.jsx(As,{className:"p-3 rounded-md bg-secondary h-full",onClick:()=>Jm(),children:e.jsx(kn,{className:"w-4 h-4"})}),e.jsx(gs,{children:"Add as a customer"})]})})]})}})],vi=fc,Er=d.forwardRef(({className:t,...s},a)=>e.jsx(Xn,{ref:a,className:A("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...s}));Er.displayName=Xn.displayName;const Ft=d.forwardRef(({className:t,...s},a)=>e.jsx(Zn,{ref:a,className:A("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...s}));Ft.displayName=Zn.displayName;const oa=d.forwardRef(({className:t,...s},a)=>e.jsx(Jn,{ref:a,className:A("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...s}));oa.displayName=Jn.displayName;function tx({customerData:t}){const{data:s}=hr();fe();const a=Tt({resolver:gt(Wd),defaultValues:{id:t.id.toString(),customer_type:t.customer_type_id.toString(),first_name:t.first_name,last_name:t.last_name,email:t.email,phone_number:t.phone_number,street_address:t.street_address,city:t.city,state:t.state,zipcode:t.zipcode}}),{mutate:r,isLoading:n,isError:i}=hu(Be,t?.id.toString());async function o(l){const{customer_type:c,...u}=l,h={...u,customer_type_id:parseInt(c)};r(h),a.reset(h)}return e.jsx("div",{className:"w-full mb-4",children:e.jsx(It,{...a,children:e.jsx("form",{onSubmit:a.handleSubmit(o),children:e.jsxs("div",{className:"space-y-4 h-full px-4 pb-6",children:[e.jsx(D,{control:a.control,name:"customer_type",render:({field:l})=>e.jsxs(I,{children:[e.jsx(P,{children:"Customer Type"}),e.jsxs(Ce,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select the type of customer"})})}),e.jsx(Ve,{data:s})]}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:a.control,name:"first_name",render:({field:l})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"First Name"}),e.jsx(k,{children:e.jsx(Q,{...l,className:"w-full"})}),e.jsx(U,{})]})}),e.jsx(D,{control:a.control,name:"last_name",render:({field:l})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Last Name"}),e.jsx(k,{children:e.jsx(Q,{...l})})]})})]}),e.jsx(D,{control:a.control,name:"email",render:({field:l})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Email"}),e.jsx(k,{children:e.jsx(Q,{...l,type:"email",className:"w-full"})}),e.jsx(U,{})]})}),e.jsx(D,{control:a.control,name:"phone_number",render:({field:l})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Phone Number"}),e.jsx(k,{children:e.jsx(Q,{...l,type:"tel",className:"w-full",onChange:c=>l.onChange(wa(c.target.value))})}),e.jsx(U,{})]})}),e.jsx(D,{control:a.control,name:"street_address",render:({field:l})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Street Address"}),e.jsx(k,{children:e.jsx(Q,{...l,className:"w-full"})}),e.jsx(U,{})]})}),e.jsxs("div",{className:"flex gap-6 w-full",children:[e.jsx(D,{control:a.control,name:"city",render:({field:l})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"City"}),e.jsx(k,{children:e.jsx(Q,{...l,className:"w-full"})}),e.jsx(U,{})]})}),e.jsx(D,{control:a.control,name:"state",render:({field:l})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"State"}),e.jsxs(Ce,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx(k,{children:e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select US state"})})}),e.jsx(Ve,{data:pr||[],valueKey:"abbreviation",labelKey:"name"})]}),e.jsx(U,{})]})})]}),e.jsx(D,{control:a.control,name:"zipcode",render:({field:l})=>e.jsxs(I,{className:"w-full",children:[e.jsx(P,{children:"Zipcode"}),e.jsx(k,{children:e.jsx(Q,{...l,type:"numeric",pattern:"[0-9]*",inputMode:"numeric"})})]})}),e.jsxs(qt,{className:"pt-8 gap-2",children:[e.jsx(Ke,{asChild:!0,children:e.jsx(j,{variant:"secondary",children:"Cancel"})}),e.jsx(Ke,{asChild:!0,children:e.jsx(j,{variant:"primary",type:"submit",children:"Save changes"})})]})]})})})})}var sx=tx;function ax({items:t,className:s,separator:a=e.jsx(Dt,{className:"h-4 w-4 text-muted-foreground"}),showHome:r=!0,homeHref:n="/dashboard"}){const i=r?[{label:"",href:n,icon:e.jsx(fa,{className:"h-4 w-4"})},...t]:t;return e.jsx("nav",{className:A("flex items-center space-x-2 text-sm",s),"aria-label":"Breadcrumb",children:e.jsx("ol",{className:"flex items-center space-x-2",children:i.map((o,l)=>{const c=l===i.length-1;return e.jsxs("li",{className:"flex items-center",children:[l>0&&e.jsx("span",{className:"mr-2",children:a}),o.href&&!c?e.jsxs(Pe,{to:o.href,className:"flex items-center gap-1 text-muted-foreground hover:text-foreground transition-colors duration-200",children:[o.icon,e.jsx("span",{children:o.label})]}):e.jsxs("span",{className:A("flex items-center gap-1",c?"text-foreground font-medium":"text-muted-foreground"),children:[o.icon,e.jsx("span",{children:o.label})]})]},l)})})})}function qa({currentPage:t,parentPages:s=[],className:a,homeHref:r="/dashboard"}){const n=[...s,{label:t}];return e.jsx(ax,{items:n,className:a,homeHref:r})}function rx(){const{id:t}=tr(),s=il(),{customerById:a,isLoading:r}=cu(t),{customerInvoices:n,isLoading:i}=du(t),{customerQuotes:o}=uu(t);return r||i?e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsxs("div",{className:"flex w-full mt-2 gap-2",children:[e.jsx(Pe,{to:"/customers",children:"Customers"}),e.jsx("p",{children:"/"}),e.jsxs(Pe,{to:s.pathname,children:["Customer-",t]})]}),e.jsx(ee,{className:"h-[161px] rounded-md"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ee,{className:"h-[48px] rounded-md"}),e.jsx(ee,{className:"h-[400px]"})]})]}):e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsx("div",{className:"pt-4 pb-2",children:e.jsx(qa,{currentPage:`Customer #${t}`,parentPages:[{label:"Customers",href:"/customers"}],homeHref:"/"})}),e.jsxs("div",{className:"flex flex-col border py-4 px-4 rounded-md gap-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-4 justify-between",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{children:e.jsx(Rt,{className:"w-[50px] h-[50px]",children:e.jsx(kt,{children:Na(`${a?.first_name} ${a?.last_name}`)})})}),e.jsx("div",{className:"my-auto",children:e.jsxs("p",{className:"font-bold text-[24px] my-auto",children:[a?.first_name," ",a?.last_name]})}),e.jsxs("div",{className:"my-auto",children:[a?.customer_type.name==="Residential"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:a?.customer_type.name,variant:"blue"})}),a?.customer_type.name==="Commercial"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:a.customer_type.name,variant:"green"})}),a?.customer_type.name!=="Commercial"&&a?.customer_type.name!=="Residential"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:a?.customer_type.name||"N/A",variant:"gray"})})]})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs(De,{children:[e.jsx(as,{asChild:!0,children:e.jsxs(j,{variant:"outline",children:[e.jsx($t,{className:"w-4 h-4 mr-4"}),"Edit Info"]})}),e.jsxs(Re,{className:"w-full sm:max-w-xl px-2",children:[e.jsxs(ke,{className:"px-4 space-y-0",children:[e.jsx(qe,{children:"Edit Customer"}),e.jsx(Ct,{children:"Make changes to your customer here. Click save when you're done."})]}),e.jsx(Je,{className:"w-full h-full pb-8 pt-6",children:e.jsx(sx,{customerData:a})})]})]}),e.jsx(zm,{title:"Delete Customer",description:"This action cannot be undone. This will permanently delete customer data from our server and cannot be retrieved back.",itemId:t||""})]})]}),e.jsxs("div",{className:"grid grid-flow-col grid-rows-3 md:grid-rows-1 gap-6 px-1",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Is,{className:"w-3 h-3 my-auto"}),e.jsx("p",{className:"text-gray-500 font-semibold text-[14px]",children:"Email"})]}),e.jsx("p",{className:"text-sm font-light",children:a?.email})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Rn,{className:"w-3 h-3 my-auto"}),e.jsx("p",{className:"text-gray-500 font-semibold text-[14px]",children:"Phone Number"})]}),e.jsx("p",{className:"text-sm font-light",children:wa(a?.phone_number)})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(zs,{className:"w-3 h-3 my-auto"}),e.jsx("p",{className:"text-gray-500 font-semibold text-[14px]",children:"Main Address"})]}),e.jsx(ni,{streetAddress:a?.street_address||"",city:a?.city||"",state:a?.state||"",zipcode:a?.zipcode||"",addressQuery:`${a?.street_address||""} ${a?.city||""} ${a?.state||""} ${a?.zipcode||""}`,textSize:"sm"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Kl,{className:"w-3 h-3 my-auto"}),e.jsx("p",{className:"text-gray-500 font-semibold text-[14px]",children:"Market"})]}),e.jsxs("p",{className:"text-sm font-light",children:[a?.city,", ",a?.state," 🇺🇸"]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ga,{className:"w-3 h-3 my-auto"}),e.jsx("p",{className:"text-gray-500 font-semibold text-[14px]",children:"Registed At"})]}),e.jsx("p",{className:"text-sm font-light",children:"Tuesday, Dec 19, 2023"})]})]})]}),e.jsx("div",{className:"w-full",children:e.jsxs(vi,{defaultValue:"overview",className:"w-full",children:[e.jsxs(Er,{className:"flex w-full justify-start py-6 px-2",children:[e.jsx(Ft,{value:"overview",children:"Overview"}),e.jsx(Ft,{value:"financials",disabled:!0,children:"Financials"}),e.jsx(Ft,{value:"payment-methods",disabled:!0,children:"Payment Methods"}),e.jsx(Ft,{value:"locations",disabled:!0,children:"Locations"}),e.jsx(Ft,{value:"notifications",disabled:!0,children:"Notifications"})]}),e.jsx(oa,{value:"overview",className:"border rounded-md p-4",children:e.jsxs("div",{className:"flex flex-col gap-4 p-2",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-4 mb-2",children:[e.jsx(Ps,{className:"w-5 h-5 my-auto"}),e.jsx("p",{className:"text-[22px] font-semibold",children:"Invoices"})]}),n?.length===0&&e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-gray-500 dark:text-gray-300 text-center font-light mb-2",children:"No invoices found for this customer."})}),n&&n.length>0&&e.jsx(e.Fragment,{children:e.jsxs(is,{children:[e.jsxs(Va,{children:["A list of ",a?.first_name,"'s recent invoices."]}),e.jsx(ls,{children:e.jsxs(We,{children:[e.jsxs(he,{className:"flex w-[100px]",children:[e.jsx(Lr,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Invoice"})]}),e.jsx(he,{children:e.jsxs("div",{className:"flex",children:[e.jsx(Or,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Status"})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex",children:[e.jsx(tt,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Date"})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex",children:[e.jsx($r,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Service"})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex w-full justify-end",children:[e.jsx(Mr,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Amount"})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex w-full justify-end",children:[e.jsx(zr,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Action"})]})})]})}),e.jsx(cs,{children:n?.map((l,c)=>e.jsx(le.Fragment,{children:e.jsxs(We,{children:[e.jsxs(ue,{className:"font-medium",children:["INV-",pe(l.invoice_number)]}),e.jsxs(ue,{children:[l.invoice_status.name==="Overdue"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:l.invoice_status.name,variant:"red"})}),l.invoice_status.name==="Pending"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:l.invoice_status.name,variant:"yellow"})}),l.invoice_status.name==="Paid"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:l.invoice_status.name,variant:"green"})}),l.invoice_status.name==="Draft"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:l.invoice_status.name,variant:"gray"})})]}),e.jsx(ue,{children:os(l.invoice_date)}),e.jsx(ue,{children:l.service.name}),e.jsxs(ue,{className:"text-right",children:["$",se(l.total)]}),e.jsx(ue,{className:"flex",children:e.jsx(j,{variant:"secondary",className:"ml-auto",asChild:!0,children:e.jsx(Pe,{to:`/invoices/${l.invoice_number}`,children:e.jsx(Dt,{className:"w-4 h-4"})})})})]})},c))})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-4 mb-2",children:[e.jsx(ir,{className:"w-5 h-5 my-auto"}),e.jsx("p",{className:"text-[22px] font-semibold",children:"Quotes"})]}),o?.length===0&&e.jsx(e.Fragment,{children:e.jsx("p",{className:"text-gray-500 dark:text-gray-300 text-center font-light mb-2",children:"No quotes found for this customer."})}),o&&o.length>0&&e.jsx(e.Fragment,{children:e.jsxs(is,{children:[e.jsxs(Va,{children:["A list of ",a?.first_name,"'s recent quotes."]}),e.jsx(ls,{children:e.jsxs(We,{children:[e.jsxs(he,{className:"flex w-[100px]",children:[e.jsx(Lr,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Quote"})]}),e.jsx(he,{children:e.jsxs("div",{className:"flex",children:[e.jsx(Or,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Status"})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex",children:[e.jsx(tt,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Date"})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex",children:[e.jsx($r,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Service"})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex w-full justify-end",children:[e.jsx(Mr,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Amount"})]})}),e.jsx(he,{children:e.jsxs("div",{className:"flex w-full justify-end",children:[e.jsx(zr,{className:"w-4 h-4 mr-2 my-auto"}),e.jsx("p",{className:"my-auto",children:"Action"})]})})]})}),e.jsx(cs,{children:o?.map((l,c)=>e.jsx(le.Fragment,{children:e.jsxs(We,{children:[e.jsxs(ue,{className:"font-medium",children:["QT-",pe(l.quote_number)]}),e.jsxs(ue,{children:[l.quote_status.name==="Rejected"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:l.quote_status.name,variant:"red"})}),l.quote_status.name==="Pending"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:l.quote_status.name,variant:"yellow"})}),l.quote_status.name==="Accepted"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:l.quote_status.name,variant:"green"})}),l.quote_status.name==="Draft"&&e.jsx(e.Fragment,{children:e.jsx(xe,{title:l.quote_status.name,variant:"gray"})})]}),e.jsx(ue,{children:os(l.quote_date)}),e.jsx(ue,{children:l.service.name}),e.jsxs(ue,{className:"text-right",children:["$",se(l.total)]}),e.jsx(ue,{className:"flex",children:e.jsx(j,{variant:"secondary",className:"ml-auto",asChild:!0,children:e.jsx(Pe,{to:`/quotes/${l.quote_number}`,children:e.jsx(Dt,{className:"w-4 h-4"})})})})]})},c))})]})})]})]})}),e.jsx(oa,{value:"locations",children:"This is a location where the customer can add multiple addresses to their account."})]})})]})}const nx=async()=>{const t=performance.now();try{const s=performance.now(),{data:a,error:r}=await w.from("information_schema.tables").select("table_name").limit(1),i=performance.now()-s,o=r?"Disconnected":"Connected";let l=0,c=null,u=null,h=!1;if(!r){const{data:v}=await w.from("information_schema.tables").select("table_name").eq("table_schema","public");l=v?.length||0;try{const{count:$}=await w.from(q.SERVICE).select("*",{count:"exact",head:!0}),{count:x}=await w.from(q.QUOTE_STATUS).select("*",{count:"exact",head:!0}),{count:y}=await w.from(q.INVOICE_STATUS).select("*",{count:"exact",head:!0});c=($||0)+(x||0)+(y||0)}catch{}try{const{data:$}=await w.from("pg_policies").select("policyname").limit(1);h=!!($&&$.length>0)}catch{}try{const{data:$}=await w.from(q.SERVICE).select("updated_at, created_at").order("updated_at",{ascending:!1}).limit(1);$&&$[0]&&(u=$[0].updated_at||$[0].created_at)}catch{}}const p=performance.now();await w.from(q.SERVICE).select("id").limit(1);const N=performance.now()-p,_="",m=_.match(/https:\/\/([^.]+)\.supabase\.co/),R=m?m[1]:"unknown";let S="us-east-1";_.includes(".supabase.co")&&(_.includes("eu-")&&(S="eu-west-1"),_.includes("ap-")&&(S="ap-southeast-1"),_.includes("ca-")&&(S="ca-central-1"));const E=w.realtime!==void 0,b=w.auth!==void 0,O=w.storage!==void 0;let F=!1;try{F=w.functions!==void 0}catch{}let L=null;try{const{data:v}=await w.auth.admin.listUsers({page:1,perPage:1});L=v?.users?.length||null}catch{}const H={activeConnections:1,maxConnections:100,usage:"< 5%"},ne=new Date;ne.setHours(ne.getHours()-1);const G=`${Math.floor((Date.now()-ne.getTime())/(1e3*60))} minutes`,oe=performance.now()-t;return{database:{host:_.replace("https://","").replace("http://",""),region:S,version:null,connectionStatus:o,latency:i,poolStats:H},supabase:{projectUrl:_,apiVersion:"v1",realtime:E,authEnabled:b,edgeFunctions:F,storage:O},performance:{responseTime:oe,queryTime:N,lastChecked:new Date().toISOString(),uptime:G},usage:{totalTables:l,totalRows:c,dataSize:c?`~${Math.ceil(c/100)}KB`:null,lastActivity:u},security:{rls:h,ssl:_.startsWith("https://"),authUsers:L}}}catch(s){console.error("Error fetching infrastructure info:",s);const r=performance.now()-t;return{database:{host:"unknown",region:null,version:null,connectionStatus:"Disconnected",latency:null,poolStats:{activeConnections:null,maxConnections:null,usage:null}},supabase:{projectUrl:"unknown",apiVersion:"v1",realtime:!1,authEnabled:!1,edgeFunctions:!1,storage:!1},performance:{responseTime:r,queryTime:null,lastChecked:new Date().toISOString(),uptime:null},usage:{totalTables:0,totalRows:null,dataSize:null,lastActivity:null},security:{rls:!1,ssl:!1,authUsers:null}}}},ox=async()=>{try{const t=await nx(),{data:s,error:a}=await w.from(q.SERVICE).select("id, updated_at, created_at");if(a)throw a;const{data:r,error:n}=await w.from(q.QUOTE_STATUS).select("id, updated_at");if(n)throw n;const{data:i,error:o}=await w.from(q.INVOICE_STATUS).select("id, updated_at");if(o)throw o;const{data:l,error:c}=await w.from(q.QUOTE_REQUEST_STATUS).select("id, updated_at");if(c)throw c;const u=s?.length||0,h={quote:r?.length||0,invoice:i?.length||0,quoteRequest:l?.length||0,total:(r?.length||0)+(i?.length||0)+(l?.length||0)},p=[...s?.map(m=>m.updated_at||m.created_at)||[],...r?.map(m=>m.updated_at)||[],...i?.map(m=>m.updated_at)||[],...l?.map(m=>m.updated_at)||[]].filter(Boolean),g=s&&s.length>0?Math.max(...s.map(m=>new Date(m.updated_at||m.created_at).getTime())):null,N=p.length>0?Math.max(...p.map(m=>new Date(m).getTime())):null,_=Math.max(g||0,N||0);return{totalStatuses:h,activeServices:u,lastUpdated:{services:g?new Date(g).toISOString():null,statuses:N?new Date(N).toISOString():null,mostRecent:_>0?new Date(_).toISOString():null},configuration:{status:"Active",lastCheck:new Date().toISOString()},infrastructure:t}}catch(t){throw console.error("Error fetching server overview stats:",t),t}},ix=async()=>{try{const{error:t}=await w.from(q.SERVICE).select("id").limit(1);return!t}catch(t){return console.error("System health check failed:",t),!1}},lx=()=>ie({queryKey:["server-overview"],queryFn:ox,staleTime:300*1e3,refetchInterval:600*1e3,retry:3,retryDelay:t=>Math.min(1e3*2**t,3e4)}),cx=()=>ie({queryKey:["system-health"],queryFn:ix,staleTime:120*1e3,refetchInterval:300*1e3,retry:2}),dx=()=>{const t=lx(),s=cx();return{stats:t.data,isLoadingStats:t.isLoading,isErrorStats:t.isError,errorStats:t.error,isHealthy:s.data,isLoadingHealth:s.isLoading,isErrorHealth:s.isError,isLoading:t.isLoading||s.isLoading,isError:t.isError||s.isError,refetchStats:t.refetch,refetchHealth:s.refetch,refetchAll:()=>{t.refetch(),s.refetch()}}},ux=[{id:"statuses",title:"Statuses",description:"Manage status options for invoices, quotes, and quote requests",icon:e.jsx(Vt,{className:"h-6 w-6"}),path:"/data-management/statuses"},{id:"services",title:"Services",description:"Manage service types and pricing used in quotes and invoices",icon:e.jsx(Ze,{className:"h-6 w-6"}),path:"/data-management/services"},{id:"customer-types",title:"Customer Types",description:"Manage customer categories and classification types for better organization",icon:e.jsx(Kt,{className:"h-6 w-6"}),path:"/data-management/customer-types"}];function mx(){const{stats:t,isLoadingStats:s,isErrorStats:a,isHealthy:r,refetchAll:n}=dx(),i=o=>{if(!o)return"Never";const l=new Date(o),u=Math.floor((new Date().getTime()-l.getTime())/(1e3*60*60));return u<1?"Just now":u<24?`${u}h ago`:u<168?`${Math.floor(u/24)}d ago`:l.toLocaleDateString()};return e.jsxs("div",{className:"flex-1 space-y-4 mb-8",children:[e.jsx(Qs,{title:"Data Management",subheading:"Manage system data and configuration settings",showActionButton:!1}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:ux.map(o=>e.jsx(Pe,{to:o.path,children:e.jsxs(Y,{className:"cursor-pointer transition-all duration-200 hover:shadow-lg hover:scale-[1.02] border-border hover:border-primary/20",children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("div",{className:"p-2 bg-primary/100 text-white rounded-lg",children:o.icon})}),e.jsx(Dt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(X,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ce,{className:"text-xl",children:o.title}),e.jsx(rs,{className:"text-sm leading-relaxed",children:o.description})]})})]})},o.id))}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Quick Overview"}),e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>n(),disabled:s,children:[e.jsx(Mt,{className:`h-4 w-4 mr-2 ${s?"animate-spin":""}`}),"Refresh"]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Total Statuses"}),e.jsx(Wl,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:t?.totalStatuses.total||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?e.jsx(ee,{className:"h-3 w-20"}):`Quote: ${t?.totalStatuses.quote||0} • Invoice: ${t?.totalStatuses.invoice||0} • Request: ${t?.totalStatuses.quoteRequest||0}`})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Active Services"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:t?.activeServices||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Available service types"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Last Updated"}),e.jsx(Mn,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-20"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:i(t?.lastUpdated.mostRecent||null)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Most recent change"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"System Status"}),e.jsx(Vt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):e.jsx("div",{className:`text-2xl font-bold ${r?"text-green-600":"text-red-600"}`,children:r?"Active":"Error"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r?"All systems operational":"Connection issues detected"})]})]})]}),a&&e.jsx("div",{className:"mt-4 p-4 bg-destructive/10 border border-destructive/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-destructive",children:"Failed to load statistics. Please check your connection and try refreshing."})})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Infrastructure & Server Info"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Database"}),e.jsx(Ur,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-20"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:`text-2xl font-bold ${t?.infrastructure.database.connectionStatus==="Connected"?"text-green-600":"text-red-600"}`,children:t?.infrastructure.database.connectionStatus||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?e.jsx(ee,{className:"h-3 w-24"}):`${t?.infrastructure.database.latency?`${Math.round(t.infrastructure.database.latency)}ms`:"--"} • ${t?.infrastructure.database.region||"Unknown region"}`})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Supabase API"}),e.jsx(Qr,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t?.infrastructure.supabase.apiVersion||"v1"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?e.jsx(ee,{className:"h-3 w-20"}):`Auth: ${t?.infrastructure.supabase.authEnabled?"Enabled":"Disabled"} • RT: ${t?.infrastructure.supabase.realtime?"Yes":"No"}`})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Performance"}),e.jsx(Br,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:t?.infrastructure.performance.responseTime?`${Math.round(t.infrastructure.performance.responseTime)}ms`:"--"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Response time"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Project Info"}),e.jsx(Ws,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-20"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold truncate",children:t?.infrastructure.database.host.split(".")[0]||"Unknown"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s?e.jsx(ee,{className:"h-3 w-16"}):"Project ID"})]})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Database Usage & Performance"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Total Tables"}),e.jsx(Gl,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:t?.infrastructure.usage.totalTables||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Application tables"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Total Records"}),e.jsx(Ur,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:t?.infrastructure.usage.totalRows||"--"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:t?.infrastructure.usage.dataSize||"Size unknown"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Query Time"}),e.jsx(Br,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:t?.infrastructure.performance.queryTime?`${Math.round(t.infrastructure.performance.queryTime)}ms`:"--"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Average query latency"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Connection Pool"}),e.jsx(Vr,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold text-green-600",children:t?.infrastructure.database.poolStats.usage||"--"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t?.infrastructure.database.poolStats.activeConnections||"--"," active connections"]})]})]})]})]}),e.jsxs("div",{className:"mt-8",children:[e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsx("h3",{className:"text-lg font-semibold",children:"Security & Features"})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Row Level Security"}),e.jsx(zn,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-20"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:`text-2xl font-bold ${t?.infrastructure.security.rls?"text-green-600":"text-yellow-600"}`,children:t?.infrastructure.security.rls?"Enabled":"Disabled"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["SSL: ",t?.infrastructure.security.ssl?"Yes":"No"]})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Edge Functions"}),e.jsx(Qr,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-20"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:`text-2xl font-bold ${t?.infrastructure.supabase.edgeFunctions?"text-green-600":"text-gray-600"}`,children:t?.infrastructure.supabase.edgeFunctions?"Available":"Disabled"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Storage: ",t?.infrastructure.supabase.storage?"Yes":"No"]})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Auth Users"}),e.jsx(Kt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-16"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:t?.infrastructure.security.authUsers!==null&&t?.infrastructure.security.authUsers!==void 0?t.infrastructure.security.authUsers:"Private"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Registered users"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Session Uptime"}),e.jsx(Vr,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[s?e.jsx(ee,{className:"h-8 w-20"}):a?e.jsx("div",{className:"text-2xl font-bold text-destructive",children:"--"}):e.jsx("div",{className:"text-2xl font-bold",children:t?.infrastructure.performance.uptime||"--"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Current session"})]})]})]})]})]})}const Fs=jc,Ls=yc,sn=vc,xx=d.forwardRef(({className:t,inset:s,children:a,...r},n)=>e.jsxs(eo,{ref:n,className:A("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",t),...r,children:[a,e.jsx(Dt,{className:"ml-auto h-4 w-4"})]}));xx.displayName=eo.displayName;const hx=d.forwardRef(({className:t,...s},a)=>e.jsx(to,{ref:a,className:A("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...s}));hx.displayName=to.displayName;const js=d.forwardRef(({className:t,sideOffset:s=4,...a},r)=>e.jsx(gc,{children:e.jsx(so,{ref:r,sideOffset:s,className:A("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a})}));js.displayName=so.displayName;const lt=d.forwardRef(({className:t,inset:s,...a},r)=>e.jsx(ao,{ref:r,className:A("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",t),...a}));lt.displayName=ao.displayName;const px=d.forwardRef(({className:t,children:s,checked:a,...r},n)=>e.jsxs(ro,{ref:n,className:A("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:a,...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(no,{children:e.jsx(Ge,{className:"h-4 w-4"})})}),s]}));px.displayName=ro.displayName;const fx=d.forwardRef(({className:t,children:s,...a},r)=>e.jsxs(oo,{ref:r,className:A("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...a,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(no,{children:e.jsx(Yl,{className:"h-2 w-2 fill-current"})})}),s]}));fx.displayName=oo.displayName;const Ir=d.forwardRef(({className:t,inset:s,...a},r)=>e.jsx(io,{ref:r,className:A("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",t),...a}));Ir.displayName=io.displayName;const ys=d.forwardRef(({className:t,...s},a)=>e.jsx(lo,{ref:a,className:A("-mx-1 my-1 h-px bg-muted",t),...s}));ys.displayName=lo.displayName;const Wa=({className:t,...s})=>e.jsx("span",{className:A("ml-auto text-xs tracking-widest opacity-60",t),...s});Wa.displayName="DropdownMenuShortcut";const bi=Ee({name:z().min(1,"Service name is required").max(100,"Service name must be less than 100 characters").trim(),description:z().max(500,"Description must be less than 500 characters").optional().or(ta("")),default_price:z().optional().or(ta("")).refine(t=>{if(!t||t.trim()==="")return!0;const s=parseFloat(t);return!isNaN(s)||t.includes("$")||t.toLowerCase().includes("per")},'Price must be a valid number or descriptive text (e.g., "$300 per sq ft")')}),gx=bi.extend({id:te().positive("Service ID must be a positive number")}),Pr=()=>{const t=fe(),s=me({mutationFn:n=>_u(n),onSuccess:n=>{t.invalidateQueries({queryKey:["services"]}),Be({title:"Service created successfully",description:`${n.name} has been added to your services.`})},onError:n=>{console.error("Error creating service:",n),Be({title:"Error creating service",description:n.message||"Something went wrong. Please try again.",variant:"destructive"})}}),a=me({mutationFn:n=>Su(n),onSuccess:n=>{t.invalidateQueries({queryKey:["services"]}),Be({title:"Service updated successfully",description:`${n.name} has been updated.`})},onError:n=>{console.error("Error updating service:",n),Be({title:"Error updating service",description:n.message||"Something went wrong. Please try again.",variant:"destructive"})}}),r=me({mutationFn:n=>Tu(n),onSuccess:()=>{t.invalidateQueries({queryKey:["services"]}),Be({title:"Service deleted successfully",description:"The service has been removed from your system."})},onError:n=>{console.error("Error deleting service:",n),Be({title:"Error deleting service",description:n.message||"Something went wrong. Please try again.",variant:"destructive"})}});return{createService:s,updateService:a,deleteService:r,isCreating:s.isPending,isUpdating:a.isPending,isDeleting:r.isPending,isLoading:s.isPending||a.isPending||r.isPending}};function jx({setOpen:t}){const{createService:s,isCreating:a}=Pr(),r=Tt({resolver:gt(bi),defaultValues:{name:"",description:"",default_price:""}}),n=async i=>{try{const o={...i,description:i.description?.trim()||void 0,default_price:i.default_price?.trim()||void 0};await s.mutateAsync(o),r.reset(),t(!1)}catch(o){console.error("Form submission error:",o)}};return e.jsx("div",{className:"w-full",children:e.jsx(It,{...r,children:e.jsxs("form",{onSubmit:r.handleSubmit(n),children:[e.jsxs("div",{className:"space-y-6 h-full px-1 pb-6",children:[e.jsx(D,{control:r.control,name:"name",render:({field:i})=>e.jsxs(I,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),"Service Name *"]}),e.jsx(k,{children:e.jsx(Q,{...i,placeholder:"e.g., Roof Repair, Gutter Installation",className:"w-full"})}),e.jsx(dt,{children:"Enter a clear, descriptive name for the service"}),e.jsx(U,{})]})}),e.jsx(D,{control:r.control,name:"description",render:({field:i})=>e.jsxs(I,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(mt,{className:"h-4 w-4"}),"Description"]}),e.jsx(k,{children:e.jsx(Ae,{...i,placeholder:"Describe what this service includes, materials used, typical duration, etc.",className:"w-full min-h-[100px] resize-none",rows:4})}),e.jsx(dt,{children:"Optional: Provide details about what this service includes"}),e.jsx(U,{})]})}),e.jsx(D,{control:r.control,name:"default_price",render:({field:i})=>e.jsxs(I,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(or,{className:"h-4 w-4"}),"Default Price"]}),e.jsx(k,{children:e.jsx(Q,{...i,placeholder:"e.g., 150, $300 per sq ft, Contact for quote",className:"w-full"})}),e.jsx(dt,{children:"Optional: Enter a price, rate, or pricing description. Can be a number (150) or text ($300 per sq ft)"}),e.jsx(U,{})]})}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"font-medium text-blue-900",children:"Service Setup Tips"})]}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1 ml-6",children:[e.jsx("li",{children:"• Use clear, professional service names"}),e.jsx("li",{children:"• Add detailed descriptions to help with quotes"}),e.jsx("li",{children:"• Set default prices for common services"}),e.jsx("li",{children:"• You can always edit these details later"})]})]})]}),e.jsxs(qt,{className:"px-4 pt-4 gap-2 border-t",children:[e.jsx(Ke,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",disabled:a,children:"Cancel"})}),e.jsx(j,{type:"submit",disabled:a,className:"min-w-[120px]",children:a?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Create Service"]})})]})]})})})}function yx({setOpen:t,service:s}){const{updateService:a,isUpdating:r}=Pr(),n=Tt({resolver:gt(gx),defaultValues:{id:s.id,name:s.name||"",description:s.description||"",default_price:s.default_price||""}});d.useEffect(()=>{n.reset({id:s.id,name:s.name||"",description:s.description||"",default_price:s.default_price||""})},[s,n]);const i=async o=>{try{const l={...o,description:o.description?.trim()||void 0,default_price:o.default_price?.trim()||void 0};await a.mutateAsync(l),t(!1)}catch(l){console.error("Form submission error:",l)}};return e.jsx("div",{className:"w-full",children:e.jsx(It,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(i),children:[e.jsxs("div",{className:"space-y-6 h-full px-1 pb-6",children:[e.jsx(D,{control:n.control,name:"name",render:({field:o})=>e.jsxs(I,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4"}),"Service Name *"]}),e.jsx(k,{children:e.jsx(Q,{...o,placeholder:"e.g., Roof Repair, Gutter Installation",className:"w-full"})}),e.jsx(dt,{children:"Enter a clear, descriptive name for the service"}),e.jsx(U,{})]})}),e.jsx(D,{control:n.control,name:"description",render:({field:o})=>e.jsxs(I,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(mt,{className:"h-4 w-4"}),"Description"]}),e.jsx(k,{children:e.jsx(Ae,{...o,placeholder:"Describe what this service includes, materials used, typical duration, etc.",className:"w-full min-h-[100px] resize-none",rows:4})}),e.jsx(dt,{children:"Optional: Provide details about what this service includes"}),e.jsx(U,{})]})}),e.jsx(D,{control:n.control,name:"default_price",render:({field:o})=>e.jsxs(I,{children:[e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(or,{className:"h-4 w-4"}),"Default Price"]}),e.jsx(k,{children:e.jsx(Q,{...o,placeholder:"e.g., 150, $300 per sq ft, Contact for quote",className:"w-full"})}),e.jsx(dt,{children:"Optional: Enter a price, rate, or pricing description. Can be a number (150) or text ($300 per sq ft)"}),e.jsx(U,{})]})}),e.jsxs("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-4 w-4 text-amber-600"}),e.jsx("span",{className:"font-medium text-amber-900",children:"Edit Service"})]}),e.jsx("p",{className:"text-sm text-amber-700",children:"Changes will be applied immediately and will affect future quotes and invoices using this service."})]})]}),e.jsxs(qt,{className:"px-4 pt-4 gap-2 border-t",children:[e.jsx(Ke,{asChild:!0,children:e.jsx(j,{type:"button",variant:"outline",disabled:r,children:"Cancel"})}),e.jsx(j,{type:"submit",disabled:r,className:"min-w-[120px]",children:r?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"mr-2 h-4 w-4 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Update Service"]})})]})]})})})}function vx(){const[t,s]=d.useState(""),[a,r]=d.useState(null),[n,i]=d.useState(!1),[o,l]=d.useState(!1),[c,u]=d.useState(!1);fe();const{deleteService:h,isDeleting:p}=Pr(),{data:g=[],isLoading:N,error:_}=ie({queryKey:["services"],queryFn:ei}),m=g.filter(b=>b.name.toLowerCase().includes(t.toLowerCase())||b.description?.toLowerCase().includes(t.toLowerCase())),R=b=>{if(!b)return"Not set";if(b.includes("$")||b.toLowerCase().includes("per"))return b;const O=parseFloat(b);return isNaN(O)?b:new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(O)},S=()=>e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((b,O)=>e.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[e.jsx(ee,{className:"h-12 w-12 rounded-full"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(ee,{className:"h-4 w-[200px]"}),e.jsx(ee,{className:"h-4 w-[300px]"})]}),e.jsx(ee,{className:"h-8 w-[80px]"})]},O))}),E=({service:b})=>e.jsx(Y,{className:"mb-4 lg:hidden",children:e.jsxs(X,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-lg",children:b.name}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:b.description||"No description provided"})]}),e.jsxs(Fs,{children:[e.jsx(Ls,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"sm",children:e.jsx(Qa,{className:"h-4 w-4"})})}),e.jsxs(js,{align:"end",children:[e.jsxs(lt,{onClick:()=>{r(b),l(!0)},children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(ys,{}),e.jsxs(lt,{className:"text-destructive",onClick:()=>{r(b),u(!0)},children:[e.jsx(Ot,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Default Price"}),e.jsx("span",{className:"font-semibold",children:R(b.default_price)})]}),e.jsxs(de,{variant:"secondary",children:["ID: ",b.id]})]})]})});return _?e.jsx("div",{className:"container mx-auto py-8",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-destructive mb-4",children:"Error Loading Services"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try refreshing the page"})]})}):e.jsxs("div",{className:"flex flex-col w-full gap-4",children:[e.jsx("div",{className:"pt-4",children:e.jsx(qa,{currentPage:"Services Management",parentPages:[{label:"Data Management",href:"/data-management"}],homeHref:"/"})}),e.jsx(Qs,{title:"Services Management",subheading:"Manage your service types and pricing",actionButtonText:"Add Service",actionButtonIcon:e.jsx(Ht,{className:"h-4 w-4 mr-2"}),sheetTitle:"Add New Service",sheetDescription:"Fill out the form to create a new service type.",SheetContentBody:jx}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Total Services"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Available service types"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"With Pricing"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.filter(b=>b.default_price&&b.default_price.trim()!=="").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Services have pricing"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"No Pricing"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.filter(b=>!b.default_price||b.default_price.trim()==="").length}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Need pricing setup"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Last Created"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[e.jsx("div",{className:"text-2xl font-bold",children:g.length>0?"Recent":"None"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Latest service added"})]})]})]}),e.jsxs(Y,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs(ce,{children:["All Services (",m.length,")"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:w-[300px]",children:[e.jsx(Es,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(Q,{placeholder:"Search services...",value:t,onChange:b=>s(b.target.value),className:"pl-10"})]}),e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(Xl,{className:"h-4 w-4 mr-2"}),"Filter"]})]})]})}),e.jsx(X,{children:N?e.jsx(S,{}):m.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ze,{className:"mx-auto h-12 w-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No services found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:t?"No services match your search criteria.":"Get started by creating your first service."}),e.jsx(De,{open:n,onOpenChange:i,children:e.jsx(as,{asChild:!0,children:e.jsxs(j,{children:[e.jsx(Ht,{className:"h-4 w-4 mr-2"}),"Add Service"]})})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"lg:hidden",children:m.map(b=>e.jsx(E,{service:b},b.id))}),e.jsx("div",{className:"hidden lg:block",children:e.jsxs(is,{children:[e.jsx(ls,{children:e.jsxs(We,{children:[e.jsx(he,{children:"Service Name"}),e.jsx(he,{children:"Description"}),e.jsx(he,{children:"Default Price"}),e.jsx(he,{children:"Created"}),e.jsx(he,{className:"text-right",children:"Actions"})]})}),e.jsx(cs,{children:m.map(b=>e.jsxs(We,{children:[e.jsx(ue,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(Ze,{className:"h-4 w-4 text-primary"})}),b.name]})}),e.jsx(ue,{className:"max-w-[300px] truncate",children:b.description||"No description provided"}),e.jsx(ue,{children:e.jsx("span",{className:"font-semibold",children:R(b.default_price)})}),e.jsx(ue,{children:b.created_at?new Date(b.created_at).toLocaleDateString():"Unknown"}),e.jsx(ue,{className:"text-right",children:e.jsxs(Fs,{children:[e.jsx(Ls,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"sm",children:e.jsx(Qa,{className:"h-4 w-4"})})}),e.jsxs(js,{align:"end",children:[e.jsxs(lt,{onClick:()=>{r(b),l(!0)},children:[e.jsx($t,{className:"h-4 w-4 mr-2"}),"Edit Service"]}),e.jsx(ys,{}),e.jsxs(lt,{className:"text-destructive",onClick:()=>{r(b),u(!0)},children:[e.jsx(Ot,{className:"h-4 w-4 mr-2"}),"Delete Service"]})]})]})})]},b.id))})]})})]})})]}),e.jsx(De,{open:o,onOpenChange:l,children:e.jsxs(Re,{className:"w-full sm:max-w-xl px-6",children:[e.jsxs(ke,{children:[e.jsx(qe,{children:"Edit Service"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:['Update details for "',a?.name,'"']})]}),a&&e.jsx(yx,{setOpen:l,service:a})]})}),e.jsx(pt,{open:c,onOpenChange:u,children:e.jsxs(at,{children:[e.jsxs(rt,{children:[e.jsx(nt,{children:"Are you sure?"}),e.jsxs(ot,{children:['This action cannot be undone. This will permanently delete the service "',a?.name,'" and remove it from all quotes and invoices.']})]}),e.jsxs(ft,{children:[e.jsx(j,{variant:"outline",onClick:()=>u(!1),children:"Cancel"}),e.jsx(j,{variant:"destructive",disabled:p,onClick:async()=>{if(a)try{await h.mutateAsync(a.id),u(!1),r(null)}catch(b){console.error("Delete error:",b)}},children:p?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete Service"})]})]})})]})}const Aa=t=>{switch(t){case"invoice":return q.INVOICE_STATUS;case"quote":return q.QUOTE_STATUS;case"quote_request":return q.QUOTE_REQUEST_STATUS;default:throw new Error(`Invalid status type: ${t}`)}},Dr=(t,s)=>({id:t.id,name:t.name,description:t.description,created_at:t.created_at,updated_at:t.updated_at,type:s}),Xs=async t=>{try{const s=Aa(t),{data:a,error:r}=await w.from(s).select("*").order("name",{ascending:!0});return r?(console.error(`Error fetching ${t} statuses:`,r),{data:null,error:r.message}):{data:a?.map(i=>Dr(i,t))||[],error:null}}catch(s){const a=s instanceof Error?s.message:"Unknown error occurred";return console.error("Error in fetchStatusesByType:",s),{data:null,error:a}}},bx=async()=>{try{const[t,s,a]=await Promise.all([Xs("invoice"),Xs("quote"),Xs("quote_request")]);return t.error||s.error||a.error?{data:null,error:`Errors occurred: ${[t.error,s.error,a.error].filter(Boolean).join(", ")}`}:{data:[...t.data||[],...s.data||[],...a.data||[]],error:null}}catch(t){const s=t instanceof Error?t.message:"Unknown error occurred";return console.error("Error in fetchAllStatuses:",t),{data:null,error:s}}},Nx=async(t,s)=>{try{const a=Aa(t),{data:r}=await w.from(a).select("id, name").eq("name",s.name.trim()).maybeSingle();if(r)return{data:null,error:`A ${t} status with the name "${s.name}" already exists`};const n={name:s.name.trim(),description:s.description?.trim()||null},{data:i,error:o}=await w.from(a).insert([n]).select("*").single();return o?(console.error(`Error creating ${t} status:`,o),o.code==="23505"&&o.message.includes("pkey")?{data:null,error:"Database primary key error. This usually happens when the database sequence is out of sync. Please refresh the page and try again, or contact support if the issue persists."}:o.code==="23505"?{data:null,error:"A status with this name already exists. Please choose a different name."}:{data:null,error:o.message}):{data:Dr(i,t),error:null}}catch(a){const r=a instanceof Error?a.message:"Unknown error occurred";return console.error("Error in createStatus:",a),{data:null,error:r}}},wx=async(t,s,a)=>{try{const r=Aa(t),{data:n}=await w.from(r).select("id, name").eq("name",a.name.trim()).neq("id",s).maybeSingle();if(n)return{data:null,error:`A ${t} status with the name "${a.name}" already exists`};const{data:i,error:o}=await w.from(r).update({name:a.name.trim(),description:a.description?.trim()||null,updated_at:new Date().toISOString()}).eq("id",s).select("*").single();return o?(console.error(`Error updating ${t} status:`,o),{data:null,error:o.message}):{data:Dr(i,t),error:null}}catch(r){const n=r instanceof Error?r.message:"Unknown error occurred";return console.error("Error in updateStatus:",r),{data:null,error:n}}},Cx=async(t,s)=>{try{const a=Aa(t);let r=!1,n="";if(t==="invoice"){const{data:o}=await w.from(q.INVOICE).select("id").eq("invoice_status_id",s).limit(1);o&&o.length>0&&(r=!0,n="invoices")}else if(t==="quote"){const{data:o}=await w.from(q.QUOTE).select("id").eq("status_id",s).limit(1);o&&o.length>0&&(r=!0,n="quotes")}else if(t==="quote_request"){const{data:o}=await w.from(q.QUOTE_REQUEST).select("id").eq("est_request_status_id",s).limit(1);o&&o.length>0&&(r=!0,n="quote requests")}if(r)return{success:!1,error:`Cannot delete this status because it is currently being used by existing ${n}.`};const{error:i}=await w.from(a).delete().eq("id",s);return i?(console.error(`Error deleting ${t} status:`,i),{success:!1,error:i.message}):{success:!0,error:null}}catch(a){const r=a instanceof Error?a.message:"Unknown error occurred";return console.error("Error in deleteStatus:",a),{success:!1,error:r}}},_x=async(t,s)=>{try{let a=0;if(t==="invoice"){const{count:r,error:n}=await w.from(q.INVOICE).select("*",{count:"exact",head:!0}).eq("invoice_status_id",s);if(n)throw n;a=r||0}else if(t==="quote"){const{count:r,error:n}=await w.from(q.QUOTE).select("*",{count:"exact",head:!0}).eq("status_id",s);if(n)throw n;a=r||0}else if(t==="quote_request"){const{count:r,error:n}=await w.from(q.QUOTE_REQUEST).select("*",{count:"exact",head:!0}).eq("est_request_status_id",s);if(n)throw n;a=r||0}return{count:a,error:null}}catch(a){const r=a instanceof Error?a.message:"Unknown error occurred";return console.error("Error in getStatusUsage:",a),{count:0,error:r}}},Ue={all:["statuses"],allStatuses:()=>[...Ue.all,"all"],byType:t=>[...Ue.all,"type",t],byId:(t,s)=>[...Ue.all,"type",t,"id",s],usage:(t,s)=>[...Ue.all,"usage",t,s]},Sx=()=>ie({queryKey:Ue.allStatuses(),queryFn:bx,staleTime:300*1e3,cacheTime:600*1e3,select:t=>{if(t.error||!t.data)return{statuses:[],error:t.error};const s=t.data.reduce((a,r)=>(a[r.type]||(a[r.type]=[]),a[r.type].push(r),a),{});return{statuses:t.data,grouped:s,error:null}}}),Tx=t=>ie({queryKey:Ue.byType(t),queryFn:()=>Xs(t),staleTime:300*1e3,cacheTime:600*1e3,select:s=>({statuses:s.data||[],error:s.error,isLoading:!1})}),Ex=(t,s,a=!0)=>ie({queryKey:Ue.usage(t,s),queryFn:()=>_x(t,s),enabled:a&&s>0,staleTime:120*1e3,select:r=>({count:r.count,error:r.error})}),Ix=()=>{const t=fe();return me({mutationFn:({type:s,data:a})=>Nx(s,a),onSuccess:(s,{type:a})=>{s.data&&!s.error&&(t.invalidateQueries({queryKey:Ue.allStatuses()}),t.invalidateQueries({queryKey:Ue.byType(a)}),t.setQueryData(Ue.byId(a,s.data.id),{data:s.data,error:null}))},onError:s=>{console.error("Error creating status:",s)}})},Px=()=>{const t=fe();return me({mutationFn:({type:s,id:a,data:r})=>wx(s,a,r),onSuccess:(s,{type:a,id:r})=>{s.data&&!s.error&&(t.invalidateQueries({queryKey:Ue.allStatuses()}),t.invalidateQueries({queryKey:Ue.byType(a)}),t.setQueryData(Ue.byId(a,r),{data:s.data,error:null}))},onError:s=>{console.error("Error updating status:",s)}})},Dx=()=>{const t=fe();return me({mutationFn:({type:s,id:a})=>Cx(s,a),onSuccess:(s,{type:a,id:r})=>{s.success&&(t.invalidateQueries({queryKey:Ue.allStatuses()}),t.invalidateQueries({queryKey:Ue.byType(a)}),t.removeQueries({queryKey:Ue.byId(a,r)}),t.removeQueries({queryKey:Ue.usage(a,r)}))},onError:s=>{console.error("Error deleting status:",s)}})},Rx=t=>{const s=Sx();Tx("invoice");const a=Ix(),r=Px(),n=Dx(),i=(u,h)=>a.mutateAsync({type:u,data:h}),o=(u,h,p)=>r.mutateAsync({type:u,id:h,data:p}),l=(u,h)=>n.mutateAsync({type:u,id:h}),c=()=>{s.refetch()};return{allStatuses:s.data?.statuses||[],groupedStatuses:s.data?.grouped||{},typeStatuses:[],isLoading:s.isLoading||!1,isCreating:a.isPending,isUpdating:r.isPending,isDeleting:n.isPending,error:s.data?.error||null||null,createError:a.error,updateError:r.error,deleteError:n.error,createSuccess:a.isSuccess,updateSuccess:r.isSuccess,deleteSuccess:n.isSuccess,createStatus:i,updateStatus:o,deleteStatus:l,refetchAll:c,resetCreateState:a.reset,resetUpdateState:r.reset,resetDeleteState:n.reset}},ia=Ee({name:z().min(1,"Status name is required").min(2,"Status name must be at least 2 characters").max(50,"Status name must not exceed 50 characters").regex(/^[a-zA-Z0-9\s\-_\.]+$/,"Status name can only contain letters, numbers, spaces, hyphens, underscores, and dots").transform(t=>t.trim()),description:z().max(200,"Description must not exceed 200 characters").optional().transform(t=>t?t.trim():void 0)}),Fa=_s(["invoice","quote","quote_request"],{required_error:"Status type is required",invalid_type_error:"Invalid status type selected"});Ee({type:Fa,name:ia.shape.name,description:ia.shape.description});Ee({action:_s(["delete"],{required_error:"Action is required"}),statusIds:bs(te().positive("Invalid status ID")).min(1,"At least one status must be selected").max(20,"Cannot perform bulk action on more than 20 statuses at once"),type:Fa});Ee({search:z().optional(),type:_s(["all","invoice","quote","quote_request"]).optional().default("all"),sortBy:_s(["name","created_at","updated_at","type"]).optional().default("name"),sortOrder:_s(["asc","desc"]).optional().default("asc")});Ee({type:Fa,id:te().positive("Invalid status ID")});const kx={invoice:["Draft","Sent","Pending","Paid","Overdue","Cancelled","Refunded","Partial Payment"],quote:["Draft","Sent","Pending Review","Accepted","Rejected","Expired","Converted","Under Review"],quote_request:["New Request","In Review","Scheduled","Completed","Cancelled","Follow Up Required","Quote Sent","Converted to Quote"]},qx=t=>kx[t];Ee({statuses:bs(Ee({type:Fa,name:z().min(1,"Name is required"),description:z().optional()})).min(1,"At least one status must be provided").max(100,"Cannot import more than 100 statuses at once")});const an=t=>{switch(t){case"invoice":return"Invoice";case"quote":return"Quote";case"quote_request":return"Quote Request";default:return t}},Ax=t=>{switch(t){case"invoice":return e.jsx(mt,{className:"h-4 w-4 text-blue-600"});case"quote":return e.jsx(Vt,{className:"h-4 w-4 text-green-600"});case"quote_request":return e.jsx(Ze,{className:"h-4 w-4 text-purple-600"});default:return e.jsx(mt,{className:"h-4 w-4"})}},Fx=t=>{switch(t){case"invoice":return"bg-blue-100 text-blue-800 hover:bg-blue-200";case"quote":return"bg-green-100 text-green-800 hover:bg-green-200";case"quote_request":return"bg-purple-100 text-purple-800 hover:bg-purple-200";default:return"bg-gray-100 text-gray-800 hover:bg-gray-200"}},Lx=({status:t,onSubmit:s,onCancel:a,isLoading:r,mode:n})=>{const[i,o]=d.useState(t?.type||"invoice"),l=Tt({resolver:gt(ia),defaultValues:{name:t?.name||"",description:t?.description||""}}),c=async p=>{await s({...p,type:i})},u=d.useMemo(()=>qx(i),[i]),h=p=>{l.setValue("name",p)};return e.jsx(It,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(c),className:"space-y-6",children:[n==="create"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Status Type"}),e.jsx("p",{className:"text-xs text-muted-foreground font-thin",children:"Choose which type of records this status will be used for"})]}),e.jsxs(Ce,{value:i,onValueChange:p=>o(p),children:[e.jsx(Ne,{className:"w-full text-left py-8",children:e.jsx(_e,{placeholder:"Select status type"})}),e.jsxs(Ye,{children:[e.jsx(et,{className:"hover:cursor-pointer",value:"invoice",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-1 bg-blue-100 rounded",children:e.jsx(mt,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Invoice Status"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"For billing and payment tracking"})]})]})}),e.jsx(et,{className:"hover:cursor-pointer",value:"quote",children:e.jsxs("div",{className:"flex items-center gap-3 py-2",children:[e.jsx("div",{className:"p-1 bg-green-100 rounded",children:e.jsx(Vt,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Quote Status"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"For estimate and proposal tracking"})]})]})}),e.jsx(et,{className:"hover:cursor-pointer",value:"quote_request",children:e.jsxs("div",{className:"flex items-center gap-3 py-2",children:[e.jsx("div",{className:"p-1 bg-purple-100 rounded",children:e.jsx(Ze,{className:"h-4 w-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Quote Request Status"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"For lead and inquiry management"})]})]})})]})]})]}),e.jsx(D,{control:l.control,name:"name",render:({field:p})=>e.jsxs(I,{children:[e.jsxs(P,{children:["Status Name ",e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsx(k,{children:e.jsx(Q,{placeholder:"e.g., Pending Review, In Progress, Completed...",...p,className:"text-base"})}),e.jsx(dt,{className:"text-xs font-thin",children:"Choose a clear, descriptive name (2-50 characters). This will be visible throughout the system."}),e.jsx(U,{})]})}),n==="create"&&u.length>0&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm font-medium text-muted-foreground",children:["Popular ",an(i)," Statuses"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1 font-thin",children:"Click any suggestion to use it as your status name"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:u.slice(0,8).map(p=>e.jsx(j,{type:"button",variant:"outline",size:"sm",onClick:()=>h(p),className:"justify-start text-left text-xs h-auto py-2 px-3",children:e.jsx("div",{className:"truncate",children:p})},p))})]}),e.jsx(D,{control:l.control,name:"description",render:({field:p})=>e.jsxs(I,{children:[e.jsx(P,{children:"Description"}),e.jsx(k,{children:e.jsx(Ae,{placeholder:"Optional: Describe when this status should be used, what it represents, or any special conditions...",className:"resize-none text-base min-h-[80px]",rows:3,...p})}),e.jsx(dt,{className:"text-xs font-thin",children:"Help your team understand when to use this status (max 200 characters)"}),e.jsx(U,{})]})}),n==="create"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Preview"}),e.jsxs("div",{className:"p-3 border rounded-lg bg-muted/30",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Ax(i),e.jsx("span",{className:"font-medium",children:l.watch("name")||"Status Name"}),e.jsx(de,{variant:"secondary",className:Fx(i),children:an(i)})]}),l.watch("description")&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:l.watch("description")})]})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-3 pt-4 border-t",children:[e.jsx(j,{type:"button",variant:"outline",onClick:a,className:"flex-1",children:"Cancel"}),e.jsxs(j,{type:"submit",disabled:r,className:"flex-1",children:[r&&e.jsx(Mt,{className:"mr-2 h-4 w-4 animate-spin"}),n==="create"?e.jsxs(e.Fragment,{children:[e.jsx(Ht,{className:"mr-2 h-4 w-4"}),"Create Status"]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"mr-2 h-4 w-4"}),"Update Status"]})]})]})]})})},Ox=({status:t,onSubmit:s,onCancel:a,isLoading:r,mode:n})=>{const[i,o]=d.useState(t?.type||"invoice"),l=Tt({resolver:gt(ia),defaultValues:{name:t?.name||"",description:t?.description||""}}),c=async u=>{await s({...u,type:i})};return e.jsx(It,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(c),className:"space-y-4",children:[e.jsx(D,{control:l.control,name:"name",render:({field:u})=>e.jsxs(I,{children:[e.jsx(P,{children:"Status Name"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"Enter status name...",...u})}),e.jsx(dt,{children:"A unique name for this status (2-50 characters)"}),e.jsx(U,{})]})}),e.jsx(D,{control:l.control,name:"description",render:({field:u})=>e.jsxs(I,{children:[e.jsx(P,{children:"Description (Optional)"}),e.jsx(k,{children:e.jsx(Ae,{placeholder:"Enter a brief description...",className:"resize-none",rows:3,...u})}),e.jsx(dt,{children:"Optional description to clarify when this status should be used"}),e.jsx(U,{})]})}),e.jsxs(ft,{children:[e.jsx(j,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),e.jsxs(j,{type:"submit",disabled:r,children:[r&&e.jsx(Mt,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Status"]})]})]})})},$x=({status:t,isOpen:s,onClose:a})=>{const{data:r,isLoading:n}=Ex(t.type,t.id,s);return e.jsx(pt,{open:s,onOpenChange:a,children:e.jsxs(at,{children:[e.jsxs(rt,{children:[e.jsxs(nt,{className:"flex items-center gap-2",children:[e.jsx(ja,{className:"h-5 w-5"}),"Status Usage: ",t.name]}),e.jsx(ot,{children:"View how this status is currently being used in the system"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Current Usage"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Records using this status"})]}),e.jsx("div",{className:"text-right",children:n?e.jsx(ee,{className:"h-8 w-16"}):e.jsx("div",{className:"text-2xl font-bold",children:r?.count??0})})]}),e.jsxs("div",{className:"p-4 border rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Status Information"}),e.jsxs("dl",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Type:"}),e.jsx("dd",{className:"capitalize",children:t.type.replace("_"," ")})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Created:"}),e.jsx("dd",{children:new Date(t.created_at).toLocaleDateString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("dt",{className:"text-muted-foreground",children:"Last Updated:"}),e.jsx("dd",{children:new Date(t.updated_at).toLocaleDateString()})]}),t.description&&e.jsxs("div",{className:"pt-2",children:[e.jsx("dt",{className:"text-muted-foreground mb-1",children:"Description:"}),e.jsx("dd",{className:"text-sm",children:t.description})]})]})]}),r&&r.count>0&&e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"h-4 w-4 text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"This status is currently in use and cannot be deleted. You can still edit its name and description."})]})})]}),e.jsx(ft,{children:e.jsx(j,{variant:"outline",onClick:a,children:"Close"})})]})})},Mx=({status:t,isOpen:s,onConfirm:a,onCancel:r,isLoading:n})=>e.jsx(pt,{open:s,onOpenChange:r,children:e.jsxs(at,{children:[e.jsxs(rt,{children:[e.jsxs(nt,{className:"flex items-center gap-2",children:[e.jsx(At,{className:"h-5 w-5 text-destructive"}),"Delete Status"]}),e.jsxs(ot,{children:['Are you sure you want to delete "',t.name,'"? This action cannot be undone.']})]}),e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(At,{className:"h-4 w-4 text-red-600"}),e.jsxs("p",{className:"text-sm text-red-800",children:["Please ensure this status is not being used by any ",t.type.replace("_"," "),"s before deleting it."]})]})}),e.jsxs(ft,{children:[e.jsx(j,{variant:"outline",onClick:r,children:"Cancel"}),e.jsxs(j,{variant:"destructive",onClick:a,disabled:n,children:[n&&e.jsx(Mt,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Status"]})]})]})});function zx(){const[t,s]=d.useState(""),[a,r]=d.useState("all"),[n,i]=d.useState(!1),[o,l]=d.useState(!1),[c,u]=d.useState(!1),[h,p]=d.useState(!1),[g,N]=d.useState(null),{allStatuses:_,groupedStatuses:m,isLoading:R,isCreating:S,isUpdating:E,isDeleting:b,error:O,createError:F,updateError:L,deleteError:H,createStatus:ne,updateStatus:G,deleteStatus:Z,refetchAll:oe,resetCreateState:v,resetUpdateState:$,resetDeleteState:x}=Rx(),y=d.useMemo(()=>{let J=_;return a!=="all"&&(J=J.filter(Le=>Le.type===a)),t&&(J=J.filter(Le=>Le.name.toLowerCase().includes(t.toLowerCase())||Le.description?.toLowerCase().includes(t.toLowerCase()))),J},[_,a,t]),f=d.useMemo(()=>({total:_.length,invoice:m.invoice?.length||0,quote:m.quote?.length||0,quote_request:m.quote_request?.length||0}),[_,m]),M=async J=>{try{const Le=await ne(J.type,{name:J.name,description:J.description});if(Le.error)throw new Error(Le.error);i(!1),v()}catch(Le){console.error("Error creating status:",Le)}},C=async J=>{if(g)try{const Le=await G(g.type,g.id,{name:J.name,description:J.description});if(Le.error)throw new Error(Le.error);l(!1),N(null),$()}catch(Le){console.error("Error updating status:",Le)}},W=async()=>{if(g)try{const J=await Z(g.type,g.id);if(!J.success)throw new Error(J.error||"Failed to delete status");p(!1),N(null),x()}catch(J){console.error("Error deleting status:",J)}},ge=J=>{N(J),l(!0)},je=J=>{N(J),u(!0)},Qe=J=>{N(J),p(!0)},B=J=>{switch(J){case"invoice":return e.jsx(mt,{className:"h-4 w-4"});case"quote":return e.jsx(Vt,{className:"h-4 w-4"});case"quote_request":return e.jsx(Ze,{className:"h-4 w-4"});default:return e.jsx(Vt,{className:"h-4 w-4"})}},Se=J=>{switch(J){case"invoice":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300";case"quote":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300";case"quote_request":return"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300"}},Cs=J=>J.replace("_"," ").replace(/\b\w/g,Le=>Le.toUpperCase());return e.jsxs("div",{className:"flex-1 space-y-4 mb-8",children:[e.jsx(Qs,{title:"Status Management",subheading:"Manage statuses for invoices, quotes, and quote requests",showActionButton:!0,actionButtonText:"Create Status",actionButtonIcon:e.jsx(Ht,{className:"h-4 w-4 mr-1"}),useSheet:!1,onActionClick:()=>i(!0)}),O||F||L||H?e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pa,{className:"h-4 w-4 text-red-600"}),e.jsx("p",{className:"text-sm text-red-800",children:String(O||F||L||H||"An unexpected error occurred")})]})}):null,e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Total Statuses"}),e.jsx(Vt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all types"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Invoice Statuses"}),e.jsx(mt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.invoice}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"For invoice management"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Quote Statuses"}),e.jsx(Vt,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.quote}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"For quote tracking"})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(ce,{className:"text-sm font-medium",children:"Request Statuses"}),e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(X,{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.quote_request}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"For request workflow"})]})]})]}),e.jsxs(Y,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ce,{children:"Status Management"}),e.jsx(rs,{children:"Create, edit, and organize statuses for your business workflow"})]}),e.jsxs(j,{variant:"outline",onClick:oe,disabled:R,children:[e.jsx(Mt,{className:`h-4 w-4 mr-2 ${R?"animate-spin":""}`}),"Refresh"]})]})}),e.jsxs(X,{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Es,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(Q,{placeholder:"Search statuses...",value:t,onChange:J=>s(J.target.value),className:"pl-8"})]})}),e.jsxs(vi,{value:a,onValueChange:J=>r(J),children:[e.jsxs(Er,{className:"grid w-full grid-cols-4",children:[e.jsx(Ft,{value:"all",children:"All Types"}),e.jsx(Ft,{value:"invoice",children:"Invoices"}),e.jsx(Ft,{value:"quote",children:"Quotes"}),e.jsx(Ft,{value:"quote_request",children:"Requests"})]}),e.jsx(oa,{value:a,className:"space-y-4",children:R?e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((J,Le)=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"h-4 w-32"}),e.jsx(ee,{className:"h-3 w-48"})]}),e.jsx(ee,{className:"h-8 w-20"})]},Le))}):y.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Vt,{className:"mx-auto h-12 w-12 text-muted-foreground"}),e.jsx("h3",{className:"mt-2 text-sm font-semibold",children:"No statuses found"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:t?"Try adjusting your search terms.":"Get started by creating your first status."}),!t&&e.jsxs(j,{className:"mt-4",onClick:()=>i(!0),children:[e.jsx(Ht,{className:"mr-2 h-4 w-4"}),"Create Status"]})]}):e.jsx("div",{className:"space-y-3",children:y.map(J=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[e.jsx("div",{className:"flex items-center space-x-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[B(J.type),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h4",{className:"font-medium",children:J.name}),e.jsx(de,{variant:"secondary",className:Se(J.type),children:Cs(J.type)})]}),J.description&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:J.description})]})]})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>je(J),children:e.jsx(ja,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>ge(J),children:e.jsx(ga,{className:"h-4 w-4"})}),e.jsx(j,{variant:"ghost",size:"sm",onClick:()=>Qe(J),children:e.jsx(Ot,{className:"h-4 w-4"})})]})]},`${J.type}-${J.id}`))})})]})]})]}),e.jsx(De,{open:n,onOpenChange:i,children:e.jsx(Re,{className:"w-full sm:max-w-xl p-0",side:"right",children:e.jsx(Je,{className:"h-full",children:e.jsxs("div",{className:"px-6 py-6 space-y-6",children:[e.jsxs(ke,{children:[e.jsx(qe,{className:"flex items-center gap-2",children:"Create New Status"}),e.jsx(Ct,{children:"Add a new status to organize your business workflow. Choose the appropriate type and provide a descriptive name."})]}),e.jsx(Lx,{mode:"create",onSubmit:M,onCancel:()=>i(!1),isLoading:S})]})})})}),g&&e.jsx(pt,{open:o,onOpenChange:l,children:e.jsxs(at,{className:"sm:max-w-[425px]",children:[e.jsxs(rt,{children:[e.jsx(nt,{children:"Edit Status"}),e.jsxs(ot,{children:['Make changes to "',g.name,'" status']})]}),e.jsx(Ox,{mode:"edit",status:g,onSubmit:C,onCancel:()=>l(!1),isLoading:E})]})}),g&&e.jsx($x,{status:g,isOpen:c,onClose:()=>u(!1)}),g&&e.jsx(Mx,{status:g,isOpen:h,onConfirm:W,onCancel:()=>p(!1),isLoading:b})]})}function Ux(){const t=vs(),s=()=>{t(-2)};return e.jsxs("div",{className:"flex flex-col w-screen-md gap-2 mt-[150px] mb-8",children:[e.jsx("div",{className:"w-[100px] mx-auto",children:e.jsx(xe,{variant:"gray",title:"404 error"})}),e.jsx("p",{className:"text-[32px] lg:text-[48px] font-[600] mx-auto",children:"We can't find this page"}),e.jsx("p",{className:"text-center text-muted-foreground",children:"The page you are looking for doesn't exist or has been moved."}),e.jsxs("div",{className:"grid grid-flow-row grid-cols-1 md:grid-cols-2 mt-8 gap-4",children:[e.jsxs(j,{variant:"secondary",onClick:s,className:"",children:[e.jsx(nr,{className:"w-4 h-4 mr-4"}),"Go Back"]}),e.jsx(j,{className:"",variant:"primary",asChild:!0,children:e.jsxs(Pe,{to:"/",children:[e.jsx(fa,{className:"w-4 h-4 mr-4"}),"Go home"]})})]})]})}const Xt={ALL:["customer-types"],DETAIL:t=>["customer-types",t],USAGE:t=>["customer-types",t,"usage"]},Ni={CUSTOMER_TYPES:["customerTypes"],CUSTOMER_TYPE:t=>["customerType",t],CUSTOMER_TYPE_USAGE:t=>["customerTypeUsage",t]},Qx=()=>ie({queryKey:Ni.CUSTOMER_TYPES,queryFn:async()=>{const t=await Fo();if(t.error)throw new Error(t.error);return t.data||[]},staleTime:300*1e3,retry:2}),wi=(t,s=!0)=>ie({queryKey:Ni.CUSTOMER_TYPE_USAGE(t),queryFn:async()=>{const a=await tu(t);if(a.error)throw new Error(a.error);return a.data},enabled:s&&!!t,staleTime:120*1e3,retry:1}),Bx=t=>{const s=fe();return me({mutationFn:Zd,onSuccess:a=>{s.invalidateQueries({queryKey:[Xt.ALL]}),a.data},onError:a=>{console.error("Error creating customer type:",a)}})},Vx=()=>{const t=fe();return me({mutationFn:Jd,onSuccess:(s,a)=>{if(s.error)throw new Error(s.error);t.invalidateQueries({queryKey:Xt.ALL}),s.data&&(t.setQueryData(Xt.DETAIL(a.id),s.data),t.setQueryData(Xt.ALL,(r=[])=>r.map(n=>n.id===a.id?s.data:n).sort((n,i)=>n.name.localeCompare(i.name))))},onError:s=>{console.error("Update customer type mutation error:",s)}})},Hx=()=>{const t=fe();return me({mutationFn:eu,onSuccess:(s,a)=>{if(!s.success)throw new Error(s.error||"Failed to delete customer type");t.setQueryData(Xt.ALL,(r=[])=>r.filter(n=>n.id!==a)),t.removeQueries({queryKey:Xt.DETAIL(a)}),t.removeQueries({queryKey:Xt.USAGE(a)}),t.invalidateQueries({queryKey:Xt.ALL})},onError:s=>{console.error("Delete customer type mutation error:",s)}})},Kx=()=>{const{data:t=[],isLoading:s,error:a,refetch:r}=Qx(),n=Bx(),i=Vx(),o=Hx();return{customerTypes:t,isLoading:s,isCreating:n.isPending,isUpdating:i.isPending,isDeleting:o.isPending,error:a?.message||null,createError:n.error?.message||null,updateError:i.error?.message||null,deleteError:o.error?.message||null,createCustomerType:n.mutateAsync,updateCustomerType:i.mutateAsync,deleteCustomerType:o.mutateAsync,refetchCustomerTypes:r,resetCreateState:n.reset,resetUpdateState:i.reset,resetDeleteState:o.reset}},Wx=Ee({name:z().min(1,"Customer type name is required").min(2,"Customer type name must be at least 2 characters").max(50,"Customer type name must not exceed 50 characters").trim().refine(t=>/^[a-zA-Z0-9\s\-_&()]+$/.test(t),"Customer type name can only contain letters, numbers, spaces, and basic punctuation"),description:z().max(255,"Description must not exceed 255 characters").optional().or(ta(""))}),Gx=Ee({id:te().positive("Invalid customer type ID"),name:z().min(1,"Customer type name is required").min(2,"Customer type name must be at least 2 characters").max(50,"Customer type name must not exceed 50 characters").trim().refine(t=>/^[a-zA-Z0-9\s\-_&()]+$/.test(t),"Customer type name can only contain letters, numbers, spaces, and basic punctuation"),description:z().max(255,"Description must not exceed 255 characters").optional().or(ta(""))}),Yx=gt(Wx),Xx=gt(Gx),rn={name:"",description:""},Zx=t=>({id:t.id,name:t.name,description:t.description||""}),Jx=t=>t.charAt(0).toUpperCase()+t.slice(1),eh=t=>{const s=["bg-blue-100 text-blue-800","bg-green-100 text-green-800","bg-purple-100 text-purple-800","bg-orange-100 text-orange-800","bg-red-100 text-red-800","bg-yellow-100 text-yellow-800","bg-indigo-100 text-indigo-800","bg-pink-100 text-pink-800"],a=t.split("").reduce((r,n)=>r+n.charCodeAt(0),0);return s[a%s.length]},nn=({customerType:t,onSubmit:s,onCancel:a,isLoading:r,mode:n})=>{const i=Tt({resolver:n==="create"?Yx:Xx,defaultValues:n==="create"?rn:t?Zx({id:t.id,name:t.name,description:t.description||null}):rn}),o=async l=>{try{const c=n==="edit"&&t?{...l,id:t.id}:l;await s(c),i.reset()}catch(c){console.error("Form submission error:",c)}};return e.jsx(It,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(o),className:"space-y-6 px-1",children:[e.jsx(D,{control:i.control,name:"name",render:({field:l})=>e.jsxs(I,{children:[e.jsx(P,{children:"Customer Type Name"}),e.jsx(k,{children:e.jsx(Q,{placeholder:"e.g., Residential, Commercial, Industrial",...l,disabled:r})}),e.jsx(dt,{children:"Enter a unique name for this customer type (2-50 characters)"}),e.jsx(U,{})]})}),e.jsx(D,{control:i.control,name:"description",render:({field:l})=>e.jsxs(I,{children:[e.jsx(P,{children:"Description (Optional)"}),e.jsx(k,{children:e.jsx(Ae,{className:"min-h-[200px]",placeholder:"Describe this customer type and its characteristics...",rows:3,...l,disabled:r})}),e.jsx(dt,{children:"Provide additional context about this customer type (max 255 characters)"}),e.jsx(U,{})]})}),e.jsxs(qt,{className:"flex justify-end space-x-2",children:[e.jsx(j,{type:"button",variant:"outline",onClick:a,disabled:r,children:"Cancel"}),e.jsx(j,{type:"submit",disabled:r||!i.formState.isDirty,children:r?e.jsxs(e.Fragment,{children:[e.jsx(Mt,{className:"mr-2 h-4 w-4 animate-spin"}),n==="create"?"Creating...":"Updating..."]}):n==="create"?"Create Customer Type":"Update Customer Type"})]})]})})},th=({customerType:t,isOpen:s,onClose:a})=>{const{data:r,isLoading:n}=wi(t.id,s);return e.jsx(pt,{open:s,onOpenChange:a,children:e.jsxs(at,{className:"sm:max-w-md",children:[e.jsxs(rt,{children:[e.jsxs(nt,{className:"flex items-center space-x-2",children:[e.jsx(ja,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{children:"Customer Type Usage"})]}),e.jsxs(ot,{children:['Usage details for "',t.name,'"']})]}),e.jsx("div",{className:"space-y-4",children:n?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"h-4 w-full"}),e.jsx(ee,{className:"h-4 w-3/4"})]}):r?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[e.jsx("span",{className:"text-sm font-medium",children:"Customers using this type:"}),e.jsx(de,{variant:"secondary",className:"text-lg px-3 py-1",children:r.customerCount})]}),e.jsxs("div",{className:"p-3 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.canDelete?e.jsx(ct,{className:"h-4 w-4 text-green-600"}):e.jsx(pa,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium",children:r.canDelete?"Can be deleted":"Cannot be deleted"})]}),e.jsx("p",{className:"text-sm text-gray-600",children:r.canDelete?"This customer type is not in use and can be safely deleted.":"This customer type is currently assigned to customers and cannot be deleted."})]})]}):e.jsx("p",{className:"text-sm text-gray-500",children:"Unable to load usage information."})}),e.jsx(ft,{children:e.jsx(j,{variant:"outline",onClick:a,children:"Close"})})]})})},sh=({customerType:t,isOpen:s,onConfirm:a,onCancel:r,isLoading:n})=>{const{data:i}=wi(t.id,s);return e.jsx(pt,{open:s,onOpenChange:r,children:e.jsxs(at,{className:"sm:max-w-md",children:[e.jsxs(rt,{children:[e.jsxs(nt,{className:"flex items-center space-x-2",children:[e.jsx(At,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{children:"Delete Customer Type"})]}),e.jsxs(ot,{children:['Are you sure you want to delete "',t.name,'"?']})]}),e.jsxs("div",{className:"space-y-4",children:[i&&!i.canDelete&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(pa,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Cannot delete"})]}),e.jsxs("p",{className:"text-sm text-red-700",children:["This customer type is assigned to ",i.customerCount," customer",i.customerCount!==1?"s":"",". Please reassign or remove these customers before deleting."]})]}),i&&i.canDelete&&e.jsx("p",{className:"text-sm text-gray-600",children:"This action cannot be undone. The customer type will be permanently removed from the system."})]}),e.jsxs(ft,{className:"flex space-x-2",children:[e.jsx(j,{variant:"outline",onClick:r,disabled:n,children:"Cancel"}),e.jsx(j,{variant:"destructive",onClick:a,disabled:n||(i?!i.canDelete:!1),children:n?e.jsxs(e.Fragment,{children:[e.jsx(Mt,{className:"mr-2 h-4 w-4 animate-spin"}),"Deleting..."]}):"Delete Customer Type"})]})]})})},ah=()=>{const[t,s]=d.useState(""),[a,r]=d.useState(null),[n,i]=d.useState(!1),[o,l]=d.useState(!1),[c,u]=d.useState(!1),{customerTypes:h,isLoading:p,error:g,createCustomerType:N,updateCustomerType:_,deleteCustomerType:m,refetchCustomerTypes:R,isCreating:S,isUpdating:E,isDeleting:b,createError:O,updateError:F,deleteError:L}=Kx(),H=d.useMemo(()=>{if(!t.trim())return h;const x=t.toLowerCase();return h.filter(y=>y.name.toLowerCase().includes(x)||y.description&&y.description.toLowerCase().includes(x))},[h,t]),ne=async x=>{try{await N(x)}catch(y){console.error("Create customer type error:",y)}},G=async x=>{try{await _(x),i(!1),r(null)}catch(y){console.error("Update customer type error:",y)}},Z=async()=>{if(a)try{await m(a.id),u(!1),r(null)}catch(x){console.error("Delete customer type error:",x)}},oe=x=>{r(x),i(!0)},v=x=>{r(x),l(!0)},$=x=>{r(x),u(!0)};return e.jsxs("div",{className:"w-full mx-auto pb-6 space-y-6",children:[e.jsx(Qs,{title:"Customer Types",subheading:"Manage customer types to categorize and organize your clients",actionButtonText:"Add Customer Type",actionButtonIcon:e.jsx(Ht,{className:"mr-2 h-4 w-4"}),useSheet:!0,sheetTitle:"Create Customer Type",sheetDescription:"Add a new customer type to categorize your clients",SheetContentBody:({setOpen:x})=>e.jsx(nn,{mode:"create",onSubmit:async y=>{await ne(y),x(!1)},onCancel:()=>x(!1),isLoading:S})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(Y,{children:e.jsx(X,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Kt,{className:"h-5 w-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Types"}),e.jsx("p",{className:"text-2xl font-bold",children:h.length})]})]})})}),e.jsx(Y,{children:e.jsx(X,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Es,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Filtered Results"}),e.jsx("p",{className:"text-2xl font-bold",children:H.length})]})]})})}),e.jsx(Y,{children:e.jsx(X,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ct,{className:"h-5 w-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold",children:h.length})]})]})})})]}),e.jsxs(Y,{children:[e.jsx(re,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ce,{children:"Customer Types List"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>R(),disabled:p,children:[e.jsx(Mt,{className:`mr-2 h-4 w-4 ${p?"animate-spin":""}`}),"Refresh"]})})]})}),e.jsxs(X,{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Es,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Q,{placeholder:"Search customer types by name or description...",value:t,onChange:x=>s(x.target.value),className:"pl-10"})]}),(g||O||F||L)&&e.jsxs("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(At,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:"text-sm font-medium text-red-800",children:"Error"})]}),e.jsx("p",{className:"text-sm text-red-700 mt-1",children:g||O||F||L})]}),p?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[...Array(6)].map((x,y)=>e.jsx(Y,{children:e.jsx(X,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(ee,{className:"h-4 w-3/4"}),e.jsx(ee,{className:"h-3 w-full"}),e.jsx(ee,{className:"h-3 w-2/3"})]})})},y))}):H.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Kt,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:t?"No customer types found":"No customer types yet"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:t?"Try adjusting your search terms":"Get started by creating your first customer type"}),!t&&e.jsx("p",{className:"mt-2 text-sm text-gray-500",children:'Use the "Add Customer Type" button above to get started.'})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:H.map(x=>e.jsx(Y,{className:"hover:shadow-md transition-shadow",children:e.jsxs(X,{className:"p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center space-x-2 mb-2",children:e.jsx(de,{className:eh(x.name),children:Jx(x.name)})}),x.description&&e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:x.description})]}),e.jsxs(Fs,{children:[e.jsx(Ls,{asChild:!0,children:e.jsx(j,{variant:"ghost",size:"sm",children:e.jsx(Qa,{className:"h-4 w-4"})})}),e.jsxs(js,{align:"end",children:[e.jsx(Ir,{children:"Actions"}),e.jsxs(lt,{onClick:()=>v(x),children:[e.jsx(ja,{className:"mr-2 h-4 w-4"}),"View Usage"]}),e.jsxs(lt,{onClick:()=>oe(x),children:[e.jsx(ga,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(ys,{}),e.jsxs(lt,{onClick:()=>$(x),className:"text-red-600 hover:text-red-700",children:[e.jsx(Ot,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["ID: ",x.id]}),e.jsx("span",{children:new Date(x.created_at).toLocaleDateString()})]})]})},x.id))})]})]}),e.jsx(De,{open:n,onOpenChange:i,children:e.jsxs(Re,{children:[e.jsxs(ke,{children:[e.jsx(qe,{children:"Edit Customer Type"}),e.jsx(Ct,{children:"Update the selected customer type details"})]}),e.jsx("div",{className:"mt-6",children:a&&e.jsx(nn,{mode:"edit",customerType:a,onSubmit:G,onCancel:()=>{i(!1),r(null)},isLoading:E})})]})}),a&&e.jsx(th,{customerType:a,isOpen:o,onClose:()=>{l(!1),r(null)}}),a&&e.jsx(sh,{customerType:a,isOpen:c,onConfirm:Z,onCancel:()=>{u(!1),r(null)},isLoading:b})]})};var rh=ah;function nh(){const t=ts(),s=vs(),{toast:a}=ss(),[r,n]=le.useState(!1),i=t?.user,o=i?.user_metadata,l=i?.app_metadata,c=h=>h?new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Never",u=async()=>{n(!0);try{await t?.signOut(),a({title:"Signed out successfully",description:"You have been logged out of your account."}),s("/login")}catch{a({variant:"destructive",title:"Sign out failed",description:"There was an error signing you out. Please try again."})}finally{n(!1)}};return i?e.jsxs("div",{className:"flex-1 space-y-4 mb-8",children:[e.jsx(Qs,{title:"Profile",subheading:"Manage your account information and preferences",showActionButton:!1,showSeparator:!1}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-1 lg:grid-cols-3",children:[e.jsxs(Y,{className:"lg:col-span-2",children:[e.jsxs(re,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Us,{className:"h-5 w-5"}),"Personal Information"]}),e.jsx(rs,{children:"Your profile information from Google authentication"})]}),e.jsx(X,{children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs(Rt,{className:"h-20 w-20",children:[e.jsx(ps,{src:o?.avatar_url||o?.picture,alt:o?.full_name||"User"}),e.jsx(kt,{className:"text-lg",children:Na(o?.full_name||o?.name||"User")})]}),e.jsxs("div",{className:"flex-1 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:o?.full_name||o?.name||"No Name"}),e.jsx("p",{className:"text-muted-foreground",children:i.email})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[o?.email_verified&&e.jsxs(de,{variant:"secondary",className:"text-green-700 bg-green-100",children:[e.jsx(ct,{className:"h-3 w-3 mr-1"}),"Email Verified"]}),l?.provider&&e.jsxs(de,{variant:"outline",className:"capitalize",children:[e.jsx(Ws,{className:"h-3 w-3 mr-1"}),l.provider]})]})]})]})})]}),e.jsxs(Y,{children:[e.jsx(re,{children:e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Mn,{className:"h-5 w-5"}),"Quick Actions"]})}),e.jsxs(X,{className:"space-y-3",children:[e.jsxs(j,{variant:"outline",size:"sm",className:"w-full",onClick:()=>window.location.reload(),children:[e.jsx(Mt,{className:"h-4 w-4 mr-2"}),"Refresh Profile"]}),e.jsxs(j,{variant:"destructive",size:"sm",className:"w-full",onClick:u,disabled:r,children:[r?e.jsx(Mt,{className:"h-4 w-4 mr-2 animate-spin"}):e.jsx(lr,{className:"h-4 w-4 mr-2"}),r?"Signing Out...":"Sign Out"]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(Y,{children:[e.jsxs(re,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(zn,{className:"h-5 w-5"}),"Account Details"]}),e.jsx(rs,{children:"Information about your account and authentication"})]}),e.jsxs(X,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"User ID"}),e.jsx("p",{className:"text-sm font-mono break-all",children:i.id})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Email"}),e.jsx("p",{className:"text-sm",children:i.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Phone"}),e.jsx("p",{className:"text-sm",children:i.phone||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Role"}),e.jsx("p",{className:"text-sm capitalize",children:i.role||"User"})]})]}),e.jsx(Jt,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Email Confirmed"}),i.email_confirmed_at?e.jsxs(de,{variant:"secondary",className:"text-green-700 bg-green-100",children:[e.jsx(ct,{className:"h-3 w-3 mr-1"}),"Confirmed"]}):e.jsxs(de,{variant:"secondary",className:"text-yellow-700 bg-yellow-100",children:[e.jsx(Hr,{className:"h-3 w-3 mr-1"}),"Pending"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Phone Confirmed"}),i.phone_confirmed_at?e.jsxs(de,{variant:"secondary",className:"text-green-700 bg-green-100",children:[e.jsx(ct,{className:"h-3 w-3 mr-1"}),"Confirmed"]}):e.jsxs(de,{variant:"secondary",className:"text-gray-700 bg-gray-100",children:[e.jsx(Hr,{className:"h-3 w-3 mr-1"}),"Not Set"]})]})]})]})]}),e.jsxs(Y,{children:[e.jsxs(re,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Zl,{className:"h-5 w-5"}),"Authentication"]}),e.jsx(rs,{children:"Login providers and security information"})]}),e.jsxs(X,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Authentication Providers"}),e.jsx("div",{className:"space-y-2",children:l?.providers?.map(h=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(de,{variant:"outline",className:"capitalize",children:[e.jsx(Ws,{className:"h-3 w-3 mr-1"}),h]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:h==="google"?"Google OAuth":h})]},h))})]}),e.jsx(Jt,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Account Created"}),e.jsxs("p",{className:"text-sm flex items-center gap-2",children:[e.jsx(tt,{className:"h-3 w-3"}),c(i.created_at)]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Updated"}),e.jsxs("p",{className:"text-sm flex items-center gap-2",children:[e.jsx(Js,{className:"h-3 w-3"}),c(i.updated_at)]})]}),i.last_sign_in_at&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Last Sign In"}),e.jsxs("p",{className:"text-sm flex items-center gap-2",children:[e.jsx(Js,{className:"h-3 w-3"}),c(i.last_sign_in_at)]})]})]})]})]})]}),o&&Object.keys(o).length>0&&e.jsxs(Y,{children:[e.jsxs(re,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(Ws,{className:"h-5 w-5"}),"Provider Information"]}),e.jsx(rs,{children:"Additional information from your authentication provider"})]}),e.jsx(X,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:Object.entries(o).filter(([h,p])=>p&&h!=="avatar_url"&&h!=="picture"&&h!=="full_name"&&h!=="name"&&h!=="email").map(([h,p])=>e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground capitalize",children:h.replace(/_/g," ")}),e.jsx("p",{className:"text-sm break-all",children:typeof p=="boolean"?p?"Yes":"No":String(p)})]},h))})})]})]}):e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(Ns,{title:"Profile",subheading:"Loading profile information...",showActionButton:!1}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.jsxs(Y,{children:[e.jsxs(re,{children:[e.jsx(ee,{className:"h-4 w-1/2"}),e.jsx(ee,{className:"h-3 w-3/4"})]}),e.jsxs(X,{children:[e.jsx(ee,{className:"h-20 w-20 rounded-full mb-4"}),e.jsx(ee,{className:"h-4 w-full mb-2"}),e.jsx(ee,{className:"h-4 w-2/3"})]})]})})]})}function oh({icon:t,title:s,path:a}){return e.jsx(e.Fragment,{children:e.jsx(Pe,{to:a,className:"",children:e.jsx(ks,{children:e.jsxs(qs,{children:[e.jsx(As,{children:e.jsx("div",{className:"p-2 rounded-lg border border-white dark:border-zinc-900 hover:border-zinc-200 dark:hover:border-zinc-800 transition duration-150 ease-in-out hover:scale-110",children:t})}),e.jsx(gs,{children:s})]})})})})}function Ga(){const{setTheme:t}=Qc();return e.jsxs(Fs,{children:[e.jsx(Ls,{asChild:!0,children:e.jsxs(j,{variant:"outline",size:"icon",className:"rounded-full",children:[e.jsx(Jl,{className:"h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0"}),e.jsx(ec,{className:"absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100"}),e.jsx("span",{className:"sr-only",children:"Toggle theme"})]})}),e.jsxs(js,{align:"end",children:[e.jsx(lt,{onClick:()=>t("light"),children:"Light"}),e.jsx(lt,{onClick:()=>t("dark"),children:"Dark"}),e.jsx(lt,{onClick:()=>t("system"),children:"System"})]})]})}const Ci=[{title:"Home",icon:e.jsx(fa,{size:"20px",className:"text-zinc-900 dark:text-zinc-300"}),path:"/",group:1,lastOfGroup:!0},{title:"Sales Leads",icon:e.jsx(tc,{size:"20px",className:"text-zinc-900 dark:text-zinc-300"}),path:"/inbox",group:2},{title:"Invoices",icon:e.jsx(Ps,{size:"20px",className:"text-zinc-900 dark:text-zinc-300"}),path:"/invoices",group:2},{title:"Quotes",icon:e.jsx(ir,{size:"20px",className:"text-zinc-900 dark:text-zinc-300"}),path:"/quotes",group:2},{title:"Customers",icon:e.jsx(Kt,{size:"20px",className:"text-zinc-900 dark:text-zinc-300"}),path:"/customers",group:2,lastOfGroup:!1},{title:"Data Management",icon:e.jsx(sc,{size:"20px",className:"text-zinc-900 dark:text-zinc-300"}),path:"/data-management",group:3}];function ih({userData:t}){const s=vs(),a=ts();return e.jsxs(De,{children:[e.jsx(as,{asChild:!0,children:e.jsx(j,{size:"icon",variant:"outline",children:e.jsx(ac,{size:"18px"})})}),e.jsxs(Re,{className:"w-full ",children:[e.jsx(ke,{children:e.jsx(qe,{children:e.jsxs("div",{className:"flex gap-2 h-[50px]",children:[e.jsx("div",{className:"w-[50px] h-[50px] bg-blue-600 rounded-2xl",children:e.jsx("img",{src:"/assets/TRA-logo.png",className:"shadow-xs p-[0px]"})}),e.jsxs("div",{className:"flex flex-col -space-y-4 my-auto",children:[e.jsx("p",{className:"text-[8px] text-left font-[400] uppercase",children:"The"}),e.jsx("p",{className:"text-[18px] font-[900] uppercase tracking-tight",children:"Roofing"}),e.jsx("p",{className:"text-[8px] text-right font-[400] uppercase",children:"Application"})]})]})})}),e.jsx(Je,{className:"w-full h-full py-6",children:e.jsxs("div",{className:"my-4",children:[e.jsx("div",{className:"grid grid-flow-row grid-cols-1 gap-2 pb-6",children:Ci.map((r,n)=>e.jsx(le.Fragment,{children:e.jsx(Ke,{asChild:!0,children:e.jsx(Pe,{to:r.path,children:e.jsxs("div",{className:"flex gap-4 py-4 px-4 hover:bg-secondary rounded-lg",children:[r.icon,e.jsx("p",{className:"font-[500]",children:r.title})]})})})},n))}),a?.user&&e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-flow-row grid-cols-1 w-full",children:[e.jsxs("div",{className:"flex px-2 gap-4 pb-6 w-full",children:[e.jsxs(Rt,{children:[e.jsx(ps,{src:t.avatar_url,alt:t.full_name}),e.jsx(kt,{children:Na(t.full_name)})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"font-[700] text-[14px]",children:t.full_name}),e.jsx("p",{className:"font-[400] text-[14px]",children:t.email})]})]}),e.jsx("div",{className:"flex gap-2 w-full",children:e.jsx(Ke,{asChild:!0,children:e.jsxs(j,{className:"mr-auto",variant:"primary",onClick:()=>a.signOut(),children:[e.jsx(lr,{className:"mr-2 h-4 w-4"})," SignOut"]})})})]}),e.jsx("div",{className:"px-2 mt-4",children:e.jsx(Ga,{})})]}),!a.user&&e.jsxs("div",{className:"flex px-2 gap-4 pb-6",children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(j,{variant:"primary",onClick:()=>s("/login"),children:[e.jsx(rc,{className:"mr-2 h-4 w-4"})," Login"]})}),e.jsx("div",{className:"px-2",children:e.jsx(Ga,{})})]})]})})]})]})}function lh({userData:t}){return e.jsx("div",{className:"fixed z-50 border-b-2 w-full  lg:hidden bg-white dark:bg-zinc-900",children:e.jsxs("div",{className:"max-w-screen px-3 flex my-3 justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{className:"w-[40px] bg-blue-600 rounded-xl",children:e.jsx("img",{src:"/assets/TRA-logo.png",className:"shadow-xs p-[0px]"})}),e.jsxs("div",{className:"flex flex-col -space-y-2 my-auto",children:[e.jsx("p",{className:"my-auto text-[8px] mb-[-0px] text-left font-[400] uppercase",children:"The"}),e.jsx("p",{className:"text-[16px] font-[900] uppercase tracking-tight",children:"Roofing"}),e.jsx("p",{className:"text-[8px] text-right pt-[1px] font-[400] uppercase",children:"Application"})]})]}),e.jsx("div",{className:"",children:e.jsx(ih,{userData:t})})]})})}function ch({userData:t}){const s=ts(),[a,r]=le.useState(!1),[n,i]=le.useState(!1),[o,l]=le.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden z-40 fixed px-2 border-r-1 lg:w-[80px] lg:h-screen lg:flex lg:flex-col bg-white border-r border-zinc-200 dark:bg-zinc-900 dark:border-zinc-800",children:e.jsxs("div",{className:"flex flex-col mx-auto w-full my-4 h-full gap-6",children:[e.jsxs("div",{className:"mx-auto",children:[e.jsx("div",{className:"w-[50px] bg-blue-600 rounded-2xl transition ease-in-out duration-300 hover:scale-105",children:e.jsx(Pe,{to:"/",children:e.jsx("img",{src:"/assets/TRA-logo.png",className:"shadow-xs p-[0px]"})})}),s?.user&&e.jsx("div",{className:"w-full flex justify-center mt-6",children:e.jsxs(Fs,{children:[e.jsx(Ls,{asChild:!0,children:e.jsxs(Rt,{className:"cursor-pointer hover:border-2 hover:border-blue-500 transition ease-in-out duration-300 hover:scale-110",children:[e.jsx(ps,{src:s.user.user_metadata.avatar_url}),e.jsx(kt,{children:Na(s?.user?.user_metadata?.full_name)})]})}),e.jsxs(js,{className:"w-56",children:[e.jsx(Ir,{children:"My Account"}),e.jsx(ys,{}),e.jsx(sn,{children:e.jsx(Pe,{to:"/profile",children:e.jsxs(lt,{className:"cursor-pointer",children:[e.jsx(Kt,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Profile"}),e.jsx(Wa,{children:"⇧⌘P"})]})})}),e.jsx(ys,{}),e.jsx(sn,{children:e.jsxs(lt,{className:"cursor-pointer",onClick:()=>s.signOut(),children:[e.jsx(lr,{className:"mr-2 h-4 w-4"}),e.jsx("span",{children:"Log out"}),e.jsx(Wa,{children:"⇧⌘Q"})]})})]})]})})]}),e.jsx("div",{className:"flex flex-col mx-auto gap-2",children:Ci.map((c,u)=>e.jsxs(le.Fragment,{children:[e.jsx(oh,{title:c.title,icon:c.icon,path:c.path}),c.lastOfGroup===!0&&e.jsx(Jt,{className:"mb-2"})]},u))}),e.jsxs("div",{className:"flex flex-col mt-auto gap-2 mx-auto",children:[s?.user&&e.jsx("div",{children:e.jsxs(xt,{children:[e.jsx(ht,{asChild:!0,children:e.jsx(j,{variant:"primary",className:"rounded-full",size:"icon",children:e.jsx(Ht,{size:"18px"})})}),e.jsx(st,{side:"right",className:"w-48 p-2",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>r(!0),className:"flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-accent hover:text-accent-foreground transition-colors w-full text-left",children:[e.jsx(Kt,{size:16}),e.jsx("span",{children:"New Customer"})]}),e.jsxs("button",{onClick:()=>i(!0),className:"flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-accent hover:text-accent-foreground transition-colors w-full text-left",children:[e.jsx(ir,{size:16}),e.jsx("span",{children:"New Quote"})]}),e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-3 px-3 py-2 text-sm rounded-md hover:bg-accent hover:text-accent-foreground transition-colors w-full text-left",children:[e.jsx(Ps,{size:16}),e.jsx("span",{children:"New Invoice"})]})]})})]})}),e.jsx("div",{className:"flex justify-center w-full",children:e.jsx(Ga,{})})]})]})}),e.jsx(lh,{userData:t}),e.jsx(De,{open:a,onOpenChange:r,children:e.jsxs(Re,{className:"w-full sm:max-w-lg px-2",children:[e.jsxs(ke,{className:"px-4 space-y-0 mb-4",children:[e.jsx(qe,{children:"Add New Customer"}),e.jsx(Ct,{children:"Fill out the details for the new customer."})]}),e.jsx(Je,{className:"h-[calc(100vh-120px)]",children:e.jsx(hs,{setOpen:r})})]})}),e.jsx(De,{open:n,onOpenChange:i,children:e.jsxs(Re,{className:"w-full sm:max-w-lg px-2",children:[e.jsxs(ke,{className:"px-4 space-y-0 mb-4",children:[e.jsx(qe,{children:"Create New Quote"}),e.jsx(Ct,{children:"Fill out the details for the new quote."})]}),e.jsx(Je,{className:"h-[calc(100vh-120px)]",children:e.jsx(ra,{})})]})}),e.jsx(De,{open:o,onOpenChange:l,children:e.jsxs(Re,{className:"w-full sm:max-w-lg px-2",children:[e.jsxs(ke,{className:"px-4 space-y-0 mb-4",children:[e.jsx(qe,{children:"Create New Invoice"}),e.jsx(Ct,{children:"Fill out the details for the new invoice."})]}),e.jsx(Je,{className:"h-[calc(100vh-120px)]",children:e.jsx(na,{setOpen:l})})]})})]})}var Rr="ToastProvider",[kr,dh,uh]=bc("Toast"),[_i]=$s("Toast",[uh]),[mh,La]=_i(Rr),Si=t=>{const{__scopeToast:s,label:a="Notification",duration:r=5e3,swipeDirection:n="right",swipeThreshold:i=50,children:o}=t,[l,c]=d.useState(null),[u,h]=d.useState(0),p=d.useRef(!1),g=d.useRef(!1);return a.trim()||console.error(`Invalid prop \`label\` supplied to \`${Rr}\`. Expected non-empty \`string\`.`),e.jsx(kr.Provider,{scope:s,children:e.jsx(mh,{scope:s,label:a,duration:r,swipeDirection:n,swipeThreshold:i,toastCount:u,viewport:l,onViewportChange:c,onToastAdd:d.useCallback(()=>h(N=>N+1),[]),onToastRemove:d.useCallback(()=>h(N=>N-1),[]),isFocusedToastEscapeKeyDownRef:p,isClosePausedRef:g,children:o})})};Si.displayName=Rr;var Ti="ToastViewport",xh=["F8"],Ya="toast.viewportPause",Xa="toast.viewportResume",Ei=d.forwardRef((t,s)=>{const{__scopeToast:a,hotkey:r=xh,label:n="Notifications ({hotkey})",...i}=t,o=La(Ti,a),l=dh(a),c=d.useRef(null),u=d.useRef(null),h=d.useRef(null),p=d.useRef(null),g=St(s,p,o.onViewportChange),N=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),_=o.toastCount>0;d.useEffect(()=>{const R=S=>{r.length!==0&&r.every(b=>S[b]||S.code===b)&&p.current?.focus()};return document.addEventListener("keydown",R),()=>document.removeEventListener("keydown",R)},[r]),d.useEffect(()=>{const R=c.current,S=p.current;if(_&&R&&S){const E=()=>{if(!o.isClosePausedRef.current){const L=new CustomEvent(Ya);S.dispatchEvent(L),o.isClosePausedRef.current=!0}},b=()=>{if(o.isClosePausedRef.current){const L=new CustomEvent(Xa);S.dispatchEvent(L),o.isClosePausedRef.current=!1}},O=L=>{!R.contains(L.relatedTarget)&&b()},F=()=>{R.contains(document.activeElement)||b()};return R.addEventListener("focusin",E),R.addEventListener("focusout",O),R.addEventListener("pointermove",E),R.addEventListener("pointerleave",F),window.addEventListener("blur",E),window.addEventListener("focus",b),()=>{R.removeEventListener("focusin",E),R.removeEventListener("focusout",O),R.removeEventListener("pointermove",E),R.removeEventListener("pointerleave",F),window.removeEventListener("blur",E),window.removeEventListener("focus",b)}}},[_,o.isClosePausedRef]);const m=d.useCallback(({tabbingDirection:R})=>{const E=l().map(b=>{const O=b.ref.current,F=[O,...Sh(O)];return R==="forwards"?F:F.reverse()});return(R==="forwards"?E.reverse():E).flat()},[l]);return d.useEffect(()=>{const R=p.current;if(R){const S=E=>{const b=E.altKey||E.ctrlKey||E.metaKey;if(E.key==="Tab"&&!b){const F=document.activeElement,L=E.shiftKey;if(E.target===R&&L){u.current?.focus();return}const G=m({tabbingDirection:L?"backwards":"forwards"}),Z=G.findIndex(oe=>oe===F);Ua(G.slice(Z+1))?E.preventDefault():L?u.current?.focus():h.current?.focus()}};return R.addEventListener("keydown",S),()=>R.removeEventListener("keydown",S)}},[l,m]),e.jsxs(El,{ref:c,role:"region","aria-label":n.replace("{hotkey}",N),tabIndex:-1,style:{pointerEvents:_?void 0:"none"},children:[_&&e.jsx(Za,{ref:u,onFocusFromOutsideViewport:()=>{const R=m({tabbingDirection:"forwards"});Ua(R)}}),e.jsx(kr.Slot,{scope:a,children:e.jsx(Fe.ol,{tabIndex:-1,...i,ref:g})}),_&&e.jsx(Za,{ref:h,onFocusFromOutsideViewport:()=>{const R=m({tabbingDirection:"backwards"});Ua(R)}})]})});Ei.displayName=Ti;var Ii="ToastFocusProxy",Za=d.forwardRef((t,s)=>{const{__scopeToast:a,onFocusFromOutsideViewport:r,...n}=t,i=La(Ii,a);return e.jsx(co,{tabIndex:0,...n,ref:s,style:{position:"fixed"},onFocus:o=>{const l=o.relatedTarget;!i.viewport?.contains(l)&&r()}})});Za.displayName=Ii;var Hs="Toast",hh="toast.swipeStart",ph="toast.swipeMove",fh="toast.swipeCancel",gh="toast.swipeEnd",Pi=d.forwardRef((t,s)=>{const{forceMount:a,open:r,defaultOpen:n,onOpenChange:i,...o}=t,[l,c]=ar({prop:r,defaultProp:n??!0,onChange:i,caller:Hs});return e.jsx(ds,{present:a||l,children:e.jsx(vh,{open:l,...o,ref:s,onClose:()=>c(!1),onPause:Nt(t.onPause),onResume:Nt(t.onResume),onSwipeStart:we(t.onSwipeStart,u=>{u.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:we(t.onSwipeMove,u=>{const{x:h,y:p}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","move"),u.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${h}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${p}px`)}),onSwipeCancel:we(t.onSwipeCancel,u=>{u.currentTarget.setAttribute("data-swipe","cancel"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:we(t.onSwipeEnd,u=>{const{x:h,y:p}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","end"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${h}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${p}px`),c(!1)})})})});Pi.displayName=Hs;var[jh,yh]=_i(Hs,{onClose(){}}),vh=d.forwardRef((t,s)=>{const{__scopeToast:a,type:r="foreground",duration:n,open:i,onClose:o,onEscapeKeyDown:l,onPause:c,onResume:u,onSwipeStart:h,onSwipeMove:p,onSwipeCancel:g,onSwipeEnd:N,..._}=t,m=La(Hs,a),[R,S]=d.useState(null),E=St(s,x=>S(x)),b=d.useRef(null),O=d.useRef(null),F=n||m.duration,L=d.useRef(0),H=d.useRef(F),ne=d.useRef(0),{onToastAdd:G,onToastRemove:Z}=m,oe=Nt(()=>{R?.contains(document.activeElement)&&m.viewport?.focus(),o()}),v=d.useCallback(x=>{!x||x===1/0||(window.clearTimeout(ne.current),L.current=new Date().getTime(),ne.current=window.setTimeout(oe,x))},[oe]);d.useEffect(()=>{const x=m.viewport;if(x){const y=()=>{v(H.current),u?.()},f=()=>{const M=new Date().getTime()-L.current;H.current=H.current-M,window.clearTimeout(ne.current),c?.()};return x.addEventListener(Ya,f),x.addEventListener(Xa,y),()=>{x.removeEventListener(Ya,f),x.removeEventListener(Xa,y)}}},[m.viewport,F,c,u,v]),d.useEffect(()=>{i&&!m.isClosePausedRef.current&&v(F)},[i,F,m.isClosePausedRef,v]),d.useEffect(()=>(G(),()=>Z()),[G,Z]);const $=d.useMemo(()=>R?Li(R):null,[R]);return m.viewport?e.jsxs(e.Fragment,{children:[$&&e.jsx(bh,{__scopeToast:a,role:"status","aria-live":r==="foreground"?"assertive":"polite",children:$}),e.jsx(jh,{scope:a,onClose:oe,children:Cc.createPortal(e.jsx(kr.ItemSlot,{scope:a,children:e.jsx(Il,{asChild:!0,onEscapeKeyDown:we(l,()=>{m.isFocusedToastEscapeKeyDownRef.current||oe(),m.isFocusedToastEscapeKeyDownRef.current=!1}),children:e.jsx(Fe.li,{tabIndex:0,"data-state":i?"open":"closed","data-swipe-direction":m.swipeDirection,..._,ref:E,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:we(t.onKeyDown,x=>{x.key==="Escape"&&(l?.(x.nativeEvent),x.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,oe()))}),onPointerDown:we(t.onPointerDown,x=>{x.button===0&&(b.current={x:x.clientX,y:x.clientY})}),onPointerMove:we(t.onPointerMove,x=>{if(!b.current)return;const y=x.clientX-b.current.x,f=x.clientY-b.current.y,M=!!O.current,C=["left","right"].includes(m.swipeDirection),W=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,ge=C?W(0,y):0,je=C?0:W(0,f),Qe=x.pointerType==="touch"?10:2,B={x:ge,y:je},Se={originalEvent:x,delta:B};M?(O.current=B,Ks(ph,p,Se,{discrete:!1})):on(B,m.swipeDirection,Qe)?(O.current=B,Ks(hh,h,Se,{discrete:!1}),x.target.setPointerCapture(x.pointerId)):(Math.abs(y)>Qe||Math.abs(f)>Qe)&&(b.current=null)}),onPointerUp:we(t.onPointerUp,x=>{const y=O.current,f=x.target;if(f.hasPointerCapture(x.pointerId)&&f.releasePointerCapture(x.pointerId),O.current=null,b.current=null,y){const M=x.currentTarget,C={originalEvent:x,delta:y};on(y,m.swipeDirection,m.swipeThreshold)?Ks(gh,N,C,{discrete:!0}):Ks(fh,g,C,{discrete:!0}),M.addEventListener("click",W=>W.preventDefault(),{once:!0})}})})})}),m.viewport)})]}):null}),bh=t=>{const{__scopeToast:s,children:a,...r}=t,n=La(Hs,s),[i,o]=d.useState(!1),[l,c]=d.useState(!1);return Ch(()=>o(!0)),d.useEffect(()=>{const u=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(u)},[]),l?null:e.jsx(Pl,{asChild:!0,children:e.jsx(co,{...r,children:i&&e.jsxs(e.Fragment,{children:[n.label," ",a]})})})},Nh="ToastTitle",Di=d.forwardRef((t,s)=>{const{__scopeToast:a,...r}=t;return e.jsx(Fe.div,{...r,ref:s})});Di.displayName=Nh;var wh="ToastDescription",Ri=d.forwardRef((t,s)=>{const{__scopeToast:a,...r}=t;return e.jsx(Fe.div,{...r,ref:s})});Ri.displayName=wh;var ki="ToastAction",qi=d.forwardRef((t,s)=>{const{altText:a,...r}=t;return a.trim()?e.jsx(Fi,{altText:a,asChild:!0,children:e.jsx(qr,{...r,ref:s})}):(console.error(`Invalid prop \`altText\` supplied to \`${ki}\`. Expected non-empty \`string\`.`),null)});qi.displayName=ki;var Ai="ToastClose",qr=d.forwardRef((t,s)=>{const{__scopeToast:a,...r}=t,n=yh(Ai,a);return e.jsx(Fi,{asChild:!0,children:e.jsx(Fe.button,{type:"button",...r,ref:s,onClick:we(t.onClick,n.onClose)})})});qr.displayName=Ai;var Fi=d.forwardRef((t,s)=>{const{__scopeToast:a,altText:r,...n}=t;return e.jsx(Fe.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...n,ref:s})});function Li(t){const s=[];return Array.from(t.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&s.push(r.textContent),_h(r)){const n=r.ariaHidden||r.hidden||r.style.display==="none",i=r.dataset.radixToastAnnounceExclude==="";if(!n)if(i){const o=r.dataset.radixToastAnnounceAlt;o&&s.push(o)}else s.push(...Li(r))}}),s}function Ks(t,s,a,{discrete:r}){const n=a.originalEvent.currentTarget,i=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:a});s&&n.addEventListener(t,s,{once:!0}),r?Dl(n,i):n.dispatchEvent(i)}var on=(t,s,a=0)=>{const r=Math.abs(t.x),n=Math.abs(t.y),i=r>n;return s==="left"||s==="right"?i&&r>a:!i&&n>a};function Ch(t=()=>{}){const s=Nt(t);Ts(()=>{let a=0,r=0;return a=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(s)),()=>{window.cancelAnimationFrame(a),window.cancelAnimationFrame(r)}},[s])}function _h(t){return t.nodeType===t.ELEMENT_NODE}function Sh(t){const s=[],a=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const n=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||n?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;a.nextNode();)s.push(a.currentNode);return s}function Ua(t){const s=document.activeElement;return t.some(a=>a===s?!0:(a.focus(),document.activeElement!==s))}var Th=Si,Oi=Ei,$i=Pi,Mi=Di,zi=Ri,Ui=qi,Qi=qr;const Eh=Th,Bi=d.forwardRef(({className:t,...s},a)=>e.jsx(Oi,{ref:a,className:A("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",t),...s}));Bi.displayName=Oi.displayName;const Ih=Os("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground",success:"border bg-green-500 text-muted-forground"}},defaultVariants:{variant:"default"}}),Vi=d.forwardRef(({className:t,variant:s,...a},r)=>e.jsx($i,{ref:r,className:A(Ih({variant:s}),t),...a}));Vi.displayName=$i.displayName;const Ph=d.forwardRef(({className:t,...s},a)=>e.jsx(Ui,{ref:a,className:A("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",t),...s}));Ph.displayName=Ui.displayName;const Hi=d.forwardRef(({className:t,...s},a)=>e.jsx(Qi,{ref:a,className:A("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",t),"toast-close":"",...s,children:e.jsx(Ms,{className:"h-4 w-4"})}));Hi.displayName=Qi.displayName;const Ki=d.forwardRef(({className:t,...s},a)=>e.jsx(Mi,{ref:a,className:A("text-sm font-semibold",t),...s}));Ki.displayName=Mi.displayName;const Wi=d.forwardRef(({className:t,...s},a)=>e.jsx(zi,{ref:a,className:A("text-sm opacity-90",t),...s}));Wi.displayName=zi.displayName;function Dh(){const{toasts:t}=ss();return e.jsxs(Eh,{children:[t.map(function({id:s,title:a,description:r,action:n,...i}){return e.jsxs(Vi,{...i,children:[e.jsxs("div",{className:"grid gap-1",children:[a&&e.jsx(Ki,{children:a}),r&&e.jsx(Wi,{children:r})]}),n,e.jsx(Hi,{})]},s)}),e.jsx(Bi,{})]})}const Rh=({children:t})=>{const s=ts(),[a,r]=le.useState({avatar_url:"",email:"",email_verified:!1,full_name:"",iss:"",name:"",picture:"",provider_id:"",sub:""}),n=le.useCallback(async()=>{s.user&&r(s.user.user_metadata)},[s.user]);return le.useEffect(()=>{n()},[n]),e.jsxs(e.Fragment,{children:[e.jsx("header",{children:e.jsx(ch,{userData:a})}),e.jsxs("div",{className:"flex justify-center lg:ml-[5rem] py-2 px-3 sm:px-6",children:[e.jsx("div",{className:"flex w-full mt-[66px] lg:mt-[0rem] justify-center max-w-screen-3xl",children:t}),e.jsx(Dh,{})]})]})};var kh=Rh;const qh=({children:t})=>ts()?.user?e.jsx(e.Fragment,{children:t}):e.jsx(pn,{to:"/login"});var Xe=qh;class Ah{accessToken=null;async initialize(){try{const{data:{session:s},error:a}=await w.auth.getSession();if(a||!s)return console.error("No active session found:",a),!1;const r=s.provider_token;return r?(this.accessToken=r,!0):(console.error("No Google access token found in session"),!1)}catch(s){return console.error("Failed to initialize Google service:",s),!1}}async refreshTokenIfNeeded(){return this.accessToken?!0:await this.initialize()}async makeGoogleApiRequest(s,a={}){if(await this.refreshTokenIfNeeded(),!this.accessToken)throw new Error("No access token available");const r=await fetch(s,{...a,headers:{Authorization:`Bearer ${this.accessToken}`,"Content-Type":"application/json",...a.headers}});if(!r.ok){const n=await r.text();throw new Error(`Google API request failed: ${r.status} - ${n}`)}return r}async sendEmail(s){try{const a=this.createEmailContent(s);return{success:!0,messageId:(await(await this.makeGoogleApiRequest("https://gmail.googleapis.com/gmail/v1/users/me/messages/send",{method:"POST",body:JSON.stringify({raw:nl.from(a,"utf-8").toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")})})).json()).id}}catch(a){return console.error("Failed to send email:",a),{success:!1,error:a instanceof Error?a.message:"Unknown error"}}}async getMessages(s,a=10){try{const r=new URLSearchParams({maxResults:a.toString(),...s&&{q:s}}),i=await(await this.makeGoogleApiRequest(`https://gmail.googleapis.com/gmail/v1/users/me/messages?${r}`)).json();return i.messages?await Promise.all(i.messages.map(async l=>await(await this.makeGoogleApiRequest(`https://gmail.googleapis.com/gmail/v1/users/me/messages/${l.id}`)).json())):[]}catch(r){return console.error("Failed to get messages:",r),[]}}async getLabels(){try{return(await(await this.makeGoogleApiRequest("https://gmail.googleapis.com/gmail/v1/users/me/labels")).json()).labels||[]}catch(s){return console.error("Failed to get labels:",s),[]}}async getUserProfile(){try{return await(await this.makeGoogleApiRequest("https://gmail.googleapis.com/gmail/v1/users/me/profile")).json()}catch(s){return console.error("Failed to get user profile:",s),{}}}async getDriveFiles(s,a=10){try{const r=new URLSearchParams({pageSize:a.toString(),fields:"files(id,name,mimeType,createdTime,modifiedTime)",...s&&{q:s}});return(await(await this.makeGoogleApiRequest(`https://www.googleapis.com/drive/v3/files?${r}`)).json()).files||[]}catch(r){return console.error("Failed to get Drive files:",r),[]}}async uploadFileToDrive(s,a,r,n){try{const i={name:s,...n&&{parents:[n]}},o=new FormData;return o.append("metadata",new Blob([JSON.stringify(i)],{type:"application/json"})),o.append("file",new Blob([a],{type:r})),{success:!0,fileId:(await(await this.makeGoogleApiRequest("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",{method:"POST",body:o,headers:{Authorization:`Bearer ${this.accessToken}`}})).json()).id}}catch(i){return console.error("Failed to upload file to Drive:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error"}}}async getCalendars(){try{return(await(await this.makeGoogleApiRequest("https://www.googleapis.com/calendar/v3/users/me/calendarList")).json()).items||[]}catch(s){return console.error("Failed to get calendars:",s),[]}}async createCalendarEvent(s,a){try{return{success:!0,eventId:(await(await this.makeGoogleApiRequest(`https://www.googleapis.com/calendar/v3/calendars/${s}/events`,{method:"POST",body:JSON.stringify(a)})).json()).id}}catch(r){return console.error("Failed to create calendar event:",r),{success:!1,error:r instanceof Error?r.message:"Unknown error"}}}createEmailContent(s){const a="===============boundary===============";let r="";return r+=`To: ${s.to.join(", ")}\r
`,s.cc&&s.cc.length>0&&(r+=`Cc: ${s.cc.join(", ")}\r
`),s.bcc&&s.bcc.length>0&&(r+=`Bcc: ${s.bcc.join(", ")}\r
`),r+=`Subject: ${s.subject}\r
`,r+=`MIME-Version: 1.0\r
`,s.attachments&&s.attachments.length>0?(r+=`Content-Type: multipart/mixed; boundary="${a}"\r
\r
`,r+=`--${a}\r
`,r+=`Content-Type: text/html; charset="UTF-8"\r
`,r+=`Content-Transfer-Encoding: 7bit\r
\r
`,r+=`${s.htmlBody||s.textBody||""}\r
`,s.attachments.forEach(n=>{r+=`--${a}\r
`,r+=`Content-Type: ${n.mimeType}; name="${n.filename}"\r
`,r+=`Content-Disposition: attachment; filename="${n.filename}"\r
`,r+=`Content-Transfer-Encoding: base64\r
\r
`,r+=`${n.content}\r
`}),r+=`--${a}--\r
`):s.htmlBody?(r+=`Content-Type: text/html; charset="UTF-8"\r
\r
`,r+=s.htmlBody):(r+=`Content-Type: text/plain; charset="UTF-8"\r
\r
`,r+=s.textBody||""),r}async checkGmailPermissions(){try{return await this.getUserProfile(),!0}catch(s){return console.error("Gmail permissions not available:",s),!1}}}const Pt=new Ah,Gi=()=>{const{user:t,session:s}=ts(),[a,r]=d.useState(!1),[n,i]=d.useState(!1),[o,l]=d.useState(null);d.useEffect(()=>{(async()=>{if(!t||!s){r(!1);return}i(!0),l(null);try{const O=await Pt.initialize();r(O),O||l("Failed to initialize Google service. Please ensure you have the required permissions.")}catch(O){l(O instanceof Error?O.message:"Unknown error occurred"),r(!1)}finally{i(!1)}})()},[t,s]);const c=d.useCallback(async function(b,O="Service call failed"){if(!a)return l("Google service not initialized"),null;l(null);try{return await b()}catch(F){const L=F instanceof Error?F.message:O;return l(L),console.error(O,F),null}},[a]),u=d.useCallback(async b=>await c(()=>Pt.sendEmail(b),"Failed to send email")||{success:!1,error:"Service not available"},[c]),h=d.useCallback(async(b,O)=>await c(()=>Pt.getMessages(b,O),"Failed to get messages")||[],[c]),p=d.useCallback(async()=>await c(()=>Pt.getLabels(),"Failed to get labels")||[],[c]),g=d.useCallback(async()=>await c(()=>Pt.getUserProfile(),"Failed to get user profile")||{},[c]),N=d.useCallback(async(b,O)=>await c(()=>Pt.getDriveFiles(b,O),"Failed to get Drive files")||[],[c]),_=d.useCallback(async(b,O,F,L)=>await c(()=>Pt.uploadFileToDrive(b,O,F,L),"Failed to upload file to Drive")||{success:!1,error:"Service not available"},[c]),m=d.useCallback(async()=>await c(()=>Pt.getCalendars(),"Failed to get calendars")||[],[c]),R=d.useCallback(async(b,O)=>await c(()=>Pt.createCalendarEvent(b,O),"Failed to create calendar event")||{success:!1,error:"Service not available"},[c]),S=d.useCallback(async()=>await c(()=>Pt.checkGmailPermissions(),"Failed to check Gmail permissions")||!1,[c]),E=d.useCallback(async()=>{i(!0),l(null);try{const b=await Pt.initialize();r(b),b||l("Failed to reinitialize Google service")}catch(b){l(b instanceof Error?b.message:"Reinitialization failed"),r(!1)}finally{i(!1)}},[]);return{isInitialized:a,isLoading:n,error:o,sendEmail:u,getMessages:h,getLabels:p,getUserProfile:g,getDriveFiles:N,uploadFileToDrive:_,getCalendars:m,createCalendarEvent:R,checkGmailPermissions:S,reinitialize:E}},Yi=t=>({...t,invoice_line_services:t.invoice_line_service?.map(s=>({...s,service:t.service}))||[],invoice_payment:t.invoice_payment?.map(s=>({id:s.id,date_received:s.date_received,payment_method:s.payment_method,amount:s.amount}))||[]}),Fh=t=>({...t,quote_line_item:t.quote_line_item?.map(s=>({...s,service:s.service||t.service}))||[]}),Me=es.create({headerContainer:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",marginBottom:15,paddingBottom:12,borderBottomWidth:1,borderBottomColor:"#e5e7eb"},logoSection:{flexDirection:"column",alignItems:"flex-start"},logo:{width:40,height:40,marginBottom:6,borderRadius:6},companyName:{fontSize:14,fontWeight:"bold",color:"#1f2937",marginBottom:2},companyTagline:{fontSize:8,color:"#6b7280",fontStyle:"italic"},invoiceSection:{flexDirection:"column",alignItems:"flex-end"},invoiceTitle:{fontSize:22,fontWeight:"bold",color:"#1f2937",marginBottom:14,letterSpacing:.5},invoiceDetails:{flexDirection:"column",alignItems:"flex-end"},detailRow:{flexDirection:"row",marginBottom:2,alignItems:"center"},detailLabel:{fontSize:8,color:"#6b7280",marginRight:6,width:50,textAlign:"right"},detailValue:{fontSize:8,color:"#1f2937",fontWeight:"medium",width:70},statusBadge:{marginTop:4,paddingHorizontal:8,paddingVertical:2,borderRadius:8,backgroundColor:"#fbbf24",alignItems:"center",justifyContent:"center"},statusBadgePaid:{backgroundColor:"#10b981"},statusBadgeOverdue:{backgroundColor:"#ef4444"},statusText:{fontSize:7,color:"#ffffff",fontWeight:"bold",textTransform:"uppercase",letterSpacing:.3}}),Lh=({invoice:t})=>e.jsxs(K,{style:Me.headerContainer,children:[e.jsxs(K,{style:Me.logoSection,children:[e.jsx(cn,{style:Me.logo,src:"/public/company-logo.png"}),e.jsx(T,{style:Me.companyName,children:"RIOS ROOFING"}),e.jsx(T,{style:Me.companyTagline,children:"Professional Roofing Services"})]}),e.jsxs(K,{style:Me.invoiceSection,children:[e.jsx(T,{style:Me.invoiceTitle,children:"INVOICE"}),e.jsxs(K,{style:Me.invoiceDetails,children:[e.jsxs(K,{style:Me.detailRow,children:[e.jsx(T,{style:Me.detailLabel,children:"Invoice #:"}),e.jsx(T,{style:Me.detailValue,children:t.invoice_number})]}),e.jsxs(K,{style:Me.detailRow,children:[e.jsx(T,{style:Me.detailLabel,children:"Date:"}),e.jsx(T,{style:Me.detailValue,children:os(t.invoice_date)})]}),e.jsxs(K,{style:Me.detailRow,children:[e.jsx(T,{style:Me.detailLabel,children:"Due Date:"}),e.jsx(T,{style:Me.detailValue,children:os(t.due_date)})]})]})]})]}),Oe=es.create({container:{flexDirection:"row",justifyContent:"space-between",marginBottom:15},section:{width:"48%"},sectionTitle:{fontSize:9,fontWeight:"bold",color:"#374151",marginBottom:4,textTransform:"uppercase",letterSpacing:.3},infoBox:{backgroundColor:"#f9fafb",padding:8,borderRadius:4,borderLeftWidth:2,borderLeftColor:"#3b82f6"},companyName:{fontSize:10,fontWeight:"bold",color:"#1f2937",marginBottom:2},addressLine:{fontSize:8,color:"#4b5563",marginBottom:1},contactLine:{fontSize:8,color:"#4b5563",marginBottom:1},customerName:{fontSize:10,fontWeight:"bold",color:"#1f2937",marginBottom:2},billingNote:{fontSize:7,color:"#6b7280",fontStyle:"italic",marginTop:4}}),Oh=({invoice:t})=>{const s=n=>n.company_name?n.company_name:`${n.first_name} ${n.last_name}`,r={street:t.bill_to_street_address||t.customer.street_address,city:t.bill_to_city||t.customer.city,state:t.bill_to_state||t.customer.state,zipcode:t.bill_to_zipcode||t.customer.zipcode};return e.jsxs(K,{style:Oe.container,children:[e.jsxs(K,{style:Oe.section,children:[e.jsx(T,{style:Oe.sectionTitle,children:"From"}),e.jsxs(K,{style:Oe.infoBox,children:[e.jsx(T,{style:Oe.companyName,children:"RIOS ROOFING"}),e.jsx(T,{style:Oe.addressLine,children:t.bill_from_street_address||"150 Tallant St"}),e.jsxs(T,{style:Oe.addressLine,children:[t.bill_from_city||"Houston",", ",t.bill_from_state||"TX"," ",t.bill_from_zipcode||"77076"]}),t.bill_from_email&&e.jsxs(T,{style:Oe.contactLine,children:["Email: ",t.bill_from_email]}),e.jsx(T,{style:Oe.contactLine,children:"Phone: 832-310-3593"}),e.jsx(T,{style:Oe.contactLine,children:"Email: rrios.roofing@gmail.com"})]})]}),e.jsxs(K,{style:Oe.section,children:[e.jsx(T,{style:Oe.sectionTitle,children:"Bill To"}),e.jsxs(K,{style:Oe.infoBox,children:[e.jsx(T,{style:Oe.customerName,children:s(t.customer)}),e.jsx(T,{style:Oe.addressLine,children:r.street}),e.jsxs(T,{style:Oe.addressLine,children:[r.city,", ",r.state," ",r.zipcode]}),e.jsxs(T,{style:Oe.contactLine,children:["Phone: ",t.customer.phone_number]}),e.jsxs(T,{style:Oe.contactLine,children:["Email: ",t.customer.email]})]})]})]})},be=es.create({container:{marginBottom:15},sectionTitle:{fontSize:9,fontWeight:"bold",color:"#374151",marginBottom:6,textTransform:"uppercase",letterSpacing:.3},table:{borderWidth:1,borderColor:"#e5e7eb",borderRadius:4},tableHeader:{flexDirection:"row",backgroundColor:"#f3f4f6",borderBottomWidth:1,borderBottomColor:"#e5e7eb",paddingVertical:6,paddingHorizontal:8},tableHeaderCell:{fontSize:7,fontWeight:"bold",color:"#374151",textTransform:"uppercase",letterSpacing:.3},descriptionHeader:{flex:3},quantityHeader:{flex:1,textAlign:"center"},rateHeader:{flex:1.2,textAlign:"right"},amountHeader:{flex:1.2,textAlign:"right"},tableRow:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#f3f4f6",paddingVertical:6,paddingHorizontal:8,minHeight:24},lastRow:{borderBottomWidth:0},tableCell:{fontSize:8,color:"#1f2937"},descriptionCell:{flex:3},quantityCell:{flex:1,textAlign:"center"},rateCell:{flex:1.2,textAlign:"right"},amountCell:{flex:1.2,textAlign:"right"},itemDescription:{fontSize:8,color:"#1f2937",fontWeight:"medium",marginBottom:1},itemDetails:{fontSize:7,color:"#6b7280"},emptyState:{padding:20,textAlign:"center",color:"#6b7280",fontSize:8,fontStyle:"italic"}}),$h=({invoice:t})=>{const s=n=>n==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n),a=n=>n==null?"0":n.toString(),r=(n,i)=>!n||!i?0:n*i;return!t.invoice_line_services||t.invoice_line_services.length===0?e.jsxs(K,{style:be.container,children:[e.jsx(T,{style:be.sectionTitle,children:"Invoice Items"}),e.jsx(K,{style:be.table,children:e.jsx(T,{style:be.emptyState,children:"No items found for this invoice"})})]}):e.jsxs(K,{style:be.container,children:[e.jsx(T,{style:be.sectionTitle,children:"Invoice Items"}),e.jsxs(K,{style:be.table,children:[e.jsxs(K,{style:be.tableHeader,children:[e.jsx(T,{style:[be.tableHeaderCell,be.descriptionHeader],children:"Description"}),e.jsx(T,{style:[be.tableHeaderCell,be.quantityHeader],children:"Qty"}),e.jsx(T,{style:[be.tableHeaderCell,be.rateHeader],children:"Rate"}),e.jsx(T,{style:[be.tableHeaderCell,be.amountHeader],children:"Amount"})]}),t.invoice_line_services.map((n,i)=>{const o=i===(t.invoice_line_services?.length??0)-1;return r(n.qty,n.rate),e.jsxs(K,{style:[be.tableRow,...o?[be.lastRow]:[]],children:[e.jsx(K,{style:be.descriptionCell,children:e.jsx(T,{style:be.itemDescription,children:n.description||"No description provided"})}),e.jsx(T,{style:[be.tableCell,be.quantityCell],children:a(n.qty)}),e.jsx(T,{style:[be.tableCell,be.rateCell],children:n.fixed_item?"Fixed":s(n.rate)}),e.jsx(T,{style:[be.tableCell,be.amountCell],children:s(n.amount)})]},`${n.id||i}`)})]})]})},Te=es.create({container:{marginBottom:10},sectionTitle:{fontSize:9,fontWeight:"bold",color:"#374151",marginBottom:6,textTransform:"uppercase",letterSpacing:.3},table:{borderWidth:1,borderColor:"#e5e7eb",borderRadius:4},tableHeader:{flexDirection:"row",backgroundColor:"#f3f4f6",borderBottomWidth:1,borderBottomColor:"#e5e7eb",paddingVertical:4,paddingHorizontal:8},tableHeaderCell:{fontSize:7,fontWeight:"bold",color:"#374151",textTransform:"uppercase",letterSpacing:.3},dateHeader:{flex:2},methodHeader:{flex:2},amountHeader:{flex:1,textAlign:"right"},tableRow:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#f3f4f6",paddingVertical:8,paddingHorizontal:12},lastRow:{borderBottomWidth:0},tableCell:{fontSize:10,color:"#1f2937"},dateCell:{flex:2},methodCell:{flex:2},amountCell:{flex:1,textAlign:"right"},noPayments:{padding:16,textAlign:"center",color:"#6b7280",fontSize:9,fontStyle:"italic"},totalRow:{flexDirection:"row",backgroundColor:"#fef3c7",paddingVertical:10,paddingHorizontal:12,borderTopWidth:2,borderTopColor:"#f59e0b"},totalLabel:{flex:4,fontSize:10,fontWeight:"bold",color:"#92400e",textAlign:"right",paddingRight:12},totalAmount:{flex:1,fontSize:10,fontWeight:"bold",color:"#92400e",textAlign:"right"}}),Mh=({invoice:t})=>{const s=o=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o),a=o=>new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),r=o=>o.split("_").map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "),i=!t.invoice_payment||t.invoice_payment.length===0?0:t.invoice_payment.reduce((o,l)=>o+l.amount,0);return!t.invoice_payment||t.invoice_payment.length===0?null:e.jsxs(K,{style:Te.container,children:[e.jsx(T,{style:Te.sectionTitle,children:"Payments Received"}),e.jsxs(K,{style:Te.table,children:[e.jsxs(K,{style:Te.tableHeader,children:[e.jsx(T,{style:[Te.tableHeaderCell,Te.dateHeader],children:"Date"}),e.jsx(T,{style:[Te.tableHeaderCell,Te.methodHeader],children:"Method"}),e.jsx(T,{style:[Te.tableHeaderCell,Te.amountHeader],children:"Amount"})]}),t.invoice_payment.map((o,l)=>{const c=l===t.invoice_payment.length-1;return e.jsxs(K,{style:[Te.tableRow,...c?[Te.lastRow]:[]],children:[e.jsx(T,{style:[Te.tableCell,Te.dateCell],children:a(o.date_received)}),e.jsx(T,{style:[Te.tableCell,Te.methodCell],children:r(o.payment_method)}),e.jsx(T,{style:[Te.tableCell,Te.amountCell],children:s(o.amount)})]},o.id)}),i>0&&e.jsxs(K,{style:Te.totalRow,children:[e.jsx(T,{style:Te.totalLabel,children:"Total Payments:"}),e.jsx(T,{style:Te.totalAmount,children:s(i)})]})]})]})},ze=es.create({container:{flexDirection:"row",justifyContent:"flex-end",marginBottom:15},summaryBox:{width:"45%",backgroundColor:"#f9fafb",borderRadius:4,borderWidth:1,borderColor:"#e5e7eb",overflow:"hidden"},summaryRow:{flexDirection:"row",justifyContent:"space-between",paddingVertical:4,paddingHorizontal:10,borderBottomWidth:1,borderBottomColor:"#f3f4f6"},subtotalRow:{backgroundColor:"transparent"},taxRow:{backgroundColor:"transparent"},totalRow:{backgroundColor:"#dbeafe",borderBottomWidth:0,borderTopWidth:2,borderTopColor:"#3b82f6"},amountDueRow:{backgroundColor:"#f3e8ff",borderBottomWidth:0,borderTopWidth:2,borderTopColor:"#8b5cf6"},label:{fontSize:8,color:"#374151"},value:{fontSize:8,color:"#1f2937",fontWeight:"medium"},totalLabel:{fontSize:9,color:"#1e40af",fontWeight:"bold"},totalValue:{fontSize:9,color:"#1e40af",fontWeight:"bold"},amountDueLabel:{fontSize:10,color:"#7c3aed",fontWeight:"bold"},amountDueValue:{fontSize:10,color:"#7c3aed",fontWeight:"bold"},paidLabel:{fontSize:8,color:"#059669"},paidValue:{fontSize:8,color:"#059669",fontWeight:"medium"}}),zh=({invoice:t})=>{const s=c=>c==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(c),a=()=>!t.invoice_line_services||t.invoice_line_services.length===0?t.subtotal||0:t.invoice_line_services.reduce((c,u)=>c+(u.amount||0),0),r=()=>!t.invoice_payment||t.invoice_payment.length===0?0:t.invoice_payment.reduce((c,u)=>c+u.amount,0),n=a(),i=t.total||n,o=r(),l=t.amount_due||i-o;return e.jsx(K,{style:ze.container,children:e.jsxs(K,{style:ze.summaryBox,children:[e.jsxs(K,{style:[ze.summaryRow,ze.subtotalRow],children:[e.jsx(T,{style:ze.label,children:"Subtotal:"}),e.jsx(T,{style:ze.value,children:s(n)})]}),e.jsxs(K,{style:[ze.summaryRow,ze.totalRow],children:[e.jsx(T,{style:ze.totalLabel,children:"Total:"}),e.jsx(T,{style:ze.totalValue,children:s(i)})]}),o>0&&e.jsxs(K,{style:[ze.summaryRow],children:[e.jsx(T,{style:ze.paidLabel,children:"Payments:"}),e.jsxs(T,{style:ze.paidValue,children:["-",s(o)]})]}),e.jsxs(K,{style:[ze.summaryRow,ze.amountDueRow],children:[e.jsx(T,{style:ze.amountDueLabel,children:l<=0?"Paid in Full":"Amount Due:"}),e.jsx(T,{style:ze.amountDueValue,children:l<=0?"$0.00":s(l)})]})]})})},Ie=es.create({container:{marginTop:"auto",paddingTop:10,borderTopWidth:1,borderTopColor:"#e5e7eb"},notesSection:{marginBottom:10},notesTitle:{fontSize:8,fontWeight:"bold",color:"#374151",marginBottom:3},notesText:{fontSize:7,color:"#4b5563",lineHeight:1.2},footerContent:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-end"},companyInfo:{flex:1},companyName:{fontSize:8,fontWeight:"bold",color:"#1f2937",marginBottom:1},companyAddress:{fontSize:6,color:"#6b7280",marginBottom:.5},companyContact:{fontSize:6,color:"#6b7280"},thankYou:{flex:1,textAlign:"center"},thankYouText:{fontSize:8,color:"#3b82f6",fontWeight:"medium",marginBottom:1},tagline:{fontSize:6,color:"#6b7280",fontStyle:"italic"},paymentInfo:{flex:1,textAlign:"right"},paymentTitle:{fontSize:7,fontWeight:"bold",color:"#374151",marginBottom:2},paymentText:{fontSize:6,color:"#4b5563",marginBottom:.5}}),Uh=({invoice:t,displayOptions:s={showPaymentHistory:!0,showCustomerNotes:!0,showPaymentInformation:!0}})=>e.jsxs(K,{style:Ie.container,children:[s.showCustomerNotes&&(t.public_note||t.cust_note)&&e.jsxs(K,{style:Ie.notesSection,children:[e.jsx(T,{style:Ie.notesTitle,children:"Notes:"}),e.jsx(T,{style:Ie.notesText,children:t.public_note||t.cust_note})]}),e.jsxs(K,{style:Ie.footerContent,children:[e.jsxs(K,{style:Ie.companyInfo,children:[e.jsx(T,{style:Ie.companyName,children:"RIOS ROOFING"}),e.jsx(T,{style:Ie.companyAddress,children:t.bill_from_street_address||"150 Tallant St"}),e.jsxs(T,{style:Ie.companyAddress,children:[t.bill_from_city||"Houston",", ",t.bill_from_state||"TX"," ",t.bill_from_zipcode||"77076"]}),e.jsx(T,{style:Ie.companyContact,children:t.bill_from_email||"info@riosroofing.com"})]}),e.jsxs(K,{style:Ie.thankYou,children:[e.jsx(T,{style:Ie.thankYouText,children:"Thank you for your business!"}),e.jsx(T,{style:Ie.tagline,children:"Your trusted roofing partner"})]}),s.showPaymentInformation&&e.jsxs(K,{style:Ie.paymentInfo,children:[e.jsx(T,{style:Ie.paymentTitle,children:"Payment Information"}),e.jsx(T,{style:Ie.paymentText,children:"Payment is due within 30 days"}),e.jsxs(T,{style:Ie.paymentText,children:["Please reference Invoice #",t.invoice_number]}),e.jsx(T,{style:Ie.paymentText,children:"Questions? Contact us at:"}),e.jsx(T,{style:Ie.paymentText,children:t.bill_from_email||"info@riosroofing.com"})]})]})]}),Qh=es.create({page:{fontSize:9,paddingTop:25,paddingLeft:30,paddingRight:30,paddingBottom:25,backgroundColor:"#ffffff",fontFamily:"Helvetica",lineHeight:1.3}}),Ja=({invoice:t,displayOptions:s={showPaymentHistory:!0,showCustomerNotes:!0,showPaymentInformation:!0}})=>e.jsx(dn,{children:e.jsxs(un,{size:"A4",style:Qh.page,children:[e.jsx(Lh,{invoice:t}),e.jsx(Oh,{invoice:t}),e.jsx($h,{invoice:t}),s.showPaymentHistory&&e.jsx(Mh,{invoice:t}),e.jsx(zh,{invoice:t}),e.jsx(Uh,{invoice:t,displayOptions:s})]})});var Oa="Checkbox",[Bh]=$s(Oa),[Vh,Ar]=Bh(Oa);function Hh(t){const{__scopeCheckbox:s,checked:a,children:r,defaultChecked:n,disabled:i,form:o,name:l,onCheckedChange:c,required:u,value:h="on",internal_do_not_use_render:p}=t,[g,N]=ar({prop:a,defaultProp:n??!1,onChange:c,caller:Oa}),[_,m]=d.useState(null),[R,S]=d.useState(null),E=d.useRef(!1),b=_?!!o||!!_.closest("form"):!0,O={checked:g,disabled:i,setChecked:N,control:_,setControl:m,name:l,form:o,value:h,hasConsumerStoppedPropagationRef:E,required:u,defaultChecked:Zt(n)?!1:n,isFormControl:b,bubbleInput:R,setBubbleInput:S};return e.jsx(Vh,{scope:s,...O,children:Kh(p)?p(O):r})}var Xi="CheckboxTrigger",Zi=d.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:a,...r},n)=>{const{control:i,value:o,disabled:l,checked:c,required:u,setControl:h,setChecked:p,hasConsumerStoppedPropagationRef:g,isFormControl:N,bubbleInput:_}=Ar(Xi,t),m=St(n,h),R=d.useRef(c);return d.useEffect(()=>{const S=i?.form;if(S){const E=()=>p(R.current);return S.addEventListener("reset",E),()=>S.removeEventListener("reset",E)}},[i,p]),e.jsx(Fe.button,{type:"button",role:"checkbox","aria-checked":Zt(c)?"mixed":c,"aria-required":u,"data-state":al(c),"data-disabled":l?"":void 0,disabled:l,value:o,...r,ref:m,onKeyDown:we(s,S=>{S.key==="Enter"&&S.preventDefault()}),onClick:we(a,S=>{p(E=>Zt(E)?!0:!E),_&&N&&(g.current=S.isPropagationStopped(),g.current||S.stopPropagation())})})});Zi.displayName=Xi;var Fr=d.forwardRef((t,s)=>{const{__scopeCheckbox:a,name:r,checked:n,defaultChecked:i,required:o,disabled:l,value:c,onCheckedChange:u,form:h,...p}=t;return e.jsx(Hh,{__scopeCheckbox:a,checked:n,defaultChecked:i,disabled:l,required:o,onCheckedChange:u,name:r,form:h,value:c,internal_do_not_use_render:({isFormControl:g})=>e.jsxs(e.Fragment,{children:[e.jsx(Zi,{...p,ref:s,__scopeCheckbox:a}),g&&e.jsx(sl,{__scopeCheckbox:a})]})})});Fr.displayName=Oa;var Ji="CheckboxIndicator",el=d.forwardRef((t,s)=>{const{__scopeCheckbox:a,forceMount:r,...n}=t,i=Ar(Ji,a);return e.jsx(ds,{present:r||Zt(i.checked)||i.checked===!0,children:e.jsx(Fe.span,{"data-state":al(i.checked),"data-disabled":i.disabled?"":void 0,...n,ref:s,style:{pointerEvents:"none",...t.style}})})});el.displayName=Ji;var tl="CheckboxBubbleInput",sl=d.forwardRef(({__scopeCheckbox:t,...s},a)=>{const{control:r,hasConsumerStoppedPropagationRef:n,checked:i,defaultChecked:o,required:l,disabled:c,name:u,value:h,form:p,bubbleInput:g,setBubbleInput:N}=Ar(tl,t),_=St(a,N),m=Nc(i),R=Rl(r);d.useEffect(()=>{const E=g;if(!E)return;const b=window.HTMLInputElement.prototype,F=Object.getOwnPropertyDescriptor(b,"checked").set,L=!n.current;if(m!==i&&F){const H=new Event("click",{bubbles:L});E.indeterminate=Zt(i),F.call(E,Zt(i)?!1:i),E.dispatchEvent(H)}},[g,m,i,n]);const S=d.useRef(Zt(i)?!1:i);return e.jsx(Fe.input,{type:"checkbox","aria-hidden":!0,defaultChecked:o??S.current,required:l,disabled:c,name:u,value:h,form:p,...s,tabIndex:-1,ref:_,style:{...s.style,...R,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});sl.displayName=tl;function Kh(t){return typeof t=="function"}function Zt(t){return t==="indeterminate"}function al(t){return Zt(t)?"indeterminate":t?"checked":"unchecked"}const ut=d.forwardRef(({className:t,...s},a)=>e.jsx(Fr,{ref:a,className:A("grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...s,children:e.jsx(el,{className:A("grid place-content-center text-current"),children:e.jsx(Ge,{className:"h-4 w-4"})})}));ut.displayName=Fr.displayName;const Wh=t=>[{id:"standard",name:"Standard Invoice",description:"Regular invoice with payment details",subject:`Invoice INV-${pe(t?.invoice_number||0)} from Rios Roofing`,message:`Dear ${t?.customer?.first_name||"Customer"},

      We hope this email finds you well. Please find your invoice attached to this email for the roofing services we provided.

      Please review the detailed invoice information below, including payment history if applicable. The attached PDF contains the complete invoice for your records.

      If you have any questions about this invoice or need clarification on any of the services provided, please don't hesitate to reach out to us.

      Thank you for choosing Rios Roofing for your roofing needs!

      Best regards,
      Rios Roofing Services
      150 Tallant St, Houston TX 77076
      Phone: 832-310-3593
      Email: rrios.roofing@gmail.com`},{id:"initial_down_payment",name:"Initial Down Payment Received",description:"Thank customer for down payment and notify about project start",subject:`Down Payment Received - Project Ready to Begin - INV-${pe(t?.invoice_number||0)}`,message:`Dear ${t?.customer?.first_name||"Customer"},

      Thank you for your down payment! We're excited to confirm that we have received your initial payment and are ready to begin your roofing project.

      Our team is now proceeding with the procurement of materials and will have everything ready to start as soon as possible. We will contact you within the next 1-2 business days to schedule the project start date that works best for you.

      Please review the invoice details below for your records. The remaining balance will be due upon project completion.

      We appreciate your trust in Rios Roofing and look forward to delivering exceptional results for your roofing project!

      Best regards,
      Rios Roofing Services
      150 Tallant St, Houston TX 77076
      Phone: 832-310-3593
      Email: rrios.roofing@gmail.com`},{id:"payment_received",name:"Payment Received Notification",description:"Acknowledge a new payment has been received",subject:`Payment Received - Thank You - INV-${pe(t?.invoice_number||0)}`,message:`Dear ${t?.customer?.first_name||"Customer"},

      Thank you for your recent payment! We wanted to confirm that we have successfully received and processed your payment.

      Please review the updated invoice details below, including your payment history and current balance. Your prompt payments help us maintain our high-quality service standards.

      If you have any questions about your account balance or payment history, please don't hesitate to contact us.

      We truly appreciate your business and timely payments!

      Best regards,
      Rios Roofing Services
      150 Tallant St, Houston TX 77076
      Phone: 832-310-3593
      Email: rrios.roofing@gmail.com`},{id:"final_payment",name:"Project Complete - Final Payment",description:"Project completion notification with final payment confirmation",subject:`Project Complete - Final Payment Received - INV-${pe(t?.invoice_number||0)}`,message:`Dear ${t?.customer?.first_name||"Customer"},

      Congratulations! We're pleased to confirm that your roofing project has been completed successfully and your final payment has been received.

      Your invoice is now paid in full, and we want to thank you for choosing Rios Roofing for your roofing needs. We take pride in delivering quality workmanship and are confident that your new roof will serve you well for years to come.

      Please find the final invoice summary below for your records. We also recommend keeping all documentation for warranty purposes.

      If you have any questions about your completed project or need any follow-up services, please don't hesitate to reach out. We're always here to help!

      Thank you once again for your business and trust in our services.

      Best regards,
      Rios Roofing Services
      150 Tallant St, Houston TX 77076
      Phone: 832-310-3593
      Email: rrios.roofing@gmail.com`}],Gh=({invoice:t,trigger:s})=>{const[a,r]=d.useState(!1),[n,i]=d.useState(!1),[o,l]=d.useState("standard"),[c,u]=d.useState({showPaymentHistory:!0,showCustomerNotes:!0,showPaymentInformation:!0}),h=x=>{u(y=>({...y,[x]:!y[x]}))};console.log("🔍 EmailInvoiceDialog - Invoice data received:",{invoice:t,invoiceId:t?.id,invoiceNumber:t?.invoice_number,invoiceTotal:t?.total,paymentsCount:t?.invoice_payment?.length||0,payments:t?.invoice_payment,customerEmail:t?.customer?.email,customerName:t?.customer?`${t.customer.first_name} ${t.customer.last_name}`:"Unknown",amountDueFromDB:t?.amount_due});const p=Wh(t),g=p.find(x=>x.id===o)||p[0],[N,_]=d.useState({to:t?.customer?.email||"",cc:"",subject:g.subject,message:g.message}),{toast:m}=ss(),{sendEmail:R,isInitialized:S,isLoading:E,error:b,checkGmailPermissions:O}=Gi(),F=(x,y)=>{_(f=>({...f,[x]:y}))},L=x=>{l(x);const y=p.find(f=>f.id===x);y&&_(f=>({...f,subject:y.subject,message:y.message}))},H=x=>{const y=pe(x.invoice_number||0),f=x.customer?`${x.customer.first_name}_${x.customer.last_name}`.replace(/\s+/g,"_"):"Unknown_Customer";return`INV-${y}_${f}.pdf`},ne=async x=>{try{typeof Zs>"u"&&console.warn("Buffer not available, PDF generation may fail");const y=await mn(e.jsx(Ja,{invoice:x,displayOptions:c})).toBlob();return new Promise((f,M)=>{const C=new FileReader;C.onloadend=()=>{if(C.result)try{const W=C.result.split(",")[1];if(!W||W.length===0)throw new Error("Failed to extract base64 data from PDF");try{atob(W.substring(0,Math.min(100,W.length)))}catch{throw new Error("Generated base64 data is invalid")}f(W)}catch(W){console.error("Base64 validation error:",W),M(new Error("Generated PDF contains invalid base64 data"))}else M(new Error("Failed to convert PDF to base64"))},C.onerror=W=>{console.error("FileReader error:",W),M(new Error("Failed to read PDF blob"))},C.readAsDataURL(y)})}catch(y){throw console.error("Error generating PDF:",y),y instanceof Error?new Error(`PDF generation failed: ${y.message}`):new Error("Failed to generate PDF for email attachment")}},G=x=>{const y=x?.invoice_payment||x?.payments||[];return Array.isArray(y)?y.reduce((f,M)=>{const C=parseFloat(M.amount)||0;return f+C},0):0},Z=x=>{if(x?.amount_due!==null&&x?.amount_due!==void 0&&x?.amount_due>=0)return parseFloat(x.amount_due)||0;const y=parseFloat(x?.total)||0,f=G(x);return Math.max(0,y-f)},oe=async()=>{if(console.log("📧 handleSendEmail - Starting email process:",{emailForm:N,invoice:t,invoiceTotal:t?.total,payments:t?.invoice_payment||t?.payments,totalPayments:G(t),amountDue:Z(t),amountDueFromDB:t?.amount_due}),!N.to.trim()){m({title:"Validation Error",description:"Please enter a recipient email address.",variant:"destructive"});return}if(!N.subject.trim()){m({title:"Validation Error",description:"Please enter an email subject.",variant:"destructive"});return}i(!0);try{if(!await O()){m({title:"Permission Required",description:"Gmail access is required to send emails. Please ensure you have granted the necessary permissions.",variant:"destructive"});return}m({title:"Preparing Email",description:"Generating invoice PDF attachment...",variant:"default"});let y,f;try{const C=Yi(t);f=H(C),y=await ne(C)}catch(C){if(console.error("PDF generation error:",C),!window.confirm("PDF generation failed. Would you like to send the email without the PDF attachment?")){m({title:"Email Cancelled",description:"Email not sent due to PDF generation failure",variant:"destructive"});return}y="",f=""}const M=await R({to:N.to.split(",").map(C=>C.trim()),cc:N.cc?N.cc.split(",").map(C=>C.trim()):void 0,subject:N.subject,htmlBody:`
          <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; border: 1px solid #e5e7eb;">
            <!-- Header with Logo -->
            <div style="background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%); color: white; padding: 25px; text-align: center; border-radius: 8px 8px 0 0;">
              <div style="display: flex; align-items: center; justify-content: center; gap: 15px;">
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="1080" height="1080">
                  <path d="M0 0 C356.4 0 712.8 0 1080 0 C1080 356.4 1080 712.8 1080 1080 C723.6 1080 367.2 1080 0 1080 C0 723.6 0 367.2 0 0 Z " fill="#2460E5" transform="translate(0,0)"/>
                  <path d="M0 0 C8.10497731 3.81757686 15.46790576 9.25945348 22.75 14.4375 C30.60048059 19.95809025 38.50032706 25.38534423 46.5 30.6875 C55.65914137 36.76303873 64.77948052 42.89235248 73.875 49.0625 C74.52122314 49.50081146 75.16744629 49.93912292 75.83325195 50.39071655 C78.4986761 52.19864939 81.1640192 54.00670154 83.8291626 55.81504822 C90.83314522 60.56680816 97.84391243 65.30852007 104.85513306 70.04959106 C116.46916752 77.90327141 128.08032842 85.76118038 139.6875 93.625 C140.32255463 94.05524475 140.95760925 94.4854895 141.61190796 94.92877197 C146.71019984 98.38289488 151.80829092 101.83731412 156.90637207 105.29174805 C161.37498603 108.31963945 165.84368221 111.34740944 170.3125 114.375 C170.94731293 114.80508362 171.58212585 115.23516724 172.23617554 115.67828369 C182.48772071 122.62338639 192.74311948 129.56277979 203 136.5 C213.89844835 143.8711433 224.79486123 151.24527396 235.6875 158.625 C236.32255463 159.05524475 236.95760925 159.4854895 237.61190796 159.92877197 C242.71019984 163.38289488 247.80829092 166.83731412 252.90637207 170.29174805 C257.37498603 173.31963945 261.84368221 176.34740944 266.3125 179.375 C267.26471939 180.02012543 267.26471939 180.02012543 268.23617554 180.67828369 C278.48772071 187.62338639 288.74311948 194.56277979 299 201.5 C313.72920062 211.46206478 328.45256685 221.43271377 343.17333984 231.40722656 C347.67580536 234.45796591 352.17851109 237.50835066 356.68145752 240.55838013 C359.89499406 242.73507544 363.10823642 244.91220209 366.32080078 247.09033203 C372.35966492 251.18402495 378.40154323 255.27306405 384.45339966 259.34753418 C387.30467967 261.26755951 390.15435269 263.18996247 393.00390625 265.11254883 C394.35971346 266.02633587 395.71630277 266.93896372 397.07373047 267.8503418 C398.95871299 269.11602676 400.84093518 270.3857231 402.72265625 271.65625 C403.79265869 272.37619141 404.86266113 273.09613281 405.96508789 273.83789062 C412.72256393 278.65200114 417.92596594 282.8669644 419.41796875 291.38671875 C420.09060086 302.9668986 411.89761912 312.4529532 405.625 321.5 C404.89539063 322.56347656 404.16578125 323.62695312 403.4140625 324.72265625 C401.97356386 326.81909623 400.52844372 328.91236937 399.07836914 331.00219727 C397.71520964 332.96839432 396.35993121 334.94008382 395.01342773 336.91772461 C394.40184814 337.80983643 393.79026855 338.70194824 393.16015625 339.62109375 C392.35783569 340.79949829 392.35783569 340.79949829 391.53930664 342.00170898 C388.48038262 345.97273089 384.91195301 348.01580353 380 349 C378.39972928 349.13938706 376.79354296 349.21964958 375.1875 349.25 C374.37667969 349.27578125 373.56585937 349.3015625 372.73046875 349.328125 C366.36496178 348.56317137 361.13276816 344.98376899 355.96875 341.42578125 C354.99742126 340.76730949 354.99742126 340.76730949 354.00646973 340.09553528 C352.66050352 339.18240353 351.31622779 338.26677517 349.97363281 337.34869385 C348.114274 336.07808982 346.24991893 334.81533537 344.3828125 333.55615234 C340.75086423 331.10632171 337.12521281 328.64728233 333.5 326.1875 C332.1556405 325.2759804 330.81123839 324.36452363 329.46679688 323.453125 C326.68863921 321.56973876 323.91066031 319.68608931 321.1328125 317.80224609 C315.22966275 313.79923326 309.32424966 309.7995624 303.41891479 305.79977417 C301.49543471 304.49690771 299.57204284 303.1939111 297.64868164 301.89086914 C291.75201677 297.89601746 285.85505789 293.90160208 279.95698547 289.90882874 C264.28582829 279.29999717 248.625566 268.6759301 233 258 C233 259.78512863 234.55129071 261.02598064 235.625 262.375 C242.30159942 271.24039026 246.06647309 280.34816444 249 291 C249.37125 292.155 249.7425 293.31 250.125 294.5 C252.61560323 304.46241294 253.32040103 314.32501641 253.25 324.5625 C253.25773438 325.69107422 253.26546875 326.81964844 253.2734375 327.98242188 C253.21963814 351.37169173 244.67252123 372.62162612 229 390 C228.32453125 390.75796875 227.6490625 391.5159375 226.953125 392.296875 C215.90538331 404.0091425 201.90268211 412.15527974 188 420 C188.4947583 420.72960937 188.9895166 421.45921875 189.49926758 422.2109375 C201.58843224 440.04132034 213.65464246 457.88706759 225.7043457 475.74414062 C226.86018534 477.45703359 228.01602843 479.16992421 229.171875 480.8828125 C230.02884224 482.15279083 230.02884224 482.15279083 230.90312195 483.44842529 C237.77609813 493.63304221 244.65591701 503.81303463 251.53662109 513.99243164 C257.18328129 522.34691002 262.82472759 530.70487371 268.4609375 539.06640625 C270.32571521 541.83206481 272.19056076 544.59767761 274.05541992 547.36328125 C275.25941335 549.14932062 276.46303246 550.93561239 277.66625977 552.72216797 C279.33648961 555.20211401 281.00796656 557.6812152 282.6796875 560.16015625 C283.42319962 561.26527306 283.42319962 561.26527306 284.18173218 562.39271545 C286.01141821 565.10396367 287.82841856 567.77856256 289.83251953 570.36499023 C291 572 291 572 291 574 C280.29950702 574.23198245 269.59961459 574.40952189 258.89711666 574.51812172 C253.92700661 574.57025351 248.95861999 574.64092101 243.98950195 574.75439453 C239.19124576 574.86327706 234.39464369 574.92288637 229.59524727 574.94877243 C227.76702389 574.96721127 225.93888842 575.00322262 224.11137199 575.05730057 C209.80948006 575.46356737 209.80948006 575.46356737 205.39741516 571.89494324 C203.57421608 569.33441869 202.25672465 566.87460803 201 564 C200.37649658 563.02812744 199.75299316 562.05625488 199.1105957 561.05493164 C198.63710693 560.26465576 198.16361816 559.47437988 197.67578125 558.66015625 C197.12873535 557.75289795 196.58168945 556.84563965 196.01806641 555.91088867 C195.17381104 554.50093628 195.17381104 554.50093628 194.3125 553.0625 C189.98470729 545.89261766 185.6208539 538.75329263 181.125 531.6875 C176.34444419 524.16873234 171.65926829 516.59448664 167 509 C161.92064655 500.72202667 156.79723997 492.47675978 151.58911133 484.27929688 C146.5430578 476.31749939 141.61652485 468.28225702 136.69335938 460.24414062 C136.05591797 459.20451172 135.41847656 458.16488281 134.76171875 457.09375 C134.14216309 456.083125 133.52260742 455.0725 132.88427734 454.03125 C130.40132394 450.03690568 127.840047 446.09497102 125.26098633 442.16210938 C124 440 124 440 124 438 C110.47 438 96.94 438 83 438 C83 482.88 83 527.76 83 574 C50.5775 574.804375 50.5775 574.804375 17.5 575.625 C10.70212891 575.8617041 3.90425781 576.0984082 -3.09960938 576.34228516 C-11.46972656 576.4597168 -11.46972656 576.4597168 -15.40148926 576.48153687 C-18.13120223 576.52136895 -20.82853221 576.60170777 -23.55187988 576.7449646 C-42.00350661 577.67290336 -42.00350661 577.67290336 -50 574 C-56.84902286 567.79589702 -60.61861266 559.6804776 -64.38447571 551.37388229 C-66.99364337 545.92486204 -70.27934924 540.93570383 -73.5625 535.875 C-74.80771238 533.89252174 -76.05026258 531.90836655 -77.2890625 529.921875 C-78.52592333 527.94784252 -79.76290235 525.97388408 -81 524 C-88.7768706 511.5914071 -96.52565008 499.16753266 -104.1875 486.6875 C-109.71461476 477.68507803 -115.296061 468.72100833 -120.9609375 459.8046875 C-125.33597637 452.88785227 -129.6623035 445.94031439 -134 439 C-147.2 438.67 -160.4 438.34 -174 438 C-174 482.88 -174 527.76 -174 574 C-199.08 574 -224.16 574 -250 574 C-250 471.04 -250 368.08 -250 262 C-258.34477038 267.28086374 -258.34477038 267.28086374 -266.55859375 272.734375 C-267.50621582 273.38051758 -268.45383789 274.02666016 -269.43017578 274.69238281 C-270.42259277 275.37139648 -271.41500977 276.05041016 -272.4375 276.75 C-274.08369449 277.87279792 -275.72989312 278.99558978 -277.37628174 280.11810303 C-278.51863467 280.89707107 -279.66084535 281.67624777 -280.80291748 282.45562744 C-287.06922638 286.73179712 -293.34674964 290.9913909 -299.625 295.25 C-300.79419537 296.04328555 -301.96338478 296.83657989 -303.13256836 297.62988281 C-309.31339861 301.82324137 -315.49587338 306.01416799 -321.6796875 310.203125 C-322.32321671 310.639095 -322.96674591 311.075065 -323.629776 311.52424622 C-326.87968476 313.72577277 -330.13014462 315.92647852 -333.3815918 318.12573242 C-339.2441457 322.09229887 -345.10237424 326.06464951 -350.94113159 330.06619263 C-353.49663184 331.81740519 -356.05444297 333.56522742 -358.61230469 335.31298828 C-359.81098372 336.13359279 -361.0084534 336.95596719 -362.20458984 337.78027344 C-379.30524831 349.56408426 -379.30524831 349.56408426 -387.4375 349.625 C-388.46746094 349.65851563 -389.49742187 349.69203125 -390.55859375 349.7265625 C-400.67547155 347.59064959 -405.58871639 340.06847814 -410.96289062 331.94140625 C-411.8713119 330.54441267 -412.77951378 329.14727639 -413.6875 327.75 C-414.60588824 326.3674696 -415.52580122 324.98595078 -416.44726562 323.60546875 C-432.26098273 299.81292694 -432.26098273 299.81292694 -431 289 C-429.25789065 282.57597178 -425.11788401 279.06190053 -419.796875 275.40234375 C-419.18313019 274.97239609 -418.56938538 274.54244843 -417.93704224 274.09947205 C-415.96459698 272.72319681 -413.98393711 271.35964954 -412 270 C-411.35887268 269.56012756 -410.71774536 269.12025513 -410.05718994 268.66705322 C-405.34544382 265.44224164 -400.61149826 262.2507914 -395.875 259.0625 C-394.3801378 258.05409886 -392.88543022 257.04546847 -391.39086914 256.03662109 C-389.11737922 254.50201197 -386.84381154 252.96751997 -384.56977844 251.43371582 C-377.51714783 246.67670229 -370.47567721 241.9033621 -363.4375 237.125 C-362.44411621 236.45090088 -361.45073242 235.77680176 -360.42724609 235.08227539 C-358.87232163 234.02681979 -357.31799794 232.96763547 -355.81938171 231.83364868 C-351.93537098 228.97955184 -348.19285029 227.28323597 -343.66186523 225.6184082 C-335.98187867 222.34447012 -328.87299155 218.68984494 -325 211 C-320.14154993 194.68761902 -322.42133341 175.61327923 -323.05297852 158.84362793 C-323.32059835 151.07269595 -323.42653454 143.29820567 -323.54368305 135.52378941 C-323.63595476 129.47780837 -323.75582829 123.43721863 -323.96440125 117.39402771 C-324.01113228 115.72854637 -324.01113228 115.72854637 -324.05880737 114.02941895 C-324.11695329 111.96931355 -324.19058397 109.90955653 -324.28343201 107.85072327 C-324.469214 100.15390841 -322.63405134 95.13238538 -317.6875 89.25 C-312.5672562 84.96328426 -307.53215142 81.89741324 -300.79101562 81.80712891 C-299.15791443 81.78303452 -299.15791443 81.78303452 -297.49182129 81.75845337 C-292.48543906 81.71392549 -287.47919058 81.67289661 -282.47265625 81.64990234 C-279.8384515 81.63339 -277.20429068 81.60616327 -274.5703125 81.56787109 C-270.76538925 81.51284517 -266.9615187 81.49118274 -263.15625 81.4765625 C-261.98920532 81.45389313 -260.82216064 81.43122375 -259.61975098 81.40786743 C-251.25827234 81.42926021 -244.32107325 82.96042569 -238.0592041 88.81436157 C-233.85312023 93.36151264 -231.74054066 97.7946173 -231.77294922 104.06567383 C-231.77317581 105.53663261 -231.77317581 105.53663261 -231.77340698 107.03730774 C-231.78372955 108.0833165 -231.79405212 109.12932526 -231.8046875 110.20703125 C-231.8075174 111.28756271 -231.81034729 112.36809418 -231.81326294 113.48136902 C-231.82443868 116.92519301 -231.84953882 120.36875489 -231.875 123.8125 C-231.88503315 126.15038686 -231.89415842 128.48827781 -231.90234375 130.82617188 C-231.9243695 136.55087035 -231.95782132 142.27541645 -232 148 C-215.36474262 136.75253895 -198.73087563 125.5030937 -182.11706543 114.22396851 C-172.91527459 107.97688266 -163.70890515 101.73659361 -154.5 95.5 C-144.6633746 88.8381762 -134.82962932 82.17214234 -125 75.5 C-115.23245083 68.87014728 -105.46149394 62.24534809 -95.6875 55.625 C-95.04380463 55.18899475 -94.40010925 54.7529895 -93.73690796 54.30377197 C-88.5018643 50.75789804 -83.26662193 47.21231753 -78.03137207 43.66674805 C-77.38196655 43.22693604 -76.73256104 42.78712402 -76.06347656 42.33398438 C-75.4146199 41.89454498 -74.76576324 41.45510559 -74.09724426 41.00234985 C-72.13500545 39.67336025 -70.17284873 38.34424951 -68.21069336 37.01513672 C-65.62859144 35.26614655 -63.04602975 33.51783827 -60.46313477 31.77001953 C-54.66740374 27.8470523 -48.87535284 23.91902709 -43.09825134 19.96865845 C-40.54858146 18.22533493 -37.99712564 16.48463408 -35.44564819 14.74395752 C-34.25279537 13.92894106 -33.06088445 13.11254393 -31.87002563 12.2946167 C-11.15391417 -1.9334226 -11.15391417 -1.9334226 0 0 Z " fill="#FBFBFB" transform="translate(546,227)"/>
                  <path d="M0 0 C8.10497731 3.81757686 15.46790576 9.25945348 22.75 14.4375 C30.60048059 19.95809025 38.50032706 25.38534423 46.5 30.6875 C55.65914137 36.76303873 64.77948052 42.89235248 73.875 49.0625 C74.52122314 49.50081146 75.16744629 49.93912292 75.83325195 50.39071655 C78.4986761 52.19864939 81.1640192 54.00670154 83.8291626 55.81504822 C90.83314522 60.56680816 97.84391243 65.30852007 104.85513306 70.04959106 C116.46916752 77.90327141 128.08032842 85.76118038 139.6875 93.625 C140.32255463 94.05524475 140.95760925 94.4854895 141.61190796 94.92877197 C146.71019984 98.38289488 151.80829092 101.83731412 156.90637207 105.29174805 C161.37498603 108.31963945 165.84368221 111.34740944 170.3125 114.375 C170.94731293 114.80508362 171.58212585 115.23516724 172.23617554 115.67828369 C182.48772071 122.62338639 192.74311948 129.56277979 203 136.5 C213.89844835 143.8711433 224.79486123 151.24527396 235.6875 158.625 C236.32255463 159.05524475 236.95760925 159.4854895 237.61190796 159.92877197 C242.71019984 163.38289488 247.80829092 166.83731412 252.90637207 170.29174805 C257.37498603 173.31963945 261.84368221 176.34740944 266.3125 179.375 C267.26471939 180.02012543 267.26471939 180.02012543 268.23617554 180.67828369 C278.48772071 187.62338639 288.74311948 194.56277979 299 201.5 C313.72920062 211.46206478 328.45256685 221.43271377 343.17333984 231.40722656 C347.67580536 234.45796591 352.17851109 237.50835066 356.68145752 240.55838013 C359.89499406 242.73507544 363.10823642 244.91220209 366.32080078 247.09033203 C372.35966492 251.18402495 378.40154323 255.27306405 384.45339966 259.34753418 C387.30467967 261.26755951 390.15435269 263.18996247 393.00390625 265.11254883 C394.35971346 266.02633587 395.71630277 266.93896372 397.07373047 267.8503418 C398.95871299 269.11602676 400.84093518 270.3857231 402.72265625 271.65625 C403.79265869 272.37619141 404.86266113 273.09613281 405.96508789 273.83789062 C412.72256393 278.65200114 417.92596594 282.8669644 419.41796875 291.38671875 C420.09060086 302.9668986 411.89761912 312.4529532 405.625 321.5 C404.89539063 322.56347656 404.16578125 323.62695312 403.4140625 324.72265625 C401.97356386 326.81909623 400.52844372 328.91236937 399.07836914 331.00219727 C397.71520964 332.96839432 396.35993121 334.94008382 395.01342773 336.91772461 C394.40184814 337.80983643 393.79026855 338.70194824 393.16015625 339.62109375 C392.35783569 340.79949829 392.35783569 340.79949829 391.53930664 342.00170898 C388.48038262 345.97273089 384.91195301 348.01580353 380 349 C378.39972928 349.13938706 376.79354296 349.21964958 375.1875 349.25 C374.37667969 349.27578125 373.56585937 349.3015625 372.73046875 349.328125 C366.36496178 348.56317137 361.13276816 344.98376899 355.96875 341.42578125 C354.99742126 340.76730949 354.99742126 340.76730949 354.00646973 340.09553528 C352.66050352 339.18240353 351.31622779 338.26677517 349.97363281 337.34869385 C348.114274 336.07808982 346.24991893 334.81533537 344.3828125 333.55615234 C340.75086423 331.10632171 337.12521281 328.64728233 333.5 326.1875 C332.1556405 325.2759804 330.81123839 324.36452363 329.46679688 323.453125 C326.68863921 321.56973876 323.91066031 319.68608931 321.1328125 317.80224609 C315.22966275 313.79923326 309.32424966 309.7995624 303.41891479 305.79977417 C301.49543471 304.49690771 299.57204284 303.1939111 297.64868164 301.89086914 C291.0777127 297.43919232 284.50613472 292.98841805 277.93359375 288.5390625 C270.86878547 283.75629527 263.80579575 278.97085199 256.74456787 274.18280029 C255.0585807 273.03971716 253.37232779 271.89702697 251.68603516 270.75439453 C248.7059775 268.73411872 245.72767129 266.71129086 242.75 264.6875 C241.91202881 264.1198291 241.07405762 263.5521582 240.21069336 262.96728516 C235.96544966 260.07758251 231.78135846 257.12378261 227.640625 254.0859375 C221.86998251 249.86725577 215.95812374 245.88533135 210 241.9375 C208.99710938 241.26912109 207.99421875 240.60074219 206.9609375 239.91210938 C202.24542736 236.77757454 197.51276815 233.67953488 192.72265625 230.66015625 C185.52167988 226.09765158 178.48887919 221.28881832 171.4375 216.5 C169.94045897 215.48502556 168.4433049 214.47021783 166.94604492 213.45556641 C163.84152942 211.3515451 160.73749642 209.24681478 157.63378906 207.14160156 C151.07024044 202.6905225 144.50014691 198.24912613 137.93045044 193.80712891 C125.81337942 185.61373243 113.70162532 177.41250002 101.59243774 169.2074585 C91.39824365 162.30011122 81.20005661 155.39868675 71 148.5 C51.73681605 135.47119423 51.73681605 135.47119423 43.96853638 130.20741272 C40.75419256 128.02941484 37.5384019 125.85363943 34.31884766 123.68334961 C28.51560337 119.767268 22.73245504 115.82890566 17.00869751 111.79721069 C14.42157956 109.97645548 11.82559139 108.16857777 9.22894287 106.3614502 C8.00371605 105.50300486 6.78309526 104.63794351 5.56744385 103.76599121 C3.89709773 102.5682527 2.21264482 101.39357455 0.5234375 100.22265625 C-0.42611816 99.54984619 -1.37567383 98.87703613 -2.35400391 98.18383789 C-4.91028201 96.72498351 -4.91028201 96.72498351 -7.45239258 97.54101562 C-10.48786702 99.27939562 -13.40782403 101.13588858 -16.28515625 103.12109375 C-16.88960068 103.53243057 -17.4940451 103.9437674 -18.11680603 104.36756897 C-20.10174509 105.71981452 -22.08206836 107.07866369 -24.0625 108.4375 C-25.4599565 109.39110871 -26.85774793 110.34422678 -28.25585938 111.296875 C-31.12147361 113.25022748 -33.98545987 115.20593104 -36.84814453 117.16357422 C-42.32348778 120.90646797 -47.81296997 124.62842662 -53.30310059 128.34957886 C-55.59482298 129.90326311 -57.88564265 131.45827575 -60.17648315 133.01325989 C-72.13730846 141.13180237 -84.10750864 149.2365143 -96.07666016 157.34277344 C-100.61730568 160.41802561 -105.15766696 163.49369731 -109.69793701 166.56950378 C-112.91813211 168.75102373 -116.13840755 170.93242482 -119.35888672 173.11352539 C-125.23801683 177.09539617 -131.11644725 181.0782839 -136.99186707 185.06562805 C-154.20694835 196.74851206 -171.47252073 208.34918719 -188.80224609 219.86157227 C-196.98030426 225.30290022 -205.11927247 230.8008387 -213.25 236.3125 C-213.93486481 236.77665314 -214.61972961 237.24080627 -215.3253479 237.71902466 C-232.55999363 249.39568759 -232.55999363 249.39568759 -249.65625 261.2734375 C-258.89510363 267.77448331 -268.18705749 274.1706744 -277.6027832 280.41308594 C-284.89222372 285.24930477 -292.13996753 290.14543283 -299.375 295.0625 C-299.95934814 295.45956146 -300.54369629 295.85662292 -301.14575195 296.26571655 C-303.56115682 297.9070114 -305.97650019 299.5483966 -308.3916626 301.19004822 C-312.8236281 304.2021341 -317.25857881 307.20978623 -321.6953125 310.21484375 C-322.33785477 310.65007355 -322.98039703 311.08530334 -323.64241028 311.53372192 C-326.88784442 313.73175315 -330.13386743 315.92890966 -333.38061523 318.125 C-339.24346147 322.09185913 -345.10203919 326.06441989 -350.94113159 330.06619263 C-353.49663184 331.81740519 -356.05444297 333.56522742 -358.61230469 335.31298828 C-359.81098372 336.13359279 -361.0084534 336.95596719 -362.20458984 337.78027344 C-379.30524831 349.56408426 -379.30524831 349.56408426 -387.4375 349.625 C-388.46746094 349.65851563 -389.49742187 349.69203125 -390.55859375 349.7265625 C-400.67547155 347.59064959 -405.58871639 340.06847814 -410.96289062 331.94140625 C-411.8713119 330.54441267 -412.77951378 329.14727639 -413.6875 327.75 C-414.60588824 326.3674696 -415.52580122 324.98595078 -416.44726562 323.60546875 C-432.26098273 299.81292694 -432.26098273 299.81292694 -431 289 C-429.25789065 282.57597178 -425.11788401 279.06190053 -419.796875 275.40234375 C-419.18313019 274.97239609 -418.56938538 274.54244843 -417.93704224 274.09947205 C-415.96459698 272.72319681 -413.98393711 271.35964954 -412 270 C-411.35887268 269.56012756 -410.71774536 269.12025513 -410.05718994 268.66705322 C-405.34544382 265.44224164 -400.61149826 262.2507914 -395.875 259.0625 C-394.3801378 258.05409886 -392.88543022 257.04546847 -391.39086914 256.03662109 C-389.11737922 254.50201197 -386.84381154 252.96751997 -384.56977844 251.43371582 C-377.51714783 246.67670229 -370.47567721 241.9033621 -363.4375 237.125 C-362.44411621 236.45090088 -361.45073242 235.77680176 -360.42724609 235.08227539 C-358.87232163 234.02681979 -357.31799794 232.96763547 -355.81938171 231.83364868 C-351.93537098 228.97955184 -348.19285029 227.28323597 -343.66186523 225.6184082 C-335.98187867 222.34447012 -328.87299155 218.68984494 -325 211 C-320.14154993 194.68761902 -322.42133341 175.61327923 -323.05297852 158.84362793 C-323.32059835 151.07269595 -323.42653454 143.29820567 -323.54368305 135.52378941 C-323.63595476 129.47780837 -323.75582829 123.43721863 -323.96440125 117.39402771 C-324.01113228 115.72854637 -324.01113228 115.72854637 -324.05880737 114.02941895 C-324.11695329 111.96931355 -324.19058397 109.90955653 -324.28343201 107.85072327 C-324.469214 100.15390841 -322.63405134 95.13238538 -317.6875 89.25 C-312.5672562 84.96328426 -307.53215142 81.89741324 -300.79101562 81.80712891 C-299.15791443 81.78303452 -299.15791443 81.78303452 -297.49182129 81.75845337 C-292.48543906 81.71392549 -287.47919058 81.67289661 -282.47265625 81.64990234 C-279.8384515 81.63339 -277.20429068 81.60616327 -274.5703125 81.56787109 C-270.76538925 81.51284517 -266.9615187 81.49118274 -263.15625 81.4765625 C-261.98920532 81.45389313 -260.82216064 81.43122375 -259.61975098 81.40786743 C-251.25827234 81.42926021 -244.32107325 82.96042569 -238.0592041 88.81436157 C-233.85312023 93.36151264 -231.74054066 97.7946173 -231.77294922 104.06567383 C-231.77317581 105.53663261 -231.77317581 105.53663261 -231.77340698 107.03730774 C-231.78372955 108.0833165 -231.79405212 109.12932526 -231.8046875 110.20703125 C-231.8075174 111.28756271 -231.81034729 112.36809418 -231.81326294 113.48136902 C-231.82443868 116.92519301 -231.84953882 120.36875489 -231.875 123.8125 C-231.88503315 126.15038686 -231.89415842 128.48827781 -231.90234375 130.82617188 C-231.9243695 136.55087035 -231.95782132 142.27541645 -232 148 C-215.36474262 136.75253895 -198.73087563 125.5030937 -182.11706543 114.22396851 C-172.91527459 107.97688266 -163.70890515 101.73659361 -154.5 95.5 C-144.6633746 88.8381762 -134.82962932 82.17214234 -125 75.5 C-115.23245083 68.87014728 -105.46149394 62.24534809 -95.6875 55.625 C-95.04380463 55.18899475 -94.40010925 54.7529895 -93.73690796 54.30377197 C-88.5018643 50.75789804 -83.26662193 47.21231753 -78.03137207 43.66674805 C-77.38196655 43.22693604 -76.73256104 42.78712402 -76.06347656 42.33398438 C-75.4146199 41.89454498 -74.76576324 41.45510559 -74.09724426 41.00234985 C-72.13500545 39.67336025 -70.17284873 38.34424951 -68.21069336 37.01513672 C-65.62859144 35.26614655 -63.04602975 33.51783827 -60.46313477 31.77001953 C-54.66740374 27.8470523 -48.87535284 23.91902709 -43.09825134 19.96865845 C-40.54858146 18.22533493 -37.99712564 16.48463408 -35.44564819 14.74395752 C-34.25279537 13.92894106 -33.06088445 13.11254393 -31.87002563 12.2946167 C-11.15391417 -1.9334226 -11.15391417 -1.9334226 0 0 Z " fill="#FEFEFE" transform="translate(546,227)"/>
                  <path d="M0 0 C2.48658243 1.48270287 4.91234405 2.98042983 7.29638672 4.62426758 C8.24763428 5.2760498 9.19888184 5.92783203 10.17895508 6.59936523 C11.21028564 7.3127002 12.24161621 8.02603516 13.30419922 8.76098633 C14.4113094 9.52116198 15.5188232 10.28075009 16.62670898 11.03979492 C18.38910391 12.24738521 20.15122601 13.45535647 21.91218567 14.66503906 C28.07010456 18.89487258 34.25461981 23.08505624 40.44219971 27.27133179 C42.3892298 28.58873097 44.33579377 29.90681617 46.28222656 31.22509766 C56.712806 38.28921287 67.14750927 45.34723337 77.58248901 52.40484619 C87.70098346 59.24841511 97.81655359 66.09627789 107.92919922 72.94848633 C120.10549813 81.19884869 132.28536891 89.4439158 144.46972656 97.68237305 C151.14362133 102.19514137 157.81630746 106.70965612 164.4841156 111.23141479 C167.59230742 113.3390968 170.70120558 115.44573568 173.81015015 117.55230713 C175.28741012 118.55370107 176.76432772 119.55560028 178.24087524 120.55804443 C188.72147708 127.67749147 188.72147708 127.67749147 199.42919922 134.44848633 C195.27983718 135.83160701 192.29497088 134.39205412 188.30419922 133.07348633 C187.56298828 132.83887695 186.82177734 132.60426758 186.05810547 132.36254883 C180.58096388 130.60025098 180.58096388 130.60025098 179.42919922 129.44848633 C177.54148121 129.0902113 175.64296981 128.78849386 173.74169922 128.51098633 C171.98019531 128.25188477 171.98019531 128.25188477 170.18310547 127.98754883 C168.32492187 127.72071289 168.32492187 127.72071289 166.42919922 127.44848633 C165.22134766 127.2705957 164.01349609 127.09270508 162.76904297 126.90942383 C157.5785805 126.15259905 152.39757964 125.42120483 147.17919922 124.88598633 C143.42919922 124.44848633 143.42919922 124.44848633 141.42919922 123.44848633 C77.57419922 122.95348633 77.57419922 122.95348633 12.42919922 122.44848633 C12.42919922 226.39848633 12.42919922 330.34848633 12.42919922 437.44848633 C9.70201629 434.7213034 7.81165007 432.76971515 5.77880859 429.68408203 C5.29730347 428.95844559 4.81579834 428.23280914 4.31970215 427.48518372 C3.80927368 426.70608139 3.29884521 425.92697906 2.77294922 425.12426758 C2.22997192 424.30460007 1.68699463 423.48493256 1.12756348 422.64042664 C-0.60965363 420.01684289 -2.34067963 417.38925384 -4.07080078 414.76098633 C-6.32789187 411.33820524 -8.58810262 407.91751717 -10.85205078 404.49926758 C-11.41317566 403.65203629 -11.97430054 402.80480499 -12.5524292 401.93190002 C-16.69431881 395.70462029 -20.96485087 389.57964328 -25.30145264 383.48690796 C-30.11649891 376.71259514 -34.7336575 369.81582107 -39.32080078 362.88598633 C-40.1730913 361.60245537 -41.02563519 360.31909262 -41.87841797 359.03588867 C-43.60115351 356.44316318 -45.32275277 353.84968922 -47.04345703 351.25561523 C-50.95894859 345.35471656 -54.89067996 339.46464629 -58.82080078 333.57348633 C-60.1385806 331.59697149 -61.45629659 329.62041409 -62.77392578 327.64379883 C-63.58845215 326.42200928 -63.58845215 326.42200928 -64.41943359 325.17553711 C-64.79938477 324.60561035 -65.17933594 324.03568359 -65.57080078 323.44848633 C-62.68822382 320.36910043 -59.43128214 318.7421992 -55.69580078 316.88598633 C-47.92123626 312.87479724 -41.27819001 308.03505856 -34.57080078 302.44848633 C-33.68650391 301.72918945 -32.80220703 301.00989258 -31.89111328 300.26879883 C-14.51759037 285.49318589 -2.72897751 263.38865679 -0.71142578 240.60522461 C1.12258751 212.47731934 -2.6171026 183.49666585 -21.57080078 161.44848633 C-22.06708984 160.79750977 -22.56337891 160.1465332 -23.07470703 159.47583008 C-38.14531181 140.47704761 -64.58883747 132.0070593 -87.44580078 127.26098633 C-88.18693115 127.105896 -88.92806152 126.95080566 -89.69165039 126.79101562 C-92.31107791 126.28275196 -94.93351749 125.85468958 -97.57080078 125.44848633 C-98.7008252 125.27188477 -99.83084961 125.0952832 -100.99511719 124.91333008 C-116.50495462 122.74532104 -132.23630927 123.00154608 -147.86541748 122.84759521 C-151.7881259 122.80701299 -155.71070146 122.75617349 -159.63330078 122.70629883 C-167.27904169 122.61054634 -174.9248491 122.52583297 -182.57080078 122.44848633 C-180.05734079 119.89463359 -177.67863995 117.69390416 -174.67626953 115.73364258 C-173.51538818 114.9687854 -173.51538818 114.9687854 -172.33105469 114.18847656 C-171.0575415 113.3581189 -171.0575415 113.3581189 -169.75830078 112.51098633 C-167.85256223 111.25437206 -165.94766623 109.9964794 -164.04345703 108.73754883 C-162.48715576 107.70936035 -162.48715576 107.70936035 -160.89941406 106.66040039 C-154.80391069 102.60984585 -148.75152194 98.49567376 -142.69580078 94.38598633 C-141.36729791 93.48498324 -140.03876575 92.58402333 -138.71020508 91.68310547 C-136.0088999 89.85114634 -133.30784394 88.01882048 -130.60693359 86.1862793 C-124.73921717 82.20551052 -118.86822819 78.22957369 -112.99740601 74.25338745 C-110.42120775 72.50851312 -107.84517828 70.7633897 -105.26914978 69.01826477 C-100.07342442 65.49843195 -94.87752224 61.9788604 -89.68135071 58.45968628 C-76.57873446 49.58576413 -63.47754253 40.70976264 -50.38330078 31.82348633 C-49.81815765 31.43996002 -49.25301453 31.05643372 -48.67074585 30.6612854 C-42.70358782 26.61164266 -36.73689785 22.56131074 -30.77049255 18.51055908 C-28.19835377 16.76433091 -25.62608726 15.01829095 -23.05380249 13.27227783 C-21.24529278 12.04458363 -19.43697419 10.8166083 -17.62866211 9.58862305 C-16.51823926 8.83486469 -15.40780682 8.08112045 -14.29736328 7.32739258 C-12.85224365 6.3462146 -12.85224365 6.3462146 -11.37792969 5.34521484 C-10.45157715 4.71929443 -9.52522461 4.09337402 -8.57080078 3.44848633 C-7.56581543 2.66723389 -6.56083008 1.88598145 -5.52539062 1.08105469 C-2.57080078 -0.55151367 -2.57080078 -0.55151367 0 0 Z " fill="#1F4FBA" transform="translate(541.57080078125,323.551513671875)"/>
                  <path d="M0 0 C67.27358491 0 67.27358491 0 83.7421875 15.65625 C92.79062432 25.56001169 94.57799282 36.97163517 94.25 49.9921875 C93.67470332 62.09067663 89.01846993 73.71976765 80 82 C57.69784825 99.06198452 25.52203484 95 0 95 C0 63.65 0 32.3 0 0 Z " fill="#1C4AB0" transform="translate(629,508)"/>
                  <path d="M0 0 C67.06031182 0 67.06031182 0 84.28515625 16.09765625 C92.62253149 25.34663517 94.56660661 37.22340802 94.28515625 49.2890625 C93.30633052 62.02720557 88.94854015 73.11476099 79.60546875 81.95703125 C57.44658283 99.33198977 25.80137381 95 0 95 C0 63.65 0 32.3 0 0 Z " fill="#1C4AB0" transform="translate(372,508)"/>
                </svg>
                <div>
                  <h1 style="margin: 0; font-size: 28px; font-weight: bold;">Rios Roofing</h1>
                  <p style="margin: 0; font-size: 16px; opacity: 0.9;">Professional Services</p>
                </div>
              </div>
            </div>
            
            <!-- Message Content -->
            <div style="padding: 30px; background-color: #ffffff; line-height: 1.6;">
              ${N.message.replace(/\n/g,"<br>")}
            </div>
            
            <!-- Invoice Summary Section -->
            <div style="margin: 0 30px 20px 30px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
              <div style="background-color: #f8fafc; padding: 15px; border-bottom: 1px solid #e5e7eb;">
                <h3 style="margin: 0; color: #1f2937; font-size: 16px; font-weight: 600;">Invoice Summary</h3>
              </div>
              <div style="padding: 20px;">
                <table style="width: 100%; border-collapse: collapse;">
                  <tr>
                    <td style="padding: 8px 0; color: #6b7280; font-weight: 500; width: 40%;">Invoice Number:</td>
                    <td style="padding: 8px 0; color: #1f2937; font-weight: 600;">INV-${pe(t?.invoice_number||0)}</td>
                  </tr>
                  <tr>
                    <td style="padding: 8px 0; color: #6b7280; font-weight: 500;">Issue Date:</td>
                    <td style="padding: 8px 0; color: #1f2937;">${t?.issue_date?new Date(t.issue_date).toLocaleDateString():"N/A"}</td>
                  </tr>
                  <tr>
                    <td style="padding: 8px 0; color: #6b7280; font-weight: 500;">Due Date:</td>
                    <td style="padding: 8px 0; color: #1f2937;">${t?.due_date?new Date(t.due_date).toLocaleDateString():"N/A"}</td>
                  </tr>
                  ${t?.customer?`
                  <tr>
                    <td style="padding: 8px 0; color: #6b7280; font-weight: 500;">Customer:</td>
                    <td style="padding: 8px 0; color: #1f2937;">${t.customer.first_name} ${t.customer.last_name}</td>
                  </tr>
                  ${t.customer.company?`
                  <tr>
                    <td style="padding: 8px 0; color: #6b7280; font-weight: 500;">Company:</td>
                    <td style="padding: 8px 0; color: #1f2937;">${t.customer.company}</td>
                  </tr>`:""}
                  `:""}
                  ${t?.job_title?`
                  <tr>
                    <td style="padding: 8px 0; color: #6b7280; font-weight: 500;">Project:</td>
                    <td style="padding: 8px 0; color: #1f2937;">${t.job_title}</td>
                  </tr>`:""}
                  <tr style="border-top: 1px solid #e5e7eb;">
                    <td style="padding: 12px 0 8px 0; color: #6b7280; font-weight: 500;">Subtotal:</td>
                    <td style="padding: 12px 0 8px 0; color: #1f2937;">$${se(t?.subtotal||0)}</td>
                  </tr>
                  ${t?.tax_rate&&t.tax_rate>0?`
                  <tr>
                    <td style="padding: 4px 0; color: #6b7280; font-weight: 500;">Tax (${(t.tax_rate*100).toFixed(1)}%):</td>
                    <td style="padding: 4px 0; color: #1f2937;">$${se((t.subtotal||0)*(t.tax_rate||0))}</td>
                  </tr>`:""}
                  <tr style="border-top: 2px solid #2563eb;">
                    <td style="padding: 12px 0 8px 0; color: #2563eb; font-weight: 700; font-size: 16px;">Total Amount:</td>
                    <td style="padding: 12px 0 8px 0; color: #2563eb; font-weight: 700; font-size: 16px;">$${se(t?.total||0)}</td>
                  </tr>
                  ${t?.invoice_payment&&t.invoice_payment.length>0||t?.payments&&t.payments.length>0?`
                  <tr>
                    <td style="padding: 8px 0 4px 0; color: #16a34a; font-weight: 600;">Total Payments:</td>
                    <td style="padding: 8px 0 4px 0; color: #16a34a; font-weight: 600;">-$${se(G(t))}</td>
                  </tr>`:""}
                  <tr style="border-top: 1px solid #dc2626; background-color: #fef2f2;">
                    <td style="padding: 12px 8px; color: #dc2626; font-weight: 700; font-size: 18px;">Amount Due:</td>
                    <td style="padding: 12px 8px; color: #dc2626; font-weight: 700; font-size: 18px;">$${se(Z(t))}</td>
                  </tr>
                </table>
              </div>
            </div>
            
            ${t?.invoice_payment&&t.invoice_payment.length>0||t?.payments&&t.payments.length>0?`
            <!-- Payment History Section -->
            <div style="margin: 0 30px 20px 30px; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
              <div style="background-color: #f0fdf4; padding: 15px; border-bottom: 1px solid #e5e7eb;">
                <h3 style="margin: 0; color: #16a34a; font-size: 16px; font-weight: 600;">Payment History</h3>
              </div>
              <div style="padding: 20px;">
                <table style="width: 100%; border-collapse: collapse;">
                  <thead>
                    <tr style="border-bottom: 1px solid #e5e7eb;">
                      <th style="padding: 8px 0; text-align: left; color: #6b7280; font-weight: 600; font-size: 14px;">Date</th>
                      <th style="padding: 8px 0; text-align: left; color: #6b7280; font-weight: 600; font-size: 14px;">Method</th>
                      <th style="padding: 8px 0; text-align: right; color: #6b7280; font-weight: 600; font-size: 14px;">Amount</th>
                    </tr>
                  </thead>
                  <tbody>
                    ${(t?.invoice_payment||t?.payments||[]).map(C=>`
                    <tr style="border-bottom: 1px solid #f3f4f6;">
                      <td style="padding: 10px 0; color: #1f2937;">${C.date_received?new Date(C.date_received).toLocaleDateString():"N/A"}</td>
                      <td style="padding: 10px 0; color: #1f2937;">${C.payment_method||"N/A"}</td>
                      <td style="padding: 10px 0; text-align: right; color: #16a34a; font-weight: 600;">$${se(parseFloat(C.amount)||0)}</td>
                    </tr>
                    `).join("")}
                  </tbody>
                </table>
              </div>
            </div>`:""}
            
            ${y?`
            <!-- Invoice Attachment Notice -->
            <div style="background-color: #f3f4f6; padding: 20px; margin: 0 30px; border-radius: 8px; border-left: 4px solid #2563eb;">
              <h3 style="margin: 0 0 10px 0; color: #1f2937; font-size: 16px;">Invoice Attached</h3>
              <p style="margin: 0; color: #6b7280; font-size: 14px;">
                Your invoice (${f}) is attached to this email as a PDF document.
              </p>
            </div>`:""}
            
            <!-- Thank You Message -->
            <div style="margin: 20px 30px; padding: 25px; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: 8px; border-left: 4px solid #0ea5e9; text-align: center;">
              <h3 style="margin: 0 0 15px 0; color: #0c4a6e; font-size: 18px; font-weight: 600;">Thank You for Your Business!</h3>
              <p style="margin: 0 0 10px 0; color: #0369a1; font-size: 16px; line-height: 1.5;">
                We truly appreciate the opportunity to serve you with our roofing services. Your trust in Rios Roofing means the world to us.
              </p>
              <p style="margin: 0; color: #0369a1; font-size: 14px; line-height: 1.4;">
                ${t?.customer?`Thank you, ${t.customer.first_name}`:"Thank you"}, for choosing us for your roofing needs. We're committed to providing exceptional quality and service on every project.
              </p>
            </div>
            
            <!-- Footer -->
            <div style="background-color: #f9fafb; padding: 20px 30px; text-align: center; font-size: 12px; color: #6b7280; border-radius: 0 0 8px 8px;">
              <div style="border-top: 1px solid #e5e7eb; padding-top: 15px;">
                <p style="margin: 5px 0;"><strong>Rios Roofing Services</strong></p>
                <p style="margin: 5px 0;">150 Tallant St, Houston TX 77076</p>
                <p style="margin: 5px 0;">Phone: 832-310-3593 | Email: rrios.roofing@gmail.com</p>
                <p style="margin: 10px 0 5px 0; font-style: italic;">
                  This email was sent from The Roofing App
                </p>
              </div>
            </div>
          </div>
        `,textBody:N.message,attachments:y?[{filename:f,content:y,mimeType:"application/pdf"}]:void 0});M.success?(m({title:"Email Sent Successfully",description:`Invoice email ${y?"with PDF attachment ":""}has been sent to ${N.to}`,variant:"default"}),r(!1),_(C=>({...C,cc:"",message:C.message}))):m({title:"Failed to Send Email",description:M.error||"An unknown error occurred while sending the email.",variant:"destructive"})}catch(x){m({title:"Email Send Error",description:x instanceof Error?x.message:"Failed to send email",variant:"destructive"})}finally{i(!1)}},v=S&&!E,$=b!==null;return e.jsxs(pt,{open:a,onOpenChange:r,children:[e.jsx(ws,{asChild:!0,children:s||e.jsxs(j,{size:"sm",variant:"outline",disabled:!v||$,title:v?$?"Google services unavailable":"Email invoice":"Loading Google services...",children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),"Email Invoice"]})}),e.jsxs(at,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(rt,{children:[e.jsx(nt,{children:"Email Invoice"}),e.jsxs(ot,{children:["Send invoice INV-",pe(t?.invoice_number||0)," to your customer via email. The invoice PDF will be automatically attached to the email."]})]}),$&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-3 mb-4",children:[e.jsxs("p",{className:"text-sm text-red-800",children:[e.jsx("strong",{children:"Service Error:"})," ",b]}),e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Please ensure you have granted Gmail permissions when signing in with Google."})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs(ae,{className:"text-left flex items-center gap-2",children:[e.jsx(mt,{className:"w-4 h-4"}),"Email Template"]}),e.jsxs(Ce,{value:o,onValueChange:L,children:[e.jsx(Ne,{className:"w-full py-6",children:e.jsx(_e,{placeholder:"Select an email template"})}),e.jsx(Ye,{children:p.map(x=>e.jsx(et,{value:x.id,children:e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"font-medium",children:x.name}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x.description})]})},x.id))})]}),e.jsxs("div",{className:"text-sm text-muted-foreground bg-muted/50 p-3 rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Template: "}),g.description]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(ae,{className:"text-sm font-medium",children:"PDF Display Options"}),e.jsxs("div",{className:"space-y-3 p-4 bg-muted/30 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ut,{id:"showPaymentHistory",checked:c.showPaymentHistory,onCheckedChange:()=>h("showPaymentHistory")}),e.jsx(ae,{htmlFor:"showPaymentHistory",className:"text-sm font-normal cursor-pointer",children:"Show payment history"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ut,{id:"showCustomerNotes",checked:c.showCustomerNotes,onCheckedChange:()=>h("showCustomerNotes")}),e.jsx(ae,{htmlFor:"showCustomerNotes",className:"text-sm font-normal cursor-pointer",children:"Show customer notes"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ut,{id:"showPaymentInformation",checked:c.showPaymentInformation,onCheckedChange:()=>h("showPaymentInformation")}),e.jsx(ae,{htmlFor:"showPaymentInformation",className:"text-sm font-normal cursor-pointer",children:"Show payment information"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"These options control what information is included in the PDF attachment."})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(ae,{htmlFor:"to",className:"text-left",children:"To *"}),e.jsx(Q,{id:"to",placeholder:"customer@example.com",value:N.to,onChange:x=>F("to",x.target.value),className:"w-full"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(ae,{htmlFor:"cc",className:"text-left",children:"CC"}),e.jsx(Q,{id:"cc",placeholder:"Optional - separate multiple emails with commas",value:N.cc,onChange:x=>F("cc",x.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(ae,{htmlFor:"subject",className:"text-left",children:"Subject *"}),e.jsx(Q,{id:"subject",value:N.subject,onChange:x=>F("subject",x.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(ae,{htmlFor:"message",className:"text-left pt-2",children:"Message *"}),e.jsx(Ae,{id:"message",rows:12,value:N.message,onChange:x=>F("message",x.target.value),className:"col-span-3 resize-none"})]})]}),e.jsxs(ft,{children:[e.jsx(j,{variant:"outline",onClick:()=>r(!1),disabled:n,children:"Cancel"}),e.jsx(j,{onClick:oe,disabled:n||!v||$,children:n?e.jsxs(e.Fragment,{children:[e.jsx(Yt,{className:"w-4 h-4 mr-2 animate-spin"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Is,{className:"w-4 h-4 mr-2"}),"Send Email"]})})]})]})]})},Yh=({invoice:t,trigger:s})=>{const[a,r]=d.useState(!1),[n,i]=d.useState(!0),[o,l]=d.useState({showPaymentHistory:!0,showCustomerNotes:!0,showPaymentInformation:!0});if(d.useEffect(()=>{if(a){const p=setTimeout(()=>{i(!1)},1500);return()=>clearTimeout(p)}else i(!0)},[a]),!t||!t.customer)return s;const c=p=>p.toString().padStart(4,"0"),u=()=>{const p=c(t.invoice_number||0),g=t.customer?`${t.customer.first_name}_${t.customer.last_name}`.replace(/\s+/g,"_"):"Unknown_Customer";return`INV-${p}_${g}.pdf`},h=p=>{l(g=>({...g,[p]:!g[p]}))};return e.jsxs(pt,{open:a,onOpenChange:r,children:[e.jsx(ws,{asChild:!0,children:s}),e.jsxs(at,{className:"w-full h-full max-w-full max-h-full p-0 sm:max-w-6xl sm:max-h-[95vh] sm:p-6 flex flex-col sm:rounded-lg",children:[e.jsxs(rt,{className:"flex-shrink-0 p-6 sm:p-0",children:[e.jsxs(nt,{className:"flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5 text-blue-600"}),"Invoice PDF Preview"]}),e.jsxs(ot,{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Preview and download invoice INV-",c(t.invoice_number||0)]}),e.jsx(de,{variant:"outline",className:"ml-2",children:t.customer?`${t.customer.first_name} ${t.customer.last_name}`:"Unknown Customer"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 sm:px-0",children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border",children:[e.jsx("h3",{className:"text-sm font-medium mb-3 text-gray-900 dark:text-gray-100",children:"PDF Display Options"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ut,{checked:o.showPaymentHistory,onCheckedChange:()=>h("showPaymentHistory")}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show Payment History"}),o.showPaymentHistory&&e.jsx(Ge,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ut,{checked:o.showCustomerNotes,onCheckedChange:()=>h("showCustomerNotes")}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show Customer Notes"}),o.showCustomerNotes&&e.jsx(Ge,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ut,{checked:o.showPaymentInformation,onCheckedChange:()=>h("showPaymentInformation")}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show Payment Information"}),o.showPaymentInformation&&e.jsx(Ge,{className:"w-4 h-4 text-green-600"})]})]})]}),e.jsxs("div",{className:"min-h-[500px] relative border-0 sm:border border-gray-200 sm:rounded-lg overflow-hidden bg-gray-50 mb-4",children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50 z-10",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(ns,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading PDF preview..."})]})}),e.jsx(xn,{width:"100%",height:"500px",className:"border-0",children:e.jsx(Ja,{invoice:t,displayOptions:o})})]})]}),e.jsxs(ft,{className:"flex-shrink-0 flex flex-row justify-between items-center pt-4 border-t px-6 sm:px-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(mt,{className:"w-4 h-4"}),e.jsxs("span",{children:["File: ",u()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",onClick:()=>r(!1),children:[e.jsx(Ms,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsx(hn,{document:e.jsx(Ja,{invoice:t,displayOptions:o}),fileName:u(),children:({loading:p})=>e.jsx(j,{disabled:p,className:"bg-blue-600 hover:bg-blue-700",children:p?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"w-4 h-4 mr-2 animate-spin"}),"Preparing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ya,{className:"w-4 h-4 mr-2"}),"Download PDF"]})})})]})]})]})]})};function Xh(){const{id:t}=tr(),{toast:s}=ss(),a=fe(),[r,n]=le.useState(!1),[i,o]=le.useState(!1),[l,c]=le.useState(null),[u,h]=le.useState({amount:"",payment_method:"",date_received:new Date().toISOString().split("T")[0]}),[p,g]=le.useState({amount:"",payment_method:"",date_received:new Date().toISOString().split("T")[0]}),N=t?parseInt(t,10):null,_=N!==null&&!isNaN(N)&&N>0,{data:m,isLoading:R,isError:S}=ri(_?N:null),{data:E,isLoading:b}=jr(),{mutate:O,isLoading:F}=Hu(s),{mutate:L,isLoading:H}=ji(s),{mutate:ne,isLoading:G}=qm(s);if(!_)return e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg text-red-500",children:"Invalid invoice number in URL"})})});if(R)return e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg",children:"Loading invoice..."})})});if(S||!m)return e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg text-red-500",children:"Error loading invoice or invoice not found"})})});const Z=m.invoice_line_service?.reduce((B,Se)=>B+(Se.amount||0),0)||0,oe=m.invoice_payment?.reduce((B,Se)=>B+(Se.amount||0),0)||0,v=Z-oe,$=B=>{switch(B?.toLowerCase()){case"paid":return"green";case"pending":return"yellow";case"overdue":return"red";default:return"gray"}},x=B=>{m?.invoice_number&&O({status_id:parseInt(B,10),invoice_number:m.invoice_number},{onSuccess:()=>{a.invalidateQueries({queryKey:["invoiceById",N]}),a.invalidateQueries({queryKey:["invoices"]})}})},y=(B,Se)=>{h(Cs=>({...Cs,[B]:Se}))},f=(B,Se)=>{g(Cs=>({...Cs,[B]:Se}))},M=()=>{if(!m?.invoice_number)return;if(!u.amount||!u.payment_method||!u.date_received){s({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});return}const B=parseFloat(u.amount);if(isNaN(B)||B<=0){s({title:"Validation Error",description:"Please enter a valid payment amount.",variant:"destructive"});return}L({invoice_id:m.invoice_number,amount:B,payment_method:u.payment_method,date_received:u.date_received},{onSuccess:()=>{h({amount:"",payment_method:"",date_received:new Date().toISOString().split("T")[0]}),a.invalidateQueries({queryKey:["invoiceById",N]}),n(!1)}})},C=()=>{n(!1),h({amount:"",payment_method:"",date_received:new Date().toISOString().split("T")[0]})},W=()=>{o(!1),c(null),g({amount:"",payment_method:"",date_received:new Date().toISOString().split("T")[0]})},ge=B=>{c(B.id),g({amount:B.amount.toString(),payment_method:B.payment_method||"",date_received:B.date_received?new Date(B.date_received).toISOString().split("T")[0]:new Date().toISOString().split("T")[0]}),o(!0)},je=B=>{window.confirm("Are you sure you want to delete this payment? This action cannot be undone.")&&ne({item_id:B},{onSuccess:()=>{a.invalidateQueries({queryKey:["invoiceById",N]})}})},Qe=()=>{if(!m?.invoice_number||!l)return;if(!p.amount||!p.payment_method||!p.date_received){s({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});return}const B=parseFloat(p.amount);if(isNaN(B)||B<=0){s({title:"Validation Error",description:"Please enter a valid payment amount.",variant:"destructive"});return}ne({item_id:l},{onSuccess:()=>{a.invalidateQueries({queryKey:["invoiceById",N]}),L({invoice_id:m.invoice_number,amount:B,payment_method:p.payment_method,date_received:p.date_received},{onSuccess:()=>{g({amount:"",payment_method:"",date_received:new Date().toISOString().split("T")[0]}),c(null),a.invalidateQueries({queryKey:["invoiceById",N]}),o(!1),s({title:"Payment Updated",description:"Payment has been successfully updated.",variant:"default"})},onError:Se=>{s({title:"Error Creating Payment",description:`Failed to create the updated payment: ${Se.message}`,variant:"destructive"})}})},onError:Se=>{s({title:"Error Deleting Payment",description:`Failed to delete the original payment: ${Se.message}`,variant:"destructive"})}})};return e.jsxs("div",{className:"w-full mx-auto py-4",children:[e.jsx("div",{className:"pt-1 pb-2",children:e.jsx(qa,{currentPage:`Invoice #${pe(m.invoice_number||0)}`,parentPages:[{label:"Invoices",href:"/invoices"}],homeHref:"/"})}),e.jsxs("div",{className:"flex justify-between gap-4 mb-2 pb-2",children:[e.jsxs("div",{className:"w-full flex gap-2 mt-auto",children:[e.jsx(yi,{invoice:m,trigger:e.jsx(j,{size:"icon",variant:"secondary",children:e.jsx($t,{className:"w-[16px]"})})}),e.jsx(j,{size:"icon",variant:"secondary",onClick:()=>window.print(),title:"Print invoice",children:e.jsx(Un,{className:"w-[16px]"})}),e.jsx(Yh,{invoice:Yi(m),trigger:e.jsx(j,{size:"icon",variant:"secondary",title:"Download PDF",children:e.jsx(ya,{className:"w-[16px]"})})}),e.jsx(Gh,{invoice:m,trigger:e.jsx(j,{size:"icon",variant:"secondary",title:"Email invoice",children:e.jsx(Ba,{className:"w-[16px]"})})})]}),e.jsx("div",{className:"w-full flex justify-end gap-4",children:e.jsxs("div",{className:"w-fit",children:[e.jsx(ae,{children:"Status"}),e.jsxs(Ce,{value:m?.invoice_status_id?.toString()||"",onValueChange:x,disabled:F||b,children:[e.jsx(Ne,{className:"w-[180px]",children:e.jsx(_e,{placeholder:F?"Updating...":"Select a status"})}),e.jsx(Ye,{position:"popper",children:e.jsxs(ko,{children:[e.jsx(xr,{children:"Invoice Status"}),E?.map(B=>e.jsx(et,{value:B.id.toString(),children:B.name},B.id))]})})]})]})})]}),e.jsxs("div",{className:"w-full flex lg:flex-row flex-col gap-4",children:[e.jsxs(Y,{className:"dark:bg-zinc-900 w-full",children:[e.jsx(re,{children:e.jsxs("div",{className:"w-full flex flex-col sm:flex-row sm:justify-between md:px-6 md:pt-5",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-[50px] h-max bg-blue-600 rounded-2xl transition ease-in-out duration-300 hover:scale-105",children:e.jsx(Pe,{to:"/",children:e.jsx("img",{src:"/company-logo.png",className:"shadow-xs p-[0px] rounded-2xl"})})}),e.jsxs("div",{className:"text-md sm:text-lg font-semibold text-gray-700 dark:text-zinc-100",children:[e.jsx("p",{className:"",children:"Rios Roofing"}),e.jsx("p",{className:"-mt-2",children:"Services"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:text-right",children:[e.jsx(de,{className:"w-fit mt-6 sm:mt-0 sm:ml-auto",variant:$(m.invoice_status?.name||""),children:m.invoice_status?.name||"Unknown"}),e.jsxs("p",{className:"text-lg font-medium",children:["INV-",pe(m.invoice_number||0)]})]})]})}),e.jsx(X,{children:e.jsxs("div",{className:"flex flex-col sm:px-6 pb-6 w-full",children:[e.jsxs("div",{className:"flex w-full justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Us,{className:"w-4 h-4 my-auto"}),e.jsx("p",{className:"text-sm text-gray-500 align-middle",children:"Customer"})]}),e.jsx("div",{className:"flex my-2 pt-1 pb-2 gap-4",children:e.jsxs(Pe,{to:`/customers/${m.customer_id}`,className:"cursor-pointer hover:opacity-80 transition-opacity flex gap-4",title:"View customer details",children:[e.jsx(Rt,{children:e.jsx(kt,{children:`${(m.customer?.first_name||"").substring(0,1)}${(m.customer?.last_name||"").substring(0,1)}`})}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium",children:[m.customer?.first_name||""," ",m.customer?.last_name||""]}),e.jsx("p",{className:"font-light",children:m.customer?.email||""})]})]})})]}),e.jsxs("div",{className:"text-sm text-right",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Qn,{className:"w-4 h-4 my-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mb-0",children:"Service"})]}),e.jsx("p",{className:"font-medium",children:m.service?.name||"Unknown Service"})]})]}),e.jsxs("div",{className:"w-full flex flex-col sm:flex-row justify-between gap-4 py-2",children:[e.jsxs("div",{className:"w-full text-left",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Invoice From"}),e.jsx("p",{className:"mb-1 font-medium",children:"Rios Roofing"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:"150 Tallant St, Houston TX 77076"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:"rrios.roofing@gmail.com"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:"832-310-3593"}),e.jsxs("div",{className:"my-6 text-left",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Date Create"}),e.jsx("p",{className:"font-medium",children:m.invoice_date?wt(m.invoice_date):"N/A"})]})]}),e.jsxs("div",{className:"w-full text-left",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Invoice To"}),e.jsxs("p",{className:"mb-1 font-medium",children:[m.customer?.first_name||""," ",m.customer?.last_name||""]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:[m.bill_to_street_address||m.customer?.street_address||"",m.bill_to_city||m.customer?.city?`, ${m.bill_to_city||m.customer?.city}`:"",m.bill_to_state||m.customer?.state?`, ${m.bill_to_state||m.customer?.state}`:""," ",m.bill_to_zipcode||m.customer?.zipcode||""]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:m.customer?.email||""}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:m.customer?.phone_number||""}),e.jsxs("div",{className:"text-left my-6",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Due Date"}),e.jsx("p",{className:"font-medium",children:m.due_date?wt(m.due_date):"N/A"})]})]})]}),e.jsx("div",{className:"overflow-hidden border border-gray-200 dark:border-zinc-800 rounded-lg",children:e.jsxs(is,{children:[e.jsx(ls,{className:"bg-gray-50 dark:bg-zinc-800",children:e.jsxs(We,{children:[e.jsx(he,{className:"w-[100px]",children:"#"}),e.jsx(he,{children:"Description"}),e.jsx(he,{className:"text-right",children:"Qty"}),e.jsx(he,{className:"text-right",children:"Rate"}),e.jsx(he,{className:"text-right",children:"Total"})]})}),e.jsx(cs,{children:m.invoice_line_service?.map((B,Se)=>e.jsxs(We,{children:[e.jsx(ue,{children:Se+1}),e.jsx(ue,{children:e.jsx("p",{className:"font-medium",children:B.description||"No description"})}),e.jsx(ue,{className:"text-right",children:B.qty||0}),e.jsx(ue,{className:"text-right",children:B.rate?`$${se(B.rate)}`:"Fixed"}),e.jsxs(ue,{className:"text-right",children:["$",se(B.amount||0)]})]},B.id))||e.jsx(We,{children:e.jsx(ue,{colSpan:5,className:"text-center text-gray-500",children:"No line items found"})})})]})}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs("div",{className:"w-72 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["$",se(Z)]})]}),e.jsxs("div",{className:"flex justify-between text-base border-t border-gray-200 dark:border-gray-700 pt-2",children:[e.jsx("span",{className:"font-semibold",children:"Total"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["$",se(m.total||Z)]})]})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"text-sm font-medium",children:"NOTES"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:m.public_note||m.cust_note||"No customer notes added"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-10 text-sm text-gray-600",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx("p",{children:"Have a Question?"}),e.jsx("a",{href:"mailto:rrios.roofing@gmail.com",className:"text-blue-600",children:"rrios.roofing@gmail.com"})]})]})]})})]}),e.jsx(Y,{className:"w-full lg:w-1/3 h-fit",children:e.jsx(X,{children:e.jsxs("div",{className:"flex flex-col sm:px-0 pb-6 w-full",children:[e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"text-sm font-medium my-4",children:"Payment Information"}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 font-medium",children:"Amount Due"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:["$",se(v)]})]}),e.jsx(de,{variant:v<=0?"green":"yellow",className:"text-sm",children:v<=0?"Fully Paid":"Payment Due"})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs(pt,{open:r,onOpenChange:n,children:[e.jsx(ws,{asChild:!0,children:e.jsxs(j,{size:"sm",variant:"secondary",children:[e.jsx($n,{className:"w-[16px] mr-2"}),"Record Payment"]})}),e.jsxs(at,{className:"sm:max-w-[500px]",children:[e.jsxs(rt,{children:[e.jsxs(nt,{children:["Record Payment for INV-",pe(m.invoice_number||0)]}),e.jsxs(ot,{children:["Add a new payment for this invoice. Outstanding balance: $",se(v)]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ae,{htmlFor:"amount",className:"text-right",children:"Amount *"}),e.jsxs("div",{className:"col-span-3 relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"$"}),e.jsx(Q,{id:"amount",type:"number",step:"0.01",min:"0",max:v>0?v:void 0,placeholder:"0.00",value:u.amount,onChange:B=>y("amount",B.target.value),className:"pl-8"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ae,{htmlFor:"payment_method",className:"text-right",children:"Payment Method *"}),e.jsx(Q,{id:"payment_method",placeholder:"e.g., Cash, Check, Credit Card, Bank Transfer",value:u.payment_method,onChange:B=>y("payment_method",B.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ae,{htmlFor:"date_received",className:"text-right",children:"Date Received *"}),e.jsx(Q,{id:"date_received",type:"date",value:u.date_received,onChange:B=>y("date_received",B.target.value),className:"col-span-3"})]})]}),e.jsxs(ft,{children:[e.jsx(j,{variant:"outline",onClick:C,children:"Cancel"}),e.jsx(j,{onClick:M,disabled:H,children:H?"Recording...":"Record Payment"})]})]})]}),e.jsx(pt,{open:i,onOpenChange:o,children:e.jsxs(at,{className:"sm:max-w-[500px]",children:[e.jsxs(rt,{children:[e.jsxs(nt,{children:["Edit Payment for INV-",pe(m.invoice_number||0)]}),e.jsx(ot,{children:"Update the payment details below."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ae,{htmlFor:"edit_amount",className:"text-right",children:"Amount *"}),e.jsxs("div",{className:"col-span-3 relative",children:[e.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"$"}),e.jsx(Q,{id:"edit_amount",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:p.amount,onChange:B=>f("amount",B.target.value),className:"pl-8"})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ae,{htmlFor:"edit_payment_method",className:"text-right",children:"Payment Method *"}),e.jsx(Q,{id:"edit_payment_method",placeholder:"e.g., Cash, Check, Credit Card, Bank Transfer",value:p.payment_method,onChange:B=>f("payment_method",B.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(ae,{htmlFor:"edit_date_received",className:"text-right",children:"Date Received *"}),e.jsx(Q,{id:"edit_date_received",type:"date",value:p.date_received,onChange:B=>f("date_received",B.target.value),className:"col-span-3"})]})]}),e.jsxs(ft,{children:[e.jsx(j,{variant:"outline",onClick:W,children:"Cancel"}),e.jsx(j,{onClick:Qe,disabled:H||G,children:H||G?"Updating...":"Update Payment"})]})]})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-gray-700 dark:text-gray-300",children:"Payment History"}),m.invoice_payment&&m.invoice_payment.length>0?e.jsxs(e.Fragment,{children:[m.invoice_payment.map((B,Se)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 dark:bg-gray-800 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center",children:e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:["Payment #",Se+1]}),e.jsx("p",{className:"text-xs text-gray-500",children:B.payment_method||"Payment"})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-green-600",children:["+$",se(B.amount||0)]}),e.jsx("p",{className:"text-xs text-gray-500",children:B.date_received?wt(B.date_received):"N/A"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(j,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0",onClick:()=>ge(B),disabled:G,title:"Edit payment",children:e.jsx(ga,{className:"h-3 w-3"})}),e.jsx(j,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-500 hover:text-red-700",onClick:()=>je(B.id),disabled:G,title:"Delete payment",children:e.jsx(Fn,{className:"h-3 w-3"})})]})]})]},B.id)),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:"Total Payments"}),e.jsxs("span",{className:"font-bold text-green-600 text-lg",children:["$",se(oe)]})]})]}):e.jsx("div",{className:"text-center py-4 text-gray-500",children:"No payments recorded yet"})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium my-4",children:"Private Note"}),e.jsx(Ae,{value:m.private_note||"",placeholder:"No private notes added",readOnly:!0})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium my-4",children:"Measurement Note"}),e.jsx(Ae,{value:m.sqft_measurement||"",placeholder:"No measurement notes added",readOnly:!0})]})]})})})]})]})}const V=es.create({page:{fontSize:9,paddingTop:25,paddingLeft:30,paddingRight:30,paddingBottom:25,backgroundColor:"#ffffff",fontFamily:"Helvetica",lineHeight:1.3},headerContainer:{flexDirection:"row",justifyContent:"space-between",alignItems:"flex-start",marginBottom:15,paddingBottom:12,borderBottomWidth:1,borderBottomColor:"#e5e7eb"},logoSection:{flexDirection:"column",alignItems:"flex-start"},logo:{width:40,height:40,marginBottom:6,borderRadius:6},companyName:{fontSize:14,fontWeight:"bold",color:"#1f2937",marginBottom:2},companyTagline:{fontSize:8,color:"#6b7280",fontStyle:"italic"},quoteSection:{flexDirection:"column",alignItems:"flex-end"},quoteTitle:{fontSize:22,fontWeight:"bold",color:"#1f2937",marginBottom:14,letterSpacing:.5},container:{flexDirection:"row",justifyContent:"space-between",marginBottom:15},section:{width:"48%"},sectionTitle:{fontSize:9,fontWeight:"bold",color:"#374151",marginBottom:4,textTransform:"uppercase",letterSpacing:.3},infoBox:{backgroundColor:"#f9fafb",padding:8,borderRadius:4,borderLeftWidth:2,borderLeftColor:"#3b82f6"},table:{borderWidth:1,borderColor:"#e5e7eb",borderRadius:4,marginBottom:15},tableHeader:{flexDirection:"row",backgroundColor:"#f3f4f6",borderBottomWidth:1,borderBottomColor:"#e5e7eb",paddingVertical:6,paddingHorizontal:8},tableRow:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#f3f4f6",paddingVertical:6,paddingHorizontal:8},summaryContainer:{flexDirection:"row",justifyContent:"flex-end",marginBottom:15},summaryBox:{width:"45%",backgroundColor:"#f9fafb",borderRadius:4,borderWidth:1,borderColor:"#e5e7eb"},summaryRow:{flexDirection:"row",justifyContent:"space-between",paddingVertical:4,paddingHorizontal:10,borderBottomWidth:1,borderBottomColor:"#f3f4f6"},totalRow:{backgroundColor:"#dbeafe",borderBottomWidth:0,borderTopWidth:2,borderTopColor:"#3b82f6"},text:{fontSize:8,color:"#1f2937"},labelText:{fontSize:8,color:"#374151"},totalText:{fontSize:9,color:"#1e40af",fontWeight:"bold"}}),er=({quote:t,displayOptions:s={showServiceDetails:!0,showMeasurementNote:!0,showCustomerNotes:!0}})=>{const a=o=>o==null?"$0.00":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(o),n=t.custom_address&&t.custom_street_address?{street:t.custom_street_address,city:t.custom_city,state:t.custom_state,zipcode:t.custom_zipcode}:{street:t.customer?.street_address,city:t.customer?.city,state:t.customer?.state,zipcode:t.customer?.zipcode},i=t.quote_line_item&&t.quote_line_item.length>0;return e.jsx(dn,{children:e.jsxs(un,{size:"A4",style:V.page,children:[e.jsxs(K,{style:V.headerContainer,children:[e.jsxs(K,{style:V.logoSection,children:[e.jsx(cn,{style:V.logo,src:"/public/company-logo.png"}),e.jsx(T,{style:V.companyName,children:"RIOS ROOFING"}),e.jsx(T,{style:V.companyTagline,children:"Professional Roofing Services"})]}),e.jsxs(K,{style:V.quoteSection,children:[e.jsx(T,{style:V.quoteTitle,children:"QUOTE"}),e.jsxs(T,{style:V.text,children:["Quote #: QT-",pe(t.quote_number||0)]}),e.jsxs(T,{style:V.text,children:["Date: ",os(t.quote_date)]}),e.jsxs(T,{style:V.text,children:["Expires: ",os(t.expiration_date)]}),t.service&&e.jsxs(T,{style:[V.text,{marginTop:4,fontWeight:"bold",color:"#0c4a6e"}],children:["Service: ",t.service.name]})]})]}),e.jsxs(K,{style:V.container,children:[e.jsxs(K,{style:V.section,children:[e.jsx(T,{style:V.sectionTitle,children:"Quote From"}),e.jsxs(K,{style:V.infoBox,children:[e.jsx(T,{style:V.text,children:"RIOS ROOFING"}),e.jsx(T,{style:V.text,children:"150 Tallant St"}),e.jsx(T,{style:V.text,children:"Houston, TX 77076"}),e.jsx(T,{style:V.text,children:"Phone: 832-310-3593"}),e.jsx(T,{style:V.text,children:"Email: rrios.roofing@gmail.com"})]})]}),e.jsxs(K,{style:V.section,children:[e.jsx(T,{style:V.sectionTitle,children:"Quote To"}),e.jsxs(K,{style:V.infoBox,children:[e.jsxs(T,{style:V.text,children:[t.customer?.first_name," ",t.customer?.last_name]}),e.jsx(T,{style:V.text,children:n.street}),e.jsxs(T,{style:V.text,children:[n.city,", ",n.state," ",n.zipcode]}),e.jsxs(T,{style:V.text,children:["Phone: ",t.customer?.phone_number]}),e.jsxs(T,{style:V.text,children:["Email: ",t.customer?.email]})]})]})]}),e.jsxs(K,{children:[e.jsx(T,{style:V.sectionTitle,children:"Quote Items"}),e.jsxs(K,{style:V.table,children:[e.jsxs(K,{style:V.tableHeader,children:[e.jsx(T,{style:[V.labelText,{flex:3}],children:"Description"}),e.jsx(T,{style:[V.labelText,{flex:1,textAlign:"center"}],children:"Qty"}),e.jsx(T,{style:[V.labelText,{flex:1.2,textAlign:"right"}],children:"Rate"}),e.jsx(T,{style:[V.labelText,{flex:1.2,textAlign:"right"}],children:"Amount"})]}),i?t.quote_line_item.map((o,l)=>e.jsxs(K,{style:V.tableRow,children:[e.jsx(T,{style:[V.text,{flex:3}],children:o.description}),e.jsx(T,{style:[V.text,{flex:1,textAlign:"center"}],children:o.qty}),e.jsx(T,{style:[V.text,{flex:1.2,textAlign:"right"}],children:o.fixed_item?"Fixed":a(o.rate)}),e.jsx(T,{style:[V.text,{flex:1.2,textAlign:"right"}],children:a(o.amount)})]},l)):e.jsxs(K,{style:V.tableRow,children:[e.jsx(T,{style:[V.text,{flex:3}],children:t.service?.name||"Roofing Service"}),e.jsx(T,{style:[V.text,{flex:1,textAlign:"center"}],children:"1"}),e.jsx(T,{style:[V.text,{flex:1.2,textAlign:"right"}],children:"Fixed"}),e.jsx(T,{style:[V.text,{flex:1.2,textAlign:"right"}],children:a(t.total)})]})]})]}),e.jsx(K,{style:V.summaryContainer,children:e.jsxs(K,{style:V.summaryBox,children:[e.jsxs(K,{style:V.summaryRow,children:[e.jsx(T,{style:V.labelText,children:"Subtotal:"}),e.jsx(T,{style:V.text,children:a(t.subtotal)})]}),e.jsxs(K,{style:[V.summaryRow,V.totalRow],children:[e.jsx(T,{style:V.totalText,children:"Quote Total:"}),e.jsx(T,{style:V.totalText,children:a(t.total)})]})]})}),s.showCustomerNotes&&(t.public_note||t.cust_note)&&e.jsxs(K,{style:{marginBottom:15},children:[e.jsx(T,{style:V.sectionTitle,children:"Customer Notes"}),e.jsxs(K,{style:V.infoBox,children:[t.public_note&&e.jsx(K,{style:{marginBottom:4},children:e.jsx(T,{style:V.text,children:t.public_note})}),t.cust_note&&e.jsx(K,{style:{marginBottom:4},children:e.jsx(T,{style:V.text,children:t.cust_note})})]})]}),s.showMeasurementNote&&t.measurement_note&&e.jsxs(K,{style:{marginBottom:15},children:[e.jsx(T,{style:V.sectionTitle,children:"Measurement Notes"}),e.jsx(K,{style:V.infoBox,children:e.jsx(T,{style:V.text,children:t.measurement_note})})]}),s.showServiceDetails&&t.service?.name==="Roof Installation"&&e.jsxs(K,{style:{marginBottom:15},children:[e.jsx(T,{style:V.sectionTitle,children:"Service Details"}),e.jsxs(K,{style:V.infoBox,children:[e.jsx(T,{style:[V.text,{fontWeight:"bold",marginBottom:4,color:"#374151"}],children:"Roof Installation includes:"}),e.jsxs(K,{style:{marginBottom:8},children:[e.jsx(T,{style:V.text,children:"• 30 year rated roofing shingles"}),e.jsx(T,{style:V.text,children:"• Synthetic Roofing Underlayment"}),e.jsx(T,{style:V.text,children:"• Ridge vents & ridge caps"}),e.jsx(T,{style:V.text,children:"• New 2x2 dripedge installation"}),e.jsx(T,{style:V.text,children:"• All New base lead jacks."}),e.jsx(T,{style:V.text,children:"• New valley (if applicable)"}),e.jsx(T,{style:V.text,children:"• Up to 3 sheets of new plywood ($85 per extra sheet)"}),e.jsx(T,{style:V.text,children:"• Labor to install new shingles (6 nail for secure hold against storms)"}),e.jsx(T,{style:V.text,children:"• Cleaning Debris"})]}),e.jsx(T,{style:[V.text,{fontStyle:"italic",color:"#374151",lineHeight:1.4}],children:"In order to initiate the roofing process promptly, we kindly request a down payment of 50% of the total quoted amount, which will be allocated towards the procurement of necessary materials."})]})]}),e.jsxs(K,{style:{marginTop:"auto",borderTopWidth:1,borderTopColor:"#e5e7eb",paddingTop:10},children:[e.jsx(T,{style:[V.text,{textAlign:"center",color:"#3b82f6"}],children:"Thank you for considering us! To accept this quote, please contact us at 832-310-3593."}),e.jsx(T,{style:[V.text,{textAlign:"center",marginTop:5}],children:"RIOS ROOFING • 150 Tallant St, Houston TX 77076 • rrios.roofing@gmail.com"})]})]})})},Zh=({quote:t,trigger:s})=>{const[a,r]=d.useState(!1),[n,i]=d.useState(!0),[o,l]=d.useState({showServiceDetails:!0,showMeasurementNote:!0,showCustomerNotes:!0});if(d.useEffect(()=>{if(a){const h=setTimeout(()=>{i(!1)},1500);return()=>clearTimeout(h)}else i(!0)},[a]),!t||!t.customer)return s;const c=()=>{const h=pe(t.quote_number||0),p=t.customer?`${t.customer.first_name}_${t.customer.last_name}`.replace(/\s+/g,"_"):"Unknown_Customer";return`QT-${h}_${p}.pdf`},u=h=>{l(p=>({...p,[h]:!p[h]}))};return e.jsxs(pt,{open:a,onOpenChange:r,children:[e.jsx(ws,{asChild:!0,children:s}),e.jsxs(at,{className:"w-full h-full max-w-full max-h-full p-0 sm:max-w-6xl sm:max-h-[95vh] sm:p-6 flex flex-col sm:rounded-lg",children:[e.jsxs(rt,{className:"flex-shrink-0 p-6 sm:p-0",children:[e.jsxs(nt,{className:"flex items-center gap-2",children:[e.jsx(mt,{className:"w-5 h-5 text-blue-600"}),"Quote PDF Preview"]}),e.jsxs(ot,{className:"flex items-center gap-2",children:[e.jsxs("span",{children:["Preview and download quote QT-",pe(t.quote_number||0)]}),e.jsx(de,{variant:"outline",className:"ml-2",children:t.customer?`${t.customer.first_name} ${t.customer.last_name}`:"Unknown Customer"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-6 sm:px-0",children:[e.jsxs("div",{className:"mb-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border",children:[e.jsx("h3",{className:"text-sm font-medium mb-3 text-gray-900 dark:text-gray-100",children:"PDF Display Options"}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ut,{checked:o.showServiceDetails,onCheckedChange:()=>u("showServiceDetails")}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show Service Details"}),o.showServiceDetails&&e.jsx(Ge,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ut,{checked:o.showMeasurementNote,onCheckedChange:()=>u("showMeasurementNote")}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show Measurement Notes"}),o.showMeasurementNote&&e.jsx(Ge,{className:"w-4 h-4 text-green-600"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(ut,{checked:o.showCustomerNotes,onCheckedChange:()=>u("showCustomerNotes")}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Show Customer Notes"}),o.showCustomerNotes&&e.jsx(Ge,{className:"w-4 h-4 text-green-600"})]})]})]}),e.jsxs("div",{className:"min-h-[500px] relative border-0 sm:border border-gray-200 sm:rounded-lg overflow-hidden bg-gray-50 mb-4",children:[n&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50 z-10",children:e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx(ns,{className:"w-8 h-8 animate-spin text-blue-600"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading PDF preview..."})]})}),e.jsx(xn,{width:"100%",height:"500px",className:"border-0",children:e.jsx(er,{quote:t,displayOptions:o})})]})]}),e.jsxs(ft,{className:"flex-shrink-0 flex flex-row justify-between items-center pt-4 border-t px-6 sm:px-0",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(mt,{className:"w-4 h-4"}),e.jsxs("span",{children:["File: ",c()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{variant:"outline",onClick:()=>r(!1),children:[e.jsx(Ms,{className:"w-4 h-4 mr-2"}),"Cancel"]}),e.jsx(hn,{document:e.jsx(er,{quote:t,displayOptions:o}),fileName:c(),children:({loading:h})=>e.jsx(j,{disabled:h,className:"bg-blue-600 hover:bg-blue-700",children:h?e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"w-4 h-4 mr-2 animate-spin"}),"Preparing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ya,{className:"w-4 h-4 mr-2"}),"Download PDF"]})})})]})]})]})]})};typeof Zs>"u"&&(globalThis.Buffer=(await pl(async()=>{const{Buffer:t}=await import("./pdf-renderer-vFrxe4Hr.js").then(s=>s.i);return{Buffer:t}},__vite__mapDeps([0,1,2]))).Buffer);const Jh=t=>[{id:"standard",name:"Standard Quote",description:"Standard quote submission for customer review",subject:`Quote QT-${pe(t?.quote_number||0)} from Rios Roofing - Your Roofing Estimate`,message:`Dear ${t?.customer?.first_name||"Customer"},

      Thank you for your interest in Rios Roofing services! We're pleased to present your personalized roofing quote as requested.

      Please find your detailed quote attached to this email. This quote includes a comprehensive breakdown of all materials, labor, and services required for your roofing project.

      Key Quote Details:
      • Quote expires on: ${t?.expiration_date?new Date(t.expiration_date).toLocaleDateString():"Please see attached quote"}
      • Service: ${t?.service?.name||"Roofing Service"}
      ${t?.total?`• Total Amount: ${se(t.total)}`:""}

      We believe this quote provides excellent value and reflects our commitment to quality workmanship and premium materials. Our experienced team is ready to transform your roofing project with the same dedication that has made us a trusted name in the Houston area.

      To accept this quote or if you have any questions about the scope of work, materials, or timeline, please don't hesitate to contact us. We're here to help make your roofing project a success!

      We look forward to the opportunity to work with you and provide the exceptional roofing services your property deserves.

      Best regards,
      Rios Roofing Services
      150 Tallant St, Houston TX 77076
      Phone: 832-310-3593
      Email: rrios.roofing@gmail.com`},{id:"custom",name:"Custom Message",description:"Template with customizable message field for personalized communication",subject:`Quote QT-${pe(t?.quote_number||0)} from Rios Roofing`,message:`Dear ${t?.customer?.first_name||"Customer"},

      Please find your roofing quote attached to this email.

      [CUSTOM MESSAGE - Please customize this section with your specific message]

      Quote Details:
      • Quote Number: QT-${pe(t?.quote_number||0)}
      • Service: ${t?.service?.name||"Roofing Service"}
      ${t?.expiration_date?`• Expires: ${new Date(t.expiration_date).toLocaleDateString()}`:""}
      ${t?.total?`• Total Amount: ${se(t.total)}`:""}

      If you have any questions or would like to proceed with this quote, please contact us at your convenience.

      Best regards,
      Rios Roofing Services
      150 Tallant St, Houston TX 77076
      Phone: 832-310-3593
      Email: rrios.roofing@gmail.com`}],ln=({quote:t,trigger:s})=>{const[a,r]=d.useState(!1),[n,i]=d.useState(!1),[o,l]=d.useState("standard"),[c,u]=d.useState(""),[h,p]=d.useState({showServiceDetails:!0,showMeasurementNote:!0,showCustomerNotes:!0}),g=y=>{p(f=>({...f,[y]:!f[y]}))};console.log("🔍 EmailQuoteDialog - Quote data received:",{quote:t,quoteId:t?.id,quoteNumber:t?.quote_number,quoteTotal:t?.total,subtotal:t?.subtotal,customerEmail:t?.customer?.email,customerName:t?.customer?`${t.customer.first_name} ${t.customer.last_name}`:"Unknown",service:t?.service?.name,status:t?.quote_status?.name||t?.status?.name,expirationDate:t?.expiration_date,lineItems:t?.quote_line_item?.length||0});const N=Jh(t),_=N.find(y=>y.id===o)||N[0],[m,R]=d.useState({to:t?.customer?.email||"",cc:"",subject:_.subject,message:_.message}),{toast:S}=ss(),{sendEmail:E,isInitialized:b,isLoading:O,error:F,checkGmailPermissions:L}=Gi(),H=(y,f)=>{R(M=>({...M,[y]:f}))},ne=y=>{l(y);const f=N.find(M=>M.id===y);if(f){let M=f.message;y==="custom"&&c&&(M=f.message.replace("[CUSTOM MESSAGE - Please customize this section with your specific message]",c)),R(C=>({...C,subject:f.subject,message:M}))}},G=y=>{if(u(y),o==="custom"){const f=N.find(M=>M.id==="custom");if(f){const M=f.message.replace("[CUSTOM MESSAGE - Please customize this section with your specific message]",y);R(C=>({...C,message:M}))}}},Z=y=>{const f=pe(y.quote_number||0),M=y.customer?`${y.customer.first_name}_${y.customer.last_name}`.replace(/\s+/g,"_"):"Unknown_Customer";return`QT-${f}_${M}.pdf`},oe=async y=>{try{if(typeof Zs>"u")throw new Error("Buffer is not available for PDF generation");const f=await mn(e.jsx(er,{quote:y,displayOptions:h})).toBlob();return new Promise((M,C)=>{const W=new FileReader;W.onloadend=()=>{const je=W.result.split(",")[1];M(je)},W.onerror=ge=>{console.error("FileReader error:",ge),C(new Error("Failed to convert PDF blob to base64"))},W.readAsDataURL(f)})}catch(f){throw console.error("Error generating PDF:",f),f instanceof Error?new Error(`PDF generation failed: ${f.message}`):new Error("Failed to generate PDF for email attachment")}},v=async()=>{if(console.log("📧 handleSendEmail - Starting email process:",{emailForm:m,quote:t,quoteTotal:t?.total,subtotal:t?.subtotal,service:t?.service?.name,selectedTemplate:o,customMessage:o==="custom"?c:"N/A"}),!m.to.trim()){S({title:"Validation Error",description:"Please enter a recipient email address.",variant:"destructive"});return}if(!m.subject.trim()){S({title:"Validation Error",description:"Please enter an email subject.",variant:"destructive"});return}if(o==="custom"&&!c.trim()){S({title:"Validation Error",description:"Please enter a custom message for the custom template.",variant:"destructive"});return}i(!0);try{if(!await L()){S({title:"Permission Required",description:"Gmail permissions are required to send emails. Please authorize the application.",variant:"destructive"});return}S({title:"Preparing Email",description:"Generating quote PDF attachment...",variant:"default"});let f,M;try{f=await oe(t),M=Z(t)}catch(B){console.error("PDF generation error:",B),S({title:"PDF Generation Failed",description:B instanceof Error?B.message:"Could not generate PDF attachment. The email will be sent without the PDF.",variant:"destructive"}),f="",M=""}let C="";try{const B=await fetch("/company-logo.svg");if(B.ok){const Se=await B.text();C=Zs.from(Se,"utf-8").toString("base64")}else console.warn("Could not load company logo from /company-logo.svg")}catch(B){console.error("Error loading company logo:",B)}const W=`
        <div style="background-color: #f8fafc; padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid #2563eb;">
          <h3 style="color: #1e40af; margin: 0 0 15px 0; font-size: 18px;">Quote Summary</h3>
          <table style="width: 100%; border-collapse: collapse;">
            <tr>
              <td style="padding: 8px 0; font-weight: bold; color: #374151;">Quote Number:</td>
              <td style="padding: 8px 0; color: #6b7280;">QT-${pe(t?.quote_number||0)}</td>
            </tr>
            <tr>
              <td style="padding: 8px 0; font-weight: bold; color: #374151;">Service:</td>
              <td style="padding: 8px 0; color: #6b7280;">${t?.service?.name||"Roofing Service"}</td>
            </tr>
            <tr>
              <td style="padding: 8px 0; font-weight: bold; color: #374151;">Quote Date:</td>
              <td style="padding: 8px 0; color: #6b7280;">${t?.quote_date?new Date(t.quote_date).toLocaleDateString():"N/A"}</td>
            </tr>
            ${t?.expiration_date?`
            <tr>
              <td style="padding: 8px 0; font-weight: bold; color: #374151;">Expiration Date:</td>
              <td style="padding: 8px 0; color: #dc2626;">${new Date(t.expiration_date).toLocaleDateString()}</td>
            </tr>
            `:""}
            ${t?.subtotal?`
            <tr>
              <td style="padding: 8px 0; font-weight: bold; color: #374151;">Subtotal:</td>
              <td style="padding: 8px 0; color: #6b7280;">${se(t.subtotal)}</td>
            </tr>
            `:""}
            ${t?.total?`
            <tr>
              <td style="padding: 8px 0; font-weight: bold; color: #374151; font-size: 16px;">Total Amount:</td>
              <td style="padding: 8px 0; color: #059669; font-weight: bold; font-size: 16px;">${se(t.total)}</td>
            </tr>
            `:""}
          </table>
          
          ${t?.quote_line_item&&t.quote_line_item.length>0?`
          <div style="margin-top: 20px;">
            <h4 style="color: #1e40af; margin: 0 0 10px 0;">Line Items:</h4>
            <table style="width: 100%; border-collapse: collapse; border: 1px solid #e5e7eb;">
              <thead>
                <tr style="background-color: #f3f4f6;">
                  <th style="padding: 10px; text-align: left; border-bottom: 1px solid #e5e7eb; font-size: 12px; color: #374151;">Description</th>
                  <th style="padding: 10px; text-align: center; border-bottom: 1px solid #e5e7eb; font-size: 12px; color: #374151;">Qty</th>
                  <th style="padding: 10px; text-align: right; border-bottom: 1px solid #e5e7eb; font-size: 12px; color: #374151;">Rate</th>
                  <th style="padding: 10px; text-align: right; border-bottom: 1px solid #e5e7eb; font-size: 12px; color: #374151;">Amount</th>
                </tr>
              </thead>
              <tbody>
                ${t.quote_line_item.map(B=>`
                  <tr>
                    <td style="padding: 10px; border-bottom: 1px solid #f3f4f6; font-size: 12px; color: #374151;">${B.description||"Service Item"}</td>
                    <td style="padding: 10px; text-align: center; border-bottom: 1px solid #f3f4f6; font-size: 12px; color: #6b7280;">${B.qty||1}</td>
                    <td style="padding: 10px; text-align: right; border-bottom: 1px solid #f3f4f6; font-size: 12px; color: #6b7280;">${B.rate?se(B.rate):"N/A"}</td>
                    <td style="padding: 10px; text-align: right; border-bottom: 1px solid #f3f4f6; font-size: 12px; color: #6b7280;">${B.amount?se(B.amount):"N/A"}</td>
                  </tr>
                `).join("")}
              </tbody>
            </table>
          </div>
          `:""}

          ${t?.public_note||t?.cust_note?`
          <div style="margin-top: 15px; padding: 15px; background-color: #fffbeb; border-radius: 6px; border-left: 3px solid #f59e0b;">
            <h4 style="color: #92400e; margin: 0 0 8px 0; font-size: 14px;">Additional Notes:</h4>
            <p style="color: #78350f; margin: 0; font-size: 13px; line-height: 1.5;">${t.public_note||t.cust_note}</p>
          </div>
          `:""}
        </div>
      `,ge=`
        <!DOCTYPE html>
        <html>
        <head>
          <meta charset="utf-8">
          <title>Quote from Rios Roofing</title>
        </head>
        <body style="font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;">
          <div style="text-align: center; margin-bottom: 30px;">
            <img src="data:image/svg+xml;base64,${C}" alt="RiosRoofing Services" style="max-width: 200px; height: auto;">
          </div>
          
          <div style="white-space: pre-line; font-size: 14px; line-height: 1.6; margin-bottom: 30px;">
            ${m.message}
          </div>
          
          ${W}
          
          <div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #e5e7eb; text-align: center; color: #6b7280; font-size: 12px;">
            <p style="margin: 0;">This email was sent from your Rios Roofing management system.</p>
            <p style="margin: 5px 0 0 0;">For questions about this quote, please contact us directly.</p>
          </div>
        </body>
        </html>
      `,je={to:[m.to],cc:m.cc?[m.cc]:void 0,subject:m.subject,htmlBody:ge,attachments:f&&M?[{filename:M,content:f,mimeType:"application/pdf"}]:void 0};console.log("📧 Sending email with data:",{to:je.to,cc:je.cc,subject:je.subject,hasAttachment:!!f,attachmentFilename:M,bodyLength:ge.length}),S({title:"Sending Email",description:"Your quote is being sent...",variant:"default"});const Qe=await E(je);if(Qe.success)S({title:"Email Sent Successfully!",description:`Quote has been sent to ${m.to}`,variant:"default"}),r(!1),R({to:t?.customer?.email||"",cc:"",subject:_.subject,message:_.message}),u(""),l("standard");else throw new Error(Qe.error||"Failed to send email")}catch(y){console.error("Email sending error:",y),S({title:"Failed to Send Email",description:y instanceof Error?y.message:"An unexpected error occurred while sending the email.",variant:"destructive"})}finally{i(!1)}},$=b&&!O,x=F!==null;return e.jsxs(pt,{open:a,onOpenChange:r,children:[e.jsx(ws,{asChild:!0,children:s||e.jsxs(j,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(Is,{className:"h-4 w-4"}),"Email Quote"]})}),e.jsxs(at,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(rt,{children:[e.jsxs(nt,{className:"flex items-center gap-2",children:[e.jsx(Ps,{className:"h-5 w-5"}),"Send Quote via Email"]}),e.jsxs(ot,{children:["Send Quote QT-",pe(t?.quote_number||0)," to"," ",t?.customer?.first_name||"the customer"," with PDF attachment"]})]}),x&&e.jsx("div",{className:"p-4 border border-red-200 rounded-lg bg-red-50",children:e.jsxs("p",{className:"text-sm text-red-600",children:["Gmail service error: ",F,". Please check your authentication."]})}),!$&&!x&&e.jsx("div",{className:"p-4 border border-yellow-200 rounded-lg bg-yellow-50",children:e.jsx("p",{className:"text-sm text-yellow-600",children:"Gmail service is initializing... Please wait."})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"template",children:"Email Template"}),e.jsxs(Ce,{value:o,onValueChange:ne,children:[e.jsx(Ne,{children:e.jsx(_e,{placeholder:"Select email template"})}),e.jsx(Ye,{children:N.map(y=>e.jsx(et,{value:y.id,children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:y.name}),e.jsx("div",{className:"text-sm text-muted-foreground",children:y.description})]})},y.id))})]})]}),o==="custom"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"customMessage",children:"Custom Message *"}),e.jsx(Ae,{id:"customMessage",placeholder:"Enter your custom message here...",value:c,onChange:y=>G(y.target.value),className:"min-h-[100px] resize-none"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This message will replace the placeholder in the custom template."})]}),e.jsx(Jt,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(ae,{className:"text-sm font-medium",children:"PDF Display Options"}),e.jsxs("div",{className:"space-y-3 p-4 bg-muted/30 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ut,{id:"showServiceDetails",checked:h.showServiceDetails,onCheckedChange:()=>g("showServiceDetails")}),e.jsx(ae,{htmlFor:"showServiceDetails",className:"text-sm font-normal cursor-pointer",children:"Show service details"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ut,{id:"showMeasurementNote",checked:h.showMeasurementNote,onCheckedChange:()=>g("showMeasurementNote")}),e.jsx(ae,{htmlFor:"showMeasurementNote",className:"text-sm font-normal cursor-pointer",children:"Show measurement note"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ut,{id:"showCustomerNotes",checked:h.showCustomerNotes,onCheckedChange:()=>g("showCustomerNotes")}),e.jsx(ae,{htmlFor:"showCustomerNotes",className:"text-sm font-normal cursor-pointer",children:"Show customer notes"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"These options control what information is included in the PDF attachment."})]})]}),e.jsx(Jt,{}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"to",children:"To *"}),e.jsx(Q,{id:"to",type:"email",placeholder:"customer@email.com",value:m.to,onChange:y=>H("to",y.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"cc",children:"CC"}),e.jsx(Q,{id:"cc",type:"email",placeholder:"manager@company.com",value:m.cc,onChange:y=>H("cc",y.target.value)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"subject",children:"Subject *"}),e.jsx(Q,{id:"subject",placeholder:"Email subject",value:m.subject,onChange:y=>H("subject",y.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ae,{htmlFor:"message",children:"Message *"}),e.jsx(Ae,{id:"message",placeholder:"Email message",value:m.message,onChange:y=>H("message",y.target.value),className:"min-h-[200px] resize-none"})]})]}),e.jsxs("div",{className:"p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Quote Details (will be included in email):"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:["Quote Number: QT-",pe(t?.quote_number||0)]}),e.jsxs("div",{children:["Service: ",t?.service?.name||"N/A"]}),t?.quote_date&&e.jsxs("div",{children:["Quote Date: ",new Date(t.quote_date).toLocaleDateString()]}),t?.expiration_date&&e.jsxs("div",{children:["Expires: ",new Date(t.expiration_date).toLocaleDateString()]}),t?.total&&e.jsxs("div",{className:"font-medium col-span-2",children:["Total: ",se(t.total)]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(j,{variant:"outline",onClick:()=>r(!1),disabled:n,children:"Cancel"}),e.jsx(j,{onClick:v,disabled:!$||n||x,className:"gap-2",children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ps,{className:"h-4 w-4"}),"Send Quote"]})})]})]})]})]})};function ep({trigger:t,quoteNumber:s,customerName:a,total:r,onConfirm:n,isLoading:i=!1,disabled:o=!1}){const l=c=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(c);return e.jsxs(pi,{children:[e.jsx(fi,{asChild:!0,children:t||e.jsxs(j,{variant:"default",disabled:o,className:"w-full",children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Convert to Invoice"]})}),e.jsxs(br,{children:[e.jsxs(Nr,{children:[e.jsxs(Cr,{className:"flex items-center gap-2",children:[e.jsx(Kr,{className:"w-5 h-5 text-blue-600"}),"Convert Quote to Invoice"]}),e.jsxs(_r,{className:"space-y-2",children:[e.jsxs("p",{children:["Are you sure you want to convert ",e.jsxs("strong",{children:["Quote #",s]})," to an invoice?"]}),a&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Customer:"})," ",a]}),r!==void 0&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Amount:"})," ",l(r)]}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-md p-3 mt-4",children:e.jsxs("p",{className:"text-sm text-amber-800",children:[e.jsx("strong",{children:"⚠️ Important:"})," This action cannot be undone. Once converted, this quote will become an invoice and cannot be edited as a quote."]})})]})]}),e.jsxs(wr,{children:[e.jsx(Tr,{disabled:i,children:"Cancel"}),e.jsx(Sr,{onClick:n,disabled:i,className:"bg-blue-600 hover:bg-blue-700",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Kr,{className:"w-4 h-4 mr-2 animate-spin"}),"Converting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ct,{className:"w-4 h-4 mr-2"}),"Yes, Convert to Invoice"]})})]})]})]})}var tp=ep;function sp(){const{id:t}=tr(),s=vs(),{toast:a}=ss(),r=fe(),n=t?parseInt(t,10):null,i=n!==null&&!isNaN(n)&&n>0,{quoteById:o,isLoading:l,isError:c}=si(i?n:null),{quoteStatuses:u,isLoading:h}=gr(),{mutate:p,isLoading:g}=Fu(a,n),{mutate:N,isLoading:_}=Lu(a,n||0);if(!i)return e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg text-red-500",children:"Invalid quote number in URL"})})});if(l)return e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg",children:"Loading quote..."})})});if(c||!o)return e.jsx("div",{className:"w-full mx-auto py-4",children:e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"text-lg text-red-500",children:"Error loading quote or quote not found"})})});const m=o.subtotal||0,R=o.total||0,S=F=>{switch(F?.toLowerCase()){case"accepted":case"approved":return"green";case"pending":case"draft":return"yellow";case"rejected":case"expired":return"red";case"converted":return"blue";default:return"gray"}},E=()=>o.expiration_date?new Date(o.expiration_date)<new Date:!1,b=F=>{o?.quote_number&&p(parseInt(F,10),{onSuccess:()=>{r.invalidateQueries({queryKey:["quoteById",n]}),r.invalidateQueries({queryKey:["quotes"]})}})},O=()=>{N(void 0,{onSuccess:F=>{const L=F.invoice.invoice_number;setTimeout(()=>{window.confirm(`Quote converted successfully! Invoice #INV-${L} has been created. Would you like to view the new invoice now?`)&&s(`/invoices/${L}`)},1e3)},onError:F=>{if(F.message.includes("Invoice #")){const L=F.message.match(/Invoice #(\d+)/);if(L&&L[1]){const H=L[1];setTimeout(()=>{window.confirm(`This quote has already been converted. Would you like to view the existing Invoice #INV-${H}?`)&&s(`/invoices/${H}`)},1e3)}}}})};return e.jsxs("div",{className:"w-full mx-auto py-4",children:[e.jsx("div",{className:"pt-1 pb-2",children:e.jsx(qa,{currentPage:`Quote #${pe(o.quote_number||0)}`,parentPages:[{label:"Quotes",href:"/quotes"}],homeHref:"/"})}),e.jsxs("div",{className:"flex justify-between gap-4 mb-2 pb-2",children:[e.jsxs("div",{className:"w-full flex gap-2 mt-auto",children:[e.jsx(hi,{quote:o,trigger:e.jsx(j,{size:"icon",variant:"secondary",title:"Edit quote",children:e.jsx($t,{className:"w-[16px]"})})}),e.jsx(j,{size:"icon",variant:"secondary",onClick:()=>window.print(),title:"Print quote",children:e.jsx(Un,{className:"w-[16px]"})}),e.jsx(Zh,{quote:Fh(o),trigger:e.jsx(j,{size:"icon",variant:"secondary",title:"Download PDF",children:e.jsx(ya,{className:"w-[16px]"})})}),e.jsx(ln,{quote:o,trigger:e.jsx(j,{size:"icon",variant:"secondary",title:"Email quote",children:e.jsx(Ba,{className:"w-[16px]"})})})]}),e.jsx("div",{className:"w-full flex justify-end gap-4",children:e.jsxs("div",{className:"w-fit",children:[e.jsx(ae,{children:"Status"}),e.jsxs(Ce,{value:o?.status_id?.toString()||"",onValueChange:b,disabled:g||h,children:[e.jsx(Ne,{className:"w-[180px]",children:e.jsx(_e,{placeholder:g?"Updating...":"Select a status"})}),e.jsx(Ye,{position:"popper",children:e.jsxs(ko,{children:[e.jsx(xr,{children:"Quote Status"}),u?.map(F=>e.jsx(et,{value:F.id.toString(),children:F.name},F.id))]})})]})]})})]}),e.jsxs("div",{className:"w-full flex lg:flex-row flex-col gap-4",children:[e.jsxs(Y,{className:"dark:bg-zinc-900 w-full",children:[e.jsx(re,{children:e.jsxs("div",{className:"w-full flex flex-col sm:flex-row sm:justify-between md:px-6 md:pt-5",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-[50px] h-max bg-blue-600 rounded-2xl transition ease-in-out duration-300 hover:scale-105",children:e.jsx(Pe,{to:"/",children:e.jsx("img",{src:"/company-logo.png",className:"shadow-xs p-[0px] rounded-2xl"})})}),e.jsxs("div",{className:"text-md sm:text-lg font-semibold text-gray-700 dark:text-zinc-100",children:[e.jsx("p",{className:"",children:"Rios Roofing"}),e.jsx("p",{className:"-mt-2",children:"Services"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:text-right",children:[e.jsx(de,{className:"w-fit mt-6 sm:mt-0 sm:ml-auto",variant:S(o.quote_status?.name||""),children:o.quote_status?.name||"Unknown"}),e.jsxs("p",{className:"text-lg font-medium",children:["QT-",pe(o.quote_number||0)]})]})]})}),e.jsx(X,{children:e.jsxs("div",{className:"flex flex-col sm:px-6 pb-6 w-full",children:[e.jsxs("div",{className:"flex w-full justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Us,{className:"w-4 h-4 my-auto"}),e.jsx("p",{className:"text-sm text-gray-500 align-middle",children:"Customer"})]}),e.jsx("div",{className:"flex my-2 pt-1 pb-2 gap-4",children:e.jsxs(Pe,{to:`/customers/${o.customer_id}`,className:"cursor-pointer hover:opacity-80 transition-opacity flex gap-4",title:"View customer details",children:[e.jsx(Rt,{children:e.jsx(kt,{children:`${(o.customer?.first_name||"").substring(0,1)}${(o.customer?.last_name||"").substring(0,1)}`})}),e.jsxs("div",{className:"text-sm",children:[e.jsxs("p",{className:"font-medium",children:[o.customer?.first_name||""," ",o.customer?.last_name||""]}),e.jsx("p",{className:"font-light",children:o.customer?.email||""})]})]})})]}),e.jsxs("div",{className:"text-sm text-right",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Qn,{className:"w-4 h-4 my-auto"}),e.jsx("p",{className:"text-sm text-gray-500 mb-0",children:"Service"})]}),e.jsx("p",{className:"font-medium",children:o.service?.name||"Unknown Service"})]})]}),e.jsxs("div",{className:"w-full flex flex-col sm:flex-row justify-between gap-4 py-2",children:[e.jsxs("div",{className:"w-full text-left",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Quote From"}),e.jsx("p",{className:"mb-1 font-medium",children:"Rios Roofing"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:"150 Tallant St, Houston TX 77076"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:"rrios.roofing@gmail.com"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:"832-310-3593"}),e.jsxs("div",{className:"my-6 text-left",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Quote Date"}),e.jsx("p",{className:"font-medium",children:o.quote_date?wt(o.quote_date):"N/A"})]})]}),e.jsxs("div",{className:"w-full text-left",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Quote To"}),e.jsxs("p",{className:"mb-1 font-medium",children:[o.customer?.first_name||""," ",o.customer?.last_name||""]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:[o.custom_street_address||o.customer?.street_address,[o.custom_city||o.customer?.city,o.custom_state||o.customer?.state,o.custom_zipcode||o.customer?.zipcode].filter(Boolean).join(", ")].filter(Boolean).join(", ")||"No address provided"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:o.customer?.email||""}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-200",children:o.customer?.phone_number||""}),e.jsxs("div",{className:"text-left my-6",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Expiration Date"}),e.jsx("p",{className:`font-medium ${E()?"text-red-600":""}`,children:o.expiration_date?wt(o.expiration_date):"N/A"})]})]})]}),e.jsx("div",{className:"overflow-hidden border border-gray-200 dark:border-zinc-800 rounded-lg",children:e.jsxs(is,{children:[e.jsx(ls,{className:"bg-gray-50 dark:bg-zinc-800",children:e.jsxs(We,{children:[e.jsx(he,{className:"w-[100px]",children:"#"}),e.jsx(he,{children:"Description"}),e.jsx(he,{className:"text-right",children:"Qty"}),e.jsx(he,{className:"text-right",children:"Rate"}),e.jsx(he,{className:"text-right",children:"Total"})]})}),e.jsx(cs,{children:o.quote_line_item&&o.quote_line_item.length>0?o.quote_line_item.map((F,L)=>e.jsxs(We,{children:[e.jsx(ue,{children:L+1}),e.jsx(ue,{children:e.jsx("p",{className:"font-medium",children:F.description||"No description"})}),e.jsx(ue,{className:"text-right",children:F.qty||0}),e.jsx(ue,{className:"text-right",children:"Fixed"}),e.jsxs(ue,{className:"text-right",children:["$",se(F.amount||0)]})]},F.id)):e.jsxs(We,{children:[e.jsx(ue,{children:"1"}),e.jsxs(ue,{children:[e.jsx("p",{className:"font-medium",children:o.service?.name||"Roofing Service"}),o.measurement_note&&e.jsx("p",{className:"text-sm text-gray-500",children:o.measurement_note})]}),e.jsx(ue,{className:"text-right",children:"1"}),e.jsx(ue,{className:"text-right",children:"Fixed"}),e.jsxs(ue,{className:"text-right",children:["$",se(o.total||0)]})]})})]})}),e.jsx("div",{className:"flex justify-end mt-6",children:e.jsxs("div",{className:"w-72 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Subtotal"}),e.jsxs("span",{className:"font-medium",children:["$",se(m)]})]}),e.jsxs("div",{className:"flex justify-between text-base border-t border-gray-200 dark:border-gray-700 pt-2",children:[e.jsx("span",{className:"font-semibold",children:"Total"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:["$",se(R)]})]})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"text-sm font-medium",children:"NOTES"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:o.public_note||o.cust_note||"No customer notes added"})]}),e.jsxs("div",{className:"flex justify-between items-center mt-10 text-sm text-gray-600",children:[e.jsx("div",{}),e.jsxs("div",{children:[e.jsx("p",{children:"Have a Question?"}),e.jsx("a",{href:"mailto:rrios.roofing@gmail.com",className:"text-blue-600",children:"rrios.roofing@gmail.com"})]})]})]})})]}),e.jsx(Y,{className:"w-full lg:w-1/3 h-fit",children:e.jsx(X,{children:e.jsxs("div",{className:"flex flex-col sm:px-0 pb-6 w-full",children:[e.jsxs("div",{className:"mt-8",children:[e.jsx("p",{className:"text-sm font-medium my-4",children:"Quote Information"}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-400 font-medium",children:"Quote Total"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-700 dark:text-blue-300",children:["$",se(R)]})]}),e.jsx(de,{variant:o.converted||o.quote_status?.name?.toLowerCase()==="accepted"?"green":E()?"red":"blue",className:"text-sm",children:o.converted?"Converted":o.quote_status?.name?.toLowerCase()==="accepted"?"Accepted Quote":E()?"Expired Quote":"Active Quote"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Status:"}),e.jsx(de,{variant:S(o.quote_status?.name||""),children:o.quote_status?.name||"Unknown"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Issue Date:"}),e.jsx("span",{className:"text-sm font-medium",children:o.issue_date?wt(o.issue_date):"N/A"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Expires:"}),e.jsx("span",{className:`text-sm font-medium ${E()?"text-red-600":""}`,children:o.expiration_date?wt(o.expiration_date):"N/A"})]}),o.converted&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Converted:"}),e.jsxs(de,{variant:"green",className:"text-xs",children:[e.jsx(ct,{className:"w-3 h-3 mr-1"}),"To Invoice"]})]})]})}),!o.converted&&!E()&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(tp,{quoteNumber:o.quote_number,customerName:`${o.customer?.first_name} ${o.customer?.last_name}`,total:o.total,onConfirm:O,isLoading:_}),e.jsx(ln,{quote:o,trigger:e.jsxs(j,{className:"w-full",variant:"outline",children:[e.jsx(Ba,{className:"w-4 h-4 mr-2"}),"Send Quote"]})})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("p",{className:"text-sm font-medium my-4",children:"Private Note"}),e.jsx(Ae,{className:"min-h-[200px]",value:o.private_note||"",placeholder:"No private notes added",readOnly:!0})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("p",{className:"text-sm font-medium my-4",children:"Measurement Note"}),e.jsx(Ae,{className:"min-h-[200px]",value:o.measurement_note||"",placeholder:"No measurement notes added",readOnly:!0})]})]})})})]})]})}const rl=document.getElementById("app");if(!rl)throw new Error("Failed to find the root element");const ap=Mc.createRoot(rl),rp=new Sc;ap.render(e.jsx(Uc,{defaultTheme:"system",storageKey:"vite-ui-theme",children:e.jsx(Tc,{client:rp,children:e.jsx(ll,{children:e.jsx(Vc,{children:e.jsx(kh,{children:e.jsxs(cl,{children:[e.jsx($e,{path:"/login",element:e.jsx(Yc,{})}),e.jsx($e,{path:"/",element:e.jsx(Xe,{children:e.jsx(Ku,{})})}),e.jsx($e,{path:"/customers",element:e.jsx(Xe,{children:e.jsx(Ju,{})})}),e.jsx($e,{path:"/jobs",element:e.jsx(Xe,{children:e.jsx(tm,{})})}),e.jsx($e,{path:"/quotes",element:e.jsx(Xe,{children:e.jsx(Um,{})})}),e.jsx($e,{path:"/quotes/:id",element:e.jsx(Xe,{children:e.jsx(sp,{})})}),e.jsx($e,{path:"/invoices",element:e.jsx(Xe,{children:e.jsx(Hm,{})})}),e.jsx($e,{path:"/invoices/:id",element:e.jsx(Xe,{children:e.jsx(Xh,{})})}),e.jsx($e,{path:"/inbox",element:e.jsx(Xe,{children:e.jsx(Xm,{})})}),e.jsx($e,{path:"/customers/:id",element:e.jsx(Xe,{children:e.jsx(rx,{})})}),e.jsx($e,{path:"/data-management",element:e.jsx(Xe,{children:e.jsx(mx,{})})}),e.jsx($e,{path:"/data-management/services",element:e.jsx(Xe,{children:e.jsx(vx,{})})}),e.jsx($e,{path:"/data-management/statuses",element:e.jsx(Xe,{children:e.jsx(zx,{})})}),e.jsx($e,{path:"/data-management/customer-types",element:e.jsx(Xe,{children:e.jsx(rh,{})})}),e.jsx($e,{path:"/profile",element:e.jsx(Xe,{children:e.jsx(nh,{})})}),e.jsx($e,{path:"/404",element:e.jsx(Ux,{})}),e.jsx($e,{path:"*",element:e.jsx(pn,{to:"/404"})})]})})})})})}));
